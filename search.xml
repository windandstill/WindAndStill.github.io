<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>REST风格</title>
      <link href="/javaee/spring/utils/rest-feng-ge/"/>
      <url>/javaee/spring/utils/rest-feng-ge/</url>
      
        <content type="html"><![CDATA[<h1>1. REST简介</h1><blockquote><p><code>REST</code>(Representational State Transfer)，表现形式转换</p></blockquote><ul><li><p>传统风格资源描述形式</p><p>localhost/user/<code>get</code>ById?id=1</p><p>localhost/user/<code>save</code>User</p></li><li><p>REST风格描述形式</p><p>localhost/users/1</p><p>localhost/user/users</p></li></ul><blockquote><p>优点</p></blockquote><ol><li>隐藏资源的访问行为，无法通过地址得知对资源是何种操纵</li><li>书写简化</li></ol><h1>2. 约定方式</h1><table><thead><tr><th style="text-align:center">请求路径</th><th style="text-align:center">行为动作</th><th style="text-align:center">请求方法</th></tr></thead><tbody><tr><td style="text-align:center">localhost/users</td><td style="text-align:center">查询全部用户信息</td><td style="text-align:center">GET（查询）</td></tr><tr><td style="text-align:center">localhost/users/1</td><td style="text-align:center">查询指定用户信息</td><td style="text-align:center">GET（查询）</td></tr><tr><td style="text-align:center">localhost/users</td><td style="text-align:center">添加用户信息</td><td style="text-align:center">POST（新增/保存）</td></tr><tr><td style="text-align:center">localhost/users</td><td style="text-align:center">修改用户信息</td><td style="text-align:center">PUT（修改/更新）</td></tr><tr><td style="text-align:center">localhost/users/1</td><td style="text-align:center">删除用户信息</td><td style="text-align:center">DELETE（删除）</td></tr></tbody></table><blockquote><p>注意事项</p></blockquote><p>上述行为是约定方式，约定不是规范，可以打破，所以称REST风格，而不是REST规范</p><p>描述模块的名称通常使用复数，也就是加s的格式描述，表示此类资源，而非单个资源<br>例如: users、 books、accounts…</p><h1>3. 入门案例</h1><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>{</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = "/users",method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@RessponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>{</span><br><span class="line">        System.out.println(<span class="string">"user save...."</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user save'}"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = "/users/{id}",method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="meta">@RessponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>{</span><br><span class="line">        System.out.println(<span class="string">"user delete...."</span> + id)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user delete'}"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = "/users",method = RequestMethod.PUT)</span></span><br><span class="line">    <span class="meta">@RessponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>{</span><br><span class="line">        System.out.println(<span class="string">"user update...."</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user update'}"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = "/users/{id}",method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@RessponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>{</span><br><span class="line">        System.out.println(<span class="string">"user getById...."</span> + id)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user getById'}"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = "/users",method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@RessponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAll</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"user getAll...."</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user getAll'}"</span></span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>@RequestBody@RequestParam@PathVariable</p></blockquote><p>区别</p><ul><li>@RequestBody用于接收json数据</li><li>@RequestParam用于接收url地址传参或表单传参</li><li>@PathVariable用于接收路径参数，使用（参数名称）描述路径参数</li></ul><p>应用</p><ul><li>后期开发中，发送请求参数超过1个时，以json格式为主, @RequestBody应用较广</li><li>如果发送非json格式数据，选用@RequestParam接收请求参数</li><li>采用RESTful进行开发，当参数数量较少时，例如1个，可以采用@PathVariable接收请求路径变量， 通常用于传递id值</li></ul><h1>4. 快速开发</h1><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/users")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>{</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>{</span><br><span class="line">        System.out.println(<span class="string">"user save...."</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user save'}"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping("/{id}")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>{</span><br><span class="line">        System.out.println(<span class="string">"user delete...."</span> + id)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user delete'}"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>{</span><br><span class="line">        System.out.println(<span class="string">"user update...."</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user update'}"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping("/{id}")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>{</span><br><span class="line">        System.out.println(<span class="string">"user getById...."</span> + id)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user getById'}"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAll</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"user getAll...."</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"{'mpdule':'user getAll'}"</span></span><br><span class="line">    }  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>名称: @GetMapping @PostMapping @PutMapping @DeleteMapping</li><li>类型:方法注解</li><li>位置:基于SpringMVC的RESTful1开发控制器方法定义上方</li><li>作用:设置当前控制器方法请求访问路径与请求动作,每种对应-个请求动作, 例如@GetMapping对应GET请求</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
          <category> Utils </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> Utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot(一) 入门概念</title>
      <link href="/javaee/spring/springboot/springboot-yi-ru-men-gai-nian/"/>
      <url>/javaee/spring/springboot/springboot-yi-ru-men-gai-nian/</url>
      
        <content type="html"><![CDATA[<h1>1. 快速入门</h1><h2 id="1-1-基础配置">1.1 基础配置</h2><blockquote><p>最简SpringBoot程序所包含的基础文件</p></blockquote><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">pom.xml文件</button></li><li class="tab"><button type="button" data-href="#1-2">Application类</button></li><li class="tab"><button type="button" data-href="#1-3">测试类</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.jyw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo01<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo04<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo01Application</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(Demo01Application.class, args);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Rest模式</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/books")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> {</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"springboot is running..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"springboot is running..."</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>Spring程序与SpringBoot程序对比</p></blockquote><table><thead><tr><th style="text-align:center">类/配置文件</th><th style="text-align:center">Spring</th><th style="text-align:center">SpringBoot</th></tr></thead><tbody><tr><td style="text-align:center">pom文件中的坐标</td><td style="text-align:center">手工添加</td><td style="text-align:center">勾选添加</td></tr><tr><td style="text-align:center">web3.0配置类</td><td style="text-align:center">手工制作</td><td style="text-align:center">无</td></tr><tr><td style="text-align:center">Spring/SpringMVC配置类</td><td style="text-align:center">手工制作</td><td style="text-align:center">无</td></tr><tr><td style="text-align:center">控制器</td><td style="text-align:center">手工制作</td><td style="text-align:center">手工制作</td></tr></tbody></table><h2 id="1-2-SpringBoot简介">1.2 SpringBoot简介</h2><p>SpringBoot是由Pivotal团队提供的全新框架，其设计目的是用来<code>简化</code>Spring应用的<code>初始搭建</code>以及<code>开发过程</code></p><ul><li>Spring程序缺点<ul><li>依赖设置繁琐</li><li>配置繁琐</li></ul></li><li>SpringBoot程序优点<ul><li>起步依赖（简化依赖配置）</li><li>自动配置（简化常用工程相关配置）</li><li>辅助功能（内置服务器，……）</li></ul></li></ul><h2 id="1-3-入门pom解析">1.3 入门pom解析</h2><blockquote><p>parent</p></blockquote><ol><li>开发SpringBoot程序要继承spring-boot-starter-parent</li><li>spring-boot-starter-parent中定义了若干个依赖管理</li><li>继承parent模块可以<code>避免</code>多个依赖使用相同技术时出现<code>依赖</code>版本冲突</li><li>继承parent的形式也可以采用引入依赖的形式实现效果</li></ol><blockquote><p>starter</p></blockquote><p>SpringBoot中常见项目名称，定义了当前项目使用的所有依赖坐标，以达到减少依赖配置的目的</p><ol><li>开发SpringBoot程序需要导入坐标时通常导入对应的starter</li><li>每个不同的starter根据功能不同，通常包含多个依赖坐标</li><li>使用starter可以实现快速配置的效果，达到简化配置的目的</li></ol><p>对比parent</p><ul><li>starter<ul><li>SpringBoot中常见项目名称，定义了当前项目使用的所有依赖坐标，以达到减少依赖配置的目的</li></ul></li><li>parent<ul><li>所有SpringBoot项目要继承的项目，定义了若干个坐标版本号（依赖管理，而非依赖），以达到减少依赖冲突的目的</li><li>spring-boot-starter-parent各版本间存在着诸多坐标版本不同</li></ul></li><li>实际开发</li><li>使用任意坐标时，仅书写GAV中的G和A，V由SpringBoot提供，除非SpringBoot未提供对应版本V</li><li>如发生坐标错误，再指定Version（要小心版本冲突）</li></ul><blockquote><p>引导类</p></blockquote><ul><li>SpringBoot的引导类是Boot工程的执行入口，运行main方法就可以启动项目</li><li>SpringBoot工程运行后初始化Spring容器，扫描引导类所在包加载bean</li></ul><blockquote><p>内嵌tomcat</p></blockquote><ol><li>内嵌Tomcat服务器是SpringBoot辅助功能之一</li><li>内嵌Tomcat工作原理是将Tomcat服务器作为对象运行，并 将该对象交给Spring容器管理</li><li>变更内嵌服务器思想是去除现有服务器，添加全新的服务器</li></ol><ul><li>使用maven依赖管理变更起步依赖项</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;!--web起步依赖环境中，排除Tomcat起步依赖--&gt;</span><br><span class="line">        &lt;exclusions&gt;</span><br><span class="line">            &lt;exclusion&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;</span><br><span class="line">            &lt;/exclusion&gt;</span><br><span class="line">        &lt;/exclusions&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!--添加Jetty起步依赖，版本由SpringBoot的starter控制--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></tbody></table></figure><ul><li>Jetty比Tomcat更轻量级，可扩展性更强（相较于Tomcat），谷歌应用引擎（GAE）已经全面切换为Jetty</li></ul><blockquote><p>内置服务器</p></blockquote><p>tomcat(默认)apache出品，粉丝多，<code>应用面广</code>，负载了若干较重的组件</p><p>jetty   <code>更轻量级</code>，负载性能远不及tomcat</p><p>undertow     undertow，负载性能<code>勉强</code>跑赢tomcat</p><h1>2. 基础配置</h1><h2 id="2-1-application-properties">2.1 application.properties</h2><blockquote><p>修改配置 application.properties</p></blockquote><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改服务器端口</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#关闭运行日志图标（banner）</span></span><br><span class="line"><span class="attr">spring.main.banner-mode</span>=<span class="string">off</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#设置日志相关</span></span><br><span class="line"><span class="attr">logging.level.root</span>=<span class="string">debug</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>SpringBoot内置属性查询</p></blockquote><ul><li><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#application-properties">https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html#application-properties</a></p></li><li><p>官方文档中参考文档第一项：Application Properties</p></li></ul><blockquote><p>注意</p></blockquote><ol><li>SpringBoot中导入对应starter后，提供对应配置属性</li><li>书写SpringBoot配置采用关键字+提示形式书写</li></ol><h2 id="2-2-3种配置文件的格式">2.2 3种配置文件的格式</h2><ul><li>application.properties</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></tbody></table></figure><ul><li>application.yml(主流)</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br></pre></td></tr></tbody></table></figure><ul><li>application.yaml</li></ul><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">82</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>SpringBoot配置文件加载顺序</p></blockquote><p>application.properties &gt; application.yml &gt; application.yaml</p><blockquote><p>注意</p></blockquote><p>不同配置文件中相同配置按照加载优先级相互覆盖，不同配置文件中不同配置全部保留</p><h2 id="2-3-yaml">2.3 yaml</h2><h3 id="2-3-1-介绍">2.3.1 介绍</h3><p>YAML（YAML Ain’t Markup Language），一种数据序列化格式</p><p>优点：</p><ol><li>容易阅读</li><li>容易与脚本语言交互</li><li>以数据为核心，重数据轻格式</li></ol><p>YAML文件扩展名</p><ol><li>.yml（主流）</li><li>.yaml</li></ol><h3 id="2-3-2-yaml语法规则">2.3.2 yaml语法规则</h3><ul><li>大小写敏感</li><li>属性层级关系使用多行描述，每行结尾使用冒号结束</li><li>使用缩进表示层级关系，同层级左侧对齐，只允许使用空格（不允许使用Tab键）</li><li>属性值前面添加空格（属性名与属性值之间使用冒号+空格作为分隔）</li><li># 表示注释</li><li>核心规则：数据前面要加空格与冒号隔开</li></ul><blockquote><p>字面值表示方式</p></blockquote><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">boolean:</span> <span class="literal">TRUE</span>                       <span class="comment">#TRUE,true,True,FALSE,false，False均可</span></span><br><span class="line"><span class="attr">float:</span> <span class="number">3.14</span>                         <span class="comment">#6.8523015e+5 #支持科学计数法</span></span><br><span class="line"><span class="attr">int:</span> <span class="number">123</span>                            <span class="comment">#0b1010_0111_0100_1010_1110 #支持二进制、八进制、十六进制</span></span><br><span class="line"><span class="attr">null:</span> <span class="string">~</span>                             <span class="comment">#使用~表示null</span></span><br><span class="line"><span class="attr">string:</span> <span class="string">HelloWorld</span>                  <span class="comment">#字符串可以直接书写</span></span><br><span class="line"><span class="attr">string2:</span> <span class="string">"Hello World"</span>              <span class="comment">#可以使用双引号包裹特殊字符</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2018-02-17</span>                    <span class="comment">#日期必须使用yyyy-MM-dd格式</span></span><br><span class="line"><span class="attr">datetime:</span> <span class="number">2018-02-17T15:02:31+08:00</span> <span class="comment">#时间和日期之间使用T连接，最后使用+代表时区</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>数组表示方式：在属性名书写位置的下方使用减号作为数据开始符号，每行书写一个数据，减号与数据间空格分隔</p></blockquote><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subject:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">Java</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">前端</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">大数据</span></span><br><span class="line"><span class="attr">enterprise:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">itcast</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">16</span></span><br><span class="line">  <span class="attr">subject:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Java</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">前端</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">大数据</span></span><br><span class="line"><span class="attr">likes:</span> [<span class="string">王者荣耀</span>,<span class="string">刺激战场</span>] <span class="comment">#数组书写缩略格式</span></span><br><span class="line"></span><br><span class="line"><span class="attr">users:</span> <span class="comment">#对象数组格式</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Tom</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">4</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Jerry</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">users:</span> <span class="comment">#对象数组格式二</span></span><br><span class="line">  <span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Tom</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">4</span></span><br><span class="line">  <span class="bullet">-</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Jerry</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">users2:</span> [ { <span class="string">name:Tom</span> , <span class="string">age:4</span> } , { <span class="string">name:Jerry</span> , <span class="string">age:5</span> } ]  <span class="comment">#对象数组缩略格式</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2-3-3-yaml数据读取">2.3.3 yaml数据读取</h3><blockquote><p>在配置文件中</p></blockquote><p>使用属性名引用方式引用属性</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">baseDir:</span> <span class="string">/usr/local/fire</span></span><br><span class="line"><span class="attr">center:</span></span><br><span class="line">  <span class="attr">dataDir:</span> <span class="string">${baseDir}/data</span></span><br><span class="line"></span><br><span class="line"><span class="attr">lesson:</span> <span class="string">"Spring\tboot\nlesson"</span>  <span class="comment">#属性值中如果出现转义字符，需要使用双引号包裹</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>在java 文件中</p></blockquote><ol><li><p>使用@Value读取单个数据，属性名引用方式：${一级属性名.二级属性名……}</p></li><li><p>封装全部数据到Environment对象</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用自动装配注入Environment对象</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Environment env;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用对象的getProperty</span></span><br><span class="line">System.out.println(env.getProperty(<span class="string">"age"</span>));</span><br><span class="line">System.out.println(env.getProperty(<span class="string">"enterprise.name"</span>));</span><br><span class="line">System.out.println(env.getProperty(<span class="string">"enterprise.subject[0]"</span>));</span><br></pre></td></tr></tbody></table></figure></li><li><p>自定义对象封装指定数据的作用</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span><span class="comment">//要启用spring的管理才能实现</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = "enterprise")</span><span class="comment">//读取配置文件中前缀为enterprise的数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Enterprise</span> {</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String[] subject;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ol><h1>3. 整合第三方技术</h1><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">整合Junit</button></li><li class="tab"><button type="button" data-href="#1-2">整合MyBatis</button></li><li class="tab"><button type="button" data-href="#1-3">整合MyBatis-Plus 或者 通用Mapper</button></li><li class="tab"><button type="button" data-href="#1-4">整合Druid</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><blockquote><p>@SpringBootTest(测试类注解)</p></blockquote><p>位置：测试类定义上方</p><p>作用：设置JUnit加载的SpringBoot启动类</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(classes = SpringbootJUnitApplication.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootJUnitApplicationTests</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>注意</p></blockquote><ol><li>测试类如果存在于引导类所在包或子包中无需指定引导类</li><li>测试类如果不存在于引导类所在的包或子包中需要通过classes 属性指定引导类</li><li>如果测试类在SpringBoot启动类的包或子包中，可以省略启动类的设置，也就是省略classes的设定</li></ol><blockquote><p>整合方法</p></blockquote><ol><li>导入测试对应的starter</li><li>测试类使用@SpringBootTest修饰</li><li>使用自动装配的形式添加要测试的对象</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><ol><li>勾选MyBatis技术，也就是导入MyBatis对应的starter</li><li>数据库连接相关信息转换成配置</li><li>数据库SQL映射需要添加@Mapper被容器识别到</li></ol><blockquote><ol><li>引入依赖</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>配置信息</li></ol><p>注意:SpringBoot版本低于2.4.3(不含)，Mysql驱动版本大于8.0时，需要在url连接串中配置时区</p><p>jdbc:mysql://localhost:3306/kangan?serverTimezone=UTC</p></blockquote><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql:///kangan</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="3"><li>定义数据层接口与映射配置</li></ol></blockquote><p>需要在引导启动类上面规定mapper空间</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan("cn.jyw.demo03.mapper")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo03Application</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        SpringApplication.run(Demo03Application.class);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>或者</p><p>在mapper接口层上添加@Mapper注解</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Mapper</span><br><span class="line">public interface UserMapper {</span><br><span class="line">    User findById(Integer id);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><ol><li>手工添加对应的starter</li><li>数据层接口使用BaseMapper简化开发</li><li>需要使用的第三方技术无法通过勾选确定时，需要手工添加坐标</li></ol><blockquote><ol><li>手动添加坐标,引入依赖</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>        </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--或者--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>定义数据接口与映射配置,继承<code>BaseMapper</code></li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="3"><li>在实体类上添加@Table 注解标注是数据库里的那一张表</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Table(name = "t_user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> Date birthday;</span><br><span class="line">  <span class="keyword">private</span> String gender;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> String password;</span><br><span class="line">  <span class="keyword">private</span> String remark;</span><br><span class="line">  <span class="keyword">private</span> String station;</span><br><span class="line">  <span class="keyword">private</span> String telephone;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> {</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Date <span class="title function_">getBirthday</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> birthday;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBirthday</span><span class="params">(Date birthday)</span> {</span><br><span class="line">    <span class="built_in">this</span>.birthday = birthday;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getGender</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> gender;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(String gender)</span> {</span><br><span class="line">    <span class="built_in">this</span>.gender = gender;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> username;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> {</span><br><span class="line">    <span class="built_in">this</span>.username = username;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> password;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> {</span><br><span class="line">    <span class="built_in">this</span>.password = password;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getRemark</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> remark;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRemark</span><span class="params">(String remark)</span> {</span><br><span class="line">    <span class="built_in">this</span>.remark = remark;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getStation</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> station;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStation</span><span class="params">(String station)</span> {</span><br><span class="line">    <span class="built_in">this</span>.station = station;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getTelephone</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> telephone;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTelephone</span><span class="params">(String telephone)</span> {</span><br><span class="line">    <span class="built_in">this</span>.telephone = telephone;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其他同MyBatis</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><ol><li>整合Druid需要导入Druid对应的starter</li><li>根据Druid提供的配置方式进行配置</li></ol><blockquote><ol><li>手动添加坐标,引入依赖</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>配置文件</p></blockquote><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#变更Druid的配置方式 ()</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span> </span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql:///kangan</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"><span class="comment">#指定数据源类型 不推荐</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql:///kangan</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>整合第三方技术通用方式</p><ul><li>导入对应的starter</li><li>根据提供的配置格式，配置非默认值对应的配置项</li></ul><h1>4. 基于SpringBoot的SSMP整合</h1><h2 id="4-1-模块创建">4.1 模块创建</h2><ol><li>勾选SpringMVC与MySQL坐标</li><li>修改配置文件为yml格式</li><li>设置端口为80方便访问</li></ol><h2 id="4-2-实体类的开发">4.2 实体类的开发</h2><blockquote><p>Lombok，一个Java类库，提供了一组注解，简化POJO实体类开发(可以在创建模块的时候勾选上)</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>常用注解：@Data</p><p>为当前实体类在编译期设置对应的get/set方法，toString方法，hashCode方法，equals方法等</p><p><code>但是构造方法不在@Data内</code></p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> {</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="4-3-数据层开发">4.3 数据层开发</h2><ol><li>导入MyBatisPlus与Druid对应的starter</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>配置数据源与MyBatisPlus对应的基础配置</li></ol><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/ssm_db?servierTimezone=UTC</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#为方便调试可以开启MyBatisPlus的日志</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">tbl_</span> <span class="comment">#手动添加前缀 方便后面不用写前缀</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span> <span class="comment">#id生成策略使用数据库自增策略</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="comment">#为方便调试可以开启MyBatisPlus的日志</span></span><br></pre></td></tr></tbody></table></figure><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">分页功能</button></li><li class="tab"><button type="button" data-href="#1-2">条件查询功能</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><blockquote><p>MyBatisPlus拦截器实现</p></blockquote><p>分页操作是在MyBatisPlus的常规操作基础上增强得到，内部是动态的拼写SQL语句，因此需要增强对应的功能， 使用MyBatisPlus拦截器实现</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MpConfig</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mpInterceptor</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">//1.定义Mp拦截器</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mpInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//2.添加具体的拦截器</span></span><br><span class="line">        mpInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mpInterceptor;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>分页操作需要设定分页对象IPage</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetPage</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">IPage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">1</span>,<span class="number">5</span>);<span class="comment">//在MP里已经有IPage对象了</span></span><br><span class="line">    bookDao.selectPage(page,<span class="literal">null</span>);</span><br><span class="line">    System.out.println(page.getCurrent());<span class="comment">//当前页码值</span></span><br><span class="line">    System.out.println(page.getSize());<span class="comment">//每页数据总量</span></span><br><span class="line">    System.out.println(page.getTotal());<span class="comment">//数据总量</span></span><br><span class="line">    System.out.println(page.getPages());<span class="comment">//最大页码值</span></span><br><span class="line">    System.out.println(page.getRecords());<span class="comment">//数据</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>使用QueryWrapper对象封装查询条件，推荐使用LambdaQueryWrapper对象，所有查询操作封装成方法调用</p><blockquote><p>支持动态拼写查询条件</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetByCondition</span><span class="params">()</span>{</span><br><span class="line">    String name=<span class="string">"Spring"</span>;</span><br><span class="line">    <span class="type">IPage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(<span class="number">1</span>,<span class="number">10</span>);</span><br><span class="line">    LambdaQueryWrapper&lt;Book&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;Book&gt;();</span><br><span class="line">    <span class="comment">//like操作 判断拼接条件 对应的字段名称 条件</span></span><br><span class="line">    lqw.like(Strings.isNotEmpty(name),Book::getName,name);</span><br><span class="line">    bookDao.selectPage(page,lqw);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>QueryWrapper 也可以这样做 但是没有 LambdaQueryWrapper安全</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testGetByCondition</span><span class="params">()</span>{</span><br><span class="line">    QueryWrapper&lt;Book&gt; qw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Book&gt;();</span><br><span class="line">    qw.like(<span class="string">"name"</span>,<span class="string">"Spring"</span>);</span><br><span class="line">    bookDao.selectList(qw);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="4-4-业务层开发">4.4 业务层开发</h2><blockquote><p>定义接口</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> {</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">save</span><span class="params">(Book book)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">update</span><span class="params">(Book book)</span>;</span><br><span class="line">    Book <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br><span class="line">    List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span>;</span><br><span class="line">    IPage&lt;Book&gt; <span class="title function_">getByPage</span><span class="params">(<span class="type">int</span> currentPage,<span class="type">int</span> pageSize)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>实现类定义</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">save</span><span class="params">(Book book)</span> {</span><br><span class="line">    <span class="keyword">return</span> bookDao.insert(book) &gt; <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">delete</span><span class="params">(Integer id)</span> {</span><br><span class="line">    <span class="keyword">return</span> bookDao.deleteById(id) &gt; <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">update</span><span class="params">(Book book)</span> {</span><br><span class="line">    <span class="keyword">return</span> bookDao.updateById(book) &gt; <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getById</span><span class="params">(Integer id)</span> {</span><br><span class="line">    <span class="keyword">return</span> bookDao.selectById(id);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> List&lt;Book&gt; <span class="title function_">getAll</span><span class="params">()</span> {</span><br><span class="line">    <span class="keyword">return</span> bookDao.selectList(<span class="literal">null</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> IPage&lt;Book&gt; <span class="title function_">getByPage</span><span class="params">(<span class="type">int</span> currentPage, <span class="type">int</span> pageSize)</span> {</span><br><span class="line">        <span class="type">IPage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>&lt;Book&gt;(currentPage,pageSize);</span><br><span class="line">        <span class="keyword">return</span> bookDao.selectPage(page,<span class="literal">null</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis(五) 集群</title>
      <link href="/redis/redis-wu-ji-qun/"/>
      <url>/redis/redis-wu-ji-qun/</url>
      
        <content type="html"><![CDATA[<h1>1. 主从复制</h1><p>目的:保证互联网"三高"架构(高并发,高性能,高可用)中的<font color="red"><strong>高可用</strong></font></p><h2 id="1-1-单机redis的风险与问题">1.1 单机redis的风险与问题</h2><ul><li><p>问题1.机器故障</p><ul><li>现象：硬盘故障、系统崩溃</li><li>本质：数据丢失，很可能对业务造成灾难性打击</li><li>结论：基本上会放弃使用redis.</li></ul></li><li><p>问题2.容量瓶颈</p><ul><li>现象：内存不足，从16G升级到64G，从64G升级到128G，无限升级内存</li><li>本质：穷，硬件条件跟不上</li><li>结论：放弃使用redis</li></ul></li><li><p>结论：</p><p>为了避免单点Redis服务器故障，准备多台服务器，互相连通。将数据复制多个副本保存在不同的服 务器上，连接在一起，并保证数据是同步的。即使有其中一台服务器宕机，其他服务器依然可以继续 提供服务，实现Redis的高可用，同时实现数据冗余备份。</p></li></ul><h2 id="1-2-多台服务器连接方案">1.2 多台服务器连接方案</h2><ul><li><p>提供数据方：master</p><p>主服务器，主节点，主库</p><p>主客户端</p></li><li><p>接收数据方：slave</p><p>从服务器，从节点，从库</p><p>从客户端</p></li><li><p>需要解决的问题： 数据同步</p></li><li><p>核心工作： master的数据复制到slave中</p></li></ul><h2 id="1-3-主从复制简介">1.3 主从复制简介</h2><p>主从复制即将master中的数据即时、有效的复制到slave中</p><blockquote><p>特征：一个master可以拥有多个slave，一个slave只对应一个master</p></blockquote><p>master:</p><ul><li>写数据</li><li>执行写操作时，将出现变化的数据自动同步到slave读数据（可忽略）</li></ul><p>slave:</p><ul><li>读数据</li><li>写数据（禁止）</li></ul><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png" alt="主从复制"></p><h2 id="1-4-主从复制工作流程">1.4 主从复制工作流程</h2><h3 id="1-4-1-阶段一：建立连接阶段">1.4.1 阶段一：建立连接阶段</h3><blockquote><p>建立slave到master的连接，使master能够识别slave，并保存slave端口号</p></blockquote><p>步骤1：设置master的地址和端口，保存master信息</p><p>步骤2：建立socket连接</p><p>步骤3：发送ping命令（定时器任务）</p><p>步骤4：身份验证</p><p>步骤5：发送slave端口信息</p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E9%98%B6%E6%AE%B5%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="建立连接阶段工作流程)"></p><p>状态：</p><ul><li><p>slave：</p><p>保存master的地址与端口</p></li><li><p>master：保存slave的端口</p></li></ul><p>总体：</p><p>之间创建了连接的socket</p><blockquote><p>主从连接（slave连接master）</p></blockquote><ul><li><p>方式一：客户端发送命令</p><p><strong>slaveof</strong>  &lt;masterip&gt; &lt;msaterport&gt;</p></li><li><p>方式二：启动服务器参数</p><p>redis-server <strong>-slaveof</strong>  &lt;masterip&gt; &lt;msaterport&gt;</p></li><li><p>方式三：服务器配置</p></li></ul><p><strong>slaveof</strong>  &lt;masterip&gt; &lt;msaterport&gt;</p><blockquote><p>主从断开连接</p></blockquote><ul><li><p>客户端发送命令</p><p><strong>slaveof</strong> no one</p></li><li><p>说明：</p></li></ul><p>slave断开连接后，不会删除已有数据，只是不再接受master发送的数据</p><blockquote><p>授权访问</p></blockquote><ul><li><p>master客户端发送命令设置密码</p><p>requirepass &lt;password&gt;</p></li><li><p>master配置文件设置密码</p><p><strong>config set</strong> requirepass &lt;password&gt;</p><p><strong>config get</strong> requirepass</p></li><li><p>slave客户端发送命令设置密码</p><p><strong>auth</strong> &lt;password&gt;</p></li><li><p>slave配置文件设置密码</p><p><strong>masterauth</strong> &lt;password&gt;</p></li><li><p>slave启动服务器设置密码</p></li></ul><p><strong>redis-server</strong> –a &lt;password&gt;</p><h3 id="1-4-2-阶段二：数据同步阶段">1.4.2 阶段二：数据同步阶段</h3><blockquote><p>数据同步阶段工作流程</p></blockquote><ol><li>请求同步数据</li><li>创建RDB同步数据</li><li>恢复RDB同步数据</li><li>请求部分同步数据</li><li>恢复部分同步数据</li></ol><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="Redis数据同步工作流程"></p><p>状态：</p><ul><li>slave：具有master端全部数据，包含RDB过程接收的数据</li><li>master：保存slave当前数据同步的位置</li><li>总体：之间完成了数据克隆</li></ul><blockquote><p>数据同步阶段master说明</p></blockquote><ol><li><p>如果master数据量巨大，数据同步阶段应避开流量高峰期，避免造成master阻塞，影响业务正常执行</p></li><li><p>复制缓冲区大小设定不合理，会导致数据溢出。如进行全量复制周期太长，进行部分复制时发现数据已 经存在丢失的情况，必须进行第二次全量复制，致使slave陷入死循环状态。‘’</p><blockquote><p><strong>repl-backlog-size</strong> 1mb</p></blockquote></li><li><p>master单机内存占用主机内存的比例不应过大，建议使用50%-70%的内存，留下30%-50%的内存用于执行bgsave命令和创建复制缓冲区</p></li></ol><blockquote><p>数据同步阶段slave说明</p></blockquote><ol><li><p>为避免slave进行全量复制、部分复制时服务器响应阻塞或数据不同步，建议关闭此期间的对外服务</p><blockquote><p><strong>slave-serve-stale-data</strong> yes|no</p></blockquote></li><li><p>数据同步阶段，master发送给slave信息可以理解master是slave的一个客户端，主动向slave发送命令</p></li><li><p>多个slave同时对master请求数据同步，master发送的RDB文件增多，会对带宽造成巨大冲击，如果master带宽不足，因此数据同步需要根据业务需求，适量错峰</p></li><li><p>slave过多时，建议调整拓扑结构，由一主多从结构变为树状结构，中间的节点既是master，也是slave。注意使用树状结构时，由于层级深度，导致深度越高的slave与最顶层master间数据同步延迟 较大，数据一致性变差，应谨慎选择</p></li></ol><h3 id="1-4-3-阶段三：命令传播阶段">1.4.3 阶段三：命令传播阶段</h3><blockquote><p>当master数据库状态被修改后，导致主从服务器数据库状态不一致，此时需要让主从数据同步到一致的状态，同步的动作称为命令传播</p><p>master将接收到的数据变更命令发送给slave，slave接收命令后执行命令</p></blockquote><ol><li>命令传播阶段的部分复制</li></ol><ul><li><p>命令传播阶段出现了断网现象</p><ul><li>网络闪断闪连忽略</li><li>短时间网络中断            部分复制</li><li>长时间网络中断            全量复制</li></ul></li><li><p>部分复制的三个核心要素</p><ul><li>服务器的运行 id（run id）</li><li>主服务器的复制积压缓冲区</li><li>主从服务器的复制偏移量</li></ul></li></ul><blockquote><p>服务器运行ID（runid）</p></blockquote><ul><li><code>概念</code>：服务器运行ID是每一台服务器每次运行的身份识别码，一台服务器多次运行可以生成多个运行id</li><li><code>组成</code>：运行id由40位字符组成，是一个随机的十六进制字符<br>例如fdc9ff13b9bbaab28db42b3d50f852bb5e3fcdce</li><li><code>作用</code>：运行id被用于在服务器间进行传输，识别身份<br>如果想两次操作均对同一台服务器进行，必须每次操作携带对应的运行id，用于对方识别</li><li><code>实现方式</code>：运行id在每台服务器启动时自动生成的，master在首次连接slave时，会将自己的运行ID发送给slave，slave保存此ID，通过info Server命令，可以查看节点的runid</li></ul><blockquote><p>复制缓冲区</p></blockquote><ul><li><p><code>概念</code>：复制缓冲区，又名复制积压缓冲区，是一个先进先出（FIFO）的队列，用于存储服务器执行过的命 令，每次传播命令，master都会将传播的命令记录下来，并存储在复制缓冲区</p><ul><li>复制缓冲区默认数据存储空间大小是1M，由于存储空间大小是固定的，当入队元素的数量大于队列长度时，最先入队的元素会被弹出，而新元素会被放入队列</li></ul></li><li><p>由来：每台服务器启动时，如果开启有AOF或被连接成为master节点，即创建复制缓冲区</p></li><li><p>作用：用于保存master收到的所有指令（仅影响数据变更的指令，例如set，select）</p></li><li><p>数据来源：当master接收到主客户端的指令时，除了将指令执行，会将该指令存储到缓冲区中</p></li></ul><blockquote><p>主从服务器复制偏移量（offset）</p></blockquote><ul><li><p>概念：一个数字，描述复制缓冲区中的指令字节位置</p></li><li><p>分类：</p><ul><li>master复制偏移量：记录发送给所有slave的指令字节对应的位置（多个）</li><li>slave复制偏移量：记录slave接收master发送过来的指令字节对应的位置（一个）</li></ul></li><li><p>数据来源：</p><ul><li><p>master端：发送一次记录一次</p></li><li><p>slave端：接收一次记录一次</p></li></ul></li><li><p>作用：同步信息，比对master与slave的差异，当slave断线后，恢复数据使用</p></li></ul><h3 id="1-4-4-数据同步-命令传播阶段工作流程">1.4.4 数据同步+命令传播阶段工作流程</h3><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%91%BD%E4%BB%A4%E4%BC%A0%E6%92%AD.png" alt=" Redis数据同步与命令传播"></p><h2 id="1-5-心跳机制">1.5 心跳机制</h2><blockquote><p>进入命令传播阶段候，master与slave间需要进行信息交换，使用心跳机制进行维护，实现双方连接保持在线</p></blockquote><ul><li>master心跳：<ul><li>指令：PING</li><li>周期：由repl-ping-slave-period决定，默认10秒</li><li>作用：判断slave是否在线</li><li>查询：INFO replication 获取slave最后一次连接时间间隔，lag项维持在0或1视为正常</li></ul></li><li>slave心跳任务<ul><li>指令：REPLCONF ACK {offset}</li><li>周期：1秒</li><li>作用1：汇报slave自己的复制偏移量，获取最新的数据变更指令</li><li>作用2：判断master是否在线</li></ul></li></ul><blockquote><p>心跳阶段注意事项</p></blockquote><p>当slave多数掉线，或延迟过高时，master为保障数据稳定性，将拒绝所有信息同步操作</p><blockquote><p><strong>min-slaves-to-write</strong> 2</p><p><strong>min-slaves-max-lag</strong> 10</p></blockquote><p>slave数量少于2个，或者所有slave的延迟都大于等于10秒时，强制关闭master写功能，停止数据同步</p><ul><li>slave数量由slave发送REPLCONF ACK命令做确认</li><li>slave延迟由slave发送REPLCONF ACK命令做确认</li></ul><h2 id="1-6主从复制常见问题">1.6主从复制常见问题</h2><h3 id="1-6-1-频繁的全量复制（master重启）">1.6.1 频繁的全量复制（master重启）</h3><blockquote><p>伴随着系统的运行，master的数据量会越来越大，一旦master重启，runid将发生变化，会导致全部slave的全量复制操作</p></blockquote><p>内部优化调整方案：</p><ol><li>master内部创建master_replid变量，使用runid相同的策略生成，长度41位，并发送给所有slave</li><li>在master关闭时执行命令 shutdown save，进行RDB持久化,将runid与offset保存到RDB文件中<ul><li>repl-id repl-offset</li><li>通过redis-check-rdb命令可以查看该信息</li></ul></li><li>master重启后加载RDB文件，恢复数据<br>重启后，将RDB文件中保存的repl-id与repl-offset加载到内存中<ul><li>master_repl_id = repl master_repl_offset = repl-offset</li><li>通过info命令可以查看该信息</li></ul></li></ol><p>作用： 本机保存上次runid，重启后恢复该值，使所有slave认为还是之前的master</p><h3 id="1-6-2-频繁的全量复制（网络中断）">1.6.2 频繁的全量复制（网络中断）</h3><ul><li><p>问题现象</p><p>网络环境不佳，出现网络中断，slave不提供服务</p></li><li><p>问题原因</p><p>复制缓冲区过小，断网后slave的offset越界，触发全量复制</p></li><li><p>最终结果</p><p>slave反复进行全量复制</p></li><li><p>解决方案</p><p>修改复制缓冲区大小</p><p><code>repl-backlog-size</code></p></li></ul><p>建议设置如下：</p><ol><li>测算从master到slave的重连平均时长second</li><li>获取master平均每秒产生写命令数据总量write_size_per_second</li><li>最优复制缓冲区空间 = 2 * second * write_size_per_second</li></ol><h3 id="1-6-3-频繁的网络中断">1.6.3 频繁的网络中断</h3><ul><li><p>问题现象</p><p>master的CPU占用高或 slave频繁断开连接</p></li><li><p>问题原因</p><ul><li>slave每1秒发送REPLCONF ACK命令到master</li><li>当slave接到了慢查询时（keys * ，hgetall等），会大量占用CPU性能</li><li>master每1秒调用复制定时函数replicationCron()，比对slave发现长时间没有进行响应</li></ul></li><li><p>最终结果</p><p>master各种资源（输出缓冲区、带宽、连接等）被严重占用</p></li><li><p>解决方案</p><p>通过设置合理的超时时间，确认是否释放slave</p><p><code>repl-timeout </code></p><p>该参数定义了超时时间的阈值（默认60秒），超过该值，释放slave</p></li></ul><h3 id="1-6-4-频繁的网络中断（2）">1.6.4 频繁的网络中断（2）</h3><ul><li><p>问题现象</p><p>slave与master连接断开</p></li><li><p>问题原因</p><ul><li>master发送ping指令频度较低</li><li>master设定超时时间较短</li><li>ping指令在网络中存在丢包</li></ul></li><li><p>解决方案</p><p>提高ping指令发送的频度</p><p><code>repl-ping-slave-period</code></p><p>超时时间repl-time的时间至少是ping指令频度的5到10倍，否则slave很容易判定超时</p></li></ul><h3 id="1-6-5-数据不一致">1.6.5 数据不一致</h3><ul><li><p>问题现象</p><p>多个slave获取相同数据不同步</p></li><li><p>问题原因</p><p>网络信息不同步，数据发送有延迟</p></li><li><p>解决方案</p><ul><li>优化主从间的网络环境，通常放置在同一个机房部署，如使用阿里云等云服务器时要注意此现象</li><li>监控主从节点延迟（通过offset）判断，如果slave延迟过大，暂时屏蔽程序对该slave的数据访问</li></ul><p><strong>slave-serve-stale-data</strong> yes|no</p><p>开启后仅响应info、slaveof等少数命令（慎用，除非对数据一致性要求很高）</p></li></ul><h1>2. 哨兵模式</h1><h2 id="2-1-哨兵简介">2.1 哨兵简介</h2><blockquote><p>哨兵(sentinel) 是一个分布式系统，用于对主从结构中的每台服务器进行<code>监控</code>，当出现故障时通过投票机制选择<code>新的</code>master并将所有slave连接到新的master。</p></blockquote><ul><li><p>监控</p><p>不断的检查master和slave是否正常运行。</p><p>master存活检测、master与slave运行情况检测</p></li><li><p>通知（提醒）</p><p>当被监控的服务器出现问题时，向其他（哨兵间，客户端）发送通知。</p></li><li><p>自动故障转移</p><p>断开master与slave连接，选取一个slave作为master，将其他slave连接到新的master，并告知客户端新的服 务器地址</p></li><li><p>注意： 哨兵也是一台redis服务器，只是不提供数据服务 通常哨兵配置数量为单数</p></li></ul><h2 id="2-2-启用哨兵模式">2.2 启用哨兵模式</h2><p>配置一拖二的主从结构</p><p>配置三个哨兵（配置相同，端口不同） 参看sentinel.conf</p><p>启动哨兵</p><p><strong>redis-sentinel</strong> sentinel-端口号.conf</p><h2 id="2-3-哨兵工作原理">2.3 哨兵工作原理</h2>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis(四) 删除策略 核心配置 高级数据类型</title>
      <link href="/redis/redis-si-shan-chu-ce-lue-he-xin-pei-zhi-gao-ji-shu-ju-lei-xing/"/>
      <url>/redis/redis-si-shan-chu-ce-lue-he-xin-pei-zhi-gao-ji-shu-ju-lei-xing/</url>
      
        <content type="html"><![CDATA[<h1>1. 删除策略</h1><h2 id="1-1-过期数据">1.1 过期数据</h2><blockquote><p>Redis中的数据特征</p></blockquote><p>Redis是一种内存级数据库，所有数据均存放在内存中，内存中的数据可以通过TTL指令获取其状态</p><ul><li>XX ：具有时效性的数据</li><li>-1 ：永久有效的数据</li><li>-2 ：已经过期的数据 或 被删除的数据 或 未定义的数据</li></ul><h2 id="1-2-数据删除策略">1.2 数据删除策略</h2><h3 id="1-2-1-定时删除">1.2.1 定时删除</h3><blockquote><p>创建一个定时器，当key设置有过期时间，且过期时间到达时，由定时器任务立即执行对键的删除操作</p></blockquote><ul><li><strong>优点</strong>：节约内存，到时就删除，快速释放掉不必要的内存占用</li><li><strong>缺点</strong>：CPU压力很大，无论CPU此时负载量多高，均占用CPU，会影响redis服务器响应时间和指令吞吐量</li></ul><p>总结：用处理器性能换取存储空间（拿时间换空间）</p><h2 id="1-2-2-惰性删除">1.2.2 惰性删除</h2><blockquote><p>数据到达过期时间，不做处理。等下次访问该数据时</p><ul><li>如果未过期，返回数据</li><li>发现已过期，删除，返回不存在</li></ul></blockquote><ul><li>优点：节约CPU性能，发现必须删除的时候才删除</li><li>缺点：内存压力很大，出现长期占用内存的数据</li></ul><p>总结：用存储空间换取处理器性能（拿空间换时间）</p><h3 id="1-2-3-定期删除">1.2.3 定期删除</h3><blockquote><p>周期性轮询redis库中的时效性数据，采用随机抽取的策略，利用过期数据占比的方式控制删除频度</p></blockquote><ul><li>特点1：CPU性能占用设置有峰值，检测频度可自定义设置</li><li>特点2：内存压力不是很大，长期占用内存的冷数据会被持续清理</li></ul><p>总结：周期性抽查存储空间（随机抽查，重点抽查）</p><blockquote><p>执行流程</p></blockquote><p>Redis启动服务器初始化时，读取配置server.hz的值，默认为10</p><ul><li>每秒钟执行server.hz次<strong>serverCron()</strong> -&gt;databasesCron()-&gt;activeExpireCycle()</li><li>**activeExpireCycle()**对每个expires[*]逐一进行检测，每次执行250ms/server.hz</li><li>对某个expires[*]检测时，随机挑选W个key检测<ul><li>如果key超时，删除key</li><li>如果一轮中删除的key的数量&gt;W*25%，循环该过程</li><li>如果一轮中删除的key的数量≤W*25%，检查下一个expires[*]，0-15循环</li><li>W取值=ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP属性值</li></ul></li><li>参数current_db用于记录<strong>activeExpireCycle()</strong> 进入哪个expires[*] 执行</li><li>如果**activeExpireCycle()**执行时间到期，下次从current_db继续向下执行</li></ul><h3 id="1-2-4-删除策略比对">1.2.4 删除策略比对</h3><table><thead><tr><th style="text-align:center">删除策略</th><th style="text-align:center">内存</th><th style="text-align:center">CUP</th><th style="text-align:center">特点</th></tr></thead><tbody><tr><td style="text-align:center">定时删除</td><td style="text-align:center">节约内存,无占用</td><td style="text-align:center">不分时段占用CPU资源，频度高</td><td style="text-align:center">拿时间换空间</td></tr><tr><td style="text-align:center">惰性删除</td><td style="text-align:center">内存占用严重</td><td style="text-align:center">延时执行，CPU利用率高</td><td style="text-align:center">拿空间换时间</td></tr><tr><td style="text-align:center">定期删除</td><td style="text-align:center">内存定期随机清理</td><td style="text-align:center">每秒花费固定的CPU资源维护内存</td><td style="text-align:center">随机抽查，重点抽查</td></tr></tbody></table><h2 id="1-3-逐出算法">1.3 逐出算法</h2><blockquote><p>当新数据进入redis时，如果内存不足</p></blockquote><ul><li>Redis使用内存存储数据，在执行每一个命令前，会调用freeMemoryIfNeeded()检测内存是否充足。如果内存不满足新加入数据的最低存储要求，redis要临时删除一些数据为当前指令清理存储空间。清理数据的策略称为逐出算法。</li><li>注意：逐出数据的过程不是100%能够清理出足够的可使用的内存空间，如果不成功则反复执行。当对所有数据尝试完毕后，如果不能达到内存清理的要求，将出现错误信息。</li></ul><blockquote><p>影响数据逐出的相关配置</p></blockquote><ul><li>最大可使用内存<br><strong>maxmemory</strong><br>占用物理内存的比例，默认值为0，表示不限制。生产环境中根据需求设定，通常设置在50%以上。</li><li>每次选取待删除数据的个数<br><strong>maxmemory-samples</strong><br>选取数据时并不会全库扫描，导致严重的性能消耗，降低读写性能。因此采用随机获取数据的方式作为待检测删除数据</li><li>删除策略<br><strong>maxmemory-policy</strong><br>达到最大内存后的，对被挑选出来的数据进行删除的策略</li></ul><blockquote><p>删除策略</p></blockquote><ul><li>检测易失数据（可能会过期的数据集server.db[i].expires ）<ol><li>volatile-lru：挑选最近最少使用的数据淘汰</li><li>volatile-lfu：挑选最近使用次数最少的数据淘汰</li><li>volatile-ttl：挑选将要过期的数据淘汰</li><li>volatile-random：任意选择数据淘汰</li></ol></li><li>检测全库数据（所有数据集server.db[i].dict ）<ol><li>allkeys-lru：挑选最近最少使用的数据淘汰</li><li>allkeys-lfu：挑选最近使用次数最少的数据淘汰</li><li>allkeys-random：任意选择数据淘汰</li></ol></li><li>放弃数据驱逐<ol><li>no-enviction（驱逐）：禁止驱逐数据（redis4.0中默认策略），会引发错误OOM（Out Of Memory）</li></ol></li></ul><h2 id="2-核心配置">2. 核心配置</h2><h2 id="2-1-服务器端设定">2.1 服务器端设定</h2><blockquote><p>设置服务器以守护进程的方式运行</p></blockquote><p><strong>daemonize</strong> yes|no</p><blockquote><p>绑定主机地址</p></blockquote><p><strong>bind</strong> 127.0.0.1</p><blockquote><p>设置服务器端口号</p></blockquote><p><strong>port</strong> 6379</p><blockquote><p>设置数据库数量</p></blockquote><p><strong>databases</strong> 16</p><h2 id="2-2-日志配置">2.2 日志配置</h2><blockquote><p>设置服务器以指定日志记录级别</p></blockquote><p><strong>loglevel</strong> debug|verbose|notice|warning</p><blockquote><p>日志记录文件名</p></blockquote><p><strong>logfile</strong> 端口号.log</p><p>注意：日志级别开发期设置为verbose即可，生产环境中配置为notice，简化日志输出量，降低写日志IO的频度</p><h2 id="2-3-客户端配置">2.3 客户端配置</h2><blockquote><p>设置同一时间最大客户端连接数，默认无限制。当客户端连接到达上限，Redis会关闭新的连接</p></blockquote><p><strong>maxclients</strong> 0</p><blockquote><p>客户端闲置等待最大时长，达到最大值后关闭连接。如需关闭该功能，设置为 0</p></blockquote><p><strong>timeout</strong> 300</p><h2 id="2-4-多服务器快捷配置">2.4 多服务器快捷配置</h2><blockquote><p>导入并加载指定配置文件信息，用于快速创建redis公共配置较多的redis实例配置文件，便于维护</p></blockquote><p><strong>include</strong> /path/server-端口号.conf</p><h1>3. 高级数据类型</h1><h2 id="3-1-Bitmaps-记录0-1">3.1 Bitmaps(记录0,1)</h2><h3 id="3-1-1-Bitmaps类型的基础操作">3.1.1 Bitmaps类型的基础操作</h3><blockquote><p>获取指定key对应偏移量上的bit值</p></blockquote><p><strong>getbit</strong> key offset</p><blockquote><p>设置指定key对应偏移量上的bit值，value只能是1或0</p></blockquote><p><strong>setbit</strong> key offset value</p><h3 id="3-1-2-Bitmaps类型的扩展操作">3.1.2 Bitmaps类型的扩展操作</h3><blockquote><p>对指定key按位进行交、并、非、异或操作，并将结果保存到destKey中</p></blockquote><p><strong>bitop</strong> op destKey key1 [key2…]</p><ul><li>and：交</li><li>or：并</li><li>not：非</li><li>xor：异或</li></ul><blockquote><p>统计指定key中1的数量</p></blockquote><p>bitcount key [start end]</p><h2 id="3-2-HyperLogLog-统计UV">3.2 HyperLogLog(统计UV)</h2><h3 id="3-2-1-HyperLogLog类型的基本操作">3.2.1 HyperLogLog类型的基本操作</h3><blockquote><p>添加数据</p></blockquote><p><strong>pfadd</strong> key element [element …]</p><blockquote><p>统计数据</p></blockquote><p><strong>pfcount</strong> key [key …]</p><blockquote><p>合并数据</p></blockquote><p><strong>pfmerge</strong> destkey sourcekey [sourcekey…]</p><h3 id="3-2-2-相关说明">3.2.2 相关说明</h3><ul><li>用于进行基数统计，不是集合，不保存数据，只记录数量而不是具体数据</li><li>核心是基数估算算法，最终数值存在一定误差</li><li>误差范围：基数估计的结果是一个带有 0.81% 标准错误的近似值</li><li>耗空间极小，每个hyperloglog key占用了12K的内存用于标记基数</li><li>pfadd命令不是一次性分配12K内存使用，会随着基数的增加内存逐渐增大</li><li>Pfmerge命令合并后占用的存储空间为12K，无论合并之前数据量多少</li></ul><h2 id="3-3-GEO-坐标">3.3 GEO(坐标)</h2><h3 id="3-3-1-GEO类型的基本操作">3.3.1 GEO类型的基本操作</h3><blockquote><p>添加坐标点</p></blockquote><p><strong>geoadd</strong> key longitude latitude member [longitude latitude member …]</p><blockquote><p>获取坐标点</p></blockquote><p><strong>geopos</strong> key member [member …]</p><blockquote><p>计算坐标点距离</p></blockquote><p><strong>geodist</strong> key member1 member2 [unit]</p><blockquote><p>添加坐标点</p></blockquote><p><strong>georadius</strong> key longitude latitude radius m|km|ft|mi [withcoord] [withdist] [withhash] [count count]</p><blockquote><p>获取坐标点</p></blockquote><p><strong>georadiusbymember</strong> key member radius m|km|ft|mi [withcoord] [withdist] [withhash] [count count]</p><blockquote><p>计算经纬度</p></blockquote><p><strong>geohash</strong> key member [member …]</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis(三) 持久化与事务</title>
      <link href="/redis/redis-san-chi-jiu-hua-yu-shi-wu/"/>
      <url>/redis/redis-san-chi-jiu-hua-yu-shi-wu/</url>
      
        <content type="html"><![CDATA[<h1>1.持久化简介</h1><h2 id="1-1-什么是持久化">1.1 什么是持久化</h2><blockquote><p>利用永久性存储介质将数据进行保存，在特定的时间将保存的数据进行恢复的工作机制称为<code>持久化</code></p></blockquote><h2 id="1-2-为什么要进行持久化">1.2 为什么要进行持久化</h2><blockquote><p>防止数据的意外丢失，确保数据安全性</p></blockquote><h2 id="1-3-持久化过程保存什么">1.3 持久化过程保存什么</h2><blockquote><p>RDB</p></blockquote><ul><li><p>快照复制</p><p>将当前数据状态进行保存，快照形式，存储数据结果，存储格式简单，关注点在数据</p></li></ul><blockquote><p>AOF</p></blockquote><ul><li><p>记录操作</p><p>将数据的操作过程进行保存，日志形式，存储操作过程，存储格式复杂，关注点在数据的操作过程</p></li></ul><h1>2. RDB</h1><h2 id="2-1-RDB启动方式——-save指令">2.1 RDB启动方式—— save指令</h2><ul><li>命令</li></ul><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">save</span><br></pre></td></tr></tbody></table></figure><ul><li><p>作用</p><p>手动执行一次保存操作</p></li></ul><h2 id="2-2-RDB启动方式-——-save指令相关配置">2.2 RDB启动方式 —— save指令相关配置</h2><ul><li><p><code>dbfilename</code> dump.rdb</p><p>说明：设置本地数据库文件名，默认值为 <strong>dump.rdb</strong></p><p>经验：通常设置为<strong>dump</strong>-<code>端口号</code>.<strong>rdb</strong></p></li><li><p><code>dir</code></p><p>说明：设置存储.rdb文件的路径</p><p>经验：通常设置成存储空间较大的目录中，目录名称<code>data</code></p></li><li><p><code>rdbcompression</code> yes</p><p>说明：设置存储至本地数据库时是否压缩数据，默认为 yes，采用 LZF 压缩</p><p>经验：通常默认为开启状态，如果设置为no，可以节省 CPU 运行时间，但会使存储的文件变大（巨大）</p></li><li><p><code>rdbchecksum</code> yes</p><p>说明：设置是否进行RDB文件格式校验，该校验过程在写文件和读文件过程均进行</p><p>经验：通常默认为开启状态，如果设置为no，可以节约读写性过程约10%时间消耗，但是存储一定的数据损坏风险</p></li></ul><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%20RDB%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.png" alt="Redis RDB执行顺序"></p><blockquote><p><code>注意</code>：save指令的执行会阻塞当前Redis服务器，直到当前RDB过程完成为止，有可能会造成长时间阻塞，<code>线上环境不建议使用</code></p></blockquote><h2 id="2-3-RDB启动方式-——-bgsave指令">2.3 RDB启动方式 —— bgsave指令</h2><ul><li>命令</li></ul><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bgsave</span><br></pre></td></tr></tbody></table></figure><ul><li><p>作用</p><p>手动启动后台保存操作，但不是立即执行</p></li></ul><h2 id="2-4-RDB启动方式-——-bgsave指令工作原理">2.4 RDB启动方式 —— bgsave指令工作原理</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%20bgsave%E6%8C%87%E4%BB%A4%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.png" alt="Reids bgsave指令工作原理"></p><blockquote><p><code>注意</code>： bgsave命令是针对save阻塞问题做的优化。Redis内部所有涉及到RDB操作都采用bgsave的方式，save命令可以放弃使用</p></blockquote><h2 id="2-5-RDB启动方式-——-bgsave指令相关配置">2.5 RDB启动方式 —— bgsave指令相关配置</h2><ul><li><p>dbfilename dump.rdb</p></li><li><p>dir</p></li><li><p>rdbcompression yes</p></li><li><p>rdbchecksum yes</p></li><li><p>stop-writes-on-bgsave-error yes</p><p>说明：后台存储过程中如果出现错误现象，是否停止保存操作</p><p>经验：通常默认为开启状态</p></li></ul><h2 id="2-6-RDB启动方式-——save配置">2.6 RDB启动方式 ——save配置</h2><ul><li><p>配置</p><p><code>save</code> second changes</p></li><li><p>作用 满足限定时间范围内key的变化数量达到指定数量即进行持久化</p></li><li><p>参数 second：监控时间范围 changes：监控key的变化量</p></li><li><p>位置 在conf文件中进行配置</p></li><li><p>范例</p><p>save 900 1</p><p>save 300 10</p><p>save 60 10000</p></li></ul><h2 id="2-6-RDB启动方式-——save配置原理">2.6 RDB启动方式 ——save配置原理</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%20save%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86.png" alt="Redis save配置原理"></p><blockquote><p><code>注意</code>： save配置要根据实际业务情况进行设置，频度过高或过低都会出现性能问题，结果可能是灾难性的 save配置中对于second与changes设置通常具有互补对应关系，尽量不要设置成包含性关系 save配置启动后执行的是bgsave操作</p></blockquote><h2 id="2-7-RDB三种启动方式对比">2.7 RDB三种启动方式对比</h2><table><thead><tr><th style="text-align:center">方式</th><th style="text-align:center">save指令</th><th style="text-align:center">bgssave指令</th></tr></thead><tbody><tr><td style="text-align:center">读写</td><td style="text-align:center">同步</td><td style="text-align:center">异步</td></tr><tr><td style="text-align:center">阻塞客户端指令</td><td style="text-align:center">是</td><td style="text-align:center">否</td></tr><tr><td style="text-align:center">额外内存消耗</td><td style="text-align:center">否</td><td style="text-align:center">是</td></tr><tr><td style="text-align:center">启动新进程</td><td style="text-align:center">否</td><td style="text-align:center">是</td></tr></tbody></table><h2 id="2-8-RDB特殊启动形式">2.8 RDB特殊启动形式</h2><ul><li><p>全量复制</p><p>在主从复制中详细讲解</p></li><li><p>服务器运行过程中重启</p><p><code>debug</code> reload</p></li><li><p>关闭服务器时指定保存数据</p><p><code>shutdown</code> save</p></li></ul><blockquote><p>默认情况下执行shutdown命令时，自动执行 bgsave(如果没有开启AOF持久化功能)</p></blockquote><h2 id="2-9-RDB的优缺点">2.9 RDB的优缺点</h2><blockquote><p>RDB优点</p></blockquote><ul><li>RDB是一个紧凑压缩的二进制文件，存储效率较高</li><li>RDB内部存储的是redis在某个时间点的数据快照，非常适合用于数据备份，全量复制等场景</li><li>RDB恢复数据的速度要比AOF快很多</li><li>应用：服务器中每X小时执行bgsave备份，并将RDB文件拷贝到远程机器中，用于灾难恢复</li></ul><blockquote><p>RDB缺点</p><p>数据大时效率低  数据丢失风险 大数据下IO性能低</p></blockquote><ul><li>RDB方式无论是执行指令还是利用配置，无法做到实时持久化，具有较大的可能性丢失数据</li><li>bgsave指令每次运行要执行fork操作创建子进程，要牺牲掉一些性能</li><li>Redis的众多版本中未进行RDB文件格式的版本统一，有可能出现各版本服务之间数据格式无法兼容现象</li></ul><h1>3. AOF</h1><h2 id="3-1-AOF概念">3.1 AOF概念</h2><ul><li>AOF(append only file)持久化：以独立日志的方式记录每次写命令，重启时再重新执行AOF文件中命令达到恢复数据的目的<br>与RDB相比可以简单描述为<code>改记录数据为记录数据产生的过程 </code></li><li>AOF的主要作用是解决了数据持久化的实时性，目前已经是Redis持久化的主流方式</li></ul><blockquote><p>AOF写数据过程</p></blockquote><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%20AOF%E5%86%99%E6%95%B0%E6%8D%AE%E8%BF%87%E7%A8%8B.png" alt="AOF写数据过程"></p><h2 id="3-2-AOF写数据三种策略-appendfsync">3.2 AOF写数据三种策略(appendfsync)</h2><ul><li><p>always(每次）</p><p>每次写入操作均同步到AOF文件中，<code>数据零误差，性能较低</code></p></li><li><p>everysec（每秒）</p><p>每秒将缓冲区中的指令同步到AOF文件中，数据<code>准确性较高，性能较高</code><br>在系统突然宕机的情况下丢失1秒内的数据</p></li><li><p>no（系统控制）</p><p>由操作系统控制每次同步到AOF文件的周期，整体过程<code>不可控</code></p></li></ul><h2 id="3-3-AOF的相关配置">3.3 AOF的相关配置</h2><ul><li><p><code>appendonly</code> yes|no</p><p>是否开启AOF持久化功能，默认为不开启状态</p></li><li><p><code>appendfsync</code> always|everysec|no</p><p>AOF写数据策略</p></li><li><p><code>appendfilename</code> filename</p><p>AOF持久化文件名，默认文件名未appendonly.aof，建议配置为appendonly-端口号.aof</p></li><li><p><code>dir</code></p><p>AOF持久化文件保存路径，与RDB持久化文件保持一致即可</p></li></ul><h2 id="3-4-AOF的重写">3.4 AOF的重写</h2><blockquote><p>功能由来</p></blockquote><p>随着命令不断写入AOF，文件会越来越大，为了解决这个问题，Redis引入了AOF重写机制压缩文件体积<br>AOF文件重写是将Redis进程内的数据转化为写命令同步到新AOF文件的过程<br>简单说就是将对同一个数据的若干个条命令执行结 果转化成最终结果数据对应的指令进行记录</p><blockquote><p>AOF重写作用</p></blockquote><ul><li>降低磁盘占用量，提高磁盘利用率</li><li>提高持久化效率，降低持久化写时间，提高IO性能</li><li>降低数据恢复用时，提高数据恢复效率</li></ul><blockquote><p>AOF重写规则</p></blockquote><ul><li><p>进程内已超时的数据不再写入文件</p></li><li><p>忽略无效指令，重写时使用进程内数据直接生成，这样新的AOF文件只保留最终数据的写入命令</p></li><li><p>如del key1、 hdel key2、srem key3、set key4 111、set key4 222等</p></li><li><p>对同一数据的多条写命令合并为一条命令</p><p>如lpush list1 a、lpush list1 b、 lpush list1 c 可以转化为：lpush list1 a b c</p><p>为防止数据量过大造成客户端缓冲区溢出，对list、set、hash、zset等类型，每条指令最多写入64个元素</p></li></ul><h2 id="3-5-AOF重写方式">3.5 AOF重写方式</h2><ul><li><p>手动重写</p><p><code>bgrewriteaof</code></p></li><li><p>自动重写</p><p><code>auto-aof-rewrite-min-size</code> size</p><p><code>auto-aof-rewrite-percentage</code> percentage</p></li><li><p>自动重写触发比对参数</p><p><code>aof_current_size</code> aof当前大小</p><p><code>aof_base_size</code> aof基础大小</p></li><li><p>自动重写触发条件</p></li></ul><p>aof当前大小 &gt; <code>auto-aof-rewrite-min-size</code></p><p>(aof当前大小-aof基础大小)/aof基础大小 &gt;= <code>auto-aof-rewrite-percentage</code></p><h2 id="3-6-AOF工作流程">3.6 AOF工作流程</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%20AOF%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="AOF工作流程"></p><blockquote><p>AOF重写操作流程</p></blockquote><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%20AOF%E9%87%8D%E5%86%99%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B%20.png" alt="AOF重写工作流程"></p><h1>4. RDB与AOF区别</h1><h2 id="4-1-持久化方式区别">4.1 持久化方式区别</h2><table><thead><tr><th style="text-align:center">持久化方式</th><th style="text-align:center">RDB</th><th style="text-align:center">AOF</th></tr></thead><tbody><tr><td style="text-align:center">占用存储空间</td><td style="text-align:center">小（数据级：压缩）</td><td style="text-align:center">大（指令级：重写）</td></tr><tr><td style="text-align:center">存储速度</td><td style="text-align:center">慢</td><td style="text-align:center">快</td></tr><tr><td style="text-align:center">恢复速度</td><td style="text-align:center">快</td><td style="text-align:center">慢</td></tr><tr><td style="text-align:center">数据安全性</td><td style="text-align:center">会丢失数据</td><td style="text-align:center">依据策略决定</td></tr><tr><td style="text-align:center">资源消耗</td><td style="text-align:center">高/重量级</td><td style="text-align:center">低/轻量级</td></tr><tr><td style="text-align:center">启动优先级</td><td style="text-align:center">低</td><td style="text-align:center">高</td></tr></tbody></table><h2 id="4-2-RDB与AOF的选择">4.2 RDB与AOF的选择</h2><blockquote><p>对数据非常敏感，建议使用默认的AOF持久化方案</p></blockquote><ul><li>AOF持久化策略使用everysecond，每秒钟fsync一次<br>该策略redis仍可以保持很好的处理性能，当出现问题时，最多丢失0-1秒内的数据</li><li><code>注意</code>：由于AOF文件存储体积较大，且恢复速度较慢</li></ul><blockquote><p>数据呈现阶段有效性，建议使用RDB持久化方案</p></blockquote><ul><li>数据可以良好的做到阶段内无丢失（该阶段是开发者或运维人员手工维护的），且恢复速度较快，阶段点数据恢复通常采用RDB方案</li><li><code>注意</code>：利用RDB实现紧凑的数据持久化会使Redis降的很低</li></ul><h2 id="4-3-综合比对">4.3 综合比对</h2><ul><li>RDB与AOF的选择实际上是在做一种权衡，每种都有利有弊</li><li>如不能承受数分钟以内的数据丢失，对业务数据非常敏感，选用AOF</li><li>如能承受数分钟以内的数据丢失，且追求大数据集的恢复速度，选用RDB</li><li>灾难恢复选用RDB</li><li>双保险策略，同时开启 RDB 和 AOF，重启后，<code>Redis优先使用 AOF 来恢复数据</code>，降低丢失数据的量</li></ul><h1>5. Redis事务</h1><h2 id="5-1-什么是事务">5.1 什么是事务</h2><blockquote><p>redis事务就是一个命令执行的队列，将一系列预定义命令包装成一个整体（一个队列）<br>当执行时，一次性 按照添加顺序依次执行，中间不会被打断或者干扰<br>一个队列中，一次性、顺序性、排他性的执行一系列命令</p></blockquote><h2 id="5-2-事务的基本操作">5.2 事务的基本操作</h2><p><strong>开启事务 : multi</strong><br>作用 : 设定事务的开启位置，此指令执行后，后续的所有指令均加入到事务中</p><p><strong>执行事务: exec</strong><br>作用:设定事务的结束位置，同时执行事务。与multi成对出现，成对使用</p><blockquote><p>注意：加入事务的命令暂时进入到任务队列中，并没有立即执行，只有执行exec命令才开始执行</p></blockquote><h2 id="5-3-事务的工作流程">5.3 事务的工作流程</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Redis%20%E4%BA%8B%E5%8A%A1%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png" alt="Redis 事务工作流程"></p><h2 id="5-4-事务的注意事项">5.4 事务的注意事项</h2><blockquote><p>命令格式输入错误</p></blockquote><p>如果定义的事务中所包含的命令存在语法错误，整体事务中所有命令均不会执行。包括那些语法正确的命令。</p><blockquote><p>命令执行出现错误</p></blockquote><p>能够正确运行的命令会执行，运行错误的命令不会被执行</p><blockquote><p>注意：已经执行完毕的命令对应的数据不会自动回滚，需要程序员自己在代码中实现回滚。</p></blockquote><h2 id="5-5-手动进行事务回滚">5.5 手动进行事务回滚</h2><p>记录操作过程中被影响的数据之前的状态</p><ul><li>单数据：string</li><li>多数据：hash、list、set、zset</li></ul><p>设置指令恢复所有的被修改的项</p><ul><li>单数据：直接set（注意周边属性，例如时效）</li><li>多数据：修改对应值或整体克隆复制</li></ul><h1>6. 锁</h1><blockquote><p>使用场景</p></blockquote><ul><li>多个客户端有可能同时操作同一组数据，并且该数据一旦被操作修改后，将不适用于继续操作</li><li>在操作之前锁定要操作的数据，一旦发生变化，终止当前操作</li></ul><h2 id="6-1-锁">6.1 锁</h2><blockquote><p>对 key 添加监视锁，在执行exec前如果key发生了变化，终止事务执行</p></blockquote><ul><li><strong>watch</strong> key1 [key2……]</li></ul><blockquote><p>取消对所有 key 的监视</p></blockquote><ul><li><strong>unwatch</strong></li></ul><h2 id="6-2-分布式锁">6.2 分布式锁</h2><blockquote><p>虽然redis是单线程的，但是多个客户端对同一数据同时进行操作时，如何避免不被同时修改</p></blockquote><ul><li>使用 setnx 设置一个公共锁</li></ul><blockquote><p><strong>setnx</strong> lock-key value</p></blockquote><p>利用setnx命令的返回值特征，有值则返回设置失败，无值则返回设置成功</p><ul><li><p>对于返回设置成功的，拥有控制权，进行下一步的具体业务操作</p></li><li><p>对于返回设置失败的，不具有控制权，排队或等待</p><p>操作完毕通过del操作释放锁</p></li></ul><blockquote><p>注意：上述解决方案是一种设计概念，依赖规范保障，具有风险性</p></blockquote><h2 id="6-3-分布式锁改良">6.3 分布式锁改良</h2><ul><li>由于锁操作由用户控制加锁解锁，必定会存在加锁后未解锁的风险</li><li>需要解锁操作不能仅依赖用户控制，系统级别要给出对应的保底处理方案</li></ul><blockquote><p>使用 expire 为锁key添加时间限定，到时不释放，放弃锁</p><p><strong>expire</strong> lock-key second<br><strong>pexpire</strong> lock-key milliseconds</p></blockquote><p>由于操作通常都是微秒或毫秒级，因此该锁定时间不宜设置过大。具体时间需要业务测试后确认。</p><ul><li>例如：持有锁的操作最长执行时间127ms，最短执行时间7ms。</li><li>测试百万次最长执行时间对应命令的最大耗时，测试百万次网络延迟平均耗时</li><li>锁时间设定推荐：最大耗时*120%+平均网络延迟*110%</li><li>如果业务最大耗时&lt;&lt;网络平均延迟，通常为2个数量级，取其中单个耗时较长即可</li></ul>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis(二) 指令操作</title>
      <link href="/redis/redis-er-zhi-ling-cao-zuo/"/>
      <url>/redis/redis-er-zhi-ling-cao-zuo/</url>
      
        <content type="html"><![CDATA[<h1>1. 常用指令</h1><h2 id="1-1-key-基本操作">1.1 key 基本操作</h2><table><thead><tr><th style="text-align:center">指令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>del</code> key</td><td style="text-align:center">删除指定key</td></tr><tr><td style="text-align:center"><code>exists</code> key</td><td style="text-align:center">获取key是否存在</td></tr><tr><td style="text-align:center"><code>type</code> key</td><td style="text-align:center">获取key的类型</td></tr><tr><td style="text-align:center"><code>expire</code> key seconds<br><code>pexpire</code> key milliseconds<br><code>expireat</code> key timestamp<br><code>pexpireat</code> key milliseconds-timestamp</td><td style="text-align:center">为指定key设置有效期</td></tr><tr><td style="text-align:center"><code>ttl</code> key<br><code>pttl</code> key</td><td style="text-align:center">获取key的有效时间</td></tr><tr><td style="text-align:center"><code>persist</code> key</td><td style="text-align:center">切换key从时效性转换为永久性</td></tr><tr><td style="text-align:center"><code>rename</code> key newkey<br><code>renamenx</code> key newkey</td><td style="text-align:center">为key改名</td></tr><tr><td style="text-align:center"><code>sort</code></td><td style="text-align:center">对所有key排序</td></tr><tr><td style="text-align:center">help @generic</td><td style="text-align:center">其他key通用操作</td></tr><tr><td style="text-align:center"><code>keys</code> pattern</td><td style="text-align:center">查询key</td></tr></tbody></table><blockquote><p>查询模式规则</p><p>* 匹配任意数量的任意符号 ? 配合一个任意符号 [] 匹配一个指定符</p></blockquote><table><thead><tr><th>例子</th><th>解释</th></tr></thead><tbody><tr><td>keys *</td><td>查询所有</td></tr><tr><td>keys it*</td><td>查询所有以it开头</td></tr><tr><td>keys *heima</td><td>查询所有以heima结尾</td></tr><tr><td>keys ??heima</td><td>查询所有前面两个字符任意，后面以heima结尾</td></tr><tr><td>keys user:?</td><td>查询所有以user:开头，最后一个字符任意</td></tr><tr><td>keys u[st]er:1</td><td>查询所有以u开头，以er:1结尾，中间包含一个字母，s或t</td></tr></tbody></table><h2 id="1-2数据库通用指令">1.2数据库通用指令</h2><table><thead><tr><th style="text-align:center">指令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>select</code> index</td><td style="text-align:center">切换数据库</td></tr><tr><td style="text-align:center"><code>quit</code><br><code>ping</code><br><code>echo</code> message</td><td style="text-align:center">其他操作</td></tr><tr><td style="text-align:center"><code>move</code> key db</td><td style="text-align:center">数据移动</td></tr><tr><td style="text-align:center"><code>dbsize</code><br><code>flushdb</code><br><code>flushall</code></td><td style="text-align:center">数据清除</td></tr></tbody></table><h1>2. 全部指令</h1><h2 id="2-1-String">2.1 String</h2><table><thead><tr><th style="text-align:center">操作指令</th><th style="text-align:center">作用</th><th style="text-align:center">注意事项</th><th style="text-align:center">返回值</th></tr></thead><tbody><tr><td style="text-align:center"><code>set</code> key value</td><td style="text-align:center">将字符串值 <code>value</code> 关联到 <code>key</code></td><td style="text-align:center">如果 <code>key</code> 已经持有其他值， <code>SET</code> 就覆写旧值， 无视类型<br>当 <code>SET</code> 命令对一个带有生存时间（TTL）的键进行设置之后， 该键原有的 TTL 将被清除</td><td style="text-align:center"><code>SET</code> 命令只在设置操作成功完成时才返回 <code>OK</code></td></tr><tr><td style="text-align:center"><code>setnx</code> key value</td><td style="text-align:center">只在键 <code>key</code> 不存在的情况下， 将键 <code>key</code> 的值设置为 <code>value</code></td><td style="text-align:center">若键 <code>key</code> 已经存在， 则 <code>SETNX</code> 命令不做任何动作</td><td style="text-align:center">命令在设置成功时返回 <code>1</code> ， 设置失败时返回 <code>0</code></td></tr><tr><td style="text-align:center"><code>setex</code> key value</td><td style="text-align:center">将键 <code>key</code> 的值设置为 <code>value</code> ， 并将键 <code>key</code> 的生存时间设置为 <code>seconds</code> 秒钟</td><td style="text-align:center">如果键 <code>key</code> 已经存在， 那么 <code>SETEX</code> 命令将覆盖已有的值</td><td style="text-align:center">命令在设置成功时返回 <code>OK</code> <br> 当 <code>seconds</code> 参数不合法时， 命令将返回一个错误</td></tr><tr><td style="text-align:center"><code>pestex</code> key value</td><td style="text-align:center">它以<code>毫秒</code>为单位设置 <code>key</code> 的生存时间</td><td style="text-align:center">这个命令和 <code>SETEX</code> 命令相似， 但不是像 <code>SETEX</code> 命令那样以秒为单位进行设置</td><td style="text-align:center">命令在设置成功时返回 <code>OK</code></td></tr><tr><td style="text-align:center"><code>get</code> key</td><td style="text-align:center">返回与键 <code>key</code> 相关联的字符串值</td><td style="text-align:center">如果键 <code>key</code> 不存在， 那么返回特殊值 <code>nil</code> ； 否则， 返回键 <code>key</code> 的值</td><td style="text-align:center">与键 <code>key</code> 相关联的字符串值</td></tr><tr><td style="text-align:center"><code>getset</code> key value</td><td style="text-align:center">将键 <code>key</code> 的值设为 <code>value</code> ， 并返回键 <code>key</code> 在被设置之前的旧值</td><td style="text-align:center">如果键 <code>key</code> 没有旧值， 也即是说， 键 <code>key</code> 在被设置之前并不存在， 那么命令返回 <code>nil</code></td><td style="text-align:center">给定键 <code>key</code> 的旧值</td></tr><tr><td style="text-align:center"><code>strlen</code> key</td><td style="text-align:center">返回键 <code>key</code> 储存的字符串值的长度</td><td style="text-align:center">当键 <code>key</code> 不存在时， 命令返回 <code>0</code></td><td style="text-align:center">字符串值的长度</td></tr><tr><td style="text-align:center"><code>append</code> key value</td><td style="text-align:center">如果键 <code>key</code> 已经存在并且它的值是一个字符串， <code>APPEND</code> 命令将把 <code>value</code> 追加到键 <code>key</code> 现有值的末尾</td><td style="text-align:center">如果 <code>key</code> 不存在， <code>APPEND</code> 就简单地将键 <code>key</code> 的值设为 <code>value</code> ， 就像执行 <code>SET key value</code> 一样</td><td style="text-align:center">追加 <code>value</code> 之后， 键 <code>key</code> 的值的长度</td></tr><tr><td style="text-align:center"><code>setrange </code> key offset value</td><td style="text-align:center">从偏移量 <code>offset</code> 开始， 用 <code>value</code> 参数覆写(overwrite)键 <code>key</code> 储存的字符串值</td><td style="text-align:center">不存在的键 <code>key</code> 当作空白字符串处理</td><td style="text-align:center">被修改之后， 字符串值的长度</td></tr><tr><td style="text-align:center"><code>getrange</code> key start end</td><td style="text-align:center">返回键 <code>key</code> 储存的字符串值的指定部分， 字符串的截取范围由 <code>start</code> 和 <code>end</code> 两个偏移量决定 (包括 <code>start</code> 和 <code>end</code> 在内)</td><td style="text-align:center">负数偏移量表示从字符串的末尾开始计数， <code>-1</code> 表示最后一个字符， <code>-2</code> 表示倒数第二个字符， 以此类推<br><code>GETRANGE</code> 通过保证子字符串的值域(range)不超过实际字符串的值域来处理超出范围的值域请求</td><td style="text-align:center"><code>GETRANGE</code> 命令会返回字符串值的指定部分</td></tr><tr><td style="text-align:center"><code>incr</code> key</td><td style="text-align:center">为键 <code>key</code> 储存的数字值加上一</td><td style="text-align:center">如果键 <code>key</code> 不存在， 那么它的值会先被初始化为 <code>0</code> ， 然后再执行 <code>INCR</code> 命令</td><td style="text-align:center">执行加一操作之后的值</td></tr><tr><td style="text-align:center"><code>incrby</code> key increment</td><td style="text-align:center">为键 <code>key</code> 储存的数字值加上增量 <code>increment</code></td><td style="text-align:center">如果键 <code>key</code> 不存在， 那么键 <code>key</code> 的值会先被初始化为 <code>0</code> ， 然后再执行 <code>INCRBY</code> 命令</td><td style="text-align:center">在加上增量 <code>increment</code> 之后， 键 <code>key</code> 当前的值</td></tr><tr><td style="text-align:center"><code>incrbyfloat</code> key increment</td><td style="text-align:center">为键 <code>key</code> 储存的值加上浮点数增量 <code>increment</code></td><td style="text-align:center">如果键 <code>key</code> 不存在， 那么 <code>INCRBYFLOAT</code> 会先将键 <code>key</code> 的值设为 <code>0</code> ， 然后再执行加法操做</td><td style="text-align:center">在加上增量 <code>increment</code> 之后， 键 <code>key</code> 的值</td></tr><tr><td style="text-align:center"><code>decr</code> key</td><td style="text-align:center">为键 <code>key</code> 储存的数字值减去一</td><td style="text-align:center">如果键 <code>key</code> 不存在， 那么键 <code>key</code> 的值会先被初始化为 <code>0</code> ， 然后再执行 <code>DECR</code> 操作</td><td style="text-align:center">执行减一操作之后的值</td></tr><tr><td style="text-align:center"><code>decrby</code> key increment</td><td style="text-align:center">将键 <code>key</code> 储存的整数值减去减量 <code>decrement</code></td><td style="text-align:center">如果键 <code>key</code> 不存在， 那么键 <code>key</code> 的值会先被初始化为 <code>0</code> ， 然后再执行 <code>DECRBY</code> 命令</td><td style="text-align:center">执行减法操作之后的值</td></tr><tr><td style="text-align:center"><code>mset</code> key1 value1 key2 value2</td><td style="text-align:center">同时为多个键设置值</td><td style="text-align:center"><code>MSET</code> 是一个原子性(atomic)操作，会覆盖已有value</td><td style="text-align:center">总是返回 <code>OK</code></td></tr><tr><td style="text-align:center"><code>msetnx</code> key1 value1 key2 value2</td><td style="text-align:center">当且仅当所有给定键都不存在时， 为所有给定键设置值</td><td style="text-align:center"><code>MSETNX</code> 是一个原子性(atomic)操作， 所有给定键要么就全部都被设置， 要么就全部都不设置， 不可能出现第三种状态</td><td style="text-align:center">成功 <code>1</code> <br>失败<code>0</code></td></tr><tr><td style="text-align:center"><code>mget</code> key1 key2</td><td style="text-align:center">返回给定的一个或多个字符串键的值</td><td style="text-align:center">如果给定的字符串键里面， 有某个键不存在， 那么这个键的值将以特殊值 <code>nil</code> 表示</td><td style="text-align:center">一个列表， 列表中包含了所有给定键的值</td></tr></tbody></table><blockquote><p>tips:</p></blockquote><ul><li><p><code>get</code> 只能获取字符串 其他类型的用get就会报错</p></li><li><p>数字的加减只能用于数字 带有字符的字符串会报错</p></li></ul><h2 id="2-2-hash">2.2 hash</h2><table><thead><tr><th style="text-align:center">操作指令</th><th style="text-align:center">作用</th><th style="text-align:center">注意事项</th><th style="text-align:center">返回值</th></tr></thead><tbody><tr><td style="text-align:center"><code>hset</code> hash field value</td><td style="text-align:center">将哈希表 <code>hash</code> 中域 <code>field</code> 的值设置为 <code>value</code></td><td style="text-align:center"><code>field</code>不存在就创建<code>field</code>域并设置<br>存在就覆盖</td><td style="text-align:center">新创建 <code>field</code> 域并成功为它设置值时， 命令返回 <code>1</code> <br>成功使用新值覆盖了它的旧值， 那么命令返回 <code>0</code></td></tr><tr><td style="text-align:center"><code>hsetnx</code> hash field value</td><td style="text-align:center">当且仅当域 <code>field</code> 尚未存在于哈希表的情况下， 将它的值设置为 <code>value</code></td><td style="text-align:center">如果给定域已经存在于哈希表当中， 那么命令将放弃执行设置操作</td><td style="text-align:center">设置成功时返回 <code>1</code> ， 在给定域已经存在而放弃执行设置操作时返回 <code>0</code></td></tr><tr><td style="text-align:center"><code>hget</code> hash field</td><td style="text-align:center">返回哈希表中给定域的值</td><td style="text-align:center">如果给定域不存在于哈希表中， 又或者给定的哈希表并不存在， 那么命令返回 <code>nil</code></td><td style="text-align:center"><code>HGET</code> 命令在默认情况下返回给定域的值</td></tr><tr><td style="text-align:center"><code>hexists</code> hash field</td><td style="text-align:center">检查给定域 <code>field</code> 是否存在于哈希表 <code>hash</code> 当中</td><td style="text-align:center"></td><td style="text-align:center"><code>HEXISTS</code> 命令在给定域存在时返回 <code>1</code> ， 在给定域不存在时返回 <code>0</code></td></tr><tr><td style="text-align:center"><code>hdel</code> key [field]</td><td style="text-align:center">删除哈希表 <code>key</code> 中的一个或多个指定域，不存在的域将被忽略</td><td style="text-align:center"></td><td style="text-align:center">被成功移除的域的数量，不包括被忽略的域</td></tr><tr><td style="text-align:center"><code>hlen</code> key</td><td style="text-align:center">返回哈希表 <code>key</code> 中域的数量</td><td style="text-align:center">当 <code>key</code> 不存在时，返回 <code>0</code></td><td style="text-align:center">哈希表中域的数量</td></tr><tr><td style="text-align:center"><code>hstrlen</code> key field</td><td style="text-align:center">返回哈希表 <code>key</code> 中， 与给定域 <code>field</code> 相关联的值的字符串长度（string length）</td><td style="text-align:center">如果给定的键或者域不存在， 那么命令返回 <code>0</code></td><td style="text-align:center">一个整数</td></tr><tr><td style="text-align:center"><code>hincrby</code> key field increment</td><td style="text-align:center">为哈希表 <code>key</code> 中的域 <code>field</code> 的值加上增量 <code>increment</code></td><td style="text-align:center">如果 <code>key</code> 不存在，一个新的哈希表被创建并执行 <br>如果域 <code>field</code> 不存在，那么在执行命令前，域的值被初始化为 <code>0</code></td><td style="text-align:center">执行命令之后，哈希表 <code>key</code> 中域 <code>field</code> 的值</td></tr><tr><td style="text-align:center"><code>hincrbyfloat</code> key field increment</td><td style="text-align:center">哈希表 <code>key</code> 中的域 <code>field</code> 加上浮点数增量 <code>increment</code></td><td style="text-align:center">同上</td><td style="text-align:center">执行加法操作之后 <code>field</code> 域的值</td></tr><tr><td style="text-align:center"><code>hmset</code> key [field value]</td><td style="text-align:center">同时将多个 <code>field-value</code> (域-值)对设置到哈希表 <code>key</code> 中</td><td style="text-align:center">此命令会覆盖哈希表中已存在的域<br>如果 <code>key</code> 不存在，一个空哈希表被创建并执行</td><td style="text-align:center">如果命令执行成功，返回 <code>OK</code> <br>当 <code>key</code> 不是哈希表(hash)类型时，返回一个错误</td></tr><tr><td style="text-align:center"><code>hmget key [field]</code></td><td style="text-align:center">返回哈希表 <code>key</code> 中，一个或多个给定域的值</td><td style="text-align:center">如果给定的域不存在于哈希表，那么返回一个 <code>nil</code> 值</td><td style="text-align:center">一个包含多个给定域的关联值的表，表值的排列顺序和给定域参数的请求顺序一样</td></tr><tr><td style="text-align:center"><code>hkeys</code> key</td><td style="text-align:center">返回哈希表 <code>key</code> 中的所有域</td><td style="text-align:center">当 <code>key</code> 不存在时，返回一个空表</td><td style="text-align:center">一个包含哈希表中所有域的表</td></tr><tr><td style="text-align:center"><code>hvals</code> key</td><td style="text-align:center">返回哈希表 <code>key</code> 中所有域的值</td><td style="text-align:center">当 <code>key</code> 不存在时，返回一个空表</td><td style="text-align:center">一个包含哈希表中所有值的表</td></tr><tr><td style="text-align:center"><code>hgetall</code> key</td><td style="text-align:center">返回哈希表 <code>key</code> 中，所有的域和值</td><td style="text-align:center">若 <code>key</code> 不存在，返回空列表</td><td style="text-align:center">以列表形式返回哈希表的域和域的值</td></tr></tbody></table><h2 id="2-3-list">2.3 list</h2><table><thead><tr><th style="text-align:center">操作指令</th><th style="text-align:center">作用</th><th style="text-align:center">注意事项</th><th style="text-align:center">返回值</th></tr></thead><tbody><tr><td style="text-align:center"><code>lpush</code> key [value]</td><td style="text-align:center">将一个或多个值 <code>value</code> 插入到列表 <code>key</code> 的表头</td><td style="text-align:center"><code>value</code> 值按从左到右的顺序依次插入到表头<br>如果 <code>key</code> 不存在，一个空列表会被创建并执行</td><td style="text-align:center">列表的长度</td></tr><tr><td style="text-align:center"><code>lpushx</code> key value</td><td style="text-align:center">将值 <code>value</code> 插入到列表 <code>key</code> 的表头，当且仅当 <code>key</code> 存在并且是一个列表</td><td style="text-align:center">当 <code>key</code> 不存在时，什么也不做</td><td style="text-align:center">命令执行之后，表的长度</td></tr><tr><td style="text-align:center"><code>rpush</code> key [value]</td><td style="text-align:center">将一个或多个值 <code>value</code> 插入到列表 <code>key</code> 的表尾(最右边)</td><td style="text-align:center"><code>value</code> 值按从左到右的顺序依次插入到表尾<br>如果 <code>key</code> 不存在，一个空列表会被创建并执行</td><td style="text-align:center">命令执行之后，表的长度</td></tr><tr><td style="text-align:center"><code>rpushx</code> key value</td><td style="text-align:center">将值 <code>value</code> 插入到列表 <code>key</code> 的表尾，当且仅当 <code>key</code> 存在并且是一个列表</td><td style="text-align:center">当 <code>key</code> 不存在时，什么也不做</td><td style="text-align:center">命令执行之后，表的长度</td></tr><tr><td style="text-align:center"><code>lpop</code> key</td><td style="text-align:center">移除并返回列表 <code>key</code> 的头元素</td><td style="text-align:center">当 <code>key</code> 不存在时，返回 <code>nil</code></td><td style="text-align:center">列表的头元素</td></tr><tr><td style="text-align:center"><code>rpop</code> key</td><td style="text-align:center">移除并返回列表 <code>key</code> 的尾元素</td><td style="text-align:center">当 <code>key</code> 不存在时，返回 <code>nil</code></td><td style="text-align:center">列表的尾元素</td></tr><tr><td style="text-align:center"><code>rpoplpush</code> source destination</td><td style="text-align:center">将 <code>source</code> 弹出的元素插入到列表 <code>destination</code> ，作为 <code>destination</code> 列表的的头元素</td><td style="text-align:center">如果 <code>source</code> 不存在，值 <code>nil</code> 被返回，并且不执行其他动作</td><td style="text-align:center">被弹出的元素</td></tr><tr><td style="text-align:center"><code>lrem</code> key count value</td><td style="text-align:center">根据参数 <code>count</code> 的值，移除列表中与参数 <code>value</code> 相等的元素</td><td style="text-align:center"><code>count &gt; 0</code> : 从表头开始向表尾搜索，数量为 <code>count</code><br><code>count = 0</code> : 移除表中所有与 <code>value</code> 相等的值</td><td style="text-align:center">被移除元素的数量</td></tr><tr><td style="text-align:center"><code>llen</code> key</td><td style="text-align:center">返回列表 <code>key</code> 的长度</td><td style="text-align:center">如果 <code>key</code> 不存在，则 <code>key</code> 被解释为一个空列表，返回 <code>0</code></td><td style="text-align:center">列表 <code>key</code> 的长度</td></tr><tr><td style="text-align:center"><code>lindex</code> key index</td><td style="text-align:center">返回列表 <code>key</code> 中，下标为 <code>index</code> 的元素</td><td style="text-align:center">你也可以使用负数下标，以 <code>-1</code> 表示列表的最后一个元素<br><code>关于下表都可以试试负数</code></td><td style="text-align:center">列表中下标为 <code>index</code> 的元素<br>如果 <code>index</code> 参数的值不在列表的区间范围内，返回 <code>nil</code></td></tr><tr><td style="text-align:center"><code>linsert</code> key <code>before</code></td><td style="text-align:center"><code>after</code> pivot value</td><td style="text-align:center">将值 <code>value</code> 插入到列表 <code>key</code> 当中，位于值 <code>pivot</code> 之前或之后</td><td style="text-align:center">当 <code>pivot</code> 不存在于列表 <code>key</code> 或者不存在<code>key</code>，不执行任何操作</td></tr><tr><td style="text-align:center"><code>lset</code> key index value</td><td style="text-align:center">将列表 <code>key</code> 下标为 <code>index</code> 的元素的值设置为 <code>value</code></td><td style="text-align:center">当 <code>index</code> 参数超出范围，或对一个空列表( <code>key</code> 不存在)进行时，返回一个错误</td><td style="text-align:center">操作成功返回 <code>ok</code> ，否则返回错误信息</td></tr><tr><td style="text-align:center"><code>lrange</code> key start stop</td><td style="text-align:center">返回列表 <code>key</code> 中指定区间内的元素，区间以偏移量 <code>start</code> 和 <code>stop</code> 指定</td><td style="text-align:center">包含<code>stop</code>元素<br>如果 <code>stop</code> 下标比 <code>end</code> 下标还要大，Redis将 <code>stop</code> 的值设置为 <code>end</code></td><td style="text-align:center">包含指定区间内的元素<br>如果 <code>start</code> 大于<code>list</code>长度就返回空一个列表</td></tr><tr><td style="text-align:center"><code>ltrlm</code> key start stop</td><td style="text-align:center">对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除</td><td style="text-align:center">包含<code>stop</code>元素<br>如果 <code>stop</code> 下标比 <code>end</code> 下标还要大，Redis将 <code>stop</code> 的值设置为 <code>end</code></td><td style="text-align:center">包含指定区间内的元素<br>如果 <code>start</code> 大于<code>list</code>长度就返回空一个列表</td></tr><tr><td style="text-align:center"><code>blpop</code> [key] timeout</td><td style="text-align:center">当给定多个 <code>key</code> 参数时，按参数 <code>key</code> 的先后顺序依次检查各个列表，弹出第一个非空列表的头元素</td><td style="text-align:center">如果列表为空，返回一个 <code>nil</code></td><td style="text-align:center">返回一个含有两个元素的列表，第一个元素是被弹出元素所属的 <code>key</code> ，第二个元素是被弹出元素的值</td></tr><tr><td style="text-align:center"><code>brpop</code> [key] timeout</td><td style="text-align:center">当给定多个 <code>key</code> 参数时，按参数 <code>key</code> 的先后顺序依次检查各个列表，弹出第一个非空列表的尾部元素。</td><td style="text-align:center">假如在指定时间内没有任何元素被弹出，则返回一个 <code>nil</code> 和等待时长</td><td style="text-align:center">返回一个含有两个元素的列表，第一个元素是被弹出元素所属的 <code>key</code> ，第二个元素是被弹出元素的值</td></tr><tr><td style="text-align:center"><code>brpoplpush</code> source destination timeout</td><td style="text-align:center">超时参数 <code>timeout</code> 接受一个以秒为单位的数字作为值。超时参数设为 <code>0</code> 表示阻塞时间可以无限期延长(block indefinitely)</td><td style="text-align:center">假如在指定时间内没有任何元素被弹出，则返回一个 <code>nil</code> 和等待时长</td><td style="text-align:center">反回一个含有两个元素的列表，第一个元素是被弹出元素的值，第二个元素是等待时长</td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis(一) 入门与Redis数据类型</title>
      <link href="/redis/redis-yi-ru-men-yu-redis-shu-ju-lei-xing/"/>
      <url>/redis/redis-yi-ru-men-yu-redis-shu-ju-lei-xing/</url>
      
        <content type="html"><![CDATA[<h1>1. 前言</h1><h2 id="1-1-使用场景">1.1 使用场景</h2><blockquote><p>问题现象</p></blockquote><ul><li>海量用户</li><li>高并发</li></ul><blockquote><p>罪魁祸首——关系型数据库</p></blockquote><ul><li>性能瓶颈：磁盘IO性能低下</li><li>扩展瓶颈：数据关系复杂，扩展性差，不便于大规模集群</li></ul><blockquote><p>解决思路  <code>Nosql</code></p></blockquote><ul><li>降低磁盘IO次数，越低越好 —— 内存存储</li><li>去除数据间关系，越简单越好—— 不存储关系，仅存储数据</li></ul><h2 id="1-2-Nosql">1.2 Nosql</h2><p>NoSQL：即 Not-Only SQL（ 泛指非关系型的数据库），作为关系型数据库的补充<br>Nosql 作用：应对基于海量用户和海量数据前提下的数据处理问题</p><p>特征：</p><ul><li>可扩容，可伸缩</li><li>大数据量下高性能</li><li>灵活的数据模型</li><li>高可用</li></ul><p>常见 Nosql 数据库：</p><ul><li>Redis</li><li>memcache</li><li>HBase</li><li>MongoDB</li></ul><h2 id="1-3-解决方案（电商场景）">1.3 解决方案（电商场景）</h2><blockquote><p>数量小， 变化小   MySQL</p></blockquote><p>商品基本信息：名称、价格、厂商</p><blockquote><p>文档处理   MongoDB</p></blockquote><p>商品附加信息：描述、详情、评论</p><blockquote><p>图片信息   分布式文件系统</p></blockquote><blockquote><p>搜索关键字   ES、Lucene、solr</p></blockquote><blockquote><p><code>热点信息   Redis</code>、memcache、tair</p></blockquote><p><code>高频、波段性</code></p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF%E5%AD%98%E5%82%A8.png" alt="基本信息存储"></p><h1>2. Redis简介</h1><h2 id="2-1-Redis">2.1 Redis</h2><p>概念：<em>Redis (<strong>RE</strong>mote <strong>DI</strong>ctionary <strong>S</strong>erver)</em> 是用 C 语言开发的一个开源的高性能键值对（<code>key-value</code>）数据库</p><p>Redis 特征：</p><ol><li>数据间没有必然的关联关系</li><li>内部采用单线程机制进行工作</li><li>高性能。官方提供测试数据，50个并发执行100000 个请求,读的速度是110000 次/s,写的速度是81000次/s</li><li>多数据类型支持<ul><li>字符串类型 string</li><li>列表类型         list</li><li>散列类型         hash</li><li>集合类型         set</li><li>有序集合类型 sorted_set</li></ul></li><li>持久化支持。可以进行数据灾难恢复</li></ol><h2 id="2-2-Redis-的应用">2.2 Redis 的应用</h2><ul><li>为热点数据加速查询（主要场景），如热点商品、热点新闻、热点资讯、推广类等高访问量信息等</li><li>任务队列，如秒杀、抢购、购票排队等</li><li>即时信息查询，如各位排行榜、各类网站访问统计、公交到站信息、在线人数信息（聊天室、网站）、设备信号等</li><li>时效性信息控制，如验证码控制、投票控制等</li><li>分布式数据共享，如分布式集群架构中的 session 分离</li><li>消息队列</li><li>分布式锁</li></ul><h1>3. Redis 的基本操作</h1><h2 id="3-1-功能性命令">3.1 功能性命令</h2><blockquote><p>信息添加</p><p>功能：设置 key，value 数据</p></blockquote><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> key value</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> name windandstill</span><br></pre></td></tr></tbody></table></figure><blockquote><p>信息查询</p><p>功能：根据 key 查询对应的 value，如果不存在，返回空（nil）</p></blockquote><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get key</span><br><span class="line"></span><br><span class="line">get name</span><br></pre></td></tr></tbody></table></figure><h2 id="3-2-清除屏幕信息">3.2 清除屏幕信息</h2><blockquote><p>功能：清除屏幕中的信息</p></blockquote><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">clear</span></span><br></pre></td></tr></tbody></table></figure><h2 id="3-3-帮助信息查阅">3.3 帮助信息查阅</h2><blockquote><p>功能：获取命令帮助文档，获取组中所有命令信息名称</p></blockquote><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">help 命令名称</span><br><span class="line">help <span class="selector-tag">@</span>组名</span><br></pre></td></tr></tbody></table></figure><h2 id="3-4-退出指令">3.4 退出指令</h2><blockquote><p>退出客户端命令行模式</p><p>功能：退出客户端</p></blockquote><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quit</span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">&lt;ESC&gt;</span><br></pre></td></tr></tbody></table></figure><h1>4. 数据存储类型介绍</h1><h2 id="4-1-redis-数据存储格式">4.1 redis 数据存储格式</h2><ul><li>redis 自身是一个 Map，其中所有的数据都是采用 <code>key : value</code> 的形式存储</li><li>数据类型指的是存储的数据的类型，也就是 <code>value 部分的类型</code>，<code>key 部分永远都是字符串</code></li></ul><h2 id="4-2-string">4.2 string</h2><ul><li><code>存储的数据</code>：单个数据，最简单的数据存储类型，也是最常用的数据存储类型</li><li><code>存储数据的格式</code>：一个存储空间保存一个数据</li><li><code>存储内容</code>：通常使用字符串，如果字符串以整数的形式展示，可以作为数字操作使用</li></ul><p>设置数值数据增加指定范围的值</p><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//设置数值数据减少指定范围的值</span><br><span class="line">incr key</span><br><span class="line">incrby key increment</span><br><span class="line">incrbyfloat key increment</span><br><span class="line">//设置数值数据减少指定范围的值</span><br><span class="line">decr key</span><br><span class="line">decrby key increment</span><br></pre></td></tr></tbody></table></figure><blockquote><p>string 作为数值操作</p></blockquote><ul><li>string在redis内部存储默认就是一个字符串，当遇到增减类操作incr，decr时会转成数值型进行计算</li><li>redis所有的操作都是原子性的，采用单线程处理所有业务，命令是一个一个执行的，因此无需考虑并发带来的数据影响</li><li><code>注意</code>：按数值进行操作的数据，如果原始数据不能转成数值，或超越了redis 数值上限范围，将报错<br> 9223372036854775807（java中long型数据最大值，Long.MAX_VALUE）</li></ul><p>redis用于控制数据库表主键id，为数据库表主键提供生成策略，保障数据库表的主键唯一性<br>此方案适用于所有数据库，且支持数据库集群</p><blockquote><p>常用操作</p></blockquote><table><thead><tr><th>指令</th><th>作用</th></tr></thead><tbody><tr><td><code>set</code> key value</td><td>添加/修改数据</td></tr><tr><td><code>get</code> key</td><td>获取数据</td></tr><tr><td><code>del</code> key</td><td>删除数据</td></tr><tr><td><code>mset</code> key1 value1 key2 value2</td><td>添加/修改多个数据</td></tr><tr><td><code>mget</code> key1 key2</td><td>获取多个数据</td></tr><tr><td><code>strlen</code> key</td><td>获取数据字符个数（字符串长度）</td></tr><tr><td><code>append</code> key value</td><td>追加信息到原始信息后部（如果原始信息存在就追加，否则新建）</td></tr></tbody></table><blockquote><p>设置数据具有指定的生命周期</p></blockquote><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setex key seconds value</span><br><span class="line">psetex key milliseconds value</span><br></pre></td></tr></tbody></table></figure><p>redis 控制数据的生命周期，通过数据是否失效控制业务行为，适用于所有具有时效性限定控制的操作</p><blockquote><p>注意事项</p></blockquote><ul><li><p>数据操作不成功的反馈与数据正常操作之间的差异</p><p>① 表示运行结果是否成功<br>(integer) 0 → false 失败<br>(integer) 1 → true 成功</p><p>② 表示运行结果值<br>(integer) 3 → 3 3个<br>(integer) 1 → 1 1个<br>数据未获取到 （nil）等同于null</p></li><li><p>数据最大存储量 512MB</p></li><li><p>数值计算最大范围（java中的long的最大值）9223372036854775807</p></li></ul><blockquote><p>使用案例</p></blockquote><p><strong>需求</strong>   :主页高频访问信息显示控制，例如新浪微博大V主页显示粉丝数与微博数量</p><p><strong>解决方案</strong></p><ul><li><p>在redis中为大V用户设定用户信息，以用户主键和属性值作为key，后台设定定时刷新策略即可</p><p>eg: user:id :3506728370:fans → 12210947</p><p>eg: user:id :3506728370:blogs → 6164</p><p>eg: user:id :3506728370:focuss → 83</p></li><li><p>在redis中以json格式存储大V用户信息，定时刷新（也可以使用hash类型）</p></li></ul><p>eg: user:id :3506728370 → {“id”:3506728370,“name”:“春晚”,“fans”:12210862,“blogs”:6164, “focus”:83}</p><blockquote><p>string 类型应用场景</p></blockquote><ul><li>redis应用于各种结构型和非结构型高热度数据访问加速</li><li>blog数量粉丝数等</li><li>定时投票</li></ul><blockquote><p>key 的设置约定</p></blockquote><p>数据库中的热点数据key命名惯例</p><p>表名:主键名:主键值:字段名</p><h2 id="4-3-hash">4.3 hash</h2><ul><li><code>新的存储需求</code>：对一系列存储的数据进行编组，方便管理，典型应用存储对象信息</li><li><code>需要的存储结构</code>：一个存储空间保存多个键值对数据</li><li><code>hash类型</code>：底层使用哈希表结构实现数据存储</li></ul><blockquote><p>hash的存储模式为    key hash空间   hash空间里有 filed 和 value</p></blockquote><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/redis%20hash%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt="redis hash存储结构"></p><p>hash存储结构优化</p><ul><li>如果field数量较少，存储结构优化为类数组结构</li><li>如果field数量较多，存储结构使用HashMap结构</li></ul><blockquote><p>常用指令</p></blockquote><table><thead><tr><th>指令</th><th>作用</th></tr></thead><tbody><tr><td><code>hset</code> key field value</td><td>添加/修改数据</td></tr><tr><td><code>hget</code> key field<br><code>hgetall</code> key</td><td>获取数据</td></tr><tr><td><code>hdel</code> key field1 [field2]</td><td>删除数据</td></tr><tr><td><code>hmset</code> key field1 value1 field2 value2</td><td>添加/修改多个数据</td></tr><tr><td><code>hmget</code> key field1 field2</td><td>获取多个数据</td></tr><tr><td><code>hlen</code> key</td><td>获取哈希表中字段的数量</td></tr><tr><td><code>hexists</code> key field</td><td>获取哈希表中是否存在指定的字段</td></tr><tr><td><code>hkeys</code> key<br><code>hvals</code> key</td><td>获取哈希表中所有的字段名或字段值</td></tr><tr><td><code>hincrby</code> key field increment<br><code>hincrbyfloat</code> key field increment</td><td>设置指定字段的数值数据增加指定范围的值</td></tr></tbody></table><blockquote><p>hash 类型数据操作的注意事项</p></blockquote><ul><li>hash类型下的value只能存储字符串，不允许存储其他数据类型，不存在嵌套现象。如果数据未获取到，对应的值为（nil）</li><li>每个 hash 可以存储 2^32 - 1 个键值对</li><li>hash类型十分贴近对象的数据存储形式，并且可以灵活添加删除对象属性<br>但hash设计初衷不是为了存储大量对象而设计的，切记不可滥用，更不可以将hash作为对象列表使用</li><li>hgetall 操作可以获取全部属性，如果内部field过多，遍历整体数据效率就很会低，有可能成为数据访问瓶颈</li></ul><blockquote><p>hash 类型应用场景</p></blockquote><ul><li>购物车数据存储设计</li><li>抢购，限购类、限量发放优惠卷、激活码等业务的数据存储设计</li><li>string存储对象（json）与hash存储对象</li></ul><h2 id="4-4-list">4.4 list</h2><ul><li><code>数据存储需求</code>：存储多个数据，并对数据进入存储空间的顺序进行区分</li><li><code>需要的存储结构</code>：一个存储空间保存多个数据，且通过数据可以体现进入顺序</li><li><code>list类型</code>：保存多个数据，底层使用双向链表存储结构实现</li></ul><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/redis%20list%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt="redis list存储结构"></p><blockquote><p>常用指令</p></blockquote><table><thead><tr><th style="text-align:center">指令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>lpush</code> key [value1]<br><code>rpush</code> key [value1]</td><td style="text-align:center">添加/修改数据</td></tr><tr><td style="text-align:center"><code>lrange</code> key start stop<br><code>lindex</code> key index<br><code>llen</code> key</td><td style="text-align:center">获取数据</td></tr><tr><td style="text-align:center"><code>lpop</code> key<br><code>rpop</code> key</td><td style="text-align:center">获取并移除数据</td></tr><tr><td style="text-align:center"><code>blpop</code> [key1] timeout<br><code>brpop</code> [key1] timeout<br><code>brpoplpush</code> source destination timeout</td><td style="text-align:center">规定时间内获取并移除数据</td></tr><tr><td style="text-align:center"><code>lrem</code> key count value</td><td style="text-align:center">移除指定数据</td></tr></tbody></table><blockquote><p>list 类型数据操作注意事项</p></blockquote><ul><li>list中保存的数据都是string类型的，数据总容量是有限的，最多2 32 - 1 个元素 (4294967295)</li><li>list具有索引的概念，但是操作数据时通常以队列的形式进行入队出队操作，或以栈的形式进行入栈出栈操作</li><li>获取全部数据操作结束索引设置为-1</li><li>list可以对数据进行分页操作，通常第一页的信息来自于list，第2页及更多的信息通过数据库的形式加载</li></ul><blockquote><p>list 类型应用场景</p></blockquote><ul><li>关注列表</li><li>点赞</li><li>资讯</li></ul><h2 id="4-5-set">4.5 set</h2><ul><li><code>新的存储需求</code>：存储大量的数据，在查询方面提供更高的效率</li><li><code>需要的存储结构</code>：能够保存大量的数据，高效的内部存储机制，便于查询</li><li><code>set类型</code>：<code>与hash存储结构完全相同，仅存储键，不存储值（nil），并且值是不允许重复的</code></li></ul><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/redis%20set%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt="redis set存储结构"></p><blockquote><p>常用指令</p></blockquote><table><thead><tr><th style="text-align:center">指令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>sadd</code> key [member1]</td><td style="text-align:center">添加数据</td></tr><tr><td style="text-align:center"><code>smembers</code> key</td><td style="text-align:center">获取全部数据</td></tr><tr><td style="text-align:center"><code>srem</code> key [member1]</td><td style="text-align:center">删除数据</td></tr><tr><td style="text-align:center"><code>scard</code> key</td><td style="text-align:center">获取集合数据总量</td></tr><tr><td style="text-align:center"><code>sismember</code> key member</td><td style="text-align:center">判断集合中是否包含指定数据</td></tr><tr><td style="text-align:center"><code>srandmember</code> key [count]</td><td style="text-align:center">随机获取集合中指定数量的数据</td></tr><tr><td style="text-align:center"><code>spop</code> key [count]</td><td style="text-align:center">随机获取集合中的某个数据并将该数据移出集合</td></tr><tr><td style="text-align:center"><code>sinter</code> [key1]<br><code>sunion</code> [key1]<br><code>sdiff</code> [key1]</td><td style="text-align:center">求两个集合的交、并、差集</td></tr><tr><td style="text-align:center"><code>sinterstore</code> destination [key1]<br><code>sunionstore</code> destination [key1]<br><code>sdiffstore</code> destination [key1]</td><td style="text-align:center">求两个集合的交、并、差集并存储到指定集合中</td></tr><tr><td style="text-align:center"><code>smove</code> source destination member</td><td style="text-align:center">将指定数据从原始集合中移动到目标集合中</td></tr></tbody></table><blockquote><p>注意事项</p></blockquote><ul><li>set 类型不允许数据重复，如果添加的数据在 set 中已经存在，将只保留一份</li><li>set 虽然与hash的存储结构相同，但是无法启用hash中存储值的空间</li></ul><blockquote><p>set 类型应用场景</p></blockquote><ul><li><p>随机推荐类信息检索，例如热点歌单推荐，热点新闻推荐，热卖旅游线路，应用APP推荐， 大V推荐等</p></li><li><p>redis 应用于同类信息的关联搜索，二度关联搜索，深度关联搜索</p><ul><li>显示共同关注（一度）</li><li>由用户A出发，获取到好友用户B的购物清单列表（二度）</li></ul></li><li><p>统计网站的PV（访问量）,UV（独立访客）,IP（独立IP）</p><ul><li>PV：网站被访问次数，可通过刷新页面提高访问量<br>建立string类型数据，利用incr统计日访问量（PV）</li><li>UV：网站被不同用户访问的次数，可通过cookie统计访问量，相同用户切换IP地址，UV不变<br> 建立set模型，记录不同cookie数量（UV）</li><li>IP：网站被不同IP地址访问的总次数，可通过IP地址统计访问量，相同IP不同用户访问，IP不变<br> 建立set模型，记录不同IP数量（IP）</li></ul></li><li><p>黑白名单</p><ul><li>基于经营战略设定问题用户发现、鉴别规则</li><li>周期性更新满足规则的用户黑名单，加入set集合</li><li>用户行为信息达到后与黑名单进行比对，确认行为去向</li><li>黑名单过滤IP地址：应用于开放游客访问权限的信息源</li><li>黑名单过滤设备信息：应用于限定访问设备的信息源</li><li>黑名单过滤用户：应用于基于访问权限的信息源</li></ul></li></ul><h2 id="4-6-sorted-set">4.6 sorted_set</h2><ul><li><code>新的存储需求</code>：数据排序有利于数据的有效展示，需要提供一种可以根据自身特征进行排序的方式</li><li><code>需要的存储结构</code>：新的存储模型，可以保存可排序的数据</li><li><code>sorted_set类型</code>：在set的存储结构基础上添加可排序字段</li></ul><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/sorted_ser%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt="sorted_ser存储结构"></p><blockquote><p>常用指令</p></blockquote><table><thead><tr><th style="text-align:center">指令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center"><code>zadd</code> key [score1 member1]</td><td style="text-align:center">添加数据</td></tr><tr><td style="text-align:center"><code>zrange</code> key start stop [WITHSCORES]<br><code>zrevrange</code> key start stop [WITHSCORES]</td><td style="text-align:center">获取全部数据</td></tr><tr><td style="text-align:center"><code>zrem</code> key [member …]</td><td style="text-align:center">删除数据</td></tr><tr><td style="text-align:center"><code>zrangebyscore</code> key min max [WITHSCORES] [LIMIT]<br><code>zrevrangebyscore</code> key max min [WITHSCORES]</td><td style="text-align:center">按条件获取数据</td></tr><tr><td style="text-align:center"><code>zremrangebyrank</code> key start stop<br><code>zremrangebyscore</code> key min max</td><td style="text-align:center">条件删除数据</td></tr><tr><td style="text-align:center"><code>zcard</code> key<br><code>zcount</code> key min max</td><td style="text-align:center">获取集合数据总量</td></tr><tr><td style="text-align:center"><code>zinterstore</code> destination numkeys [key …]<br><code>zunionstore</code> destination numkeys [key …]</td><td style="text-align:center">集合交、并操作</td></tr><tr><td style="text-align:center"><code>zrank</code> key member<br><code>zrevrank</code> key member</td><td style="text-align:center">获取数据对应的索引（排名）</td></tr><tr><td style="text-align:center"><code>zscore</code> key member<br><code>zincrby</code> key increment member</td><td style="text-align:center">score值获取与修改</td></tr></tbody></table><ul><li><code>min与max用于限定搜索查询的条件</code></li><li><code>start与stop用于限定查询范围，作用于索引，表示开始和结束索引</code></li><li><code>offset与count用于限定查询范围，作用于查询结果，表示开始位置和数据总量</code></li></ul><blockquote><p>sorted_set 类型数据操作的注意事项</p></blockquote><ul><li>score保存的数据存储空间是64位，如果是整数范围是-9007199254740992~9007199254740992</li><li>score保存的数据也可以是一个双精度的double值，基于双精度浮点数的特征，可能会丢失精度，使用时候要慎重</li><li>sorted_set 底层存储还是基于set结构的，因此数据不能重复，如果重复添加相同的数据，score值将被反复覆盖，保留最后一次修改的结果</li></ul><blockquote><p>sorted_set 应用场景</p></blockquote><p>redis 应用于计数器组合排序功能对应的<code>排名</code></p><p>redis 应用于定时任务<code>执行顺序管理</code>或<code>任务过期管理</code></p><h1>5 案例</h1><h2 id="5-1-限次数限时间">5.1 限次数限时间</h2><p>试用用户的使用行为进行限速，限制每个用户每分钟最多发起10次调用</p><blockquote><p>解决方案</p></blockquote><ul><li>设计计数器，记录调用次数，用于控制业务执行次数<br>以用户id作为key，使用次数作为value</li><li>在调用前获取次数，判断是否超过限定次数<br>不超过次数的情况下，每次调用计数+1 业务调用失败，计数-1</li><li>为计数器设置生命周期为指定周期，例如1秒/分钟，自动清空周期内使用次数</li></ul><blockquote><p>改良</p></blockquote><ul><li>取消最大值的判定，利用incr操作超过最大值抛出异常的形式替代每次判断是否大于最大值</li><li>判断是否为nil<br>如果是，设置为Max-次数<br>如果不是，计数+1 业务调用失败，计数-1</li><li>遇到异常即+操作超过上限，视为使用达到上限</li></ul><h2 id="5-2-消息提醒">5.2 消息提醒</h2><p>指定消息 消息的显示先后顺序</p><blockquote><p>解决方案</p></blockquote><ul><li>依赖list的数据具有顺序的特征对消息进行管理，将list结构作为栈使用</li><li>对置顶与普通会话分别创建独立的list分别管理</li><li>当某个list中接收到用户消息后，将消息发送方的id从list的一侧加入list（此处设定左侧）</li><li>多个相同id发出的消息反复入栈会出现问题，在入栈之前无论是否具有当前id对应的消息，先删除对应id</li><li>推送消息时先推送置顶会话list，再推送普通会话list，推送完成的list清除所有数据</li><li>消息的数量，也就是微信用户对话数量采用计数器的思想另行记录，伴随list操作同步更新</li></ul>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>北斗卫星实时单点定位与精度分析</title>
      <link href="/bei-dou-wei-xing-shi-shi-dan-dian-ding-wei-yu-jing-du-fen-xi/"/>
      <url>/bei-dou-wei-xing-shi-shi-dan-dian-ding-wei-yu-jing-du-fen-xi/</url>
      
        <content type="html"><![CDATA[<h1>导航电文格式解读</h1><p>C01 2021 12 01 00 00 00-0.392390531488E-03 0.396518373691E-10 0.000000000000E+00<br>0.100000000000E+01 0.923312500000E+03-0.175864468318E-08 0.562177079103E-01<br>0.299839302897E-04 0.664370250888E-03 0.300258398056E-05 0.649344501495E+04<br>0.259200000000E+06-0.103842467070E-06-0.306687686883E+01-0.428408384323E-07<br>0.803862571188E-01-0.865156250000E+02-0.697794080599E+00 0.264403870625E-08<br>-0.402159608705E-09 0.160000000000E+02 0.830000000000E+03 0.000000000000E+00<br>0.200000000000E+01 0.000000000000E+00-0.560000000000E-08-0.104000000000E-07<br>0.259200000000E+06 0.000000000000E+00</p><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">第一行</button></li><li class="tab"><button type="button" data-href="#1-2">第二行</button></li><li class="tab"><button type="button" data-href="#1-3">第三行</button></li><li class="tab"><button type="button" data-href="#1-4">第四行</button></li><li class="tab"><button type="button" data-href="#1-5">第五行</button></li><li class="tab"><button type="button" data-href="#1-6">第六行</button></li><li class="tab"><button type="button" data-href="#1-7">第七行</button></li><li class="tab"><button type="button" data-href="#1-8">第八行</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><table><thead><tr><th>名称</th><th>对应数值</th></tr></thead><tbody><tr><td>卫星系统</td><td>C</td></tr><tr><td>卫星编号(PRN)</td><td>01</td></tr><tr><td>BDT时间的年</td><td>2021</td></tr><tr><td>月、日、时、分、秒</td><td>12 01 00 00 00</td></tr><tr><td>卫星时钟偏差钟差(S)</td><td>-0.392390531488E-03</td></tr><tr><td>卫星时钟漂移(S/S)</td><td>0.396518373691E-10</td></tr><tr><td>卫星时钟漂移率(S/<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>S</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">S^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>)</td><td>0.000000000000E+00</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><table><thead><tr><th>名称</th><th>对应数值</th></tr></thead><tbody><tr><td>星历数据的有效龄期</td><td>0.100000000000E+01</td></tr><tr><td>Crs轨道半径正弦改正项</td><td>0.923312500000E+03</td></tr><tr><td>△n平均运动修正量</td><td>-0.175864468318E-08</td></tr><tr><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>M</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">M_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> toe时的平近点角</td><td>0.562177079103E-01</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><table><thead><tr><th>名称</th><th>对应数值</th></tr></thead><tbody><tr><td>Cuc 纬度幅角余弦改正项</td><td>0.299839302897E-04</td></tr><tr><td>e 卫星轨道偏心率</td><td>0.664370250888E-03</td></tr><tr><td>Cus 纬度幅角正弦改正项</td><td>0.300258398056E-05</td></tr><tr><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mi>A</mi></msqrt></mrow><annotation encoding="application/x-tex">\sqrt A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1133em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9267em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="padding-left:0.833em;">A</span></span><span style="top:-2.8867em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1133em;"><span></span></span></span></span></span></span></span></span> 轨道长半径平根</td><td>0.649344501495E+04</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><table><thead><tr><th>名称</th><th>对应数值</th></tr></thead><tbody><tr><td>toe 星历的基准时间</td><td>0.259200000000E+06</td></tr><tr><td>Cic 轨道倾角余弦调和项</td><td>-0.103842467070E-06</td></tr><tr><td>Ω 升交点赤经</td><td>-0.306687686883E+01</td></tr><tr><td>Cis 轨道倾角正弦项</td><td>-0.428408384323E-07</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><table><thead><tr><th>名称</th><th>对应数值</th></tr></thead><tbody><tr><td>I 轨道倾角</td><td>0.803862571188E-01</td></tr><tr><td>Crc 轨道半径余弦调和项</td><td>-0.865156250000E+02</td></tr><tr><td>ω 近地点角距</td><td>-0.697794080599E+00</td></tr><tr><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Ω</mi><mrow><mi>d</mi><mi>o</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Ω_{dot}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 升交点赤经变率</td><td>0.264403870625E-08</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-6"><table><thead><tr><th>名称</th><th>对应数值</th></tr></thead><tbody><tr><td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mrow><mi>d</mi><mi>o</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">I_{dot}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 轨道倾角变化率</td><td>-0.402159608705E-09</td></tr><tr><td>L2</td><td>0.160000000000E+02</td></tr><tr><td>GPS星期数（TOE）</td><td>0.830000000000E+03</td></tr><tr><td>L2P数据标志</td><td>0.000000000000E+00</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-7"><table><thead><tr><th>名称</th><th>对应数值</th></tr></thead><tbody><tr><td>卫星精度（m）</td><td>0.200000000000E+01</td></tr><tr><td>卫星健康（MSB）</td><td>0.000000000000E+00</td></tr><tr><td>TGD单频机延迟改正数</td><td>-0.560000000000E-08</td></tr><tr><td>IODC时钟数据有效期</td><td>-0.104000000000E-07</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-8"><table><thead><tr><th>名称</th><th>对应数值</th></tr></thead><tbody><tr><td>电文发送时间</td><td>0.259200000000E+06</td></tr><tr><td>拟合区间（h）</td><td>0.000000000000E+00</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Zookeeper注册中心</title>
      <link href="/hu-lian-wang-xiang-mu-jia-gou/zookeeper/zookeeper-zhu-ce-zhong-xin/"/>
      <url>/hu-lian-wang-xiang-mu-jia-gou/zookeeper/zookeeper-zhu-ce-zhong-xin/</url>
      
        <content type="html"><![CDATA[<h1>1. Zookeeper概念</h1><ul><li>Zookeeper 是 Apache Hadoop 项目下的一个子项目，是一个树形目录服务</li><li>Zookeeper 是一个分布式的、开源的分布式应用程序的协调服务</li><li>Zookeeper 提供的主要功能包括<ul><li>配置管理</li><li>分布式锁</li><li>集群管理</li></ul></li></ul><h1>2. ZooKeeper 命令操作</h1><h2 id="2-1-Zookeeper-数据模型">2.1 Zookeeper 数据模型</h2><ul><li>ZooKeeper 是一个树形目录服务,其数据模型和Unix的文件系统目录树很类似，拥有一个层次化结构</li><li>这里面的每一个节点都被称为： ZNode，每个节点上都会保存自己的数据和节点信息</li><li>节点可以拥有子节点，同时也允许少量（1MB）数据存储在该节点之下</li></ul><blockquote><p>节点可以分为四大类</p></blockquote><ul><li>PERSISTENT 持久化节点</li><li>EPHEMERAL 临时节点 ：-e</li><li>PERSISTENT_SEQUENTIAL 持久化顺序节点 ：-s</li><li>EPHEMERAL_SEQUENTIAL 临时顺序节点 ：-es</li></ul><h2 id="2-2-Zookeeper-服务端常用命令">2.2 Zookeeper 服务端常用命令</h2><ul><li>启动 ZooKeeper 服务: ./zkServer.sh start</li><li>查看 ZooKeeper 服务状态: ./zkServer.sh status</li><li>停止 ZooKeeper 服务: ./zkServer.sh stop</li><li>重启 ZooKeeper 服务: ./zkServer.sh restart</li></ul><h2 id="2-3-Zookeeper-客户端常用命令">2.3 Zookeeper 客户端常用命令</h2><table><thead><tr><th>指令</th><th>作用</th></tr></thead><tbody><tr><td>./zkCli.sh –server ip:port</td><td>连接ZooKeeper服务端</td></tr><tr><td>quit</td><td>断开连接</td></tr><tr><td>help</td><td>查看命令帮助</td></tr><tr><td>ls 目录</td><td>显示指定目录下节点</td></tr><tr><td>create /节点path value</td><td>创建节点</td></tr><tr><td>get /节点path</td><td>获取节点值</td></tr><tr><td>set /节点path value</td><td>设置节点值</td></tr><tr><td>delete /节点path</td><td>删除单个节点</td></tr><tr><td>deleteall /节点path</td><td>删除带有子节点的节点</td></tr><tr><td>create -e /节点path value</td><td>创建临时节点</td></tr><tr><td>create -s /节点path value</td><td>创建顺序节点</td></tr><tr><td>ls –s /节点path</td><td>查询节点详细信息</td></tr></tbody></table><blockquote><p>详细信息含义</p></blockquote><table><thead><tr><th>名称</th><th>含义</th></tr></thead><tbody><tr><td>czxid</td><td>节点被创建的事务ID</td></tr><tr><td>ctime</td><td>创建时间</td></tr><tr><td>mzxid</td><td>最后一次被更新的事务ID</td></tr><tr><td>mtime</td><td>修改时间</td></tr><tr><td>pzxid</td><td>子节点列表最后一次被更新的事务ID</td></tr><tr><td>cversion</td><td>子节点的版本号</td></tr><tr><td>dataversion</td><td>数据版本号</td></tr><tr><td>aclversion</td><td>权限版本号</td></tr><tr><td>ephemeralOwner</td><td>用于临时节点，代表临时节点的事务ID，如果为持久节点则为0</td></tr><tr><td>dataLength</td><td>节点存储的数据的长度</td></tr><tr><td>numChildren</td><td>当前节点的子节点个数</td></tr></tbody></table><h1>3. ZooKeeper JavaAPI 操作</h1><h2 id="3-1-Curator-介绍">3.1 Curator 介绍</h2><ul><li><p>Curator 是 Apache ZooKeeper 的Java客户端库</p></li><li><p>常见的ZooKeeper Java API ：</p><ul><li>原生Java API</li><li>ZkClient</li><li>Curator</li></ul></li><li><p>Curator 项目的目标是简化 ZooKeeper 客户端的使用</p></li></ul><p><strong>Curator 最初是 Netfix 研发的,后来捐献了 Apache 基金会,目前是 Apache 的顶级项目</strong></p><h2 id="3-2-Curator-API-常用操作">3.2 Curator API 常用操作</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">pom.xml</button></li><li class="tab"><button type="button" data-href="#1-2">修改节点</button></li><li class="tab"><button type="button" data-href="#1-3">建立连接</button></li><li class="tab"><button type="button" data-href="#1-4">添加节点</button></li><li class="tab"><button type="button" data-href="#1-5">删除节点</button></li><li class="tab"><button type="button" data-href="#1-6">修改节点</button></li><li class="tab"><button type="button" data-href="#1-7">查询节点</button></li><li class="tab"><button type="button" data-href="#1-8">Watch事件监听</button></li><li class="tab"><button type="button" data-href="#1-9">分布式锁实现</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--curator--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//建立连接</span></span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnect</span><span class="params">()</span> {</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * @param connectString       连接字符串。zk server 地址和端口 "192.168.149.135:2181,192.168.149.136:2181"</span></span><br><span class="line"><span class="comment">        * @param sessionTimeoutMs    会话超时时间 单位ms</span></span><br><span class="line"><span class="comment">        * @param connectionTimeoutMs 连接超时时间 单位ms</span></span><br><span class="line"><span class="comment">        * @param retryPolicy         重试策略</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">      <span class="comment">//重试策略</span></span><br><span class="line">       <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);</span><br><span class="line">       <span class="comment">//1.第一种方式</span></span><br><span class="line">       <span class="type">CuratorFramework</span> <span class="variable">client</span> <span class="operator">=</span> CuratorFrameworkFactory.newClient(<span class="string">"192.168.149.135:2181"</span>,</span><br><span class="line">               <span class="number">60</span> * <span class="number">1000</span>, <span class="number">15</span> * <span class="number">1000</span>, retryPolicy);</span><br><span class="line">       <span class="comment">//重试策略</span></span><br><span class="line">       <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>, <span class="number">10</span>);</span><br><span class="line">       <span class="comment">//2.第二种方式 链式编程 namespace表示只使用该名称下的空间</span></span><br><span class="line">       <span class="comment">//CuratorFrameworkFactory.builder();</span></span><br><span class="line">       client = CuratorFrameworkFactory.builder()</span><br><span class="line">               .connectString(<span class="string">"192.168.149.135:2181"</span>)</span><br><span class="line">               .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">               .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">               .retryPolicy(retryPolicy)</span><br><span class="line">               .namespace(<span class="string">"itheima"</span>)</span><br><span class="line">               .build();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//开启连接</span></span><br><span class="line">       client.start();</span><br><span class="line">   }</span><br><span class="line"><span class="comment">//最后要关闭连接</span></span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> {</span><br><span class="line">       <span class="keyword">if</span> (client != <span class="literal">null</span>) {</span><br><span class="line">           client.close();</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><p>创建节点：create 持久 临时 顺序 数据</p><ol><li><p>基本创建 ：create().forPath(“”)</p></li><li><p>创建节点 带有数据:create().forPath(“”,data)</p></li><li><p>设置节点的类型：create().withMode().forPath(“”,data)</p></li><li><p>创建多级节点  /app1/p1 ：create().creatingParentsIfNeeded().forPath(“”,data)</p></li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreate2</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">       <span class="comment">//1. 基本创建</span></span><br><span class="line">       <span class="comment">//如果创建节点，没有指定数据，则默认将当前客户端的ip作为数据存储</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> client.create().forPath(<span class="string">"/app1"</span>);</span><br><span class="line">       System.out.println(path);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreate</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">       <span class="comment">//2. 创建节点 带有数据</span></span><br><span class="line">       <span class="comment">//如果创建节点，没有指定数据，则默认将当前客户端的ip作为数据存储</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> client.create().forPath(<span class="string">"/app2"</span>, <span class="string">"hehe"</span>.getBytes());</span><br><span class="line">       System.out.println(path);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreate3</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">       <span class="comment">//3. 设置节点的类型</span></span><br><span class="line">       <span class="comment">//默认类型：持久化 可以设置临时节点 如果要用linux查看需要用个while(true)循环保证节点不关闭</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> client.create().withMode(CreateMode.EPHEMERAL).forPath(<span class="string">"/app3"</span>);</span><br><span class="line">       System.out.println(path);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreate4</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">       <span class="comment">//4. 创建多级节点  /app1/p1</span></span><br><span class="line">       <span class="comment">//creatingParentsIfNeeded():如果父节点不存在，则创建父节点</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> client.create().creatingParentsIfNeeded().forPath(<span class="string">"/app4/p1"</span>);</span><br><span class="line">       System.out.println(path);</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-6"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-7"><p>查询节点：</p><ol><li>查询数据：get: getData().forPath()</li><li>查询子节点： ls: getChildren().forPath()</li><li>查询节点状态信息：ls -s:getData().storingStatIn(状态对象).forPath()</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet1</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="comment">//1. 查询数据：get</span></span><br><span class="line">    <span class="type">byte</span>[] data = client.getData().forPath(<span class="string">"/app1"</span>);</span><br><span class="line">    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet2</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="comment">// 2. 查询子节点： ls</span></span><br><span class="line">    List&lt;String&gt; path = client.getChildren().forPath(<span class="string">"/"</span>);</span><br><span class="line">    System.out.println(path);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet3</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="type">Stat</span> <span class="variable">status</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Stat</span>();</span><br><span class="line">    System.out.println(status);</span><br><span class="line">    <span class="comment">//3. 查询节点状态信息：ls -s 版本升级后get不能查询状态信息但api没有变还是用getData</span></span><br><span class="line">    client.getData().storingStatIn(status).forPath(<span class="string">"/app1"</span>);</span><br><span class="line">    System.out.println(status);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-8"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-9"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
          <category> 项目架构 </category>
          
          <category> Zookeeper </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 项目架构 </tag>
            
            <tag> Zookeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dubbo项目架构</title>
      <link href="/hu-lian-wang-xiang-mu-jia-gou/dubbo/dubbo-xiang-mu-jia-gou/"/>
      <url>/hu-lian-wang-xiang-mu-jia-gou/dubbo/dubbo-xiang-mu-jia-gou/</url>
      
        <content type="html"><![CDATA[<p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Dubbo%E5%8E%9F%E7%90%86%E8%BF%90%E8%A1%8C%E5%9B%BE.png" alt="Dubbo原理运行图"></p><p>实现步骤</p><ol><li><p>创建服务提供者Provider模块</p></li><li><p>创建服务消费者Consumer模块</p></li><li><p>在服务提供者模块编写 UserServiceImpl 提供服务</p></li><li><p>在服务消费者中的 UserController 远程调用UserServiceImpl 提供的服务</p></li><li><p>分别启动两个服务，测试</p></li></ol><h1>1. 传统Srping和SpringMVC整合</h1><h2 id="大致思路">大致思路</h2><blockquote><ol><li>统一包版本 导入spring包</li></ol></blockquote><blockquote><ol start="2"><li>编写dubbo-service<ol><li>UserService接口</li><li>impl实现接口并加上Service注解</li><li>applciationContext包扫描</li></ol></li></ol></blockquote><blockquote><ol start="3"><li><p>编写dubbo-web</p><ol><li><p>UserController</p><ul><li><p>Controller注解</p></li><li><p>注入UserService</p></li><li><p>设置RequestMapping</p></li></ul></li><li><p>springmvc</p><ul><li>注解驱动</li><li>包扫描</li></ul></li><li><p>web中编写</p><ul><li><p>spring的监听器</p></li><li><p>前端控制器</p></li><li><p>contextConfigLocation扫描</p></li><li><p>Servletmapping</p></li></ul></li><li><p>在web pom.xml中加入service的依赖</p></li></ol></li></ol></blockquote><h2 id="1-1-dubbo-service">1.1 dubbo-service</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">pom.xml</button></li><li class="tab"><button type="button" data-href="#1-2">UserService</button></li><li class="tab"><button type="button" data-href="#1-3">UserServiceImpl</button></li><li class="tab"><button type="button" data-href="#1-4">applciationContext</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>2.7.4.1<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper.version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">zookeeper.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- servlet3.0规范的坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springmvc的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Dubbo的起步依赖，版本2.7之后统一为rg.apache.dubb --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${zookeeper.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${zookeeper.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--依赖service模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.jyw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.jyw.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> {</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.jyw.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.jyw.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello dubbo!~"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!--注解包扫描--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw.service"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <h2 id="1-2-dubbo-web">1.2 dubbo-web</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">pom.xml</button></li><li class="tab"><button type="button" data-href="#1-2">web.xml</button></li><li class="tab"><button type="button" data-href="#1-3">springmvc</button></li><li class="tab"><button type="button" data-href="#1-4">UserController</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>2.7.4.1<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper.version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">zookeeper.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- servlet3.0规范的坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springmvc的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Dubbo的起步依赖，版本2.7之后统一为rg.apache.dubb --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${zookeeper.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${zookeeper.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--依赖service模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.jyw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--tomcat插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">port</span>&gt;</span>8000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">   <span class="comment">&lt;!-- spring --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:spring/applicationContext*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">   <span class="comment">&lt;!-- Springmvc --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--注解驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw.controller"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入Service</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping("/sayHello")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> userService.sayHello();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div> <blockquote><p><strong>dubbo-service是被依赖的所以需要先maven安装一下</strong></p></blockquote><h1>2. 改造成Dubbo项目</h1><h2 id="大致思路-2">大致思路</h2><blockquote><ol><li>统一包版本 导入 spring 包与dubbo包</li></ol></blockquote><blockquote><ol start="2"><li>提取接口 dubbo-interface<ol><li>pom.xml声明</li><li>UserService接口</li></ol></li></ol></blockquote><blockquote><ol start="3"><li><p>编写dubbo-service</p><ol><li><p>编写UserServiceImpl接口 使用dubbo的Service注解对外发布</p></li><li><p>实现UserService接口</p></li><li><p>配置applicationContext 使用的dubbo就配置dubbo</p><ul><li><p>项目名称</p></li><li><p>注册中心地址</p></li><li><p>包扫描</p></li></ul></li><li><p>web.xml</p><ul><li>spring监听器</li><li>contextConfigLocation</li></ul></li><li><p>pom.xml依赖公共接口模块</p></li></ol></li></ol></blockquote><blockquote><ol start="4"><li><p>编写Dubbo-web</p><ol><li><p>编写UserController</p><ul><li>Controller 与 RequstMapping注解</li><li>用Reference远程注入UserService</li></ul></li></ol></li><li><p>编写springmvc.xml</p><ul><li>注解驱动<ul><li>包扫描</li><li>配置dubbo</li></ul></li></ul><ol start="3"><li><p>配置web.xml</p><ul><li>加载前端控制器</li></ul></li></ol><ul><li>contextConfigLocation<ul><li>servletmapping</li></ul></li></ul></li><li><p>pom.xml依赖公共接口模块</p></li></ol></blockquote><h2 id="2-1-提取接口-dubbo-interface">2.1 提取接口 dubbo-interface</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">pom.xml</button></li><li class="tab"><button type="button" data-href="#1-2">UserService</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.jyw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-2-服务提供者Dubbo-service">2.2 服务提供者Dubbo-service</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">pom.xml</button></li><li class="tab"><button type="button" data-href="#1-2">UserServiceImpl</button></li><li class="tab"><button type="button" data-href="#1-3">applicationContext.xml</button></li><li class="tab"><button type="button" data-href="#1-4">web.xml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>2.7.4.1<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper.version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">zookeeper.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- servlet3.0规范的坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springmvc的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Dubbo的起步依赖，版本2.7之后统一为rg.apache.dubb --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${zookeeper.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${zookeeper.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--依赖公共的接口模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.jyw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--tomcat插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">port</span>&gt;</span>9000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Service//将该类的对象创建出来，放到Spring的IOC容器中  bean定义</span></span><br><span class="line"><span class="comment">//从spring包下的service 换成 dubbo包下的service</span></span><br><span class="line"><span class="meta">@Service</span><span class="comment">//将这个类提供的方法（服务）对外发布。将访问的地址 ip，端口，路径注册到注册中心中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello dubbo hello!~"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--&lt;context:component-scan base-package="cn.jyw.service" /&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--dubbo的配置--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--1.配置项目的名称,唯一--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo-service"</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--2.配置注册中心的地址--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://192.168.114.130:2181"</span>/&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--3.配置dubbo包扫描--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">"cn.jyw.service.impl"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">   <span class="comment">&lt;!-- spring --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:spring/applicationContext*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-3-服务消费者Dubbo-web">2.3 服务消费者Dubbo-web</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">pom.xml</button></li><li class="tab"><button type="button" data-href="#1-2">UserController</button></li><li class="tab"><button type="button" data-href="#1-3">springmvc.xml</button></li><li class="tab"><button type="button" data-href="#1-4">web.xml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>2.7.4.1<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">zookeeper.version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">zookeeper.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- servlet3.0规范的坐标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springmvc的坐标--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Dubbo的起步依赖，版本2.7之后统一为rg.apache.dubb --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${zookeeper.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ZooKeeper客户端实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${zookeeper.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--依赖公共的接口模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.jyw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--依赖service模块--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;cn.jyw&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;dubbo-service&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--tomcat插件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">port</span>&gt;</span>8000<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入Service</span></span><br><span class="line">    <span class="comment">//@Autowired//本地注入</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1. 从zookeeper注册中心获取userService的访问url</span></span><br><span class="line"><span class="comment">        2. 进行远程调用RPC</span></span><br><span class="line"><span class="comment">        3. 将结果封装为一个代理对象。给变量赋值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span><span class="comment">//远程注入</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping("/sayHello")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> userService.sayHello();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">"http://dubbo.apache.org/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">         http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw.controller"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--dubbo的配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.配置项目的名称,唯一--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo-web"</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!--同一台机器上端口占用 不过不影响--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">"qos.port"</span> <span class="attr">value</span>=<span class="string">"33333"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dubbo:application</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2.配置注册中心的地址--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://192.168.114.130:2181"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--3.配置dubbo包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">"cn.jyw.controller"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Springmvc --&gt;</span>   </span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>将提供者和消费的结构提取出来,改动只用改动公共接口即可</p></blockquote><h1>3. Dubbo高级特性</h1><h2 id="3-1-序列化">3.1 序列化</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Dubbo%E5%BA%8F%E5%88%97%E5%8C%96.png" alt="Dubbo序列化"></p><p>​实现序列化接口 <strong>implements</strong> Serializable</p><ul><li>dubbo 内部已经将序列化和反序列化的过程内部封装了</li><li>我们只需要在定义pojo类时**<code>实现Serializable接口</code>**即可</li><li>一般会定义一个公共的pojo模块，让生产者和消费者都依赖该模块</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.jyw.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 注意！！！</span></span><br><span class="line"><span class="comment"> *  将来所有的pojo类都需要实现Serializable接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, String username, String password)</span> {</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> {</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> {</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> {</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="3-2-地址缓存">3.2 地址缓存</h2><p><strong>注册中心挂了，服务是否可以正常访问？</strong></p><ul><li>可以，因为dubbo服务消费者在第一次调用时，会将服务提供方地址缓存到本地，以后在调用则不会访问注册中心</li><li>当服务提供者地址发生变化时，注册中心会通知服务消费者</li><li>如果服务提供者的地址发生变化，而注册中心又没有反应就会无法正常访问</li></ul><h2 id="3-3-超时与重试">3.3 超时与重试</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Dubbo%E7%9A%84%E8%B6%85%E6%97%B6%E4%B8%8E%E9%87%8D%E8%AF%95.png" alt="Dubbo的超时与重试"></p><p>基本流程</p><ol><li>用户来访问<strong>服务消费者</strong></li><li><strong>服务消费者</strong><code>创建线程</code>单独访问<strong>服务提供者</strong>调用服务</li><li><strong>服务提供者</strong>处理好数据返回结果给<strong>服务消费者</strong></li><li><strong>服务消费者</strong>封装结果给用户</li></ol><p>特殊情况</p><ul><li>服务消费者在调用服务提供者的时候发生了阻塞、等待的情形，这个时候，服务消费者会一直等待下去</li><li>在某个峰值时刻，大量的请求都在同时请求服务消费者，会造成线程的大量堆积，势必会造成雪崩</li></ul><blockquote><p>dubbo 利用超时机制来解决这个问题，设置一个超时时间，在这个时间段内，无法完成服务访问，则自动断开连接<br>使用timeout属性配置超时时间，默认值1000，单位毫秒</p></blockquote><ul><li>设置了超时时间，在这个时间段内，无法完成服务访问，则自动断开连接</li><li>如果出现网络抖动，则这一次请求就会失败</li><li>Dubbo 提供重试机制来避免类似问题的发生</li><li>通过 retries  属性来设置重试次数。<strong>默认为 2 次</strong><code>加上开始的一次一共三次</code></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//服务的提供者的Service注解</span></span><br><span class="line"><span class="meta">@Service(timeout = 3000,retries = 2)</span><span class="comment">//当前服务3秒超时,重试2次，一共3次</span></span><br><span class="line"><span class="comment">//服务的消费者的Reference注解</span></span><br><span class="line"><span class="meta">@Reference(timeout = 1000)</span><span class="comment">//远程注入</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>一般建议将timeout配置在服务的提供者Service这里 服务的消费者Reference可以覆盖Service的超时</p></blockquote><h2 id="3-4-多版本">3.4 多版本</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Dubbo%E5%A4%9A%E7%89%88%E6%9C%AC.png" alt="Dubbo多版本"></p><ul><li><p><code>灰度发布</code>：<strong>当出现新功能时，会让一部分用户先使用新功能，用户反馈没问题时，再将所有用户迁移到新功能</strong></p></li><li><p>dubbo 中使用version 属性来设置和调用同一个接口的不同版本</p></li></ul><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">服务提供者</button></li><li class="tab"><button type="button" data-href="#1-2">服务消费者v1.0</button></li><li class="tab"><button type="button" data-href="#1-3">服务消费者v2.0</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reference(version = "v2.0")</span><span class="comment">//远程注入 选择版本</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(version = "v1.0")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> </span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(version = "v2.0")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl2</span> <span class="keyword">implements</span> <span class="title class_">UserService</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="3-5-负载均衡">3.5 负载均衡</h2><blockquote><p>@Service(weight = 100)</p><p>在服务提供者的@Service上选择权重默认100</p><p>@Reference(loadbalance = “random”)//远程注入</p><p>在服务消费者的@Reference上选择均衡负载类型</p></blockquote><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Dubbo%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.png" alt="Dubbo负载均衡"></p><p>负载均衡策略（4种）：</p><ul><li><p>Random ：按权重随机，默认值。按权重设置随机概率</p><p>随机概率为(权重)/(总权重)</p></li><li><p>RoundRobin ：按权重轮询</p><p>每次轮询各个机器所占比例根据权重固定</p></li><li><p>LeastActive：最少活跃调用数，相同活跃数的随机</p><p>根据服务提供者的活跃程度进行调用</p></li><li><p>ConsistentHash：一致性 Hash，相同参数的请求总是发到同一提供者</p><p>根据请求参数的值，利用Hash算法得出要去哪个服务提供者（值相同Hash就相同，就会一直去相同的服务提供者）</p></li></ul><h2 id="3-6-集群容错">3.6 集群容错</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Dubbo%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99.png" alt="Dubbo集群容错"></p><blockquote><p>@Refernece(cluster = “failove”) //默认重试</p></blockquote><p>集群容错模式：</p><ul><li>Failover Cluster：<code>失败重试</code>。默认值。当出现失败，重试其它服务器 ，默认重试2次，使用 retries 配置<br>一般用于读操作</li><li>Failfast Cluster ：<code>快速失败</code>，只发起一次调用，失败立即报错<br>通常用于写操作。</li><li>Failsafe Cluster ：<code>失败安全</code>，出现异常时，直接忽略，返回一个空结果</li><li>Failback Cluster ：<code>失败自动恢复</code>，后台记录失败请求，定时重发<br>通常用于消息通知操作。</li><li>Forking Cluster ：<code>并行调用多个服务器</code>，只要一个成功即返回(<code>比较耗性能</code>)</li><li>Broadcast  Cluster ：<code>广播调用所有提供者</code>，逐个调用，任意一台报错则报错</li></ul><h2 id="3-7-服务降级">3.7 服务降级</h2><p>服务降级方式:</p><ul><li><p><code>mock= force:return null</code>表示消费方对该服务的方法调用都直接返回null值,不发起远程调用<br>用来屏蔽不重要服务不可用时对调用方的影响</p></li><li><p><code>mock=fail:return null</code>表示消费方对该服务的方法调用在失败后，再返回null值,不抛异常<br>用来容忍不重要服务不稳定时对调用方的影响</p></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reference(mock = "fail:return null")</span><span class="comment">//不在调用userservice的服务</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
          <category> 项目架构 </category>
          
          <category> Dubbo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 项目架构 </tag>
            
            <tag> Dubbo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>互联网项目架构</title>
      <link href="/hu-lian-wang-xiang-mu-jia-gou/hu-lian-wang-xiang-mu-jia-gou/"/>
      <url>/hu-lian-wang-xiang-mu-jia-gou/hu-lian-wang-xiang-mu-jia-gou/</url>
      
        <content type="html"><![CDATA[<h1>1. 大型互联网项目架构目标</h1><h2 id="1-1-传统项目">1.1 传统项目</h2><blockquote><p>一般为企业员工使用 一般能用就行 使用人数少  小型的内部项目</p></blockquote><h2 id="1-2-互联网项目">1.2 互联网项目</h2><blockquote><p>注重用户体验 :<strong><code>美观</code><code>功能</code><code>速度</code><code>稳定性</code></strong></p></blockquote><blockquote><p>互联网项目的特点</p></blockquote><ul><li>用户多</li><li>流量大,并发高</li><li>海量数据</li><li>易受攻击</li><li>功能繁琐</li><li>变更块</li></ul><h2 id="1-3-大型互联网项目架构目标">1.3 大型互联网项目架构目标</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">高性能</button></li><li class="tab"><button type="button" data-href="#1-2">高可用</button></li><li class="tab"><button type="button" data-href="#1-3">可伸缩</button></li><li class="tab"><button type="button" data-href="#1-4">高可扩展</button></li><li class="tab"><button type="button" data-href="#1-5">安全性</button></li><li class="tab"><button type="button" data-href="#1-6">敏捷性</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><blockquote><p>提供快速的访问体验</p></blockquote><blockquote><p>衡量网站的性能指标</p></blockquote><ul><li><strong>响应时间</strong>：指执行一个请求从开始到最后收到响应数据所花费的总体时间</li><li><strong>并发数</strong>：指系统同时能处理的请求数量<ul><li><strong>并发连接数</strong>：指的是客户端向服务器发起请求，并建立了TCP连接。每秒钟服务器连接的总TCP数量</li><li><strong>请求数</strong>：也称为QPS(Query Per Second) 指每秒多少请求</li><li><strong>并发用户数</strong>：单位时间内有多少用户</li></ul></li><li><strong>吞吐量</strong>：指单位时间内系统能处理的请求数量<ul><li><strong>QPS</strong>：Query Per Second 每秒查询数</li><li><strong>TPS</strong>：Transactions Per Second 每秒事务数</li><li>一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程<br>客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数</li><li>一个页面的一次访问，只会形成一个TPS<br>但一次页面请求，可能产生多次对服务器的请求，就会有多个QPS</li></ul></li></ul><p><code>QPS &gt;= 并发连接数 &gt;= TPS</code></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>网站服务一直可以正常访问</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p>通过硬件增加/减少，提高/降低处理能力</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><p>系统间耦合低，方便的通过新增/移除方式，增加/减少新的功能/模块</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><p>提供网站安全访问和数据加密，安全存储等策略</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-6"><p>随需应变，快速响应</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>2. 集群和分布式</h1><blockquote><p>集群:许多模块一起,干一样的事</p><ul><li>一个业务模块，部署在多台服务器</li></ul><p>分布式:很多模块一起,但模块干的事不一样,合起来就是分布式项目</p><ul><li>一个大的业务系统，拆分为小的业务模块，分别部署在不同的机器上</li></ul></blockquote><h2 id="2-1-传统项目">2.1 传统项目</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E4%BC%A0%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84.png" alt="传统项目结构"></p><h2 id="2-2-集群">2.2 集群</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E9%9B%86%E7%BE%A4%E9%A1%B9%E7%9B%AE.png" alt="集群项目"></p><h2 id="2-3-集群分布式">2.3 集群分布式</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E9%9B%86%E7%BE%A4%E5%88%86%E5%B8%83%E5%BC%8F%E9%A1%B9%E7%9B%AE.png" alt="集群分布式"></p><h1>3. 架构演进</h1><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">单体架构</button></li><li class="tab"><button type="button" data-href="#1-2">垂直架构</button></li><li class="tab"><button type="button" data-href="#1-3">分布式架构</button></li><li class="tab"><button type="button" data-href="#1-4">SOA架构</button></li><li class="tab"><button type="button" data-href="#1-5">微服务架构</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E5%8D%95%E4%BD%93%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="单体架构"></p><p>优点：</p><ul><li>简单：开发部署都很方便，小型项目首选\</li></ul><p>缺点：</p><ul><li><p>项目启动慢</p></li><li><p>可靠性差</p></li><li><p>可伸缩性差</p></li><li><p>扩展性和可维护性差</p></li><li><p>性能低</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E5%9E%82%E7%9B%B4%E6%9E%B6%E6%9E%84.png" alt="垂直架构"></p><blockquote><p>垂直架构是指将单体架构中的多个模块拆分为多个独立的项目<br>形成多个独立的单体架构</p></blockquote><p>单体架构存在的问题：</p><ul><li><p>项目启动慢</p></li><li><p>可靠性差</p></li><li><p>可伸缩性差</p></li><li><p>扩展性和可维护性差</p></li><li><p>性能低</p></li></ul><p>垂直架构存在的问题：</p><ul><li>重复功能太多</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84.png" alt="分布式架构"></p><blockquote><p>分布式架构是指在垂直架构的基础上，将公共业务模块抽取出来，作为独立的服务，供其他调用者消费，以实现服务的共享和重用</p><p><code>RPC</code>： <strong>Remote Procedure Call 远程过程调用</strong><br>有非常多的协议和技术来都实现了RPC的过程<br>比如：HTTP REST风格，Java RMI规范、WebService SOAP协议、Hession等等</p></blockquote><p>垂直架构存在的问题：</p><ul><li>重复功能太多</li></ul><p>分布式架构存在的问题：</p><ul><li>服务提供方一旦产生变更，所有消费方都需要变更</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/SOA%E6%9E%B6%E6%9E%84.png" alt="SOA架构"></p><ul><li><p>SOA（Service-Oriented Architecture，面向服务的架构）是一个组件模型，它将应用程序的不同功能单元（称为服务）进行拆分，并通过这些服务之间定义良好的接口和契约联系起来。</p></li><li><p>ESB（Enterparise Servce Bus) 企业服务总线，服务中介<br>主要是提供了一个服务于服务之间的交互<br>ESB 包含的功能如：负载均衡，流量控制，加密处理，服务的监控，异常处理，监控告急等等</p></li></ul><p>分布式架构存在的问题：</p><ul><li>服务提供方一旦产生变更，所有消费方都需要变更</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84.png" alt="微服务架构"></p><blockquote><p>微服务架构是在 SOA 上做的升华，微服务架构强调的一个重点是“业务需要彻底的组件化和服务化”，原有的单个业务系统会拆分为多个可以独立开发、设计、运行的小应用<br>这些小应用之间通过服务完成交互和集成</p><p>微服务架构 = 80%的SOA服务架构思想 + 100%的组件化架构思想 + 80%的领域建模思想</p></blockquote><p>特点：</p><ul><li><p>服务实现组件化：开发者可以自由选择开发技术。也不需要协调其他团队</p></li><li><p>服务之间交互一般使用REST API</p></li><li><p>去中心化：每个微服务有自己私有的数据库持久化业务数据</p></li><li><p>自动化部署：把应用拆分成为一个一个独立的单个服务，方便自动化部署、测试、运维</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p><strong>Dubbo 是 SOA时代的产物，SpringCloud 是微服务时代的产物</strong></p>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
          <category> 项目架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 项目架构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux常用命令</title>
      <link href="/linux/linux-chang-yong-ming-ling/"/>
      <url>/linux/linux-chang-yong-ming-ling/</url>
      
        <content type="html"><![CDATA[<h1>1. Linux的简介</h1><h1>2. 文件和目录管理指令</h1><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">ls命令</button></li><li class="tab"><button type="button" data-href="#1-2">cd命令</button></li><li class="tab"><button type="button" data-href="#1-3">cp命令</button></li><li class="tab"><button type="button" data-href="#1-4">cat命令</button></li><li class="tab"><button type="button" data-href="#1-5">df命令</button></li><li class="tab"><button type="button" data-href="#1-6">du命令</button></li><li class="tab"><button type="button" data-href="#1-7">file命令</button></li><li class="tab"><button type="button" data-href="#1-8">find命令</button></li><li class="tab"><button type="button" data-href="#1-9">1 9</button></li><li class="tab"><button type="button" data-href="#1-10">1 10</button></li><li class="tab"><button type="button" data-href="#1-11">1 11</button></li><li class="tab"><button type="button" data-href="#1-12">1 12</button></li><li class="tab"><button type="button" data-href="#1-13">1 13</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p><strong>命令名称：</strong> <strong>ls</strong></p><p><strong>使用语法</strong> : ls <code>[-alrtAFR]</code> [name…]<br><strong>功能</strong> <strong>:</strong> <strong>显示指定工作目录下之内容（列出目前工作目录所含之档案及子目录</strong>)。</p><p>参数:</p><ul><li><strong><code>-a</code>  显示所有档案及目录</strong> (ls内定将档案名或目录名称开头为“.”的视为隐藏档，不会列出)</li><li><strong><code>-l</code>   除档案名称外，亦将档案型态、权限、拥有者、档案大小等资讯详细列出</strong></li><li><strong><code>-r</code>   将档案以相反次序显示</strong> (原定依英文字母次序)</li><li><strong><code>-t</code>   将档案依建立时间之先后次序列出</strong></li><li><strong><code>-A</code>   同-a，但不列出 “.” (目前目录)及 “…” (父目录)</strong></li><li>**<code>-F</code>  在列出的档案名称后加一符号；**例如可执行档则加“*”,目录则加“/”</li><li><strong><code>-R</code>  若目录下有档案，则以下之档案亦皆依序列出</strong></li></ul><p>范例：</p><ol><li><p>列出目前工作目录下所有名称是 s 开头的档案，愈新的排愈后面</p><p>ls -ltr s*</p></li><li><p>将 /bin 目录以下所有目录及档案详细资料列出</p><p>ls -lR /bin</p></li><li><p>列出目前工作目录下所有l档案及目录；目录于名称后加 “/”, 可执行档于名称后加 “*”</p><p>ls -AF</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>命令名称： cd<br>使用语法 : cd <code>[directory]</code><br>功能 :变换工作目录至 directory</p><p>参数 : directory 可为绝对路径或相对路径</p><ul><li><p><strong>若目录名称省略，则变换至用户的home directory (也就是登陆时所在的目录)</strong></p></li><li><p><strong><code>“.”</code>表示当前目录</strong></p></li><li><p><strong><code>“..”</code>表示上一级目录</strong></p></li><li><p><strong><code>“-”</code>表示进入此工作目录前所在的目录</strong></p></li><li><p><strong><code>“~”</code>表示home directory，即用户主目录</strong></p></li></ul><p>范例：</p><ol><li><p>进入用户主目录</p><p>cd 或 cd ~</p></li><li><p>进入上一级目录下source目录</p><p>cd …/source</p></li><li><p>进入/usr/local目录</p><p>cd /usr/local</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p>命令名称： cp<br>使用语法 :  cp [参数] source dest<br>cp [参数] source directory 功能 :将一个档案拷贝至另一档案，或将数个档案或目录拷贝至另一目录</p><p>参数 :</p><p>source 表示源文件 后面表示要复制的地点</p><ul><li><p><strong><code>-a</code> 尽可能将档案状态、权限等资料都照原状予以复制，等同于-dpR</strong></p></li><li><p><strong><code>-r/-R</code> 若 source 中含有目录名，则将目录下之档案亦皆依序拷贝至目的地</strong></p></li><li><p><strong><code>-f</code> 若目的地已经有相同档名的档案存在，则在复制前先予以删除再行复制</strong></p></li><li><p><strong><code>-i</code> 在覆盖文件或目录时提示</strong></p></li></ul><p>范例：</p><ol><li><p>将当前目录下所有的.c文件复制到当前目录中的source目录下</p><p>cp *.c ./source</p></li><li><p>将目录source目录下所有内容复制到temp目录下</p><p>cp –a source temp</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><p>命令名称： cat<br>使用语法 :  cat <code>[参数]</code> file1 [file2…]<br>功能 :把档案串连接后传到基本输出<br>参数：</p><ul><li><strong><code>-n</code> 或 <code>--number</code> 由 1 开始对所有输出的行数编号</strong></li><li><strong><code>-b</code> 或 <code>--number-nonblank</code> 和 <code>-n</code> 相似，只不过对于空白行不编号</strong></li><li><strong><code>-s</code> 当遇到有连续两行以上的空白行，就代换为一行的空白行</strong><br>范例：<br>输出hello.c文件内容，列出行号：<br>cat –n hello.c</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><p>命令名称： df<br>使用语法 : df [参数] [FILE]<br>功能 :显示文件系统磁盘空间使用的状况</p><p>参数 :</p><ul><li><strong><code>-k</code> 显示每个磁盘使用量</strong></li><li><strong><code>-a</code> 包含全部文件的系统文件</strong></li></ul><p>范例：显示系统所配置的每一个磁盘当前被占用的空间大小。<br>df –k</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-6"><p>命令名称： du<br>使用语法 : du [参数] [目录或文件]<br>功能 :显示指定的目录或文件所占用的磁盘空间</p><p>参数 :</p><ul><li><strong><code>-a</code>或<code>-all</code>   显示目录中所有文件的大小</strong></li><li><strong><code>-b</code>  显示目录或文件大小时，以byte为单位</strong></li><li><strong><code>-c</code>  显示每个目录和文件的大小，同时也示所有目录或文件的总和</strong></li><li><strong><code>-D</code> 显示指定符号连接的源文件大小。</strong></li><li><strong><code>-h</code>  以K，M，G为单位，提高信息的可读性</strong></li><li><strong><code>-H</code> 与<code>-h</code>参数相同，但是K，M，G是以1000为换算单位</strong></li><li><strong><code>-k</code>  以1024 bytes为单位</strong></li></ul><p>范例：显示/usr/local目录中每个文件及目录的大小，以k为单位<br>du –kc /usr/local</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-7"><p>命令名称 : file<br>使用语法 : file [参数] file<br>功能 : 辨别文件类型</p><p>参数 :</p><ul><li><strong><code>-b</code> 　列出辨识结果时，不显示文件名称</strong></li><li><strong><code>-c</code> 　详细显示指令执行过程，便于排错或分析程序执行的情形。</strong></li><li><strong><code>-L</code> 　直接显示符号连接所指向的文件的类别</strong></li><li><strong><code>-v</code>　显示版本信息</strong></li><li><strong><code>-z</code> 　尝试去解读压缩文件的内容</strong></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-8"><p>命令名称 : find<br>使用语法 : find [path…] [expression]<br>功能 : 在path目录中查找符合expression表达式的文件</p><p>参数 :</p><ul><li><p>-name filename：按文件名查找</p></li><li><p>-type c：按文件类型进行查找，c是文件类型，可取的值为：</p><ul><li>-b(块设备文件)</li><li>c(字符设备文件)</li><li>d(目录)</li><li>p(管道文件)</li><li>f(一般文件)</li><li>l(链接文件)</li><li>s(socket文件)</li></ul></li><li><p>-user username  查找属主为username的文件</p></li><li><p>-atime n  查找n天以前被访问过的文件</p><ul><li><p>-mtime n  查找n天以前被修改过的文件</p></li><li><p>-cmin n  查找n分钟以前被修改过的文件</p></li><li><p>-exec cmd {}  对查找出来的文件执行cmd命令，{}表示找到的文件，命令要以“\;”结束。</p></li></ul></li></ul><p>范例 :</p><ol><li><p>查找/usr/local目录下所有的目录<br>find /usr/local –type d</p></li><li><p>在/etc目录下查找文件名为i18n的文件<br>find /etc –name i18n</p></li><li><p>表示在用户当前的目录，搜寻所有以 .o 为结尾的文件并删除<br>ind . -name *.o -exec rm -f{} ;注意大括号里面没有空格。</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-9"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-10"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-11"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-12"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-13"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue与Element</title>
      <link href="/web/vue-element/vue-yu-element/"/>
      <url>/web/vue-element/vue-yu-element/</url>
      
        <content type="html"><![CDATA[<h1>1. 概述</h1><blockquote><p>Vue 是一套前端框架，免除原生JavaScript中的DOM操作，简化书写</p></blockquote><p>基于MVVM(Model-View-ViewModel)思想，实现数据的双向绑定，将编程的关注点放在数据上。之前我们是将关注点放在 了 DOM 操作上；而要了解 MVVM 思想，必须先聊聊 MVC 思想，如下图就是 MVC 思想图解</p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/MVC%E6%80%9D%E6%83%B3%E5%9B%BE%E8%A7%A3.png" alt="MVC思想图解"></p><p><code>C 就是咱们 js 代码，M 就是数据，而 V 是页面上展示的内容</code></p><p>MVC 思想是没法进行双向绑定的<br>双向绑定是指当数据模型数据发生变化时，页面展示的会随之发生变化，而如果表单数据 发生变化，绑定的模型数据也随之发生变化<br>接下来我们聊聊 MVVM 思想，如下图是三个组件图解</p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/MVVM%E4%B8%89%E4%B8%AA%E7%BB%84%E4%BB%B6%E5%9B%BE%E8%A7%A3.png" alt="MVVM三个组件图解"></p><p>图中的 Model 就是我们的数据， View 是视图，也就是页面标签，用户可以通过浏览器看到的内容<br>Model 和 View 是通 过 ViewModel 对象进行双向绑定的，而 ViewModel 对象是 Vue 提供的<br>接下来让大家看一下双向绑定的效果，输入框绑定了 username 模型数据，而在页面上也使用 <code>{{}}</code> 绑定了 username 模型数据</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--插值表达式--&gt;</span></span><br><span class="line">    {{username}}</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. 创建Vue核心对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>){  <span class="comment">// data() 是 ECMAScript 6 版本的新的写法</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>{</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>:<span class="string">""</span></span></span><br><span class="line"><span class="language-javascript">            } </span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">    });</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>当我们在输入框中输入内容，而输入框后面随之实时的展示我们输入的内容，这就是双向绑定的效果</p><h1>2. Vue 指令</h1><p><strong>指令</strong>：<strong>HTML 标签</strong>上带有 v- 前缀的特殊属性，不同指令具有不同含义。例如：v-if，v-for…</p><p>常用的指令有：</p><table><thead><tr><th style="text-align:center">指令</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center">v-bind</td><td style="text-align:center">为HTML标签绑定属性值，如设置 href , css样式等</td></tr><tr><td style="text-align:center">v-model</td><td style="text-align:center">在表单元素上创建双向数据绑定</td></tr><tr><td style="text-align:center">v-on</td><td style="text-align:center">为HTML标签绑定事件</td></tr><tr><td style="text-align:center">v-if</td><td style="text-align:center">条件性的渲染某元素，判定为true时渲染,否则不渲染</td></tr><tr><td style="text-align:center">v-else</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v-else-if</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">v-show</td><td style="text-align:center">根据条件展示某元素，区别在于切换的是display属性的值</td></tr><tr><td style="text-align:center">v-for</td><td style="text-align:center">列表渲染，遍历容器的元素或者对象的属性</td></tr></tbody></table><h2 id="2-1-v-bind-v-model-指令">2.1 v-bind &amp; v-model 指令</h2><blockquote><p>v-bind  为HTML标签绑定属性值，如设置 href , css样式等</p></blockquote><p>该指令可以给标签原有属性绑定模型数据。这样模型数据发生变化，标签属性值也随之发生变化</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">"url"</span>&gt;</span>百度一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--v-bind 可以省略--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">"url"</span>&gt;</span>百度一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>v-model  该指令可以给表单项标签绑定模型数据。这样就能实现双向绑定效果</p></blockquote><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">v-model</span>=<span class="string">"username"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>演示代码</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">"url"</span>&gt;</span>点击一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">"url"</span>&gt;</span>点击一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"url"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. 创建Vue核心对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>){</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> {</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">username</span>:<span class="string">""</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">url</span>:<span class="string">"https://www.baidu.com"</span></span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">    });</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-2-v-on-指令">2.2 v-on 指令</h2><blockquote><p>v-on 为HTML标签绑定事件</p></blockquote><p>我们在页面定义一个按钮，并给该按钮使用 v-on 指令绑定单击事件</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"一个按钮"</span> <span class="attr">v-on:click</span>=<span class="string">"show()"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--而使用 v-on 时还可以使用简化的写法，将 v-on: 替换成 @ ，html代码如下--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"一个按钮"</span> @<span class="attr">click</span>=<span class="string">"show()"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--上面代码绑定的 show() 需要在 Vue 对象中的 methods 属性中定义出来--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>: <span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: {</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">show</span>(<span class="params"></span>){</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">alert</span>(<span class="string">"我被点了"</span>);</span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">});</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>注意：<code>v-on:</code> 后面的事件名称是之前原生事件属性名去掉on</p><p>例如：</p><ul><li>单击事件 ： 事件属性名是 onclick，而在vue中使用是 <code>v-on:click</code></li><li>失去焦点事件：事件属性名是 onblur，而在vue中使用时 <code>v-on:blur</code></li></ul></blockquote><h2 id="2-3-条件判断指令">2.3 条件判断指令</h2> <table border="1" cellpadding="5px" cellspacing="0px">      <tbody><tr>      <th>指令</th>      <th>作用</th>    </tr>     <tr>         <td>v-if</td>         <td rowspan="3">条件性的渲染某元素,判定为true时渲染,否则不渲染</td>     </tr>     <tr>         <td>v-else</td>     </tr>      <tr>         <td>v-else-if</td>     </tr>          <tr>         <td>v-show</td>         <td>根据条件展示某元素,区别在于切换的时display属性的值</td>     </tr></tbody></table><p>现在要实现，当 <code>count</code> 模型的数据是3时，在页面上展示 <code>div1</code> 内容；当 <code>count</code> 模型的数据是4时，在页面上展示 <code>div2</code> 内容；<code>count</code> 模型数据是其他值时，在页面上展示 <code>div3</code>。这里为了动态改变模型数据 <code>count</code> 的值，再定义一个输入框绑定 <code>count</code> 模型数据。html 代码如下：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"count == 3"</span>&gt;</span>div1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">"count == 4"</span>&gt;</span>div2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span>div3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"count"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">//1. 创建Vue核心对象</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">el</span>:<span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>){</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> {</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">count</span>:<span class="number">3</span></span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">    }</span></span><br><span class="line"><span class="language-javascript">});</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>然后我们在看看 <code>v-show</code> 指令的效果，如果模型数据 <code>count </code> 的值是3时，展示 <code>div v-show</code> 内容，否则不展示，html页面代码如下</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">"count == 3"</span>&gt;</span>div v-show<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"count"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>通过上面的演示，发现 <code>v-show</code> 和 <code>v-if</code> 效果一样，那它们到底有什么区别呢</p></blockquote><p><code>v-show</code> 不展示的原理是给对应的标签添加 <code>display</code> css属性，并将该属性值设置为 <code>none</code> ，这样就达到了隐藏的效果。而 <code>v-if</code> 指令是条件不满足时根本就不会渲染</p><h2 id="2-4-v-for-指令">2.4 v-for 指令</h2><table><thead><tr><th>指令</th><th>作用</th></tr></thead><tbody><tr><td>v-for</td><td>列表渲染,遍历容器的元素或者对象的属性</td></tr></tbody></table><p>这个指令看到名字就知道是用来遍历的，该指令使用的格式如下：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;标签 v-for="变量名 in 集合模型数据"&gt;</span><br><span class="line">    {{变量名}}</span><br><span class="line">&lt;/标签&gt;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>注意：需要循环那个标签，<code>v-for</code> 指令就写在那个标签上</p></blockquote><p>如果在页面需要使用到集合模型数据的索引，就需要使用如下格式：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;标签 v-for="(变量名,索引变量) in 集合模型数据"&gt;</span><br><span class="line">    <span class="comment">&lt;!--索引变量是从0开始，所以要表示序号的话，需要手动的加1--&gt;</span></span><br><span class="line">   {{索引变量 + 1}} {{变量名}}</span><br><span class="line">&lt;/标签&gt;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"addr in addrs"</span>&gt;</span></span><br><span class="line">        {{addr}} <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"(addr,i) in addrs"</span>&gt;</span></span><br><span class="line">        {{i+1}}--{{addr}} <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//1. 创建Vue核心对象</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">"#app"</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>){</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> {</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">addrs</span>:[<span class="string">"北京"</span>,<span class="string">"上海"</span>,<span class="string">"西安"</span>]</span></span><br><span class="line"><span class="language-javascript">            }</span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">    });</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-5-生命周期">2.5 生命周期</h2><blockquote><p>生命周期的八个阶段：每触发一个生命周期事件，会自动执行一个生命周期方法，这些生命周期方法也被称为钩子方法</p></blockquote><table><thead><tr><th>状态</th><th>阶段周期</th></tr></thead><tbody><tr><td>beforeCreate</td><td>创建前</td></tr><tr><td>created</td><td>创建后</td></tr><tr><td>beforeMount</td><td>载入前</td></tr><tr><td>mounted</td><td>挂载完成</td></tr><tr><td>beforeUpdate</td><td>更新前</td></tr><tr><td>updated</td><td>更新后</td></tr><tr><td>beforeDestroy</td><td>销毁前</td></tr><tr><td>destroyed</td><td>销毁后</td></tr></tbody></table><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F(%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0).png" alt="Vue生命周期(钩子函数)"></p><h1>3. Element</h1><p>Element：是饿了么公司前端开发团队提供的一套基于 Vue 的网站组件库，用于快速构建网页。</p><p>Element 提供了很多组件（组成网页的部件）供我们使用。例如 超链接、按钮、图片、表格等等~</p><p>如下图左边的是我们编写页面看到的按钮，上图右边的是 Element 提供的页面效果，效果一目了然</p><h2 id="3-1-食用方式">3.1 食用方式</h2><ol><li>将资源<code>element-ui</code> 文件夹直接拷贝到项目的 <code>webapp</code> 下</li><li>创建页面，并在页面引入Element 的css、js文件 和 Vue.js</li></ol><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"element-ui/lib/index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"element-ui/lib/theme-chalk/index.css"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>创建Vue核心对象<br>Element 是基于 Vue 的，所以使用Element时必须要创建 Vue 对象</li></ol><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">"#app"</span></span></span><br><span class="line"><span class="language-javascript">    })</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="4"><li>官网复制Element组件代码</li></ol><blockquote><p>栗子</p></blockquote><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">el-button</span>&gt;</span>默认按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>主要按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"success"</span>&gt;</span>成功按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"info"</span>&gt;</span>信息按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"warning"</span>&gt;</span>警告按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"danger"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">plain</span>&gt;</span>朴素按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">plain</span>&gt;</span>主要按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"success"</span> <span class="attr">plain</span>&gt;</span>成功按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"info"</span> <span class="attr">plain</span>&gt;</span>信息按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"warning"</span> <span class="attr">plain</span>&gt;</span>警告按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"danger"</span> <span class="attr">plain</span>&gt;</span>危险按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">round</span>&gt;</span>圆角按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">round</span>&gt;</span>主要按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"success"</span> <span class="attr">round</span>&gt;</span>成功按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"info"</span> <span class="attr">round</span>&gt;</span>信息按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"warning"</span> <span class="attr">round</span>&gt;</span>警告按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"danger"</span> <span class="attr">round</span>&gt;</span>危险按钮<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">icon</span>=<span class="string">"el-icon-search"</span> <span class="attr">circle</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">icon</span>=<span class="string">"el-icon-edit"</span> <span class="attr">circle</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"success"</span> <span class="attr">icon</span>=<span class="string">"el-icon-check"</span> <span class="attr">circle</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"info"</span> <span class="attr">icon</span>=<span class="string">"el-icon-message"</span> <span class="attr">circle</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"warning"</span> <span class="attr">icon</span>=<span class="string">"el-icon-star-off"</span> <span class="attr">circle</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"danger"</span> <span class="attr">icon</span>=<span class="string">"el-icon-delete"</span> <span class="attr">circle</span>&gt;</span><span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"element-ui/lib/index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"element-ui/lib/theme-chalk/index.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">new</span> <span class="title class_">Vue</span>({</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">"#app"</span></span></span><br><span class="line"><span class="language-javascript">    })</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="3-2-Element-布局">3.2 Element 布局</h2><p>Element 提供了两种布局方式，分别是：</p><ul><li>Layout 布局</li><li>Container 布局容器</li></ul><blockquote><p>Layout 布局</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
          <category> Vue </category>
          
          <category> Element </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Vue </tag>
            
            <tag> Element </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Json与Ajax</title>
      <link href="/web/json-ajax/json-yu-ajax/"/>
      <url>/web/json-ajax/json-yu-ajax/</url>
      
        <content type="html"><![CDATA[<h1>1. AJAX</h1><h2 id="1-1-概念">1.1 概念</h2><p>ASynchronous JavaScript And XML异步的JavaScript 和 XML</p><p>异步和同步：客户端和服务器端相互通信的基础上</p><ul><li><code>异步</code>:客户端必须等待服务器端的响应。在等待的期间客户端不能做其他操作</li><li><code>同步</code>:客户端不需要等待服务器端的响应。在服务器处理请求的过程中，客户端可以进行其他的操作</li></ul><p>Ajax 是一种在无需重新加载整个网页的情况下，能够更新部分网页的技术<br>通过在后台与服务器进行少量数据交换，Ajax 可以使网页实现异步更新<br>这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新</p><p>传统的网页（不使用 Ajax）如果需要更新内容，必须重载整个网页页面。</p><blockquote><p>AJAX提升用户的体验</p></blockquote><h2 id="1-2-实现方式">1.2 实现方式</h2><blockquote><p>原生的JS实现方式（了解）</p></blockquote><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建核心对象</span></span><br><span class="line"><span class="keyword">var</span> xmlhttp;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">XMLHttpRequest</span>)</span><br><span class="line">{<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class="line">    xmlhttp=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">{<span class="comment">// code for IE6, IE5</span></span><br><span class="line">    xmlhttp=<span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">"Microsoft.XMLHTTP"</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 建立连接</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    参数：</span></span><br><span class="line"><span class="comment">        1. 请求方式：GET、POST</span></span><br><span class="line"><span class="comment">            * get方式，请求参数在URL后边拼接。send方法为空参</span></span><br><span class="line"><span class="comment">            * post方式，请求参数在send方法中定义</span></span><br><span class="line"><span class="comment">        2. 请求的URL：</span></span><br><span class="line"><span class="comment">        3. 同步或异步请求：true（异步）或 false（同步）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">xmlhttp.<span class="title function_">open</span>(<span class="string">"GET"</span>,<span class="string">"ajaxServlet?username=tom"</span>,<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.发送请求 post就在里面send()里面放字符串</span></span><br><span class="line">xmlhttp.<span class="title function_">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.接受并处理来自服务器的响应结果</span></span><br><span class="line"><span class="comment">//获取方式 ：xmlhttp.responseText</span></span><br><span class="line"><span class="comment">//什么时候获取？当服务器响应成功后再获取</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当xmlhttp对象的就绪状态改变时，触发事件onreadystatechange。</span></span><br><span class="line">xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">{</span><br><span class="line">    <span class="comment">//判断readyState就绪状态是否为4，判断status响应状态码是否为200</span></span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.<span class="property">readyState</span>==<span class="number">4</span> &amp;&amp; xmlhttp.<span class="property">status</span>==<span class="number">200</span>)</span><br><span class="line">    {</span><br><span class="line">       <span class="comment">//获取服务器的响应结果</span></span><br><span class="line">        <span class="keyword">var</span> responseText = xmlhttp.<span class="property">responseText</span>;</span><br><span class="line">        <span class="title function_">alert</span>(responseText);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>JQeury实现方式</p></blockquote><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">$.ajax()</button></li><li class="tab"><button type="button" data-href="#1-2">$.get()</button></li><li class="tab"><button type="button" data-href="#1-3">$.post()</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 语法：$.<span class="title function_">ajax</span>({键值对});</span><br><span class="line"> <span class="comment">//使用$.ajax()发送异步请求</span></span><br><span class="line">            $.<span class="title function_">ajax</span>({</span><br><span class="line">                <span class="attr">url</span>:<span class="string">"ajaxServlet1111"</span> , <span class="comment">// 请求路径</span></span><br><span class="line">                <span class="attr">type</span>:<span class="string">"POST"</span> , <span class="comment">//请求方式</span></span><br><span class="line">                <span class="comment">//data: "username=jack&amp;age=23",//请求参数</span></span><br><span class="line">                <span class="attr">data</span>:{<span class="string">"username"</span>:<span class="string">"jack"</span>,<span class="string">"age"</span>:<span class="number">23</span>},</span><br><span class="line">                <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">data</span>) {</span><br><span class="line">                    <span class="title function_">alert</span>(data);</span><br><span class="line">                },<span class="comment">//响应成功后的回调函数</span></span><br><span class="line">                <span class="attr">error</span>:<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">"出错啦..."</span>)</span><br><span class="line">                },<span class="comment">//表示如果请求响应出现错误，会执行的回调函数</span></span><br><span class="line"></span><br><span class="line">                <span class="attr">dataType</span>:<span class="string">"text"</span><span class="comment">//设置接受到的响应数据的格式</span></span><br><span class="line">            });</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">发送get请求</span><br><span class="line">* 语法：$.<span class="title function_">get</span>(url, [data], [callback], [type])</span><br><span class="line">* 参数：</span><br><span class="line">* url：请求路径</span><br><span class="line">* data：请求参数</span><br><span class="line">* callback：回调函数</span><br><span class="line">* type：响应结果的类型</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">发送post请求</span><br><span class="line">* 语法：$.<span class="title function_">post</span>(url, [data], [callback], [type])</span><br><span class="line">* 参数：</span><br><span class="line">* url：请求路径</span><br><span class="line">* data：请求参数</span><br><span class="line">* callback：回调函数</span><br><span class="line">* type：响应结果的类型</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>Axios实现方式</p></blockquote><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">get请求</button></li><li class="tab"><button type="button" data-href="#1-2">post请求</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为给定 ID 的 user 创建请求</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">'/user?ID=12345'</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可选地，上面的请求可以这样做</span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">'/user'</span>, {</span><br><span class="line">    <span class="attr">params</span>: {</span><br><span class="line">      <span class="attr">ID</span>: <span class="number">12345</span></span><br><span class="line">    }</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  });</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="title function_">post</span>(<span class="string">'/user'</span>, {</span><br><span class="line">    <span class="attr">firstName</span>: <span class="string">'Fred'</span>,</span><br><span class="line">    <span class="attr">lastName</span>: <span class="string">'Flintstone'</span></span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">  })</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">error</span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">  });</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>2. JSON</h1><h2 id="2-1-概念">2.1 概念</h2><p><strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otationJavaScript对象表示法</p><ul><li>json现在多用于存储和交换文本信息的语法</li></ul><ul><li>进行数据的传输</li><li>JSON 比 XML 更小、更快，更易解析</li></ul><h2 id="2-2语法">2.2语法</h2><blockquote><p>基本规则</p></blockquote><ul><li>数据在名称/值对中：json数据是由键值对构成的<ul><li>键用引号(单双都行)引起来，也可以不使用引号</li><li>值得取值类型：<ol><li>数字（整数或浮点数）</li><li>字符串（在双引号中）</li><li>逻辑值（true 或 false）</li><li>数组（在方括号中）{“persons”:[{},{}]}</li><li>对象（在花括号中） {“address”:{“province”：“陕西”…}}</li><li>null</li></ol></li></ul></li><li>数据由逗号分隔：多个键值对由逗号分隔</li><li>花括号保存对象：使用{}定义json 格式</li><li>方括号保存数组：[]</li></ul><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义基本格式</span></span><br><span class="line"> <span class="keyword">var</span> person = {<span class="string">"name"</span>: <span class="string">"张三"</span>, <span class="attr">age</span>: <span class="number">23</span>, <span class="string">'gender'</span>: <span class="literal">true</span>};</span><br><span class="line"><span class="comment">//1.嵌套格式 {}-&gt;[]</span></span><br><span class="line"><span class="keyword">var</span> person ={</span><br><span class="line">            <span class="string">"persons"</span>:[</span><br><span class="line">                {<span class="string">"name"</span>: <span class="string">"张三"</span>, <span class="string">"age"</span>: <span class="number">23</span>, <span class="string">"gender"</span>: <span class="literal">true</span>},</span><br><span class="line">        {<span class="string">"name"</span>: <span class="string">"李四"</span>, <span class="string">"age"</span>: <span class="number">24</span>, <span class="string">"gender"</span>: <span class="literal">true</span>},</span><br><span class="line">        {<span class="string">"name"</span>: <span class="string">"王五"</span>, <span class="string">"age"</span>: <span class="number">25</span>, <span class="string">"gender"</span>: <span class="literal">false</span>}</span><br><span class="line">            ]</span><br><span class="line">        }; </span><br><span class="line"><span class="comment">//2.嵌套格式 []-&gt;{}</span></span><br><span class="line"> <span class="keyword">var</span> ps = [{<span class="string">"name"</span>: <span class="string">"张三"</span>, <span class="string">"age"</span>: <span class="number">23</span>, <span class="string">"gender"</span>: <span class="literal">true</span>},</span><br><span class="line">           {<span class="string">"name"</span>: <span class="string">"李四"</span>, <span class="string">"age"</span>: <span class="number">24</span>, <span class="string">"gender"</span>: <span class="literal">true</span>},</span><br><span class="line">           {<span class="string">"name"</span>: <span class="string">"王五"</span>, <span class="string">"age"</span>: <span class="number">25</span>, <span class="string">"gender"</span>: <span class="literal">false</span>}];</span><br></pre></td></tr></tbody></table></figure><blockquote><p>获取数据:</p></blockquote><ol><li>json对象.键名</li><li>json对象[“键名”]</li><li>数组对象[索引]</li><li>遍历</li></ol><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">person.<span class="property">name</span>;</span><br><span class="line">person[<span class="string">"name"</span>]</span><br><span class="line"><span class="comment">//获取person对象中所有的键和值</span></span><br><span class="line">      <span class="comment">//for in 循环</span></span><br><span class="line">     <span class="comment">/* for(var key in person){</span></span><br><span class="line"><span class="comment">          //这样的方式获取不行。因为相当于  person."name"</span></span><br><span class="line"><span class="comment">          //alert(key + ":" + person.key);</span></span><br><span class="line"><span class="comment">          alert(key+":"+person[key]);</span></span><br><span class="line"><span class="comment">      }*/</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//获取ps中的所有值</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; ps.<span class="property">length</span>; i++) {</span><br><span class="line">          <span class="keyword">var</span> p = ps[i];</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> p){</span><br><span class="line">              <span class="title function_">alert</span>(key+<span class="string">":"</span>+p[key]);</span><br><span class="line">          }</span><br><span class="line">      }</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
          <category> Json </category>
          
          <category> Ajax </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Json </tag>
            
            <tag> Ajax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySql(三) 数据的CRUD与事务</title>
      <link href="/mysql/mysql-san-shu-ju-de-crud/"/>
      <url>/mysql/mysql-san-shu-ju-de-crud/</url>
      
        <content type="html"><![CDATA[<h1>1 DML 操作表中的数据<br>用于对表中的记录进行增删改操作</h1><h2 id="1-1-插入记录">1.1 插入记录</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> [<span class="keyword">into</span>] 表名 [字段名] <span class="keyword">values</span> (字段值)</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名：<span class="comment">-- 表示往哪张表中添加数据</span></span><br><span class="line">(字段名 <span class="number">1</span>, 字段名 <span class="number">2</span>, …)：<span class="comment">-- 要给哪些字段设置值</span></span><br><span class="line"><span class="keyword">values</span> (值 <span class="number">1</span>, 值 <span class="number">2</span>, …)：<span class="comment">-- 设置具体的值</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入全部字段</span></span><br><span class="line"><span class="comment">-- 所有的字段名都写出来</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 (字段名 <span class="number">1</span>, 字段名 <span class="number">2</span>, 字段名 <span class="number">3</span>…) <span class="keyword">values</span> (值 <span class="number">1</span>, 值 <span class="number">2</span>, 值 <span class="number">3</span>);</span><br><span class="line"><span class="comment">-- 不写字段名</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span> (值 <span class="number">1</span>, 值 <span class="number">2</span>, 值 <span class="number">3</span>…);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入部分数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 (字段名 <span class="number">1</span>, 字段名 <span class="number">2</span>, ...) <span class="keyword">values</span> (值 <span class="number">1</span>, 值 <span class="number">2</span>, ...);</span><br></pre></td></tr></tbody></table></figure><p><code>注：没有添加数据的字段会使用 NULL</code></p><h2 id="1-2-蠕虫复制">1.2 蠕虫复制</h2><blockquote><p>将一张已经存在的表中的数据复制到另一张表中</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将表名 2 中的所有的列复制到表名 1 中</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="number">1</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名 <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- 只复制部分列</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="number">1</span>(列 <span class="number">1</span>, 列 <span class="number">2</span>) <span class="keyword">select</span> 列 <span class="number">1</span>, 列 <span class="number">2</span> <span class="keyword">from</span> student;</span><br></pre></td></tr></tbody></table></figure><h2 id="1-3-更新表记录">1.3 更新表记录</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 列名<span class="operator">=</span>值 [<span class="keyword">where</span> 条件表达式]</span><br><span class="line"><span class="keyword">update</span>: 需要更新的表名</span><br><span class="line"><span class="keyword">set</span>: 修改的列值</span><br><span class="line"><span class="keyword">where</span>: 符合条件的记录才更新</span><br><span class="line">你可以同时更新一个或多个字段。</span><br><span class="line">你可以在 <span class="keyword">where</span> 子句中指定任何条件</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不带条件修改数据</span></span><br><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名<span class="operator">=</span>值; <span class="comment">-- 修改所有的行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 带条件修改数据</span></span><br><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名<span class="operator">=</span>值 <span class="keyword">where</span> 字段名<span class="operator">=</span>值;</span><br></pre></td></tr></tbody></table></figure><h2 id="1-4-删除表记录">1.4 删除表记录</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> 表名 [<span class="keyword">where</span> 条件表达式]</span><br><span class="line">如果没有指定 <span class="keyword">where</span> 子句，MySQL 表中的所有记录将被删除。</span><br><span class="line">你可以在 <span class="keyword">where</span> 子句中指定任何条件</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不带条件删除数据</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 带条件删除数据</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> 字段名<span class="operator">=</span>值;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 truncate 删除表中所有记录</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>truncate 和 delete 的区别： truncate 相当于删除表的结构，再创建一张表</p></blockquote><h1>2. DQL 查询表中的数据</h1><blockquote><p>查询不会对数据库中的数据进行修改.只是一种显示数据的方式</p></blockquote><h2 id="2-1-简单查询">2.1 简单查询</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用*表示所有列</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询指定列的数据,多个列之间以逗号分隔</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="number">1</span>, 字段名 <span class="number">2</span>, 字段名 <span class="number">3</span>, ... fromm 表名;</span><br></pre></td></tr></tbody></table></figure><h2 id="2-2-指定列的别名进行查询">2.2 指定列的别名进行查询</h2><blockquote><p>使用别名的好处： 显示的时候使用新的名字，并不修改表的结构</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 对列指定别名</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="number">1</span> <span class="keyword">as</span> 别名, 字段名 <span class="number">2</span> <span class="keyword">as</span> 别名... <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 对列和表同时指定别名</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="number">1</span> <span class="keyword">as</span> 别名, 字段名 <span class="number">2</span> <span class="keyword">as</span> 别名... <span class="keyword">from</span> 表名 <span class="keyword">as</span> 表别名;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>表使用别名的原因：用于多表查询操作</p></blockquote><h2 id="2-3-清除重复值">2.3 清除重复值</h2><blockquote><p>查询指定列并且结果不出现重复数据</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段名 <span class="keyword">from</span> 表名;</span><br></pre></td></tr></tbody></table></figure><h2 id="2-4-查询结果参与运算">2.4 查询结果参与运算</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 某列数据和固定值运算</span></span><br><span class="line"><span class="keyword">select</span> 列名 <span class="number">1</span> <span class="operator">+</span> 固定值 <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line">某列数据和其他列数据参与运算</span><br><span class="line"><span class="keyword">select</span> 列名 <span class="number">1</span> <span class="operator">+</span> 列名 <span class="number">2</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>注意: 参与运算的必须是数值类型</p></blockquote><h2 id="2-5-条件查询">2.5 条件查询</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件;</span><br><span class="line">流程：取出表中的每条数据，满足条件的记录就返回，不满足条件的记录不返回</span><br></pre></td></tr></tbody></table></figure><blockquote><p>运算符</p></blockquote><table><thead><tr><th style="text-align:center">比较运算符</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">&gt;、&lt;、&lt;=、&gt;=、=、<code>&lt;&gt; </code></td><td style="text-align:center">&lt;&gt;在 SQL 中表示不等于，在 mysql 中也可以使用!= <code>没有==</code></td></tr><tr><td style="text-align:center">BETWEEN…AND</td><td style="text-align:center">在一个范围之内，如：between 100 and 200<br>相当于条件在 100 到 200 之间，包头又包尾</td></tr><tr><td style="text-align:center">IN(集合)</td><td style="text-align:center">集合表示多个值，使用逗号分隔</td></tr><tr><td style="text-align:center">LIKE ‘张%’</td><td style="text-align:center">模糊查询</td></tr><tr><td style="text-align:center">IS NULL</td><td style="text-align:center">查询某一列为 NULL 的值，注：不能写=NULL</td></tr></tbody></table><blockquote><p>逻辑运算符</p></blockquote><table><thead><tr><th style="text-align:center">逻辑运算符</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">and 或 &amp;&amp;</td><td style="text-align:center">与，SQL 中建议使用前者，后者并不通用</td></tr><tr><td style="text-align:center">or 或 ||</td><td style="text-align:center">或</td></tr><tr><td style="text-align:center">not 或 !</td><td style="text-align:center">非</td></tr></tbody></table><blockquote><p>in 关键字</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 字段 <span class="keyword">in</span> (数据 <span class="number">1</span>, 数据 <span class="number">2.</span>..);</span><br><span class="line"><span class="keyword">in</span> 里面的每个数据都会作为一次条件，只要满足条件的就会显示</span><br></pre></td></tr></tbody></table></figure><blockquote><p>范围查询</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">between</span> 值 <span class="number">1</span> <span class="keyword">and</span> 值 <span class="number">2</span></span><br><span class="line">表示从值 <span class="number">1</span> 到值 <span class="number">2</span> 范围，包头又包尾</span><br><span class="line">比如：age <span class="keyword">between</span> <span class="number">80</span> adn <span class="number">100</span> <span class="comment">-- 相当于： age&gt;=80 &amp;&amp; age&lt;=100</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>like 关键字</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- like 表示模糊查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名 <span class="keyword">WHERE</span> 字段名 <span class="keyword">like</span> <span class="string">'通配符字符串'</span>;</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th style="text-align:center">通配符</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">%</td><td style="text-align:center">匹配多个字符串</td></tr><tr><td style="text-align:center">_</td><td style="text-align:center">匹配一个字符</td></tr></tbody></table><h1>3. 高级DQL</h1><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 通过 order by 子句，可以将查询出的结果进行排序(排序只是显示方式，不会影响数据库中数据的顺序)</span></span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 字段<span class="operator">=</span>值 <span class="keyword">order</span> <span class="keyword">by</span> 字段名 [<span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>];</span><br><span class="line"><span class="keyword">asc</span>: 升序，默认值</span><br><span class="line"><span class="keyword">desc</span>: 降序</span><br></pre></td></tr></tbody></table></figure><blockquote><p>单列排序</p></blockquote><p>只按某一个字段进行排序，单列排序</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有数据,使用年龄降序排序</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span>;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>组合排序</p></blockquote><p>同时对多个字段进行排序，如果第 1 个字段相等，则按第 2 个字段排序，依次类推</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 字段<span class="operator">=</span>值 <span class="keyword">order</span> <span class="keyword">by</span> 字段名 <span class="number">1</span> [<span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>], 字段名 <span class="number">2</span> [<span class="keyword">asc</span><span class="operator">|</span><span class="keyword">desc</span>];</span><br><span class="line"><span class="comment">-- 查询所有数据,在年龄降序排序的基础上，如果年龄相同再以数学成绩升序排序</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span>, math <span class="keyword">asc</span>;</span><br></pre></td></tr></tbody></table></figure><h2 id="3-2-聚合函数">3.2 聚合函数</h2><p>使用聚合函数查询是纵向查询， 它是对一列的值进行计算，然后返回一个结果值<br>聚合函数会忽略空值 NULL</p><blockquote><p>五个聚合函数</p></blockquote><table><thead><tr><th style="text-align:center">SQL中的聚合函数</th><th style="text-align:center">作用</th></tr></thead><tbody><tr><td style="text-align:center">max(列名)</td><td style="text-align:center">求这一列的最大值</td></tr><tr><td style="text-align:center">min(列名)</td><td style="text-align:center">求这一列的最小值</td></tr><tr><td style="text-align:center">avg(列名)</td><td style="text-align:center">求这一列的平均值</td></tr><tr><td style="text-align:center">count(列名)</td><td style="text-align:center">统计这一列有多少条记录</td></tr><tr><td style="text-align:center">sum(列名)</td><td style="text-align:center">对这一列求总和</td></tr></tbody></table><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 聚合函数(列名) <span class="keyword">from</span> 表名;</span><br><span class="line"><span class="comment">-- 查询学生总数</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(id) <span class="keyword">as</span> 总人数 <span class="keyword">from</span> student;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> 总人数 <span class="keyword">from</span> student;</span><br></pre></td></tr></tbody></table></figure><p>我们发现对于 NULL 的记录不会统计，建议如果统计个数则不要使用有可能为 null 的列</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ifnull(列名，默认值)   <span class="comment">-- 如果列名不为空，返回这列的值。如果为 NULL，则返回默认值。</span></span><br><span class="line"><span class="comment">-- 查询 id 字段，如果为 null，则使用 0 代替</span></span><br><span class="line"><span class="keyword">select</span> ifnull(id,<span class="number">0</span>) <span class="keyword">from</span> student;</span><br><span class="line"><span class="comment">-- 我们可以利用 IFNULL()函数，如果记录为 NULL，给个默认值，这样统计的数据就不会遗漏</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(ifnull(id,<span class="number">0</span>)) <span class="keyword">from</span> student;</span><br></pre></td></tr></tbody></table></figure><h2 id="3-3-分组">3.3 分组</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 分组查询是指使用 group by 语句对查询信息进行分组，相同数据作为一组</span></span><br><span class="line"><span class="keyword">select</span> 字段 <span class="number">1</span>,字段 <span class="number">2.</span>.. <span class="keyword">from</span> 表名 <span class="keyword">group</span> <span class="keyword">by</span> 分组字段 [<span class="keyword">having</span> 条件];</span><br></pre></td></tr></tbody></table></figure><blockquote><p>group by 将分组字段结果中相同内容作为一组，并且返回每组的第一条数据，所以单独分组没什么用处。<br><code>分组的目的就是为了统计，一般分组会跟聚合函数一起使用。</code></p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 按性别进行分组，求男生和女生数学的平均分</span></span><br><span class="line"><span class="keyword">select</span> sex, <span class="built_in">avg</span>(math) <span class="keyword">from</span> student3 <span class="keyword">group</span> <span class="keyword">by</span> sex;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>having 与 where 的区别</p></blockquote><table><thead><tr><th>子句</th><th>作用</th></tr></thead><tbody><tr><td>where 子句</td><td>1) 对查询结果进行分组前,将不符合where条件的行去掉,即在<code>分组之前</code>过滤数据,即先过滤在分组<br>2) where后面<code>不可以</code>使用聚合函数</td></tr><tr><td>having 子句</td><td>1) having 子句的作用是筛选满足条件的组,即在<code>分组之后</code>过滤数据,即先分组再过滤<br>2) having 后面<code>可以</code>使用聚合函数</td></tr></tbody></table><h2 id="3-4-limit-语句">3.4 limit 语句</h2><blockquote><p>limit 是限制的意思，所以 limit 的作用就是限制查询记录的条数</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span><span class="operator">|</span>字段列表 [<span class="keyword">as</span> 别名] <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 子句] [<span class="keyword">group</span> <span class="keyword">by</span> 子句][<span class="keyword">having</span> 子句][<span class="keyword">order</span> <span class="keyword">by</span> 子</span><br><span class="line">句][limit 子句];</span><br><span class="line"></span><br><span class="line">LIMIT <span class="keyword">offset</span>,length;</span><br><span class="line"><span class="keyword">offset</span>：起始行数，从 <span class="number">0</span> 开始计数，如果省略，默认就是 <span class="number">0</span></span><br><span class="line">length： 返回的行数</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询学生表中数据，从第 3 条开始显示，显示 6 条。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student3 limit <span class="number">2</span>,<span class="number">6</span>;</span><br></pre></td></tr></tbody></table></figure><h1>4. 表连接查询</h1><h2 id="4-1-多表查询">4.1 多表查询</h2><blockquote><p>多表查询的作用</p></blockquote><p>如果一条 SQL 语句查询多张表，因为查询结果在多张不同的表中，每张表取 1 列或多列</p><blockquote><p>多表查询的分类</p></blockquote><ol><li>内连接<ul><li>隐式内连接</li><li>显示内连接</li></ul></li><li>外连接<ul><li>左外连接</li><li>右外连接</li></ul></li></ol><h2 id="4-2-笛卡尔积现象">4.2 笛卡尔积现象</h2><blockquote><p>什么是笛卡尔积</p></blockquote><p>左表的每一条数据和右边的每一条数据组合,这种效果成为笛卡儿乘积</p><blockquote><p>如何清除笛卡尔积现象的影响</p></blockquote><p>我们发现不是所有的数据组合都是有用的，只有员工表.dept_id = <a href="http://xn--co2a07oz8d.id">部门表.id</a> 的数据才是有用的<br>所以需要通过条件过滤掉没用的数据</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置过滤条件 Column 'id' in where clause is ambiguous</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp,dept <span class="keyword">where</span> id<span class="operator">=</span><span class="number">5</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp,dept <span class="keyword">where</span> emp.`dept_id` <span class="operator">=</span> dept.`id`;</span><br><span class="line"><span class="comment">-- 查询员工和部门的名字</span></span><br><span class="line"><span class="keyword">select</span> emp.`name`, dept.`name` <span class="keyword">from</span> emp,dept <span class="keyword">where</span> emp.`dept_id` <span class="operator">=</span> dept.`id`;</span><br></pre></td></tr></tbody></table></figure><h2 id="4-3-内连接">4.3 内连接</h2><p>用左边表的记录去匹配右边表的记录，如果符合条件的则显示。如：从表.外键=主表.主键</p><blockquote><p>隐式内连接 : 看不到 JOIN 关键字，条件使用 WHERE 指定</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 左表, 右表 <span class="keyword">where</span> 条件</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp,dept <span class="keyword">where</span> emp.`dept_id` <span class="operator">=</span> dept.`id`;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>显示内连接：使用 INNER JOIN … ON 语句, 可以省略 INNER</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 左表 [<span class="keyword">inner</span>] <span class="keyword">join</span> 右表 <span class="keyword">on</span> 条件</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">inner</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.`dept_id` <span class="operator">=</span> d.`id`;</span><br></pre></td></tr></tbody></table></figure><h2 id="4-4-左外连接">4.4 左外连接</h2><p>用左边表的记录去匹配右边表的记录，如果符合条件的则显示；否则，显示 NULL</p><p><code>可以理解为：在内连接的基础上保证左表的数据全部显示</code></p><blockquote><p>左外连接：使用 LEFT OUTER JOIN … ON，OUTER 可以省略</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 左表 <span class="keyword">left</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 右表 <span class="keyword">on</span> 条件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用内连接查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept d <span class="keyword">inner</span> <span class="keyword">join</span> emp e <span class="keyword">on</span> d.`id` <span class="operator">=</span> e.`dept_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用左外连接查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept d <span class="keyword">left</span> <span class="keyword">join</span> emp e <span class="keyword">on</span> d.`id` <span class="operator">=</span> e.`dept_id`;</span><br></pre></td></tr></tbody></table></figure><h2 id="4-5-右外连接">4.5 右外连接</h2><p>用右边表的记录去匹配左边表的记录，如果符合条件的则显示；否则，显示 NULL</p><p>可以理解为：<strong>在内连接的基础上保证右表的数据全部显示</strong></p><blockquote><p>右外连接：使用 RIGHT OUTER JOIN … ON，OUTER 可以省略</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">from</span> 左表 <span class="keyword">right</span> [<span class="keyword">outer</span>]<span class="keyword">join</span> 右表 <span class="keyword">on</span> 条件</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用内连接查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept <span class="keyword">inner</span> <span class="keyword">join</span> emp <span class="keyword">on</span> dept.`id` <span class="operator">=</span> emp.`dept_id`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用右外连接查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept <span class="keyword">right</span> <span class="keyword">join</span> emp <span class="keyword">on</span> dept.`id` <span class="operator">=</span> emp.`dept_id`;</span><br></pre></td></tr></tbody></table></figure><h1>5. 子查询</h1><h2 id="5-1-什么是子查询">5.1 什么是子查询</h2><blockquote><p>子查询的概念</p></blockquote><ol><li>一个查询的结果做为另一个查询的条件</li><li>有查询的嵌套，内部的查询称为子查询</li><li>子查询要使用括号</li></ol><h2 id="5-2-子查询的结果是一个值的时候">5.2 子查询的结果是一个值的时候</h2><blockquote><p>子查询的结果是一个值的时候</p></blockquote><p>子查询结果只要是单行单列，肯定在 WHERE 后面作为条件，父查询使用：比较运算符，如：&gt; 、&lt;、&lt;&gt;、=</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询字段 <span class="keyword">from</span> 表 <span class="keyword">where</span> 字段<span class="operator">=</span>（子查询）;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1) 查询平均工资是多少</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(salary) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- 2) 到员工表查询小于平均的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&lt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(salary) <span class="keyword">from</span> emp);</span><br></pre></td></tr></tbody></table></figure><h2 id="5-3-子查询结果是多行单列的时候">5.3 子查询结果是多行单列的时候</h2><blockquote><p>子查询结果是多行单列的时候</p></blockquote><p>子查询结果是单例多行，结果集类似于一个数组，父查询使用 IN 运算符</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 查询字段 <span class="keyword">FROM</span> 表 <span class="keyword">WHERE</span> 字段 <span class="keyword">IN</span> （子查询）;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 先查询开发部与财务部的 id</span></span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="keyword">in</span>(<span class="string">'开发部'</span>,<span class="string">'财务部'</span>);</span><br><span class="line"><span class="comment">-- 再查询在这些部门 id 中有哪些员工</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="keyword">in</span>(<span class="string">'开发部'</span>,<span class="string">'财务</span></span><br><span class="line"><span class="string">部'</span>));</span><br></pre></td></tr></tbody></table></figure><h2 id="5-4-子查询的结果是多行多列">5.4 子查询的结果是多行多列</h2><blockquote><p>子查询的结果是多行多列</p></blockquote><p>子查询结果只要是多列，肯定在 FROM 后面作为表</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询字段 <span class="keyword">from</span> （子查询） 表别名 <span class="keyword">where</span> 条件;</span><br></pre></td></tr></tbody></table></figure><p><code>子查询作为表需要取别名，否则这张表没有名称则无法访问表中的字段</code></p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出 2011 年以后入职的员工信息，包括部门名称</span></span><br><span class="line"><span class="comment">-- 在员工表中查询 2011-1-1 以后入职的员工</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> join_date <span class="operator">&gt;=</span><span class="string">'2011-1-1'</span>;</span><br><span class="line"><span class="comment">-- 查询所有的部门信息，与上面的虚拟表中的信息组合，找出所有部门 id 等于的 dept_id</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept d, (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> join_date <span class="operator">&gt;=</span><span class="string">'2011-1-1'</span>) e <span class="keyword">where</span> d.`id`<span class="operator">=</span> e.dept_id ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 也可以使用表连接：</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">inner</span> <span class="keyword">join</span> dept <span class="keyword">on</span> emp.`dept_id` <span class="operator">=</span> dept.`id` <span class="keyword">where</span> join_date <span class="operator">&gt;=</span><span class="string">'2011-1-1'</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">inner</span> <span class="keyword">join</span> dept <span class="keyword">on</span> emp.`dept_id` <span class="operator">=</span> dept.`id` <span class="keyword">and</span> join_date <span class="operator">&gt;=</span><span class="string">'2011-1-1'</span>;</span><br></pre></td></tr></tbody></table></figure><h1>6. 事务</h1><h2 id="6-1-事务的应用场景说明">6.1 事务的应用场景说明</h2><p>什么是事务： 在实际的开发过程中，一个业务操作如：转账，往往是要多次访问数据库才能完成的<br>转账是一个用户扣钱，另一个用户加钱。如果其中有一条 SQL 语句出现异常，这条 SQL 就可能执行失败</p><p>事务执行是一个整体，所有的 SQL 语句都必须执行成功<br>如果其中有 1 条 SQL 语句出现异常，则所有的 SQL 语句都要回滚，整个业务执行失败</p><h2 id="6-2-手动提交事务">6.2 手动提交事务</h2><p>MYSQL 中可以有两种方式进行事务的操作：</p><ol><li>手动提交事务</li><li>自动提交事务</li></ol><blockquote><p>手动提交事务的 SQL 语句</p></blockquote><table><thead><tr><th style="text-align:center">功能</th><th style="text-align:center">SQL语句</th></tr></thead><tbody><tr><td style="text-align:center">开启事务</td><td style="text-align:center">start transaction</td></tr><tr><td style="text-align:center">提交事务</td><td style="text-align:center">commit</td></tr><tr><td style="text-align:center">回滚事务</td><td style="text-align:center">rollback</td></tr></tbody></table><blockquote><p>手动提交事务使用过程</p></blockquote><ol><li>执行成功的情况： 开启事务 →执行多条 SQL 语句→成功提交事务</li><li>执行失败的情况： 开启事务→执行多条 SQL 语句→事务的回滚</li></ol><h2 id="6-3-自动提交事务">6.3 自动提交事务</h2><p>MySQL 默认每一条 DML(增删改)语句都是一个单独的事务，每条语句都会自动开启一个事务，语句执行完毕 自动提交事务，MySQL 默认开始自动提交事务</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySql(二) 库和表属性</title>
      <link href="/mysql/mysql-er-ku-he-biao-shu-xing/"/>
      <url>/mysql/mysql-er-ku-he-biao-shu-xing/</url>
      
        <content type="html"><![CDATA[<h1>1. SQL 的概念</h1><h2 id="1-1-什么是-SQL">1.1 什么是 SQL</h2><p><strong>S</strong>tructured <strong>Q</strong>uery <strong>L</strong>anguage 结构化查询语言</p><h2 id="1-2-SQL-作用">1.2 SQL 作用</h2><ol><li>是一种所有关系型数据库的查询规范，不同的数据库都支持</li><li>通用的数据库操作语言，可以用在不同的数据库中</li><li>不同的数据库 SQL 语句有一些区别</li></ol><blockquote><p>SQL规范(普通话) MySQL特有(方言)Oracle特有(方言)</p></blockquote><h2 id="1-3-SQL-语句分类">1.3 SQL 语句分类</h2><ol><li>Data Definition Language (DDL 数据定义语言) <br>如：建库，建表</li><li><code>Data Manipulation Language(DML 数据操纵语言)</code><br><code>如：对表中的记录操作增删改</code></li><li><code>Data Query Language(DQL 数据查询语言)</code><br><code>如：对表中的查询操作</code></li><li>Data Control Language(DCL 数据控制语言)<br>如：对用户权限的设置</li></ol><h2 id="1-4-MySQL-的语法">1.4 MySQL 的语法</h2><ol><li>每条语句以分号结尾</li><li>SQL 中不区分大小写，关键字中认为大写和小写是一样的</li><li>3 种注释：</li></ol><table><thead><tr><th>注释的语法</th><th>说明</th></tr></thead><tbody><tr><td>–空格</td><td>单行注释</td></tr><tr><td>/* */</td><td>多行注释</td></tr><tr><td>#</td><td>这是 mysql 特有的注释方式</td></tr></tbody></table><h1>2. DDL 操作数据库</h1><h2 id="2-1-创建数据库">2.1 创建数据库</h2><blockquote><p>创建数据库的几种方式</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">create</span> database 数据库名;</span><br><span class="line"><span class="comment">-- 判断数据库是否已经存在，不存在则创建数据库</span></span><br><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> 数据库名;</span><br><span class="line"><span class="comment">-- 创建数据库并指定字符集</span></span><br><span class="line"><span class="keyword">create</span> database 数据库名 <span class="type">character</span> <span class="keyword">set</span> 字符集; </span><br></pre></td></tr></tbody></table></figure><h2 id="2-2-查看数据库">2.2 查看数据库</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看所有的数据库</span></span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"><span class="comment">-- 查看某个数据库的定义信息</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database db3;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database db1;</span><br></pre></td></tr></tbody></table></figure><h2 id="2-3-修改数据库">2.3 修改数据库</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改数据库默认的字符集</span></span><br><span class="line"><span class="comment">-- ALTER DATABASE 数据库名 DEFAULT CHARACTER SET 字符集;</span></span><br><span class="line"><span class="keyword">alter</span> database db3 <span class="type">character</span> <span class="keyword">set</span> utf8;</span><br></pre></td></tr></tbody></table></figure><h2 id="2-4-删除数据库">2.4 删除数据库</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database 数据库名;</span><br></pre></td></tr></tbody></table></figure><h2 id="2-5-使用数据库">2.5 使用数据库</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看正在使用的数据库  使用的一个 mysql 中的全局函数</span></span><br><span class="line"><span class="keyword">select</span> database();</span><br><span class="line"><span class="comment">-- 使用/切换数据库</span></span><br><span class="line">use 数据库名</span><br></pre></td></tr></tbody></table></figure><h1>3. DDL 操作表结构</h1><h2 id="3-1-MySQL-数据类型">3.1 MySQL 数据类型</h2><blockquote><p>常用数据类型</p></blockquote><table><thead><tr><th style="text-align:center">类型</th><th>描述</th></tr></thead><tbody><tr><td style="text-align:center">int</td><td>整形</td></tr><tr><td style="text-align:center">double</td><td>浮点型</td></tr><tr><td style="text-align:center">varchar</td><td>字符串型</td></tr><tr><td style="text-align:center">date</td><td>日期类型<br>格式为 yyyy-MM-dd,只有年月日,没有时分秒</td></tr></tbody></table><blockquote><p>详细的数据类型</p></blockquote> <table border="1" cellpadding="5px" cellspacing="0px">    <tbody><tr>      <th>分类</th>      <th>类型名称</th>      <th>类型说明</th>    </tr>    <tr>      <th rowspan="4">整形</th>      <td>tinyInt</td>      <td>微整型：很小的整数(占 8 位二进制)</td>    </tr>    <tr>      <td>smallint</td>      <td>小整型：小的整数(占 16 位二进制)</td>    </tr>    <tr>      <td>mediumint</td>      <td>中整型：中等长度的整数(占 24 位二进制)</td>    </tr>    <tr>      <td>int(integer)</td>      <td>整型：整数类型(占 32 位二进制)</td>    </tr>    <tr>      <th rowspan="2">小数</th>      <td>float</td>      <td>单精度浮点数，占 4 个字节</td>    </tr>    <tr>      <td>double</td>      <td>双精度浮点数，占 8 个字节</td>    </tr>    <tr>      <th rowspan="3">日期</th>      <td>double</td>      <td>双精度浮点数，占 8 个字节</td>    </tr>    <tr>      <td>time</td>      <td>表示时间类型</td>    </tr>    <tr>      <td>datetime</td>      <td>同时可以表示日期和时间类型</td>    </tr>    <tr>      <th rowspan="2">字符串</th>      <td>char(m)</td>      <td>固定长度的字符串，无论使用几个字符都占满全部，M 为 0~255 之间的整数</td>    </tr>    <tr>      <td>varchar(m)</td>      <td>可变长度的字符串，使用几个字符就占用几个，M 为 0~65535 之间的整数</td>    </tr>    <tr>      <th rowspan="4">大二进制</th>      <td>tinyblob Big Large Object</td>      <td>允许长度 0~255 字节</td>    </tr>    <tr>      <td>blob</td>      <td>允许长度 0~65535 字节</td>    </tr>    <tr>      <td>mediumblob</td>      <td>允许长度 0~167772150 字节</td>    </tr>    <tr>      <td>longblob</td>      <td>允许长度 0~4294967295 字节</td>    </tr>    <tr>      <th rowspan="4">大文本</th>      <td>tinytext</td>      <td>允许长度 0~255 字节</td>    </tr>    <tr>      <td>text</td>      <td>允许长度 0~65535 字节</td>    </tr>    <tr>      <td>mediumtext</td>      <td>允许长度 0~167772150 字节</td>    </tr>    <tr>      <td>longtext</td>      <td>允许长度 0~4294967295 字节</td>    </tr>  </tbody></table><h2 id="3-2-创建表">3.2 创建表</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名 (</span><br><span class="line">字段名 <span class="number">1</span> 字段类型 <span class="number">1</span>,</span><br><span class="line">字段名 <span class="number">2</span> 字段类型 <span class="number">2</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建 student 表包含 id,name,birthday 字段</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student (</span><br><span class="line">id <span class="type">int</span>, <span class="comment">-- 整数</span></span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>), <span class="comment">-- 字符串</span></span><br><span class="line">birthday <span class="type">date</span> <span class="comment">-- 生日，最后没有逗号</span></span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><h2 id="3-3-查看表">3.3 查看表</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use 表名称;</span><br><span class="line"><span class="comment">-- 查看某个数据库中的所有表</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">table</span>;</span><br><span class="line"><span class="comment">-- 查看表结构</span></span><br><span class="line"><span class="keyword">desc</span> 表名;</span><br><span class="line"><span class="comment">-- 查看创建表的 SQL 语句</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></tbody></table></figure><h2 id="3-4-快速创建一个表结构相同的表">3.4 快速创建一个表结构相同的表</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> 新表名 <span class="keyword">like</span> 旧表名</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建一个 s1 的表与 student 结构相同</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> s1 <span class="keyword">like</span> student;</span><br><span class="line"><span class="keyword">desc</span> s1;</span><br></pre></td></tr></tbody></table></figure><h2 id="3-5-删除表">3.5 删除表</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 直接删除表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 表名;</span><br><span class="line"><span class="comment">-- 判断表是否存在，如果存在则删除表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> `<span class="keyword">create</span>`;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 直接删除表 s1 表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> s1;</span><br><span class="line"><span class="comment">-- 判断表是否存在并删除 s1 表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> `<span class="keyword">create</span>`;</span><br></pre></td></tr></tbody></table></figure><p><code>与直接删除的区别 如果表不存在，不删除，存在则删除</code></p><h2 id="3-6-修改表结构">3.6 修改表结构</h2><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加表列 ADD</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> 列名 类型;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列类型 MODIFY</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify 列名 新的类型;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改列名 CHANGE</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 change 旧列名 新列名 类型;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除列 DROP</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> 列名;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改表名</span></span><br><span class="line">rename <span class="keyword">table</span> 表名 <span class="keyword">to</span> 新表名;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改字符集 character set</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="type">character</span> <span class="keyword">set</span> 字符集;</span><br></pre></td></tr></tbody></table></figure><h1>4. 数据库备份和还原</h1><h2 id="4-1-备份的应用场景">4.1 备份的应用场景</h2><p>在服务器进行数据传输、数据存储和数据交换，就有可能产生数据故障。比如发生意外停机或存储介质损坏<br>这时，如果没有采取数据备份和数据恢复手段与措施，就会导致数据的丢失，造成的损失是无法弥补与估量的</p><h2 id="4-2-备份与还原的语句">4.2 备份与还原的语句</h2><blockquote><p>备份格式： DOS 下，未登录的时候。这是一个可执行文件 exe，在 bin 文件夹</p></blockquote><figure class="highlight cmd"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u 用户名 -p 密码 数据库 &gt; 文件的路径</span><br></pre></td></tr></tbody></table></figure><blockquote><p>还原格式：mysql 中的命令，需要登录后才可以操作</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">USE 数据库；</span><br><span class="line">SOURCE 导入文件的路径;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 备份 day21 数据库中的数据到 d:\day21.sql 文件中</span></span><br><span class="line">mysqldump <span class="operator">-</span>uroot <span class="operator">-</span>proot day21 <span class="operator">&gt;</span> d:<span class="operator">/</span>day21.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 还原 day21 数据库中的数据到 d:\day21.sql 文件中</span></span><br><span class="line">use day21;</span><br><span class="line">source d:<span class="operator">/</span>day21.sql;</span><br></pre></td></tr></tbody></table></figure><h1>5.  数据库约束的概述</h1><h2 id="5-1-数据库约束的概述">5.1 数据库约束的概述</h2><blockquote><p>约束的作用</p></blockquote><p>对表中的数据进行限制，保证数据的正确性、有效性和完整性</p><p>一个表如果添加了约束，不正确的数据将无 法插入到表中。约束在创建表的时候添加比较合适</p><blockquote><p>约束种类</p></blockquote><table><thead><tr><th style="text-align:center">约束名</th><th style="text-align:center">约束关键字</th></tr></thead><tbody><tr><td style="text-align:center">主键</td><td style="text-align:center">primary key</td></tr><tr><td style="text-align:center">唯一</td><td style="text-align:center">unique</td></tr><tr><td style="text-align:center">非空</td><td style="text-align:center">not null</td></tr><tr><td style="text-align:center">外键</td><td style="text-align:center">foreign key</td></tr><tr><td style="text-align:center">检查约束</td><td style="text-align:center">check <code>注mysql不支持</code></td></tr></tbody></table><h2 id="5-2-主键约束">5.2 主键约束</h2><blockquote><p>主键的作用</p></blockquote><p>用来唯一标识数据库中的每一条记录</p><blockquote><p>哪个字段应该作为表的主键？</p></blockquote><p>通常不用业务字段作为主键，单独给每张表设计一个 id 的字段，把 id 作为主键<br><code>主键是给数据库和程序使用的，不是给最终的客户使用的</code><br><code>所以主键有没有含义没有关系，只要不重复，非空就行</code></p><blockquote><p>创建主键</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在创建表的时候给字段添加主键</span></span><br><span class="line">字段名 字段类型 <span class="keyword">primary</span> key</span><br><span class="line"><span class="comment">-- 在已有表中添加主键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> <span class="keyword">primary</span> key(字段名);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表学生表 st5, 包含字段(id, name, age)将 id 做为主键</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> st5 (</span><br><span class="line"> id <span class="type">int</span> <span class="keyword">primary</span> key, <span class="comment">-- id 为主键</span></span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line"> age <span class="type">int</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">desc</span> st5;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>删除主键</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除 st5 表的主键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> st5 <span class="keyword">drop</span> <span class="keyword">primary</span> key;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加主键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> st5 <span class="keyword">add</span> <span class="keyword">primary</span> key(id);</span><br></pre></td></tr></tbody></table></figure><blockquote><p>主键自增</p></blockquote><p>主键如果让我们自己添加很有可能重复,我们通常希望在每次插入新记录时,数据库自动生成主键字段的值</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">auto_increment 表示自动增长(字段类型必须是整数类型)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 默认地 AUTO_INCREMENT 的开始值是 1，如果希望修改起始值,请使用下列 SQL 语法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表时指定起始值</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">列名 <span class="type">int</span> <span class="keyword">primary</span> key auto_increment</span><br><span class="line">) auto_increment<span class="operator">=</span>起始值;</span><br><span class="line"><span class="comment">-- 指定起始值为 1000</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> st4 (</span><br><span class="line"> id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">) auto_increment <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建好以后修改起始值</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 auto_increment<span class="operator">=</span>起始值;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> st4 auto_increment <span class="operator">=</span> <span class="number">2000</span>;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>DELETE 和 TRUNCATE 对自增长的影响</p></blockquote><ul><li>DELETE：删除所有的记录之后，自增长没有影响</li><li>TRUNCATE：删除以后，自增长又重新开始</li></ul><h2 id="5-3-唯一约束">5.3 唯一约束</h2><blockquote><p>什么是唯一约束： 表中某一列不能出现重复的值</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 <span class="keyword">unique</span></span><br><span class="line"><span class="comment">-- 创建学生表 st7, 包含字段(id, name),name 这一列设置唯一约束,不能出现同名的学生</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> st7 (</span><br><span class="line"> id <span class="type">int</span>,</span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">unique</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 如果插入相同的数据就会变成null,null没有数据不存在重复的问题</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5-4-非空约束">5.4 非空约束</h2><blockquote><p>什么是非空约束：某一列不能为 nul</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"><span class="comment">-- 创建表学生表 st8, 包含字段(id,name,gender)其中 name 不能为 NULL</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> st8 (</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span>,</span><br><span class="line">gender <span class="type">char</span>(<span class="number">1</span>)</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><blockquote><p>默认值</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">字段名 字段类型 <span class="keyword">default</span> 默认值</span><br><span class="line"><span class="comment">-- 创建一个学生表 st9，包含字段(id,name,address)， 地址默认值是广州</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> st9 (</span><br><span class="line"> id <span class="type">int</span>,</span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line"> address <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">default</span> <span class="string">'广州'</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><p>如果一个字段设置了非空与唯一约束，该字段与主键的区别?</p><ol><li><code>主键数在一个表中，只能有一个</code>。不能出现多个主键。主键可以单列，也可以是多列</li><li>自增长只能用在主键上</li></ol><h2 id="5-5-外键约束">5.5 外键约束</h2><blockquote><p>什么是外键：<code>在从表中</code>与主表主键对应的那一列</p><ul><li>主表： 一方，用来约束别人的表</li><li>从表： 多方，被别人约束的表</li></ul><p>在<code>从表</code>中通过外键去<code>主表</code>中获取信息</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 新建表时增加外键：</span></span><br><span class="line">[<span class="keyword">constraint</span>] [外键约束名称] <span class="keyword">foreign</span> key(外键字段名)  <span class="keyword">references</span> 主表名(主键字段名)</span><br><span class="line"><span class="comment">-- 已有表增加外键：</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 从表 <span class="keyword">add</span> [<span class="keyword">constraint</span>] [外键约束名称] <span class="keyword">foreign</span> key (外键字段名) <span class="keyword">references</span> 主表(主</span><br><span class="line">键字段名);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1) 删除副表/从表 employee</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> employee;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2) 创建从表 employee 并添加外键约束 emp_depid_fk</span></span><br><span class="line"><span class="comment">-- 多方，从表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> employee(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">age <span class="type">int</span>,</span><br><span class="line">dep_id <span class="type">int</span>, <span class="comment">-- 外键对应主表的主键</span></span><br><span class="line"><span class="comment">-- 创建外键约束</span></span><br><span class="line"><span class="keyword">constraint</span> emp_depid_fk <span class="keyword">foreign</span> key (dep_id) <span class="keyword">references</span> department(id)</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><blockquote><p>删除外键</p></blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 从表 <span class="keyword">drop</span> <span class="keyword">foreign</span> key 外键名称;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除 employee 表的 emp_depid_fk 外键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employee <span class="keyword">drop</span> <span class="keyword">foreign</span> key emp_depid_fk;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 employee 表存在的情况下添加外键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employee <span class="keyword">add</span> <span class="keyword">constraint</span> emp_depid_fk <span class="keyword">foreign</span> key (dep_id) <span class="keyword">references</span> department(id);</span><br></pre></td></tr></tbody></table></figure><blockquote><p>外键的级联</p></blockquote><p><code>在修改和删除主表的主键时，同时更新或删除副表的外键值，称为级联操作</code></p><table><thead><tr><th style="text-align:center">级联操作语法</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">on update cascade</td><td style="text-align:center">级联更新，只能是创建表的时候创建级联关系<br>更新主表中的主键，从表中的外键列也自动同步更新</td></tr><tr><td style="text-align:center">on delete cascade</td><td style="text-align:center">级联删除</td></tr></tbody></table><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除 employee 表，重新创建 employee 表，添加级联更新和级联删除</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> employee;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> employee(</span><br><span class="line">id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">age <span class="type">int</span>,</span><br><span class="line">dep_id <span class="type">int</span>, <span class="comment">-- 外键对应主表的主键</span></span><br><span class="line"><span class="comment">-- 创建外键约束</span></span><br><span class="line"><span class="keyword">constraint</span> emp_depid_fk <span class="keyword">foreign</span> key (dep_id) <span class="keyword">references</span> </span><br><span class="line">department(id) <span class="keyword">on</span> <span class="keyword">update</span> cascade <span class="keyword">on</span> <span class="keyword">delete</span> cascade</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><h1>6. 表与表之间的关系</h1><h2 id="6-1-表关系的概念">6.1 表关系的概念</h2><blockquote><p>表与表之间的三种关系</p></blockquote><table><thead><tr><th style="text-align:center">三种关系</th><th style="text-align:center">栗子</th></tr></thead><tbody><tr><td style="text-align:center">一对多</td><td style="text-align:center">最常用的关系部门和员工</td></tr><tr><td style="text-align:center">多对多</td><td style="text-align:center">学生选课表 和 学生表， 一门课程可以有多个学生选择，一个学生选择多门课程</td></tr><tr><td style="text-align:center">一对一</td><td style="text-align:center">相对使用比较少。员工表 简历表， 公民表 护照表</td></tr></tbody></table><h2 id="6-2-一对多">6.2 一对多</h2><p>一对多（1:n） 例如：班级和学生，部门和员工，客户和订单，分类和商品</p><p>一对多建表原则: 在<code>从表(多方)</code>创建一个字段,字段作为外键指向<code>主表(一方)</code>的主键</p><h2 id="6-3-多对多">6.3 多对多</h2><p>多对多（m:n） 例如：老师和学生，学生和课程，用户和角色</p><p>多对多关系建表原则: <strong>需要创建第三张表，中间表中至少两个字段，这两个字段分别作为外键指向各自一方的主键</strong></p><h2 id="6-4-一对一">6.4 一对一</h2><p>一对一（1:1） 在实际的开发中应用不多.因为一对一可以创建成一张表</p><p>两种建表原则</p><table><thead><tr><th style="text-align:center">一对一的建表原则</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">外键唯一</td><td style="text-align:center">主表的主键和从表的外键（唯一），形成主外键关系，外键唯一 UNIQUE</td></tr><tr><td style="text-align:center">外键是主键</td><td style="text-align:center">主表的主键和从表的主键，形成主外键关系</td></tr></tbody></table><h1>7. 数据库设计</h1><h2 id="7-1-数据规范化">7.1 数据规范化</h2><blockquote><p>什么是范式</p></blockquote><p>好的数据库设计对数据的存储性能和后期的程序开发，都会产生重要的影响<br>建立科学的，规范的数据库就需要满足一些规则来优化数据的设计和存储，这些规则就称为范式</p><blockquote><p>三大范式</p></blockquote><p>目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）<br> 满足最低要求的范式是第一范式（1NF）<br>在第一范式的基础上进一步满足更多规范要求的称为第二范式（2NF），其余范式以次类推<br>一般说来，数据库只需满足第三范式(3NF）就行了</p><h2 id="7-2-1NF">7.2 1NF</h2><blockquote><p>概念</p></blockquote><p>数据库表的每一列都是不可分割的原子数据项，不能是集合、数组等非原子数据项<br>即表中的某个列有多个值时，必须拆分为不同的列<br><code>简而言之，第一范式每一列不可再拆分，称为原子性</code></p><table><thead><tr><th style="text-align:center"><code>学号</code></th><th style="text-align:center">姓名</th><th style="text-align:center">班级</th></tr></thead><tbody><tr><td style="text-align:center"><code>1</code></td><td style="text-align:center">张三</td><td style="text-align:center">一班</td></tr><tr><td style="text-align:center"><code>2</code></td><td style="text-align:center">李四</td><td style="text-align:center">二班</td></tr><tr><td style="text-align:center"><code>3</code></td><td style="text-align:center">王五</td><td style="text-align:center">三班</td></tr></tbody></table><h2 id="7-3-2NF">7.3 2NF</h2><blockquote><p>概念</p></blockquote><p>在满足第一范式的前提下，表中的每一个字段都完全依赖于主键<br>所谓完全依赖是指不能存在仅依赖主键一部分的列<br><code>简而言之，第二范式就是在第一范式的基础上所有列完全依赖于主键列</code><br>当存在一个复合主键包含多个主键列的时候，才会发生不符合第二范式的情况<br>比如有一个主键有 两个列，不能存在这样的属性，它只依赖于其中一个列，这就是不符合第二范式</p><p>第二范式的特点：</p><ol><li>一张表只描述一件事情</li><li>表中的每一列都完全依赖于主键</li></ol><p>借书证表</p><table><thead><tr><th><code>学生证号</code></th><th>学生证名称</th><th>学生证办理时间</th><th><code>借书证号</code></th><th>借书证名称</th><th>借书证办理时间</th></tr></thead></table><p>分成两张表</p><table><thead><tr><th><code>学生证号</code></th><th>学生证名称</th><th>学生证办理时间</th></tr></thead></table><table><thead><tr><th><code>借书证号</code></th><th>借书证名称</th><th>借书证办理时间</th></tr></thead></table><h2 id="7-4-3NF">7.4 3NF</h2><blockquote><p>概念</p></blockquote><p>在满足第二范式的前提下，表中的每一列都直接依赖于主键，而不是通过其它的列来间接依赖于主键<br>简而言之，第三范式就是所有列不依赖于其它非主键列，也就是在满足 2NF 的基础上，任何非主列不得传递依赖于主键<br>所谓传递依赖，指的是如果存在"A → B → C"的决定关系，则 C 传递依赖于 A<br>因此，满足第三范式的数据库表应该不存在如下依赖关系：主键列 → 非主键列 x → 非主键列 y</p><blockquote><p>学生信息表</p></blockquote><table><thead><tr><th style="text-align:center"><code>学号</code></th><th style="text-align:center">姓名</th><th style="text-align:center">年龄</th><th style="text-align:center"><code>所在学院</code></th><th style="text-align:center"><code>学院地点</code></th></tr></thead></table><p>存在传递的决定关系： <code>学号---&gt;所在学院---&gt;学院地点</code></p><p>拆分成两张表</p><table><thead><tr><th style="text-align:center"><code>学号</code></th><th style="text-align:center">姓名</th><th style="text-align:center">年龄</th><th style="text-align:center">所在学院的编号(外键)</th></tr></thead></table><table><thead><tr><th style="text-align:center"><code>学院编号 </code></th><th style="text-align:center">所在学院</th><th style="text-align:center">学院地点</th></tr></thead></table><h2 id="7-5-三大范式小结">7.5 三大范式小结</h2><table><thead><tr><th>范式</th><th>特点</th></tr></thead><tbody><tr><td>1NF</td><td>原子性：表中每列不可再拆分</td></tr><tr><td>2NF</td><td>不产生局部依赖，一张表只描述一件事情</td></tr><tr><td>3NF</td><td>不产生传递依赖，表中每一列都直接依赖于主键。而不是通过其它列间接依赖于主键</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySql(一) 认识与安装Mysql数据库</title>
      <link href="/mysql/mysql-yi-ren-shi-yu-an-zhuang-mysql-shu-ju-ku/"/>
      <url>/mysql/mysql-yi-ren-shi-yu-an-zhuang-mysql-shu-ju-ku/</url>
      
        <content type="html"><![CDATA[<h1>1 数据库概述</h1><blockquote><h2 id="1-1-数据存储的方式">1.1 数据存储的方式</h2></blockquote><table><thead><tr><th>储存位置</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>内存</td><td>速度快</td><td>不能永久保存,数据是临时状态</td></tr><tr><td>文件</td><td>数据可以永久保存</td><td>操作数据不方便,查询某个数据</td></tr><tr><td>数据库</td><td>1. 数据库可以永久保存<br>2.查询速度快<br>3.对数据的管理方便</td><td>占用资源,需要购买</td></tr></tbody></table><blockquote><h2 id="1-2-什么是数据库">1.2 什么是数据库</h2></blockquote><ol><li>存储数据的仓库</li><li>本是上是一个系统文件,还是以文件的方式存在服务器电脑上的</li><li>所有的关系型数据库都可以使用通用的<strong>SQL</strong>语句进行管理  <strong>DBMS DataBase Management System</strong></li></ol><h1>2 常见数据库</h1><ul><li><code>MySQL</code>：开源免费的数据库，小型的数据库，已经被 Oracle 收购了。MySQL6.x 版本也开始收费。后来 Sun 公司收购了 MySQL，而 Sun 公司又被 Oracle 收购</li><li><code>Oracle</code>：收费的大型数据库，Oracle 公司的产品</li><li><code>DB2</code> ：IBM 公司的数据库产品,收费的。常应用在银行系统中</li><li><code>SQL Server</code>：MicroSoft 公司收费的中型的数据库。C#、.net 等语言常使用</li><li><code>SQLite</code>: 嵌入式的小型数据库，应用在手机端，如：Android</li></ul><h1>3.  数据库的安装与卸载</h1><blockquote><h2 id="3-1-数据库的安装">3.1 <strong>数据库的安装</strong></h2><p>安装过程分成两个部分</p><ol><li>文件解压和复制过程，默认的安装目录：C:\Program Files\MySQL\MySQL Server 5.7\</li><li>安装好以后必须对 MySQL 服务器进行配置    在 mysql 中管理员的名字：root</li></ol></blockquote><ol><li>打开下载的 mysql 安装文件双击解压缩，运行“mysql-5.5.40-win32.msi</li><li>选择安装类型，有“Typical（默认）”、“Complete（完全）”、“Custom（用户自定义）”三个选项，选择“Custom”， 按“next”键继续</li><li>点选“Browse”，手动指定安装目录</li><li>填上安装目录</li><li>确认一下先前的设置，如果有误，按“Back”返回重做。按“Install”开始安装</li><li>正在安装中，请稍候</li><li>安装完成了，将进入 mysql 配置向导</li><li>选择配置方式，“Detailed Configuration（手动精确配置）”、“Standard Configuration（标准配置）”，我们选择“Detailed Configuration”，方便熟悉配置过程</li><li>选择服务器类型<br>“Developer Machine（开发测试类，mysql 占用很少资源）”<code>[练习选这个]</code><br>“Server Machine（服务器类型，mysql 占用较多资源）”<br>“Dedicated MySQL Server Machine（专门的数据库服务器，mysql 占 用所有可用资源）</li><li>选择mysql数据库的大致用途<br>“Multifunctional Database（通用多功能型，好）”<code>[练习选这个]</code><br>“Transactional Database Only（服务器类型，专注于事务处理，一般）”<br>“Non-Transactional Database Only（非事务处理型，较简单，主要做一些监控、记数用，对 MyISAM 数据类型的支持仅限于 non-transactional），按“Next” 继续</li><li>选择网站并发连接数，同时连接的数目<br>“Decision Support(DSS)/OLAP（20个左右）“Online ”<br> Transaction Processing(OLTP)（500 个左右）”<br>“Manual Setting（手动设置，自己输一个数）[我选择20个]</li><li>是否启用 TCP/IP 连接，设定端口，如果不启用，就只能在自己的机器上访问 mysql 数据库了<code>[3306端口]</code>在这个页面上，您还可以选择“启用标准模式”（Enable Strict Mode），这样 MySQL 就不会允许细小的语法错误<br>如果是新手，建议您取消标准模式以减少麻烦。但熟悉 MySQL 以后，尽量使用标准模式，因为它可以降低有害数据进入数据库的可能性<code>[想什么哇,肯定标准走起]</code><br>按“Next”继续</li><li>就是对 mysql 默认数据库语言编码进行设置（重要），一般选 UTF-8，按 “Next”继续</li><li>选择是否将 mysql 安装为 windows 服务，还可以指定 Service Name（服务标识名称），是否将 mysql 的 bin 目录加入到 Windows PATH（加入后，就可以直接使用 bin 下的文件，而不用指出目录名，比如连接， “mysql.exe -uusername -ppassword;”就可以了，不用指出 mysql.exe 的完整地址，很方便），我这里全部 打上了勾，Service Name 不变。按“Next”继续</li><li>询问是否要修改默认 root 用户（超级管理）的密码<br>“Enable root access from remote machines（是否允许 root 用户在其它的机器上登陆，如果要安全，就不要勾上，如果要方便，就勾上它）” <code>[勾上 直接账号密码都是root]</code><br>“Create An Anonymous Account（新建一个匿名用户，匿名用户可以连接数据库，不能操作数据，包括查询）”一般就不用勾了，设置完毕，按“Next”继续</li><li>确认设置无误，按“Execute”使设置生效，即完成 MYSQL 的安装和配置</li></ol><blockquote><p>注意：设置完毕，按“Finish”后有一个比较常见的错误，就是不能“Start service”，一般出现在以前有安装 mysql 的服务器上，解决的办法，先保证以前安装的 mysql 服务器彻底卸载掉了；不行的话，检查是否按上面一步所说， 之前的密码是否有修改，照上面的操作；如果依然不行，将 mysql 安装目录下的 data 文件夹备份，然后删除，在 安装完成后，将安装生成的 data 文件夹删除，备份的 data 文件夹移回来，再重启 mysql 服务就可以了，这种情况 下，可能需要将数据库检查一下，然后修复一次，防止数据出错</p><p><code>解决方法：卸载 MySQL,重装 MySQL</code></p></blockquote><blockquote><h2 id="3-2-数据库的卸载">3.2 <strong>数据库的卸载</strong></h2></blockquote><ol><li>停止 window 的 MySQL 服务。 找到“控制面板”-&gt; “管理工具”-&gt; “服务”，停止 MySQL 后台服务</li><li>卸载 MySQL 安装程序。找到“控制面板”-&gt; “程序和功能”，卸载 MySQL 程序</li><li>删除 MySQL 安装目录下的所有文件</li><li>删除 c 盘 ProgramDate 目录中关于 MySQL 的目录。路径为：C:\ProgramData\MySQL(是隐藏文件,需要显示 出来)</li></ol><h1>4. 数据库服务的启动与登录</h1><blockquote><p>MySQL 服务器启动方式有两种</p></blockquote><ol><li><p>通过服务的方式自动启动</p><p><code>此电脑</code>—右键<code>管理</code>—服务于应用程序—服务—右键MySQL</p></li><li><p>手动启动的方式</p><p><code>win+r</code>—<code>cmd</code>–<code>net start mysql</code></p><p><code>win+r</code>—<code>cmd</code>–<code>net stop mysql</code></p></li></ol><blockquote><p>控制台连接数据库</p></blockquote><p>MySQL 是一个需要账户名密码登录的数据库，登陆后使用，它提供了一个默认的 root 账号，使用安装时设置 的密码即可登录</p><p>登录格式 1：u 和 p 后面没有空格</p><blockquote><p>mysql -u用户名 -p密码</p><p>mysql -uroot -poot</p></blockquote><p>登录格式 2:</p><blockquote><p>mysql -hip 地址 -u用户名 -p密码</p><p>mysql -h127.0.0.1 -uroot -proot</p></blockquote><p>登录格式 3：</p><blockquote><p>mysql --host=ip 地址 --user=用户名 --password=密码</p><p>mysql --host=127.0.0.1 --user=root --password=root</p></blockquote><p>退出 MySQL：</p><blockquote><p>quit 或 exit</p></blockquote><h2 id="5-MySQL-目录结构">5. MySQL 目录结构</h2><table><thead><tr><th>MySQL 的目录结构</th><th>描述</th></tr></thead><tbody><tr><td>bin&lt;目录&gt;</td><td>所有 mysql 的可执行文件，如：mysql.exe</td></tr><tr><td>MySQLInstanceConfig.exe</td><td>数据库的配置向导，在安装时出现的内容</td></tr><tr><td>data&lt;目录&gt;</td><td>系统必须的数据库所在的目录</td></tr><tr><td>my.ini 文件</td><td>mysql 的配置文件，一般不建议去修改</td></tr><tr><td>c:\ProgramData\MySQL\MySQ L Server 5.7\data\</td><td>我们自己创建的数据库所在的文件夹</td></tr></tbody></table><h2 id="6-数据库管理系统">6. 数据库管理系统</h2><p>​数据库管理系统（<strong>DataBase Management System，DBMS</strong>）：指一种操作和管理数据库的大型软件，用于建 立、使用和维护数据库，对数据库进行统一管理和控制，以保证数据库的安全性和完整性。用户通过数据库管理 系统访问数据库中<code>表内的数据</code></p><h2 id="7-数据库管理系统、数据库和表的关系">7. 数据库管理系统、数据库和表的关系</h2><p>​数据库管理程序(DBMS)可以管理多个数据库，一般开发人员会针对每一个应用创建一个数据库。为保存应用 中实体的数据，一般会在数据库创建多个表，以保存程序中实体 User 的数据</p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt="数据库管理系统、数据库和表的关系"></p><ol><li>一个数据库服务器包含多个库</li><li>一个数据库包含多张表</li><li>一张表包含多条记录</li></ol>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jsp页面中自定义标签的使用</title>
      <link href="/javaee/spring/utils/jsp-ye-mian-zhong-zi-ding-yi-biao-qian-de-shi-yong/"/>
      <url>/javaee/spring/utils/jsp-ye-mian-zhong-zi-ding-yi-biao-qian-de-shi-yong/</url>
      
        <content type="html"><![CDATA[<p>Utils文件</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTag</span> <span class="keyword">extends</span> <span class="title class_">TagSupport</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">doStartTag</span><span class="params">()</span> <span class="keyword">throws</span> JspException{</span><br><span class="line">        <span class="type">JspWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="built_in">super</span>.pageContext.getOut();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            out.print(<span class="string">"这是一个自定义标签输出的内容"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.doStartTag();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>编写tld描述文件 myTag.tld</p><blockquote><p>注意url要和jsp的一致</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">taglib</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">"-//Sun Microsystems, Inc.//DTD JSP Tag Library 1.2//EN"</span></span></span><br><span class="line"><span class="meta">  <span class="string">"http://java.sun.com/dtd/web-jsptaglibrary_1_2.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">taglib</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tlib-version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">tlib-version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jsp-version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">jsp-version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">short-name</span>&gt;</span>myTag<span class="tag">&lt;/<span class="name">short-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uri</span>&gt;</span>http://jyw.cn/myTag/<span class="tag">&lt;/<span class="name">uri</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>out<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tag-class</span>&gt;</span>cn.jyw.crm.utils.MyTag<span class="tag">&lt;/<span class="name">tag-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body-content</span>&gt;</span>JSP<span class="tag">&lt;/<span class="name">body-content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">taglib</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>注意taglib中url要与tld文件中一致</p></blockquote><figure class="highlight jsp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">"mtTag"</span> uri=<span class="string">"http://jyw.cn/myTag/"</span>%&gt;</span><br><span class="line"></span><br><span class="line">&lt;mtTag:out&gt;&lt;/mtTag:out&gt;</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
          <category> Utils </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaEE </tag>
            
            <tag> Utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSM框架整合</title>
      <link href="/javaee/spring/ssm-kuang-jia-zheng-he/"/>
      <url>/javaee/spring/ssm-kuang-jia-zheng-he/</url>
      
        <content type="html"><![CDATA[<h1>1. 原始方式整合</h1><h2 id="1-1-准备工作">1.1 准备工作</h2><table><thead><tr><th style="text-align:center">名称</th><th style="text-align:center">类型</th></tr></thead><tbody><tr><td style="text-align:center">id</td><td style="text-align:center">int</td></tr><tr><td style="text-align:center">name</td><td style="text-align:center">varchar(100)</td></tr><tr><td style="text-align:center">money</td><td style="text-align:center">double(7,2)</td></tr></tbody></table><h2 id="1-2-创建Maven工程">1.2 创建Maven工程</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring相关--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Spring上下文--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--aspectj织入 Aop用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jdbc用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--事务用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--测试用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring-mvc用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--servlet和jsp--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--mybatis相关--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis整合spring包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mysql的--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="1-3-编写实体类">1.3 编写实体类</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> money;</span><br><span class="line">    <span class="comment">//省略getter和setter方法</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-4-编写Mapper接口">1.4 编写Mapper接口</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountMapper</span> {</span><br><span class="line">    <span class="comment">//保存账户数据</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Account account)</span>;</span><br><span class="line">    <span class="comment">//查询账户数据</span></span><br><span class="line">    List&lt;Account&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-5-编写Service接口">1.5 编写Service接口</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> {</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Account account)</span>; <span class="comment">//保存账户数据</span></span><br><span class="line">    List&lt;Account&gt; <span class="title function_">findAll</span><span class="params">()</span>; <span class="comment">//查询账户数据</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-6-编写Service接口实现">1.6 编写Service接口实现</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service("accountService")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Account account)</span> {</span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">            resourceAsStream = Resources.getResourceAsStream(<span class="string">"sqlMapConfig.xml"</span>);</span><br><span class="line">           <span class="comment">//获得session工厂对象</span></span><br><span class="line">            <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line">            <span class="comment">//获得session会话对象</span></span><br><span class="line">            <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">            <span class="type">AccountMapper</span> <span class="variable">accountMapper</span> <span class="operator">=</span> sqlSession.getMapper(AccountMapper.class);</span><br><span class="line">           accountMapper.save(account);</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">            sqlSession.close();</span><br><span class="line">           } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">           }</span><br><span class="line">        }</span><br><span class="line">    <span class="keyword">public</span> List&lt;Account&gt; <span class="title function_">findAll</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">        resourceAsStream = Resources.getResourceAsStream(<span class="string">"sqlMapConfig.xml"</span>);</span><br><span class="line">           <span class="comment">//获得session工厂对象</span></span><br><span class="line">            <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line">            <span class="comment">//获得session会话对象</span></span><br><span class="line">            <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">          <span class="type">AccountMapper</span> <span class="variable">accountMapper</span> <span class="operator">=</span> sqlSession.getMapper(AccountMapper.class);</span><br><span class="line"><span class="keyword">return</span> accountMapper.findAll();</span><br><span class="line">            } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">           }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-7-编写Controller">1.7 编写Controller</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line">    <span class="comment">//设置相应编码</span></span><br><span class="line">    <span class="meta">@RequestMapping(value="/save",produces="text/html;harset=UTF-8")</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(Account account)</span>{</span><br><span class="line">        accountService.save(account);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"保存成功"</span>;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping("/findAll")</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">findAll</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        modelAndView.setViewName(<span class="string">"accountList"</span>);</span><br><span class="line">        modelAndView.addObject(<span class="string">"accountList"</span>,accountService.findAll());</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-8-编写添加页面">1.8 编写添加页面</h2><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>保存账户信息表单<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"${pageContext.request.contextPath}/save.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        用户名称<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        账户金额<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"money"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"保存"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="1-9-编写列表页面">1.9 编写列表页面</h2><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>账户id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>账户名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>账户金额<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"${accountList}"</span> <span class="attr">var</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>${account.id}<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>${account.name}<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>${account.money}<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="1-10-编写相应配置文件">1.10 编写相应配置文件</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">数据库连接信息文件：jdbc.properties</button></li><li class="tab"><button type="button" data-href="#1-2">日志文件：log4j.properties</button></li><li class="tab"><button type="button" data-href="#1-3">MyBatis核心文件：sqlMapConfig.xml</button></li><li class="tab"><button type="button" data-href="#1-4">MyBatis映射文件：AccountMapper.xml</button></li><li class="tab"><button type="button" data-href="#1-5">SprngMVC配置文件：spring-mvc.xml</button></li><li class="tab"><button type="button" data-href="#1-6">Spring配置文件：applicationContext.xml</button></li><li class="tab"><button type="button" data-href="#1-7">Web.xml文件：web.xml</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/ssm</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Hibernate, Relational Persistence for Idiomatic Java</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># License: GNU Lesser General Public License (LGPL), version 2.1 or later.</span></span><br><span class="line"><span class="comment"># See the lgpl.txt file in the root directory or &lt;http://www.gnu.org/licenses/lgpl-2.1.html&gt;.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### direct log messages to stdout ###</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d{ABSOLUTE} %5p %c{1}:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### direct messages to file hibernate.log ###</span></span><br><span class="line"><span class="comment">#log4j.appender.file=org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="comment">#log4j.appender.file.File=hibernate.log</span></span><br><span class="line"><span class="comment">#log4j.appender.file.layout=org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="comment">#log4j.appender.file.layout.ConversionPattern=%d{ABSOLUTE} %5p %c{1}:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### set log levels - for more verbose logging change 'info' to 'debug' ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">debug, stdout</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--加载properties文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbc.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--定义别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;typeAlias type="cn.jyw.pojo.Account" alias="account"/&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.jyw.pojo"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"developement"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"developement"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driver}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--加载映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="cn/jyw/mapper/AccountMapper.xml"&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.jyw.mapper"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.jyw.mapper.AccountMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">parameterType</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">        insert into account values(#{id},#{name},#{money})</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"account"</span>&gt;</span></span><br><span class="line">        select * from account</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--组件扫描  主要扫描controller--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置mvc注解驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--内部资源视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"resourceViewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/pages/"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开发静态资源访问权限--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:default-servlet-handler</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-6"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--组件扫描 扫描service和mapper--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--排除controller的扫描--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:exclude-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-7"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring 监听器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--springmvc的前端控制器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--乱码过滤器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>2. Spring整合MyBatis</h1><h2 id="2-1-整合思路">2.1 整合思路</h2><blockquote><p><strong>在Service中将Session工厂交给Spring容器管理,从容器中获得执行操纵的的Mapper实例即可</strong></p><p>resourceAsStream = Resources.getResourceAsStream(“sqlMapConfig.xml”);<br>//获得session工厂对象<br>SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(resourceAsStream);<br>//获得session会话对象<br>SqlSession sqlSession = sqlSessionFactory.openSession();<br>AccountMapper accountMapper = sqlSession.getMapper(AccountMapper.class);</p></blockquote><blockquote><p><strong>将事务的控制交给Spring容器进行声明事务控制</strong></p><p>sqlSession.commit();<br>sqlSession.close();</p></blockquote><h2 id="2-2-将SqlSessionFactory配置到Spring容器中">2.2 将SqlSessionFactory配置到Spring容器中</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--加载properties文件--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--配置数据源信息--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driver}"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--配置MyBatis的sessionFactory--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--加载mybatis核心文件--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:sqlMapConfig.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-3-扫描Mapper，让Spring容器产生Mapper实现类">2.3 扫描Mapper，让Spring容器产生Mapper实现类</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置Mapper扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"cn.jyw.mapper"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-4-配置声明式事务控制">2.4 配置声明式事务控制</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置声明式事务控制--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transacionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--事务的增强--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transacionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--事务的织入--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"txPointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* cn.jyw.service.impl.*.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txPointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>此时sqlMapConfig-spring.xml</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--定义别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;typeAlias type="cn.jyw.pojo.Account" alias="account"&gt;&lt;/typeAlias&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.jyw.pojo"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-5-修改Service实现类代码">2.5 修改Service实现类代码</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service("accountService")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Account account)</span> {</span><br><span class="line">        accountMapper.save(account);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> List&lt;Account&gt; <span class="title function_">findAll</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> accountMapper.findAll();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1>3. 整体整合思路(项目)</h1><h2 id="3-1-引入依赖">3.1 引入依赖</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">Spring</button></li><li class="tab"><button type="button" data-href="#1-2">MyBatis</button></li><li class="tab"><button type="button" data-href="#1-3">日志</button></li><li class="tab"><button type="button" data-href="#1-4">json</button></li><li class="tab"><button type="button" data-href="#1-5">jstl</button></li><li class="tab"><button type="button" data-href="#1-6">文件上传</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring相关--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--aspectj织入 aop用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--jdbc用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--事务用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--springmvc用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis相关--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis整合spring包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mysql的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--日志--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--json的--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--jsp中jstl--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-6"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="3-2-整合思路">3.2 整合思路</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">Dao层</button></li><li class="tab"><button type="button" data-href="#1-2">Service层</button></li><li class="tab"><button type="button" data-href="#1-3">Controller层</button></li><li class="tab"><button type="button" data-href="#1-4">Web.xml文件</button></li><li class="tab"><button type="button" data-href="#1-5">1 5</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><ol><li><code>sqlMapConfig.xml</code> 空文件即可但是要文件头</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><code>applicationContext-dao.xml</code><ol><li>数据库链接</li><li>sqlSessionFactory对象,需要spirng和mybatis整合包下的</li><li>配置mapper扫描器</li></ol></li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--加载properties文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置数据源信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driver}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置MyBatis的sessionFactory--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--加载mybatis核心文件--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"classpath:mybatis/sqlMapConfig.xml"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置这个之后mapper文件里面就可以直接写对应类名不用写全路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"typeAliasesPackage"</span> <span class="attr">value</span>=<span class="string">"cn.jyw.crm.pojo"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置Mapper扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--设置Mapper扫描包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"cn.jyw.crm.mapper"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>数据库配置文件(jdbc.properties)</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/crm</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><ol><li><code>applicationContext-service.xml</code>包扫描器,扫描@service注解的类</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置@Service类的包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw.crm.service"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><code>applciationContext-trans.xml</code>配置事务</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置声明式事务控制--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事务的增强--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--传播行为--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"insert*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"add*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"create*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"select*"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"query*"</span> <span class="attr">propagation</span>=<span class="string">"SUPPORTS"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事务的织入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"txPointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* cn.jyw.crm.service.impl.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"txPointcut"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p>springmvc.xml</p><ol><li>包扫描器,扫描@Controller注解的类</li><li>配置注解驱动</li><li>配置视图解析器</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--组件扫描  主要扫描controller--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw.crm.controller"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置mvc注解驱动--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开发静态资源访问权限--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><ol><li>配置spring</li><li>配置前端控制器</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置全局参数，指定ContextLoaderListener监听器所用到的contextConfigLocation值(spring配置文件的位置)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/applicationContext-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--由指定的监听器来创建并管理spring的容器对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--springmvc的前端控制器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置springmvc什么时候启动,参数必须为整数--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--如果为0或者大于0,则springmvc随着容器启动而启动--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--如果小于0,则在第一次请求进来的时候启动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--所有的请求进入springmvc--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--乱码过滤器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="3-3-注意事项">3.3 注意事项</h2><blockquote><ol><li>web.xml配置时,是设置所有的请求都进入SpirngMVC,但是SpringMVC无法处理css、js等静态资源，所以无法正常显示</li></ol></blockquote><blockquote><p>解决方案</p></blockquote><ol><li>在springmvc.xml中配置</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>修改web.xml,让所有以action结尾的请求都进入SpringMVC</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--所有的请求进入springmvc--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spirng(六) SpringMVC</title>
      <link href="/javaee/spring/spring-liu-springmvc/"/>
      <url>/javaee/spring/spring-liu-springmvc/</url>
      
        <content type="html"><![CDATA[<h1>1. Spring集成web环境</h1><h2 id="1-1-ApplicationContext应用上下文获取方式">1.1 ApplicationContext应用上下文获取方式</h2><blockquote><p>应用上下文对象是通过<code>new ClasspathXmlApplicationContext(spring配置文件) </code>方式获取的<br>但是每次从容器中获得Bean时都要编写<code>new ClasspathXmlApplicationContext(spring配置文件) </code><br>这样的弊端是配置文件加载多次，应用上下文对象创建多次。</p></blockquote><blockquote><p>在Web项目中，可以使用<code>ServletContextListener</code>监听Web应用的启动，我们可以在Web应用启动时,<br>就加载Spring的配置文件，创建应用上下文对象<code>ApplicationContext</code>，在将其存储到最大的域<code>servletContext</code>域 中，<br>这样就可以在任意位置从域中获得应用上下文<code>ApplicationContext</code>对象了。</p></blockquote><h2 id="1-2-Spring提供获取应用上下文的工具">1.2 Spring提供获取应用上下文的工具</h2><p>上面的分析不用手动实现，Spring提供了一个监听器<code>ContextLoaderListener</code>就是对上述功能的封装<br>该监听器内部加载Spring配置文件，创建应用上下文对象，并存储到<code>ServletContext</code>域中<br>提供了一个客户端工 具<code>WebApplicationContextUtils</code>供使用者获得应用上下文对象</p><p>所以我们需要做的只有两件事：</p><ol><li>在web.xml中配置<code>ContextLoaderListener</code>监听器（导入spring-web坐标）</li><li>使用<code>WebApplicationContextUtils</code>获得应用上下文对象<code>ApplicationContext</code></li></ol><h2 id="1-3-导入Spring集成web的坐标">1.3 导入Spring集成web的坐标</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="1-4-配置ContextLoaderListener监听器">1.4 配置ContextLoaderListener监听器</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--全局参数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Spring的监听器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    org.springframework.web.context.ContextLoaderListener</span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="1-5-通过工具获得应用上下文对象">1.5 通过工具获得应用上下文对象</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span>  WebApplicationContextUtils.getWebApplicationContext(servletContext); <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">"id"</span>);</span><br></pre></td></tr></tbody></table></figure><h1>2.  SpringMVC 简介</h1><h2 id="2-1-SpringMVC概述">2.1 SpringMVC概述</h2><p><code>SpringMVC </code>是一种基于 Java 的实现 <code>MVC 设计模型</code>的请求驱动类型的<code>轻量级 Web 框架</code>，属于 <code>SpringFrameWork</code> 的后续产品，已经融合在 Spring Web Flow 中</p><p>SpringMVC 已经成为目前最主流的MVC框架之一，并且随着Spring3.0 的发布，全面超越 Struts2，成为最优秀的 MVC 框架。<br>它通过一套注解，让一个简单的 Java 类成为处理请求的控制器，而无须实现任何接口。同时 它还支持 <code>RESTful</code> 编程风格的请求。</p><h2 id="2-2-SpringMVC快速入门">2.2 SpringMVC快速入门</h2><p>需求：客户端发起请求，服务器端接收请求，执行逻辑并进行视图跳转。</p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/SpringMVC%E5%85%A5%E9%97%A8%E6%AD%A5%E9%AA%A4.png" alt="SpringMVC入门步骤"></p><blockquote><h3 id="1-导入坐标">1. 导入坐标</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Spring坐标--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpringMVC坐标--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Servlet坐标--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Jsp坐标--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="2-在web-xml配置SpringMVC的核心控制器">2. 在web.xml配置SpringMVC的核心控制器</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置SpringMVC的前端控制器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="3-创建Controller和业务方法">3. 创建Controller和业务方法</h3></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"Controller save running......"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight jsp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Ciallo&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="4-配置注解">4. 配置注解</h3></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping("/quick")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"Controller save running......"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success.jsp"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="5-创建spring-mvc-xml">5. 创建spring-mvc.xml</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置注解扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Spring%20MVC%E6%B5%81%E7%A8%8B%E8%A7%86%E5%9B%BE.png" alt="Spring MVC流程视图"></p><h2 id="2-3-知识要点">2.3 知识要点</h2><p>SpringMVC的开发步骤</p><ol><li>导入SpringMVC相关坐标</li><li>配置SpringMVC核心控制器DispathcerServlet</li><li>创建Controller类和视图页面</li><li>使用注解配置Controller类中业务方法的映射地址</li><li>配置SpringMVC核心文件 spring-mvc.xml</li><li>客户端发起请求测试</li></ol><h1>3. 组件解析MVC</h1><h2 id="3-1-SpringMVC的执行流程">3.1 SpringMVC的执行流程</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/SpringMVC%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt="SpringMVC的执行流程 "></p><p>① 用户发送请求至前端控制器DispatcherServlet</p><p>② DispatcherServlet收到请求调用HandlerMapping处理器映射器</p><p>③ 处理器映射器找到具体的处理器(可以根据xml配置、注解进行查找)，生成处理器对象及处理器拦截器(如果 有则生成)一并返回给DispatcherServlet</p><p>④ DispatcherServlet调用HandlerAdapter处理器适配器</p><p>⑤ HandlerAdapter经过适配调用具体的处理器(Controller，也叫后端控制器)</p><p>⑥ Controller执行完成返回ModelAndView</p><p>⑦ HandlerAdapter将controller执行结果ModelAndView返回给DispatcherServlet</p><p>⑧ DispatcherServlet将ModelAndView传给ViewReslover视图解析器</p><p>⑨ ViewReslover解析后返回具体View</p><p>⑩ DispatcherServlet根据View进行渲染视图（即将模型数据填充至视图中）。DispatcherServlet响应用户。</p><h2 id="3-2-SpringMVC组件解析">3.2 SpringMVC组件解析</h2><ol><li><p><code>前端控制器：DispatcherServlet</code></p><blockquote><p>用户请求到达前端控制器，它就相当于 MVC 模式中的 C<br>DispatcherServlet 是整个流程控制的中心，由它调用其它组件处理用户的请求<br>DispatcherServlet 的存在降低了组件之间的耦合性</p></blockquote></li><li><p><code>处理器映射器：HandlerMapping</code></p><blockquote><p>HandlerMapping 负责根据用户请求找到 Handler 即处理器<br>SpringMVC 提供了不同的映射器实现不同的映射方式<br>例如：配置文件方式，实现接口方式，注解方式等</p></blockquote></li><li><p><code>处理器适配器：HandlerAdapter</code></p><blockquote><p>通过 HandlerAdapter 对处理器进行执行，这是适配器模式的应用，通过扩展适配器可以对更多类型的处理器进行执行</p></blockquote></li><li><p><code>处理器：Handler</code></p><blockquote><p>它就是我们开发中要编写的具体业务控制器<br>由 DispatcherServlet 把用户请求转发到 Handler<br>由 Handler 对具体的用户请求进行处理</p></blockquote></li><li><p><code>视图解析器：View Resolver</code></p><blockquote><p>View Resolver 负责将处理结果生成 View 视图<br>View Resolver 首先根据逻辑视图名解析成物理视图名，即具体的页面地址<br>再生成 View 视图对象<br>最后对 View 进行渲染将处理结果通过页面展示给用户</p></blockquote></li><li><p><code>视图：View</code></p><blockquote><p>SpringMVC 框架提供了很多的 View 视图类型的支持<br>包括：jstlView、freemarkerView、pdfView等，最常用的视图就是 jsp<br>一般情况下需要通过页面标签或页面模版技术将模型数据通过页面展示给用户，需要由程序员根据业务需求开发具体的页面</p></blockquote></li></ol><h2 id="3-3-SpringMVC注解解析">3.3 SpringMVC注解解析</h2><p><code>@RequestMapping</code></p><p>作用：用于建立请求 URL 和处理请求方法之间的对应关系</p><p>位置：</p><ul><li>类上，请求URL 的第一级访问目录<br>此处不写的话，就相当于应用的根目录</li><li>方法上，请求 URL 的第二级访问目录，与类上的使用@ReqquestMapping标注的一级目录一起组成访问虚拟路径</li></ul><p>属性：</p><ul><li><p><code>value</code>：用于指定请求的URL<br>它和path属性的作用是一样的</p></li><li><p><code>method</code>：用于指定请求的方式</p><p>例如：method = RequestMethod.POST</p></li><li><p><code>params</code>：用于指定限制请求参数的条件<br>它支持简单的表达式<br>要求请求参数的key和value必须和配置的一模一样</p><p>例如：</p><ul><li>params = {“accountName”}，表示请求参数必须有accountName</li><li>params = {“moeny!100”}，表示请求参数中money不能是100</li></ul></li></ul><blockquote><h3 id="1-mvc命名空间引入">1. mvc命名空间引入</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--命名空间：--&gt;</span></span><br><span class="line">xmlns:context="http://www.springframework.org/schema/context"</span><br><span class="line">xmlns:mvc="http://www.springframework.org/schema/mvc"</span><br><span class="line"><span class="comment">&lt;!--约束地址：--&gt;</span></span><br><span class="line">http://www.springframework.org/schema/context</span><br><span class="line">http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">http://www.springframework.org/schema/mvc </span><br><span class="line">http://www.springframework.org/schema/mvc/spring-mvc.xsd</span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="2-组件扫描">2. 组件扫描</h3></blockquote><p>SpringMVC基于Spring容器，所以在进行SpringMVC操作时，需要将Controller存储到Spring容器中<br>如果使用@Controller注解标注的话，就需要使用<code>&lt;context:component-scan base-package=“cn.jyw.controller"/&gt;</code>进行组件扫描</p><h2 id="3-4-SpringMVC的XML配置解析">3.4 SpringMVC的XML配置解析</h2><blockquote><h3 id="1-视图解析器">1. 视图解析器</h3></blockquote><p>SpringMVC有默认组件配置，默认组件都是DispatcherServlet.properties配置文件中配置的<br>该配置文件地址 org/springframework/web/servlet/DispatcherServlet.properties<br>该文件中配置了默认的视图解析器，如下：</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.web.servlet.ViewResolver</span>=<span class="string">org.springframework.web.servlet.view.InternalResourceViewResolver</span></span><br></pre></td></tr></tbody></table></figure><p>翻看该解析器源码，可以看到该解析器的默认设置，如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REDIRECT_URL_PREFIX = <span class="string">"redirect:"</span> <span class="comment">//重定向前缀</span></span><br><span class="line">FORWARD_URL_PREFIX = <span class="string">"forward:"</span> <span class="comment">//转发前缀（默认值）</span></span><br><span class="line">prefix = <span class="string">""</span>; <span class="comment">//视图名称前缀</span></span><br><span class="line">suffix = <span class="string">""</span>;<span class="comment">//视图名称后缀</span></span><br></pre></td></tr></tbody></table></figure><p>我们可以通过属性注入的方式修改视图的的前后缀</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置内部资源视图解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h1>4. SpringMVC的数据响应</h1><h2 id="4-1-SpringMVC的数据响应方式">4.1 SpringMVC的数据响应方式</h2><blockquote><ol><li>页面跳转</li></ol></blockquote><ul><li>直接返回字符串</li><li>通过ModeAndView对象返回</li></ul><blockquote><ol start="2"><li>回写数据</li></ol></blockquote><ul><li>直接返回字符串</li><li>返回对象或集合</li></ul><h2 id="4-2-页面跳转">4.2 页面跳转</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">返回字符串形式</button></li><li class="tab"><button type="button" data-href="#1-2">返回ModelAndView对象</button></li><li class="tab"><button type="button" data-href="#1-3">向request域存储数据</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>直接返回字符串：此种方式会将返回的字符串与视图解析器的前后缀拼接后跳转</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick")</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">quickMethod</span><span class="params">()</span>{ </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置内部资源视图解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/views/"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>转发资源地址：<code>/WEB-INF/views/index.jsp</code></p><p>返回带有前缀的字符串：</p><ul><li>转发：<code>forward:/WEB-INF/views/index.jsp </code></li><li>重定向：<code>redirect:/index.jsp</code></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick2")</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">quickMethod2</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    modelAndView.setViewName(<span class="string">"redirect:/WEB-INF/views/index.jsp"</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">}</span><br><span class="line"><span class="meta">@RequestMapping("/quick3")</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">quickMethod3</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    modelAndView.setViewName(<span class="string">"index.jsp"</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p>在进行转发时，往往要向request域中存储数据，在jsp页面中显示<br>那么Controller中怎样向request 域中存储数据呢？</p><blockquote><ol><li>通过SpringMVC框架注入的request对象setAttribute()方法设置 (不常用)</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick")</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">quickMethod</span><span class="params">(HttpServletRequest request)</span>{</span><br><span class="line">    request.setAttribute(<span class="string">"name"</span>,<span class="string">"zhangsan"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>通过ModelAndView的addObject()方法设置</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick3")</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">quickMethod3</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    modelAndView.setViewName(<span class="string">"index.jsp"</span>);</span><br><span class="line">    modelAndView.addObject(<span class="string">"name"</span>,<span class="string">"lisi"</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="4-3-回写数据">4.3 回写数据</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">直接返回字符串</button></li><li class="tab"><button type="button" data-href="#1-2">返回json串</button></li><li class="tab"><button type="button" data-href="#1-3">返回json对象或集合</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>Web基础阶段，客户端访问服务器端，如果想直接回写字符串作为响应体返回的话<br>只需要使用 response.getWriter().print(“hello world”) 即可<br>那么在Controller中想直接回写字符串该怎样呢？</p><blockquote><ol><li>通过SpringMVC框架注入的response对象<br>使用response.getWriter().print(“hello world”) 回写数据<br>此时不需要视图跳转，业务方法返回值为void。</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick4")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod4</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> </span><br><span class="line">IOException {</span><br><span class="line">response.getWriter().print(<span class="string">"hello world"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>将需要回写的字符串直接返回<br>但此时需要通过@ResponseBody注解告知SpringMVC框架<br>方法返回的字符串不是跳转是直接在http响应体中返回。</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick5")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">quickMethod5</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line"><span class="keyword">return</span> <span class="string">"hello springMVC!!!"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>在异步项目中，客户端与服务器端往往要进行json格式字符串交互，此时我们可以手动拼接json字符串返回</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick6")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">quickMethod6</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line"><span class="keyword">return</span> <span class="string">"{\"name\":\"zhangsan\",\"age\":18}"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>上述方式手动拼接json格式字符串的方式很麻烦，开发中往往要将复杂的java对象转换成json格式的字符串<br> 我们可以使用web阶段学习过的json转换工具jackson进行转换，导入jackson坐标</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--jackson--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>通过jackson转换json格式字符串，回写字符串</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick7")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">quickMethod7</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(<span class="string">"zhangsan"</span>);</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> objectMapper.writeValueAsString(user);</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p>通过SpringMVC帮助我们对对象或集合进行json字符串的转换并回写，为处理器适配器配置消息转换参数<br>指定使用jackson进行对象或集合的转换，因此需要在spring-mvc.xml中进行如下配置</p><blockquote><p><strong>注意此处配置后后面返回字符串都会带上引号 尽量不要使用这种繁琐而且效果不好的办法</strong></p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置处理器映射器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"messageConverters"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick8")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">quickMethod8</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(<span class="string">"zhangsan"</span>);</span><br><span class="line">    user.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>在方法上添加@ResponseBody就可以返回json格式的字符串<br>但是这样配置比较麻烦，配置的代码比较多<br>因此，我们可以使用MVC的注解驱动代替上述配置(引入mvc的引入空间)</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mvc的注解驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置处理器映射器--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;bean class="org.springframework.web.servlet.mvc.method.annotation</span></span><br><span class="line"><span class="comment">.RequestMappingHandlerAdapter"&gt;</span></span><br><span class="line"><span class="comment">    &lt;property name="messageConverters"&gt;</span></span><br><span class="line"><span class="comment">        &lt;list&gt;</span></span><br><span class="line"><span class="comment">            &lt;bean class="org.springframework.http.converter.json</span></span><br><span class="line"><span class="comment">            .MappingJackson2HttpMessageConverter"&gt;</span></span><br><span class="line"><span class="comment">            &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">        &lt;/list&gt;</span></span><br><span class="line"><span class="comment">    &lt;/property&gt;</span></span><br><span class="line"><span class="comment">&lt;/bean&gt;--&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>在 SpringMVC 的各个组件中，处理器映射器、处理器适配器、视图解析器称为 SpringMVC 的三大组件</p><p>使用自动加载 RequestMappingHandlerMapping（处理映射器）和 RequestMappingHandlerAdapter（ 处理 适 配 器 ），可用在Spring-xml.xml配置文件中使用 替代注解处理器和适配器的配置</p><p>同时使用默认底层就会集成jackson进行对象或集合的json格式字符串的转换</p><h1>5. SpringMVC获得请求数据</h1><h2 id="5-1-获得请求参数">5.1 获得请求参数</h2><p>客户端请求参数的格式是：name=value&amp;name=value… … 服务器端要获得请求的参数，有时还需要进行数据的封装<br>SpringMVC可以接收如下类型的参数：</p><ul><li>基本类型参数</li><li>POJO类型参数</li><li>数组类型参数</li><li>集合类型参数</li></ul><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">获得基本类型参数</button></li><li class="tab"><button type="button" data-href="#1-2">获得POJO类型参数</button></li><li class="tab"><button type="button" data-href="#1-3">获得数组类型参数</button></li><li class="tab"><button type="button" data-href="#1-4">获得集合类型参数</button></li><li class="tab"><button type="button" data-href="#1-5">ajax</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><blockquote><p>Controller中的业务方法的参数名称要与请求参数的name一致，参数值会自动映射匹配</p></blockquote><p>springmvc1/quick9?username=zhangsan&amp;age=12</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick9")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod9</span><span class="params">(String username,<span class="type">int</span> age)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    System.out.println(username);</span><br><span class="line">    System.out.println(age);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><blockquote><p>Controller中的业务方法的POJO参数的属性名与请求参数的name一致，参数值会自动映射匹配</p></blockquote><p>springmvc1/quick9?username=zhangsan&amp;age=12</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    getter/setter…</span><br><span class="line">}</span><br><span class="line"><span class="meta">@RequestMapping("/quick10")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod10</span><span class="params">(User user)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">System.out.println(user);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><blockquote><p>Controller中的业务方法数组名称与请求参数的name一致，参数值会自动映射匹配</p></blockquote><p>springmvc1/quick11?strs=111&amp;strs=222&amp;strs=333</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick11")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod11</span><span class="params">(String[] strs)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">System.out.println(Arrays.asList(strs));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><blockquote><p>获得集合参数时，要将集合参数包装到一个POJO中才可以</p></blockquote><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"${pageContext.request.contextPath}/quick12"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userList[0].username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userList[0].age"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userList[1].username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"userList[1].age"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> calss Vo{</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; userList</span><br><span class="line">        getter/setter...方法</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick12")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod12</span><span class="params">(Vo vo)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">System.out.println(vo.getUserList());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><blockquote><p>当使用ajax提交时，可以指定contentType为json形式，那么在方法参数位置使用@RequestBody可以直接接收集合数据而无需使用POJO进行包装</p></blockquote><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"${pageContext.request.contextPath}/js/jquery-3.3.1.js"</span>&gt;&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//模拟数据</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">var</span> userList = <span class="keyword">new</span> <span class="title class_">Array</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        userList.<span class="title function_">push</span>({<span class="attr">username</span>: <span class="string">"zhangsan"</span>,<span class="attr">age</span>: <span class="string">"20"</span>});</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        userList.<span class="title function_">push</span>({<span class="attr">username</span>: <span class="string">"lisi"</span>,<span class="attr">age</span>: <span class="string">"20"</span>});</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        $.<span class="title function_">ajax</span>({</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="string">"POST"</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">url</span>: <span class="string">"/springmvc1/quick13"</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(userList),</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            contentType : <span class="string">'application/json;charset=utf-8'</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        });</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick13")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod13</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;User&gt; userList)</span> <span class="keyword">throws</span> </span><br><span class="line">IOException {</span><br><span class="line">System.out.println(userList);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="5-2-放行静态资源">5.2 放行静态资源</h2><p>注意：通过谷歌开发者工具抓包发现，没有加载到jquery文件<br>原因是SpringMVC的前端控制器 DispatcherServlet的url-pattern配置的是/<br>代表对所有的资源都进行过滤操作<br>我们可以通过以下两种方式指定放行静态资源：</p><ul><li><p>在spring-mvc.xml配置文件中指定放行的资源</p><p><code>&lt;mvc:resources mapping="/js/**" location="/js/"/&gt;</code></p></li><li><p>使用<code>&lt;mvc:default-servlet-handler/&gt;</code>标签</p><p>代表原始容器去寻找资源</p></li></ul><h2 id="5-3-请求数据乱码问题">5.3 请求数据乱码问题</h2><p>当post请求时，数据会出现乱码，我们可以设置一个过滤器来进行编码的过滤</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5-4-参数绑定注解-requestParam">5.4 参数绑定注解@requestParam</h2><p>当请求的参数名称与Controller的业务方法参数名称不一致时，就需要通过@RequestParam注解显示的绑定</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"${pageContext.request.contextPath}/quick14"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick14")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod14</span><span class="params">(<span class="meta">@RequestParam("name")</span> String username)</span> <span class="keyword">throws</span> </span><br><span class="line">IOException {</span><br><span class="line">System.out.println(username);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>注解@RequestParam还有如下参数可以使用</p><ul><li><code>value</code>：与请求参数名称</li><li><code>required</code>：此在指定的请求参数是否必须包括，默认是true，提交时如果没有此参数则报错</li><li><code>defaultValue</code>：当没有指定请求参数时，则使用指定的默认值赋值</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick14")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod14</span><span class="params">(<span class="meta">@RequestParam(value="name",required = </span></span></span><br><span class="line"><span class="meta"><span class="params">false,defaultValue = "你好!")</span> String username)</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">System.out.println(username);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="5-5-获得Restful风格的参数">5.5 获得Restful风格的参数</h2><blockquote><p><code>Restful</code>是一种软件<code>架构风格、设计风格</code>，而不是标准，只是提供了一组设计原则和约束条件<br>主要用于客户端和服务 器交互类的软件，基于这个风格设计的软件可以更简洁，更有层次，更易于实现缓存机制等</p></blockquote><p>Restful风格的请求是使用“url+请求方式”表示一次请求目的的，HTTP 协议里面四个表示操作方式的动词如下：</p><ul><li>GET：用于获取资源/user/1 GET ： 得到 id = 1 的 user</li><li>POST：用于新建资源             /user POST： 新增 user</li><li>PUT：用于更新资源               /user/1 PUT： 更新 id = 1 的 user</li><li>DELETE：用于删除资源        /user/1 DELETE： 删除 id = 1 的 user</li></ul><p>上述url地址/user/1中的1就是要获得的请求参数，在SpringMVC中可以使用占位符进行参数绑定</p><p>地址/user/1可以写成 /user/{id}，占位符{id}对应的就是1的值</p><p>在业务方法中我们可以使用@PathVariable注解进行占位符的匹配获取工作</p><blockquote><p><strong>springmvc1/quick19/zhangsan</strong></p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick19/{name}")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod19</span><span class="params">(<span class="meta">@PathVariable(value = "name",required = true)</span> String name)</span>{</span><br><span class="line">System.out.println(name);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="5-6-自定义类型转换器">5.6 自定义类型转换器</h2><ul><li><p>SpringMVC 默认已经提供了一些常用的类型转换器，例如客户端提交的字符串转换成int型进行参数设置</p></li><li><p>但是不是所有的数据类型都提供了转换器，没有提供的就需要自定义转换器<br>例如：日期类型的数据就需要自 定义转换器。</p></li></ul><blockquote><h3 id="1-定义转换器类实现Converter接口">1. 定义转换器类实现Converter接口</h3></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String,Date&gt;{</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Date <span class="title function_">convert</span><span class="params">(String source)</span> {</span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> format.parse(source);</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    } <span class="keyword">catch</span> (ParseException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="2-在配置文件中声明转换器">2. 在配置文件中声明转换器</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"converterService"</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.jyw.converter.DateConverter"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="3-在-annotation-driven-中引用转换器">3. 在&lt; annotation-driven&gt;中引用转换器</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"converterService"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5-7-获得Servlet相关API">5.7 获得Servlet相关API</h2><p>SpringMVC支持使用原始ServletAPI对象作为控制器方法的参数进行注入，常用的对象如下</p><ul><li>HttpServletRequest</li><li>HttpServletResponse</li><li>HttpSession</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick16")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod16</span><span class="params">(HttpServletRequest request,HttpServletResponse </span></span><br><span class="line"><span class="params">response,HttpSession session)</span>{</span><br><span class="line">    System.out.println(request);</span><br><span class="line">    System.out.println(response);</span><br><span class="line">    System.out.println(session);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="5-8-获得请求头">5.8 获得请求头</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1"><i class="RequestHeader"></i>请求头</button></li><li class="tab"><button type="button" data-href="#1-2"><i class="CookieValue"></i>Cookie</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>使用@RequestHeader可以获得请求头信息，相当于web阶段学习的request.getHeader(name) @RequestHeader注解的属性如下：</p><ul><li><code>value</code>：请求头的名称</li><li><code>required</code>：是否必须携带此请求头</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick17")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod17</span><span class="params">(<span class="meta">@RequestHeader(value = "User-Agent",required = false)</span> String </span></span><br><span class="line"><span class="params">headerValue)</span>{</span><br><span class="line">System.out.println(headerValue);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>使用@CookieValue可以获得指定Cookie的值 @CookieValue注解的属性如下：</p><ul><li><code>value</code>：指定cookie的名称</li><li><code>required</code>：是否必须携带此cookie</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick18")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod18</span><span class="params">(<span class="meta">@CookieValue(value = "JSESSIONID",required = false)</span> String jsessionid)</span>{</span><br><span class="line">System.out.println(jsessionid);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>6. 文件上传</h1><h2 id="6-1-文件上传客户端三要素">6.1 文件上传客户端三要素</h2><ul><li>表单项type=“file”</li><li>表单的提交方式是post</li><li>表单的enctype属性是多部分表单形式，及enctype=“multipart/form-data”</li></ul><h2 id="6-2-文件上传原理">6.2 文件上传原理</h2><ul><li>当form表单修改为多部分表单时，request.getParameter()将失效</li><li>enctype=“application/x-www-form-urlencoded”时，form表单的正文内容格式是<code>key=value&amp;key=value&amp;key=value</code></li><li>当form表单的enctype取值为Mutilpart/form-data时，请求正文内容就变成多部分形式：</li></ul><h2 id="6-3-单文件上传步骤">6.3 单文件上传步骤</h2><blockquote><h3 id="1-导入fileupload和io坐标">1. 导入fileupload和io坐标</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="2-配置文件上传解析器">2. 配置文件上传解析器</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--上传文件总大小--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"5242800"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--上传单个文件的大小--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSizePerFile"</span> <span class="attr">value</span>=<span class="string">"5242800"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--上传文件的编码类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="3-编写文件上传代码">3. 编写文件上传代码</h3></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick20")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod20</span><span class="params">(String name,MultipartFile uploadFile)</span> <span class="keyword">throws</span> </span><br><span class="line">IOException {</span><br><span class="line">    <span class="comment">//获得文件名称</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> uploadFile.getOriginalFilename();</span><br><span class="line">    <span class="comment">//保存文件</span></span><br><span class="line">    uploadFile.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">"C:\\upload\\"</span>+originalFilename));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="6-4-多文件上传实现">6.4 多文件上传实现</h2><p>多文件上传，只需要将页面修改为多个文件上传项，将方法参数MultipartFile类型修改为MultipartFile[]即可</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>多文件上传测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"${pageContext.request.contextPath}/quick21"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    名称：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    文件1：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"uploadFiles"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    文件2：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"uploadFiles"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    文件3：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"uploadFiles"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick21")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod21</span><span class="params">(String name,MultipartFile[] uploadFiles)</span> <span class="keyword">throws</span> </span><br><span class="line">IOException {</span><br><span class="line">    <span class="keyword">for</span> (MultipartFile uploadFile : uploadFiles){</span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> uploadFile.getOriginalFilename();</span><br><span class="line">        uploadFile.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">"C:\\upload\\"</span>+originalFilename));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1>7. SpringMVC拦截器</h1><h2 id="7-1-拦截器（interceptor）的作用">7.1 拦截器（interceptor）的作用</h2><p>Spring MVC 的拦截器类似于 Servlet 开发中的过滤器 Filter，用于对处理器进行预处理和后处理</p><p>将拦截器按一定的顺序联结成一条链，这条链称为拦截器链（Interceptor Chain）</p><p>在访问被拦截的方 法或字段时，拦截器链中的拦截器就会按其之前定义的顺序被调用</p><p>拦截器也是AOP思想的具体实现</p><h2 id="7-2-拦截器和过滤器区别">7.2 拦截器和过滤器区别</h2><table><thead><tr><th style="text-align:center">区别</th><th style="text-align:center">过滤器(Filter)</th><th style="text-align:center">拦截器(Interceptor)</th></tr></thead><tbody><tr><td style="text-align:center">使用范围</td><td style="text-align:center">是servlet规范中的一部分,<br>任何Java Web 工程都能使用</td><td style="text-align:center">是 SpringMVC 框架自己的,<br>只有使用了 SpringMVC 框架的工程才能用</td></tr><tr><td style="text-align:center">拦截范围</td><td style="text-align:center">在 url-pattern 中配置了/*之后,<br>可以对所有要访问的资源拦截</td><td style="text-align:center">在&lt; mvc:mapping path=“”/&gt;中配置了/**之后也可以多所有资源进行拦截<br>但是可以通过&lt; mvc:exclude-mapping path=“”/&gt;标签排除不需要拦截的资源</td></tr></tbody></table><h2 id="7-3-拦截器快速入门">7.3 拦截器快速入门</h2><blockquote><h3 id="1-创建拦截器类实现HandlerInterceptor接口">1. 创建拦截器类实现HandlerInterceptor接口</h3></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHandlerInterceptor1</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> {</span><br><span class="line">    <span class="comment">//在目标方法之前执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> {</span><br><span class="line">        System.out.println(<span class="string">"preHandle running..."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">}</span><br><span class="line">    <span class="comment">//在目标方法执行之后视图对象返回值执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> {</span><br><span class="line">        System.out.println(<span class="string">"postHandle running..."</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//在流程都执行完毕之后执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> {</span><br><span class="line">    System.out.println(<span class="string">"afterCompletion running..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="2-配置拦截器">2.  配置拦截器</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置拦截器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--对哪些资源执行拦截操作--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.jyw.interceptor.MyHandlerInterceptor1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick23")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">quickMethod23</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ParseException {</span><br><span class="line">    System.out.println(<span class="string">"目标方法执行...."</span>);</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    modelAndView.addObject(<span class="string">"name"</span>,<span class="string">"itcast"</span>);</span><br><span class="line">    modelAndView.setViewName(<span class="string">"index"</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="3-测试拦截效果">3. 测试拦截效果</h3></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick23")</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">quickMethod23</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"目标方法执行...."</span>);</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        modelAndView.addObject(<span class="string">"name"</span>,<span class="string">"Ciallo"</span>);</span><br><span class="line">        modelAndView.setViewName(<span class="string">"index"</span>);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p>结果</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">preHandle running...</span><br><span class="line">目标方法执行....</span><br><span class="line">postHandle running...</span><br><span class="line">afterCompletion running...</span><br></pre></td></tr></tbody></table></figure><h2 id="7-4-多拦截器操作">7.4 多拦截器操作</h2><p>同上，在编写一个MyHandlerInterceptor2操作，测试执行顺序</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">preHandle running...</span><br><span class="line">preHandle running222...</span><br><span class="line">目标方法执行....</span><br><span class="line">postHandle running222...</span><br><span class="line">postHandle running...</span><br><span class="line">afterCompletion running222...</span><br><span class="line">afterCompletion running...</span><br></pre></td></tr></tbody></table></figure><h2 id="7-5-拦截器方法说明">7.5 拦截器方法说明</h2><table><thead><tr><th style="text-align:center">方法名</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">preHandle()</td><td style="text-align:center">方法将在请求处理之前进行调用，该方法的返回值是布尔值Boolean类型的<br> 当它返回为false 时，表示请求结束，后续的Interceptor 和Controller 都不会再执行<br>当返回值为true 时就会继续调用下一个Interceptor 的preHandle 方 法</td></tr><tr><td style="text-align:center">postHandle()</td><td style="text-align:center">该方法是在当前请求进行处理之后被调用，前提是preHandle 方法的返回值为 true 时才能被调用<br>且它会在DispatcherServlet 进行视图返回渲染之前被调用<br>所以我们可以在这个方法中对Controller 处理之后的ModelAndView 对象 进行操作</td></tr><tr><td style="text-align:center">afterCompletion()</td><td style="text-align:center">该方法将在整个请求结束之后，也就是在DispatcherServlet 渲染了对应的视图之后执行<br>前提是preHandle 方法的返回值为true 时才能被调用</td></tr></tbody></table><h1>8. SpringMVC异常处理机制</h1><h2 id="8-1-异常处理的思路">8.1 异常处理的思路</h2><p>系统中异常包括两类：<code>预期异常</code>和<code>运行时异常RuntimeException</code>，前者通过捕获异常从而获取异常信息，后者主要通过规范代码开发、测试等手段减少运行时异常的发生</p><p>系统的<code>Dao</code>、<code>Service</code>、<code>Controller</code>出现都通过throws Exception向上抛出，最后由SpringMVC前端控制器交 由异常处理器进行异常处理，如下图</p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/SpirngMVC%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.png" alt="SpirngMVC异常处理"></p><h2 id="8-2-异常处理两种方式">8.2 异常处理两种方式</h2><ul><li>使用Spring MVC提供的简单异常处理器SimpleMappingExceptionResolver</li><li>实现Spring的异常处理接口HandlerExceptionResolver 自定义自己的异常处理器</li></ul><h2 id="8-3-简单异常处理器SimpleMappingExceptionResolver">8.3 简单异常处理器SimpleMappingExceptionResolver</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置简单映射异常处理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">“org.springframework.web.servlet.handler.SimpleMappingExceptionResolver”</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--默认错误视图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">“defaultErrorView”</span> <span class="attr">value</span>=<span class="string">“error”/</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">“exceptionMappings”</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!--异常类型 错误视图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"cn.jyw.exception.MyException"</span> <span class="attr">value</span>=<span class="string">"error"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"java.lang.ClassCastException"</span> <span class="attr">value</span>=<span class="string">"error"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="8-4-自定义异常处理步骤">8.4 自定义异常处理步骤</h2><blockquote><h3 id="1-创建异常处理器类实现HandlerExceptionResolver">1. 创建异常处理器类实现HandlerExceptionResolver</h3></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyExceptionResolver</span> <span class="keyword">implements</span> <span class="title class_">HandlerExceptionResolver</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">resolveException</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> {</span><br><span class="line">        <span class="comment">//处理异常的代码实现</span></span><br><span class="line">        <span class="comment">//创建ModelAndView对象</span></span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        modelAndView.setViewName(<span class="string">"exceptionPage"</span>);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="2-配置异常处理器">2.  配置异常处理器</h3></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"exceptionResolver"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.exception.MyExceptionResolver"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="3-编写异常页面">3. 编写异常页面</h3></blockquote><figure class="highlight jsp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">这是一个最终异常的显示页面</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></tbody></table></figure><blockquote><h3 id="4-测试异常跳转">4. 测试异常跳转</h3></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping("/quick22")</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quickMethod22</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ParseException {</span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">"yyyy-MM-dd"</span>);</span><br><span class="line">    simpleDateFormat.parse(<span class="string">"abcde"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis(三) MyBatis的多表查询和注解操作</title>
      <link href="/javaee/mybatis/mybatis-san-mybatis-de-duo-biao-cha-xun-he-zhu-jie-cao-zuo/"/>
      <url>/javaee/mybatis/mybatis-san-mybatis-de-duo-biao-cha-xun-he-zhu-jie-cao-zuo/</url>
      
        <content type="html"><![CDATA[<h1>1. Mybatis多表查询</h1><h2 id="1-1-一对一查询">1.1 一对一查询</h2><blockquote><ol><li>一对一查询的模型</li></ol></blockquote><p>用户表和订单表的关系为，一个用户有多个订单，一个订单只从属于一个用户</p><p>一对一查询的需求：查询一个订单，与此同时查询出该订单所属的用户</p><table><thead><tr><th style="text-align:center">orders</th><th style="text-align:center">user</th></tr></thead><tbody><tr><td style="text-align:center">id:int</td><td style="text-align:center">id:int</td></tr><tr><td style="text-align:center">ordertime:varchar(255)</td><td style="text-align:center">username:varchar(50)</td></tr><tr><td style="text-align:center">total:double</td><td style="text-align:center">password:varchar(50)</td></tr><tr><td style="text-align:center">uid:int</td><td style="text-align:center">birthday:varchar(50)</td></tr></tbody></table><blockquote><ol start="2"><li>一对一查询的语句</li></ol></blockquote><p>对应的sql语句：select * from orders o,user u where <a href="http://o.uid=u.id">o.uid=u.id</a></p><blockquote><ol start="3"><li>创建Order和User实体</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> Date ordertime;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> total;</span><br><span class="line">    <span class="comment">//代表当前订单从属于哪一个客户</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="4"><li>创建OrderMapper接口</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> {</span><br><span class="line">List&lt;Order&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="5"><li>配置OrderMapper.xml</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.jyw.mapper.OrderMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"orderMap"</span> <span class="attr">type</span>=<span class="string">"cn.jyw.pojo.Order"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">property</span>=<span class="string">"user.id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"user.username"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"user.password"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"user.birthday"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"orderMap"</span>&gt;</span></span><br><span class="line">        select * from orders o,user u where o.uid=u.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>其中<code>&lt;resultMap&gt;</code>还可以配置如下</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"orderMap"</span> <span class="attr">type</span>=<span class="string">"cn.jyw.pojo.Order"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"ordertime"</span> <span class="attr">column</span>=<span class="string">"ordertime"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"total"</span> <span class="attr">column</span>=<span class="string">"total"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="6"><li>测试结果</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">OrderMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(OrderMapper.class);</span><br><span class="line">List&lt;Order&gt; all = mapper.findAll();</span><br><span class="line"><span class="keyword">for</span>(Order order : all){</span><br><span class="line">System.out.println(order);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-2-一对多查询">1.2  一对多查询</h2><blockquote><ol><li>一对多查询的模型</li></ol></blockquote><p>用户表和订单表的关系为，一个用户有多个订单，一个订单只从属于一个用户</p><p>一对多查询的需求：查询一个用户，与此同时查询出该用户具有的订单</p><blockquote><ol start="2"><li>一对多查询的语句</li></ol></blockquote><p>对应的sql语句：select * from user u left join orders o on u.id=o.uid;</p><blockquote><ol start="3"><li>修改User实体</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> Date ordertime;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> total;</span><br><span class="line">    <span class="comment">//代表当前订单从属于哪一个客户</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="comment">//代表当前用户具备哪些订单</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orderList;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="4"><li>创建UserMapper接口</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> {</span><br><span class="line">List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="5"><li>配置UserMapper.xml</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.jyw.pojo.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"orderList"</span> <span class="attr">ofType</span>=<span class="string">"cn.jyw.pojo.Order"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"ordertime"</span> <span class="attr">property</span>=<span class="string">"ordertime"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"total"</span> <span class="attr">property</span>=<span class="string">"total"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">    select * from user u left join orders o on u.id=o.uid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="6"><li>测试结果</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">List&lt;User&gt; all = mapper.findAll();</span><br><span class="line"><span class="keyword">for</span>(User user : all){</span><br><span class="line">    System.out.println(user.getUsername());</span><br><span class="line">    List&lt;Order&gt; orderList = user.getOrderList();</span><br><span class="line">    <span class="keyword">for</span>(Order order : orderList){</span><br><span class="line">    System.out.println(order);</span><br><span class="line">    }</span><br><span class="line">    System.out.println(<span class="string">"----------------------------------"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-3-多对多查询">1.3 多对多查询</h2><blockquote><ol><li>多对多查询的模型</li></ol></blockquote><p>用户表和角色表的关系为，一个用户有多个角色</p><p>一个角色被多个用户使用</p><p>多对多查询的需求：查询用户同时查询出该用户的所有角色</p><table><thead><tr><th style="text-align:center">user</th><th style="text-align:center">user_role</th><th style="text-align:center">role</th></tr></thead><tbody><tr><td style="text-align:center">id:int</td><td style="text-align:center">user_id:int</td><td style="text-align:center">id:int</td></tr><tr><td style="text-align:center">username:varchar(50)</td><td style="text-align:center">role_id:int</td><td style="text-align:center">rolename:varchar(255)</td></tr><tr><td style="text-align:center">password:varchar(50)</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">birthday:varchar(50)</td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table><blockquote><ol start="2"><li>多对多查询的语句</li></ol></blockquote><p>对应的sql语句：select u.* ,r.* ,<a href="http://r.id">r.id</a> rid from user u left join user_role ur on u.id=ur.user_id inner join role r on ur.role_id=<a href="http://r.id">r.id</a></p><blockquote><ol start="3"><li>创建Role实体，修改User实体</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="comment">//代表当前用户具备哪些订单</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Order&gt; orderList;</span><br><span class="line">    <span class="comment">//代表当前用户具备哪些角色</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roleList;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String rolename;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="4"><li>添加UserMapper接口方法</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; <span class="title function_">findAllUserAndRole</span><span class="params">()</span>;</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="5"><li>配置UserMapper.xml</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">type</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roleList"</span> <span class="attr">ofType</span>=<span class="string">"cn.jyw.pojo.Role"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"rid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"rolename"</span> <span class="attr">property</span>=<span class="string">"rolename"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllUserAndRole"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">    select u.*,r.*,r.id rid from user u left join user_role ur on </span><br><span class="line">u.id=ur.user_id</span><br><span class="line">    inner join role r on ur.role_id=r.id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="6"><li>测试结果</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">List&lt;User&gt; all = mapper.findAllUserAndRole();</span><br><span class="line"><span class="keyword">for</span>(User user : all){</span><br><span class="line">    System.out.println(user.getUsername());</span><br><span class="line">    List&lt;Role&gt; roleList = user.getRoleList();</span><br><span class="line">    <span class="keyword">for</span>(Role role : roleList){</span><br><span class="line">    System.out.println(role);</span><br><span class="line">    }</span><br><span class="line">    System.out.println(<span class="string">"----------------------------------"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-4-MyBatis多表配置方式小结">1.4 MyBatis多表配置方式小结</h2><ul><li>一对一配置：使用<code>&lt;resultMap&gt;</code>做配置</li><li>一对多配置：使用<code>&lt;resultMap&gt;+&lt;collection&gt;</code>做配置</li><li>多对多配置：使用<code>&lt;resultMap&gt;+&lt;collection&gt;</code>做配置</li></ul><h1>2. MyBatis注解开发</h1><h2 id="2-1-MyBatis的常用注解">2.1 MyBatis的常用注解</h2><ul><li>@Insert：实现新增</li><li>@Update：实现更新</li><li>@Delete：实现删除</li><li>@Select：实现查询</li><li>@Result：实现结果集封装</li><li>@Results：可以与@Result 一起使用，封装多个结果集</li><li>@One：实现一对一结果集封装</li><li>@Many：实现一对多结果集封装</li></ul><h2 id="2-2-MyBatis的增删改查">2.2 MyBatis的增删改查</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert("insert into user values(#{id},#{username},#{password},#{birthday})")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Update("update user set username=#{username},password=#{password} where id=#{id}")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Delete("delete from user where id=#{id}")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select("select * from user where id=#{id}")</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select("select * from user")</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>修改MyBatis的核心配置文件，我们使用了注解替代的映射文件，所以我们只需要加载使用了注解的Mapper接口即可</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--扫描使用注解的类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"cn.jyw.mapper.UserMapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>或者指定扫描包含映射关系的接口所在的包也可以</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--加载映射关系--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定接口所在的包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.jyw.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-3-MyBatis的注解实现复杂映射开发">2.3 MyBatis的注解实现复杂映射开发</h2><p>实现复杂关系映射之前我们可以在映射文件中通过配置来实现</p><p>使用注解开发后，我们可以使用@Results注解 ，@Result注解，@One注解，@Many注解组合完成复杂关系的配置</p><table><thead><tr><th style="text-align:center">注解</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">@Results</td><td style="text-align:center">代替的是<code>&lt;resultMap&gt;</code>标签该注解中可以使用单个@Result注解，也可以使用@Result集合<br>使用格式：@Results（{@Result（），@Result（）}）或@Results（@Result（））</td></tr><tr><td style="text-align:center">@Resut</td><td style="text-align:center">代替了<code>&lt;id&gt;</code>标签和<code>&lt;result&gt;</code>标签 @Result中属性介绍：<br> column：数据库的列名<br>property：需要装配的属性名<br>one：需要使用的@One 注解（@Result（one=@One）（）））<br>many：需要使用的@Many 注解（@Result（many=@many）（）））</td></tr><tr><td style="text-align:center">@One （一对一）</td><td style="text-align:center">代替了<code>&lt;assocation&gt;</code>标签，是多表查询的关键，在注解中用来指定子查询返回单一对象<br>@One注解属性介绍：<br>select: 指定用来多表查询的 sqlmapper<br>使用格式：@Result(column=" “,property=”“,one=@One(select=”"))</td></tr><tr><td style="text-align:center">@Many （多对一）</td><td style="text-align:center">代替了<code>&lt;collection&gt;</code>标签, 是是多表查询的关键，在注解中用来指定子查询返回对象集合<br>使用格式：@Result(property=“”,column=“”,many=@Many(select=“”))</td></tr></tbody></table><h2 id="2-4-一对一查询">2.4 一对一查询</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select("select *,o.id oid from orders o,user u where o.uid=u.id")</span></span><br><span class="line">    <span class="meta">@Results({</span></span><br><span class="line"><span class="meta">            @Result(column = "oid",property = "id"),</span></span><br><span class="line"><span class="meta">            @Result(column = "ordertime",property = "ordertime"),</span></span><br><span class="line"><span class="meta">            @Result(column = "total",property = "total"),</span></span><br><span class="line"><span class="meta">            @Result(column = "uid",property = "user.id"),</span></span><br><span class="line"><span class="meta">            @Result(column = "username",property = "user.username"),</span></span><br><span class="line"><span class="meta">            @Result(column = "password",property = "user.password")</span></span><br><span class="line"><span class="meta">    })</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br></pre></td></tr></tbody></table></figure><p>或者</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select("select * from orders")</span></span><br><span class="line">   <span class="meta">@Results({</span></span><br><span class="line"><span class="meta">           @Result(column = "id",property = "id"),</span></span><br><span class="line"><span class="meta">           @Result(column = "ordertime",property = "ordertime"),</span></span><br><span class="line"><span class="meta">           @Result(column = "total",property = "total"),</span></span><br><span class="line"><span class="meta">           @Result(</span></span><br><span class="line"><span class="meta">                   property = "user", //要封装的属性名称</span></span><br><span class="line"><span class="meta">                   column = "uid", //根据那个字段去查询user表的数据</span></span><br><span class="line"><span class="meta">                   javaType = User.class, /a/要封装的实体类型</span></span><br><span class="line"><span class="meta">                   //select属性 代表查询那个接口的方法获得数据</span></span><br><span class="line"><span class="meta">                   one = @One(select = "cn.jyw.mapper.UserMapper.findById")</span></span><br><span class="line"><span class="meta">           )</span></span><br><span class="line"><span class="meta">   })</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br></pre></td></tr></tbody></table></figure><h2 id="2-5-一对多查询">2.5 一对多查询</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select("select * from user")</span></span><br><span class="line"><span class="meta">@Results({</span></span><br><span class="line"><span class="meta">        @Result(id=true ,column = "id",property = "id"),</span></span><br><span class="line"><span class="meta">        @Result(column = "username",property = "username"),</span></span><br><span class="line"><span class="meta">        @Result(column = "password",property = "password"),</span></span><br><span class="line"><span class="meta">        @Result(</span></span><br><span class="line"><span class="meta">                property = "orderList",</span></span><br><span class="line"><span class="meta">                column = "id",</span></span><br><span class="line"><span class="meta">                javaType = List.class,</span></span><br><span class="line"><span class="meta">                many = @Many(select = "cn.jyw.mapper.OrderMapper.findByUid")</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">})</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserAndOrderAll</span><span class="params">()</span>;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> {</span><br><span class="line">    <span class="meta">@Select("select * from orders where uid=#{uid}")</span></span><br><span class="line">    List&lt;Order&gt; <span class="title function_">findByUid</span><span class="params">(<span class="type">int</span> uid)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="2-6-多对多查询">2.6 多对多查询</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select("SELECT * FROM USER")</span></span><br><span class="line">   <span class="meta">@Results({</span></span><br><span class="line"><span class="meta">           @Result(id = true,column = "id",property = "id"),</span></span><br><span class="line"><span class="meta">           @Result(column = "username",property = "username"),</span></span><br><span class="line"><span class="meta">           @Result(column = "password",property = "password"),</span></span><br><span class="line"><span class="meta">           @Result(</span></span><br><span class="line"><span class="meta">                   property = "roleList",</span></span><br><span class="line"><span class="meta">                   column = "id",</span></span><br><span class="line"><span class="meta">                   javaType = List.class,</span></span><br><span class="line"><span class="meta">                   many = @Many(select = "cn.jyw.mapper.RoleMapper.findByUid")</span></span><br><span class="line"><span class="meta">           )</span></span><br><span class="line"><span class="meta">   })</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserAndRoleAll</span><span class="params">()</span>;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleMapper</span> {</span><br><span class="line">    <span class="meta">@Select("select * from role r,user_role ur where r.id=ur.role_id and ur.user_id=#{uid}")</span></span><br><span class="line">    List&lt;Role&gt; <span class="title function_">findByUid</span><span class="params">(<span class="type">int</span> uid)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> MyBatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis(二) Dao层实现以及映射文件和配置文件</title>
      <link href="/javaee/mybatis/mybatis-er-dao-ceng-shi-xian-yi-ji-ying-she-wen-jian-he-pei-zhi-wen-jian/"/>
      <url>/javaee/mybatis/mybatis-er-dao-ceng-shi-xian-yi-ji-ying-she-wen-jian-he-pei-zhi-wen-jian/</url>
      
        <content type="html"><![CDATA[<h1>1. MyBatis的Dao层实现</h1><h2 id="1-1-传统开发方式">1.1 传统开发方式</h2><blockquote><ol><li>编写UserDao接口</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> {</span><br><span class="line">List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>编写UserDaoImpl实现</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">resourceAsStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        List&lt;User&gt; userList = sqlSession.selectList(<span class="string">"userMapper.findAll"</span>);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="3"><li>. 测试传统方式</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTraditionDao</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    List&lt;User&gt; all = userDao.findAll();</span><br><span class="line">    System.out.println(all);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="1-2-代理开发方式">1.2 代理开发方式</h2><blockquote><ol><li>代理开发方式介绍</li></ol></blockquote><p>采用 Mybatis 的代理开发方式实现 DAO 层的开发，这种方式是我们后面进入企业的主流</p><p>Mapper 接口开发方法只需要程序员编写Mapper 接口（相当于Dao 接口），由Mybatis 框架根据接口定义创建接 口的动态代理对象，代理对象的方法体同上边Dao接口实现类方法</p><p>Mapper 接口开发需要遵循以下规范：</p><blockquote><ol><li>Mapper.xml文件中的namespace与mapper接口的全限定名相同</li><li>Mapper接口方法名和Mapper.xml中定义的每个statement的id相同</li><li>Mapper接口方法的输入参数类型和mapper.xml中定义的每个sql的parameterType的类型相同</li><li>Mapper接口方法的输出参数类型和mapper.xml中定义的每个sql的resultType的类型相同</li></ol></blockquote><blockquote><ol start="2"><li>编写UserMapper接口</li></ol></blockquote><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Mybaatis%E4%BB%A3%E7%90%86Dao%E5%B1%82%E4%B9%A6%E5%86%99%E8%A7%84%E8%8C%83.png" alt="Mybaatis代理Dao层书写规范"></p><p>UserDao 指的是 namespace 的位置</p><blockquote><ol start="3"><li>测试代理方式</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProxyDao</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">resourceAsStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="comment">//获得MyBatis框架生成的UserMapper接口的实现类</span></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.findById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    sqlSession.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1>2. MyBatis映射文件深入</h1><h2 id="2-1-动态sql语句">2.1 动态sql语句</h2><blockquote><p>动态sql语句概述</p></blockquote><p>Mybatis 的映射文件中，前面我们的 SQL 都是比较简单的</p><p>有些时候业务逻辑复杂时，我们的 SQL是动态变化的， 此时在前面的学习中我们的 SQL 就不能满足要求了</p><blockquote><ol start="2"><li>动态 SQL 的使用</li></ol></blockquote><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">if</button></li><li class="tab"><button type="button" data-href="#1-2">foreach</button></li><li class="tab"><button type="button" data-href="#1-3"><if></if></button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>我们根据实体类的不同取值，使用不同的 SQL语句来进行查</p><p>比如在 id如果不为空时可以根据id查询，如果username 不同空时还要加入用户名作为条件</p><p>这种情况在我们的多条件组合查询中经常会碰到</p><p>当查询条件只有id存在时，控制台打印的sql语句如下：</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    select * from User</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"id!=0"</span>&gt;</span></span><br><span class="line">        and id=#{id}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username!=null"</span>&gt;</span></span><br><span class="line">        and username=#{username}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>当查询条件id和username都存在时，控制台打印的sql语句如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得MyBatis框架生成的UserMapper接口的实现类</span></span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">un</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">condition.setId(<span class="number">1</span>);</span><br><span class="line">condition.setUsername(<span class="string">"lucy"</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.findByCondition(condition);</span><br></pre></td></tr></tbody></table></figure><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from User WHERE id = ? and username = ?</span><br></pre></td></tr></tbody></table></figure><p>当查询条件只有id存在时，控制台打印的sql语句如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得MyBatis框架生成的UserMapper接口的实现类</span></span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"><span class="type">User</span> <span class="variable">condition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">condition.setId(<span class="number">1</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.findByCondition(condition);</span><br></pre></td></tr></tbody></table></figure><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from User WHERE id = ? </span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>循环执行sql的拼接操作，例如：SELECT * FROM USER WHERE id IN (1,2,5)。</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByIds"</span> <span class="attr">parameterType</span>=<span class="string">"list"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    select * from User</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"array"</span> <span class="attr">open</span>=<span class="string">"id in("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        #{id}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>测试代码片段如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得MyBatis框架生成的UserMapper接口的实现类</span></span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"><span class="type">int</span>[] ids = <span class="keyword">new</span> <span class="title class_">int</span>[]{<span class="number">2</span>,<span class="number">5</span>};</span><br><span class="line">List&lt;User&gt; userList = userMapper.findByIds(ids);</span><br><span class="line">System.out.println(userList);</span><br></pre></td></tr></tbody></table></figure><figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * form User WHERE id in(?,?)</span><br></pre></td></tr></tbody></table></figure><p>foreach标签的属性含义如下：</p><p>&lt; foreach&gt;标签用于遍历集合，它的属性：</p><ul><li>collection：代表要遍历的集合元素，注意编写时不要写#{}</li><li>open：代表语句的开始部分</li><li>close：代表结束部分</li><li>item：代表遍历集合的每个元素，生成的变量名</li><li>sperator：代表分隔符</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-2-SQL片段抽取">2.2 SQL片段抽取</h2><blockquote><p>Sql 中可将重复的 sql 提取出来，使用时用 include 引用即可，最终达到 sql 重用的目的</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--抽取sql片段简化编写--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"selectUser"</span>&gt;</span>select * from User<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"selectUser"</span>/&gt;</span> where id=#{id}</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByIds"</span> <span class="attr">parameterType</span>=<span class="string">"list"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"selectUser"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"array"</span> <span class="attr">open</span>=<span class="string">"id in("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">            #{id}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-3-MyBatis映射文件配置-小结">2.3 MyBatis映射文件配置(小结)</h2><table><thead><tr><th style="text-align:center">标签</th><th style="text-align:center">解释</th></tr></thead><tbody><tr><td style="text-align:center"><code>&lt;select&gt;</code></td><td style="text-align:center">查询</td></tr><tr><td style="text-align:center"><code>&lt;insert&gt;</code></td><td style="text-align:center">插入</td></tr><tr><td style="text-align:center"><code>&lt;update&gt;</code></td><td style="text-align:center">修改</td></tr><tr><td style="text-align:center"><code>&lt;delete&gt;</code></td><td style="text-align:center">删除</td></tr><tr><td style="text-align:center"><code>&lt;where&gt;</code></td><td style="text-align:center">where条件</td></tr><tr><td style="text-align:center"><code>&lt;if&gt;</code></td><td style="text-align:center">if判断</td></tr><tr><td style="text-align:center"><code>&lt;foreach&gt;</code></td><td style="text-align:center">循环</td></tr><tr><td style="text-align:center"><code>&lt;sql&gt;</code></td><td style="text-align:center">sql片段抽取</td></tr><tr><td style="text-align:center"><code>&lt;include&gt;</code></td><td style="text-align:center">插入</td></tr></tbody></table><h1>3. MyBatis核心配置文件深入</h1><h2 id="3-1-typeHandlers标签">3.1 typeHandlers标签</h2><table><thead><tr><th style="text-align:center">数据类型</th><th style="text-align:center">Java类型</th><th style="text-align:center">JDBC类型</th></tr></thead><tbody><tr><td style="text-align:center"><code>BoolenaTypeHandler</code></td><td style="text-align:center"><code>java.lang.Boolean</code>,<code>boolean</code></td><td style="text-align:center">数据库兼容的<code>BOOLEAN</code></td></tr><tr><td style="text-align:center"><code>ByteTypeHander</code></td><td style="text-align:center"><code>java.lang.Byte</code>,<code>yte</code></td><td style="text-align:center">数据库兼容的<code>NUMERIC</code>或<code>BYTE</code></td></tr><tr><td style="text-align:center"><code>ShortTypeHander</code></td><td style="text-align:center"><code>java.lang.Short</code>,<code>short</code></td><td style="text-align:center">数据库兼容的<code>NUMERIC</code>或<code>SHORT INTEGER</code></td></tr><tr><td style="text-align:center"><code>IntegerTypeHander</code></td><td style="text-align:center"><code>java.lang.Integer</code>,<code>int</code></td><td style="text-align:center">数据库兼容的<code>NUMERIC</code>或<code>INTEGER</code></td></tr><tr><td style="text-align:center"><code>LongTypeHander</code></td><td style="text-align:center"><code>java.lang.Long</code>,<code>long</code></td><td style="text-align:center">数据库兼容的<code>NUMERIC</code>或<code>LONG INTEGER</code></td></tr></tbody></table><blockquote><p>你可以重写类型处理器或创建你自己的类型处理器来处理不支持的或非标准的类型</p><p>具体做法为：实现 org.apache.ibatis.type.TypeHandler 接口， 或继承一个很便利的类 org.apache.ibatis.type.BaseTypeHandler， 然后可以选择性地将它映射到一个JDBC类型</p><p>例如需求：一个Java中的Date数据类型，我想将之存到数据库的时候存成一 个1970年至今的毫秒数，取出来时转换成java的Date<br>即java的Date与数据库的varchar毫秒值之间转换</p></blockquote><p>开发步骤：</p><blockquote><ol><li>定义转换类继承类BaseTypeHandler</li><li>覆盖4个未实现的方法，其中setNonNullParameter为java程序设置数据到数据库的回调方法，getNullableResult 为查询时 mysql的字符串类型转换成 java的Type类型的方法</li><li>在MyBatis核心配置文件中进行注册</li><li>测试转换是否正确</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyDateTypeHandler</span> <span class="keyword">extends</span> <span class="title class_">BaseTypeHandler</span>&lt;Date&gt; {</span><br><span class="line">    <span class="comment">//将Date转换成long 给 数据库</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNonNullParameter</span><span class="params">(PreparedStatement preparedStatement, <span class="type">int</span> i, Date date, JdbcType type)</span> </span><br><span class="line">    {</span><br><span class="line">    preparedStatement.setString(i,date.getTime()+<span class="string">""</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//根据结果集字段名称 把 long转换成Date给java</span></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getNullableResult</span><span class="params">(ResultSet resultSet, String s)</span> <span class="keyword">throws</span> SQLException {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(resultSet.getLong(s));</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//根据结果集字段位置 把 long转换成Date给java</span></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getNullableResult</span><span class="params">(ResultSet resultSet, <span class="type">int</span> i)</span> <span class="keyword">throws</span> SQLException {</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Date</span>(resultSet.getLong(i));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">getNullableResult</span><span class="params">(CallableStatement callableStatement, <span class="type">int</span> i)</span> <span class="keyword">throws</span> SQLException {</span><br><span class="line">    <span class="keyword">return</span> callableStatement.getDate(i);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注册类型自定义转换器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"cn.jyw.typeHandlers.MyDateTypeHandler"</span>&gt;</span><span class="tag">&lt;/<span class="name">typeHandler</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="3-2-plugins标签">3.2 plugins标签</h2><blockquote><p>MyBatis可以使用第三方的插件来对功能进行扩展，分页助手PageHelper是将分页的复杂操作进行封装，使用简单的方式即 可获得分页的相关数据</p></blockquote><p>开发步骤：</p><ol><li>导入通用PageHelper的坐标</li><li>在mybatis核心配置文件中配置PageHelper插件</li><li>测试分页数据获取</li></ol><blockquote><ol><li>导入通用PageHelper坐标</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页助手 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.jsqlparser<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsqlparser<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>在mybatis核心配置文件中配置PageHelper插件</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注意：分页助手的插件 配置在通用馆mapper之前 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.github.pagehelper.PageHelper"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定方言 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span> <span class="attr">value</span>=<span class="string">"mysql"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="3"><li>测试分页代码实现</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPageHelper</span><span class="params">()</span>{</span><br><span class="line">    <span class="comment">//设置分页参数 当前页+每页显示条数</span></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    List&lt;User&gt; select = userMapper2.select(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">for</span>(User user : select){</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>获得分页相关的其他参数</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其他分页的数据</span></span><br><span class="line">PageInfo&lt;User&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;User&gt;(select);</span><br><span class="line">System.out.println(<span class="string">"总条数："</span>+pageInfo.getTotal());</span><br><span class="line">System.out.println(<span class="string">"总页数："</span>+pageInfo.getPages());</span><br><span class="line">System.out.println(<span class="string">"当前页："</span>+pageInfo.getPageNum());</span><br><span class="line">System.out.println(<span class="string">"每页显示长度："</span>+pageInfo.getPageSize());</span><br><span class="line">System.out.println(<span class="string">"是否第一页："</span>+pageInfo.isIsFirstPage());</span><br><span class="line">System.out.println(<span class="string">"是否最后一页："</span>+pageInfo.isIsLastPage());</span><br></pre></td></tr></tbody></table></figure><h2 id="3-3-MyBatis核心配置文件常用标签：">3.3 MyBatis核心配置文件常用标签：</h2><blockquote><ol><li>properties标签：该标签可以加载外部的properties文件</li><li>typeAliases标签：设置类型别名</li><li>environments标签：数据源环境配置标签</li><li>typeHandlers标签：配置自定义类型处理器</li><li>plugins标签：配置MyBatis的插件</li><li>mapers标签：加载映射文件</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> MyBatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis(一) 入门操作</title>
      <link href="/javaee/mybatis/mybatis-yi-ru-men-cao-zuo/"/>
      <url>/javaee/mybatis/mybatis-yi-ru-men-cao-zuo/</url>
      
        <content type="html"><![CDATA[<h1>1. Mybatis简介</h1><h2 id="1-1-原始jdbc操作">1.1 原始jdbc操作</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">插入数据</button></li><li class="tab"><button type="button" data-href="#1-2">查询数据</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟实体对象</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">user.setId(<span class="number">2</span>);</span><br><span class="line">user.setUsername(<span class="string">"tom"</span>);</span><br><span class="line">user.setPassword(<span class="string">"lucy"</span>); .</span><br><span class="line"><span class="comment">//注册驱动</span></span><br><span class="line">Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"><span class="comment">//获得连接</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">"jdbc:mysql:///test"</span>,<span class="string">"root"</span>,<span class="string">"root"</span> );</span><br><span class="line"><span class="comment">//获得statement</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.prepareStatement(<span class="string">"insert into user(id,username , password) values(?,?,?)"</span>);</span><br><span class="line"><span class="comment">//设置占位符参数</span></span><br><span class="line">statement.setInt(<span class="number">1</span>,user.getId());</span><br><span class="line">statement.setString(<span class="number">2</span>,user.getUsername());</span><br><span class="line">statement.setString(<span class="number">3</span>,user.getPassword());</span><br><span class="line"><span class="comment">//执行更新操作</span></span><br><span class="line">statement.executeUpdate();</span><br><span class="line"><span class="comment">//释放资源</span></span><br><span class="line">statement.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册驱动</span></span><br><span class="line">Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line"><span class="comment">//获得连接</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">"jdbc:mysql:///test"</span>,<span class="string">"root"</span>,<span class="string">"root"</span> );</span><br><span class="line"><span class="string">"root"</span>, password: <span class="string">"root"</span>);</span><br><span class="line"><span class="comment">//获得statement</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.prepareStatement(<span class="string">"select id,username,password from user"</span>); .</span><br><span class="line"><span class="comment">//执行查询</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery();</span><br><span class="line"><span class="comment">//遍历结果集</span></span><br><span class="line"><span class="keyword">while</span>(resultSet.next()){</span><br><span class="line">    <span class="comment">//封装实体</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setId(resultSet.getInt(<span class="string">"id"</span>));</span><br><span class="line">    user.setUsername(resultSet.getString(<span class="string">"username"</span>));</span><br><span class="line">    user.setPassword(resultSet.getString(<span class="string">"password"</span>));</span><br><span class="line">    <span class="comment">//user实体封装完毕</span></span><br><span class="line">    System.out.println(user);</span><br><span class="line"><span class="comment">//释放资源</span></span><br><span class="line">resultSet.close();</span><br><span class="line">statement.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-2-原始jdbc操作的分析">1.2 原始jdbc操作的分析</h2><blockquote><p>原始jdbc开发存在的问题如下：</p></blockquote><ol><li>数据库连接创建、释放频繁造成系统资源浪费从而影响系统性能</li><li>sql 语句在代码中硬编码，造成代码不易维护，实际应用 sql 变化的可能较大，sql 变动需要改变java代码</li><li>查询操作时，需要手动将结果集中的数据手动封装到实体中，插入操作时，需要手动将实体的数据设置到sql语句的占位符位置</li></ol><blockquote><p>应对上述问题给出的解决方案：</p></blockquote><ol><li>使用数据库连接池初始化连接资源</li><li>将sql语句抽取到xml配置文件中</li><li>使用反射、内省等底层技术，自动将实体与表进行属性与字段的自动映射</li></ol><h2 id="1-3-什么是Mybatis">1.3 什么是Mybatis</h2><ul><li><blockquote><p>mybatis 是一个优秀的<code>基于java的持久层框架</code>，它内部封装了 jdbc，使开发者只需要关注sql语句本身，而不需要花费精力去处理加载驱动、创建连接、创建statement等繁杂的过程</p></blockquote></li><li><blockquote><p>mybatis通过<strong>xml或注解</strong>的方式将要执行的各种 statement配置起来，并通过java对象和statement中sql的<strong>动态参数</strong>进行 映射生成最终执行的sql语句</p></blockquote></li><li><blockquote><p>最后mybatis框架执行sql并将结果映射为java对象并返回</p><p>采用ORM思想解决了实体和数据库映射的问题，对jdbc 进行了 封装，屏蔽了jdbc api 底层访问细节，使我们不用与<strong>jdbc api</strong>打交道，就可以完成对数据库的持久化操作</p></blockquote></li></ul><h2 id="1-4-Mybatis架构">1.4 Mybatis架构</h2><p>Mybatis的功能架构分为三层：</p><ol><li><blockquote><p>API接口层：提供给外部使用的接口API，开发人员通过这些本地API来操纵数据库</p><p>接口层一接收到调用请求就会调用数据处理层来完成具体的数据处理</p></blockquote></li><li><blockquote><p>数据处理层：负责具体的SQL查找、SQL解析、SQL执行和执行结果映射处理等</p><p>它主要的目的是根据调用的请求完成一次数据库操作</p></blockquote></li><li><blockquote><p>基础支撑层：负责最基础的功能支撑，包括连接管理、事务管理、配置加载和缓存处理，这些都是共用的东西，将他们抽取出来作为最基础的组件</p><p>为上层的数据处理层提供最基础的支撑。</p></blockquote></li></ol><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Mybatis%E6%9E%B6%E6%9E%84.png" alt="Mybatis架构图"></p><h2 id="1-5-Mybatis原理步骤">1.5 Mybatis原理步骤</h2><ol><li><p>mybatis配置文件，包括<code>Mybatis全局配置文件和Mybatis映射文件</code></p><p>其中全局配置文件配置了数据源、事务等信息；映射文件配置了SQL执行相关的信息</p></li><li><p>mybatis通过读取配置文件信息（全局配置文件和映射文件），构造出<code>SqlSessionFactory</code>，即会话工厂</p></li><li><p>通过SqlSessionFactory，可以创建<code>SqlSession</code>即会话</p><p><strong>Mybatis是通过SqlSession来操作数据库的</strong></p></li><li><p>SqlSession本身不能直接操作数据库，它是通过底层的<code>Executor</code>执行器接口来操作数据库的</p><p><code>Executor</code>接口有两个实现类，一个是普通执行器，一个是<code>缓存执行器（默认）</code>。</p></li><li><p>Executor执行器要处理的SQL信息是封装到一个底层对象<code>MappedStatement</code>中</p><p>该对象包括：SQL语句、输入参数映射信息、输出结果集映射信息</p><p>其中输入参数和输出结果的映射类型包括<code>HashMap</code>集合对象、<code>POJO对象类型</code>。</p></li></ol><h1>2. Mybatis的快速入门</h1><h2 id="2-1-MyBatis开发步骤">2.1 MyBatis开发步骤</h2><ol><li>添加MyBatis的坐标</li><li>创建user数据表</li><li>编写User实体类</li><li>编写映射文件UserMapper.xml</li><li>编写核心文件SqlMapConfig.xml</li><li>编写测试类</li></ol><h2 id="2-2-MyBatis-快速实现">2.2 MyBatis 快速实现</h2><blockquote><ol><li>导入MyBatis的坐标和其他相关坐标</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis坐标--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--mysql坐标--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--单元测试坐标--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--日志坐标--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>创建user数据表</li></ol></blockquote><table><thead><tr><th>名</th><th>类型</th></tr></thead><tbody><tr><td>id</td><td>int</td></tr><tr><td>username</td><td>varchar</td></tr><tr><td>password</td><td>varchar</td></tr></tbody></table><blockquote><ol start="3"><li>编写User实体类</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">//省略get个set方法</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="4"><li>编写映射文件UserMapper.xml</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">    <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"userMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">    select * from User</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="5"><li>编写核心文件SqlMapConfig.xml</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据源环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--池子--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///test"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--加载映射文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"cn.jyw/mapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="6"><li>编写测试类</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> IOException {</span><br><span class="line">      <span class="comment">//获得核心配置文件</span></span><br><span class="line">      <span class="type">InputStream</span> <span class="variable">resourceAsStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">"sqlMapConfig.xml"</span>);</span><br><span class="line">      <span class="comment">//获得session工厂对象</span></span><br><span class="line">      <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line">      <span class="comment">//获得session会话对象</span></span><br><span class="line">      <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">      <span class="comment">//执行操作   参数：namespace+id</span></span><br><span class="line">      List&lt;User&gt; userList = sqlSession.selectList(<span class="string">"userMapper.findAll"</span>);</span><br><span class="line">      <span class="comment">//打印数据</span></span><br><span class="line">      System.out.println(userList);</span><br><span class="line">      <span class="comment">//释放资源</span></span><br><span class="line">      sqlSession.close();</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure><h1>3. MyBatis的映射文件概述</h1><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--映射文件DTD约束头--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">    <span class="keyword">PUBLIC</span> <span class="string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--跟标签 命名空间,与下面语句的id一起组成查询的标识--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"userMapper"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--select 查询操作,可选的还有insert,update,delete</span></span><br><span class="line"><span class="comment">    id 语句id标识 与上面的命名空间一起组成查询标识</span></span><br><span class="line"><span class="comment">    resultType  查询结果对应的实体类型--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">        # 要执行的sql语句</span><br><span class="line">    select * from User</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h1>4. MyBatis的增删改查操作</h1><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">插入数据</button></li><li class="tab"><button type="button" data-href="#1-2">删除数据</button></li><li class="tab"><button type="button" data-href="#1-3">修改数据</button></li><li class="tab"><button type="button" data-href="#1-4">查找数据</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><blockquote><ol><li>写UserMapper映射文件</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"userMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span> <span class="attr">parameterType</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">    insert into user values(#{id},#{username},#{password})</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>编写插入实体User的代码</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">resourceAsStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="type">int</span> <span class="variable">insert</span> <span class="operator">=</span> sqlSession.insert(<span class="string">"userMapper.add"</span>, user);</span><br><span class="line">System.out.println(insert);</span><br><span class="line"><span class="comment">//提交事务</span></span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>插入操作注意问题</strong></p><ol><li>插入语句使用insert标签</li><li>在映射文件中使用parameterType属性指定要插入的数据类型</li><li>Sql语句中使用#{实体属性名}方式引用实体中的属性值</li><li>插入操作使用的API是sqlSession.insert(“<a href="http://xn--eqrzj591h57w.id">命名空间.id</a>”,实体对象);</li><li>插入操作涉及数据库数据变化，所以要使用sqlSession对象显示的提交事务， 即sqlSession.commit()</li></ol></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><blockquote><ol><li>编写UserMapper映射文件</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"userMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></span><br><span class="line">    delete from user where id=#{id}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>编写删除数据的代码</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">resourceAsStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="type">int</span> <span class="variable">delete</span> <span class="operator">=</span> sqlSession.delete(<span class="string">"userMapper.delete"</span>,<span class="number">3</span>);</span><br><span class="line">System.out.println(delete);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></tbody></table></figure><blockquote><p>删除操作注意问题</p><ol><li>删除语句使用delete标签</li><li>Sql语句中使用#{任意字符串}方式引用传递的单个参数</li><li>删除操作使用的API是sqlSession.delete(“<a href="http://xn--eqrzj591h57w.id">命名空间.id</a>”,Object)</li></ol></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><blockquote><ol><li>编写UserMapper映射文件</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"userMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">    update user set username=#{username},password=#{password} where id=#{id}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>编写修改实体User的代码</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">resourceAsStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="type">int</span> <span class="variable">update</span> <span class="operator">=</span> sqlSession.update(<span class="string">"userMapper.update"</span>, user);</span><br><span class="line">System.out.println(update);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></tbody></table></figure><blockquote><p>修改操作注意问题</p><ol><li>修改语句使用update标签</li><li>修改操作使用的API是sqlSession.update(“<a href="http://xn--eqrzj591h57w.id">命名空间.id</a>”,实体对象);</li></ol></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><blockquote><ol><li>编写UserMapper映射文件</li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"userMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">    select * from User</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="2"><li>编写修改实体User的代码</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">resourceAsStream</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">"SqlMapConfig.xml"</span>);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(resourceAsStream);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">List&lt;User&gt; userList = sqlSession.selectList(<span class="string">"userMapper.findAll"</span>);</span><br><span class="line">System.out.println(userList);</span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>5. MyBatis核心配置文件概述</h1><h2 id="5-1-MyBatis核心配置文件层级关系">5.1 MyBatis核心配置文件层级关系</h2><ul><li>configuration 配置<ul><li><strong>properties 属性</strong></li><li><strong>settiongs 设置</strong></li><li><strong>typeAliases 类型别名</strong></li><li><strong>typeHandlers 类型处理器</strong></li><li><strong>objectFactory 对象工厂</strong></li><li><strong>plugins 插件</strong></li><li><strong>environments 环境</strong><ul><li><em>environment 环境变量</em><ul><li><em>transactionManager 事务管理器</em></li><li><em>dataSource 数据源</em></li></ul></li></ul></li><li><strong>databaseldProvider 数据库厂商标识</strong></li><li><strong>mappers 映射器</strong></li></ul></li></ul><h2 id="5-2-MyBatis常用配置解析">5.2 MyBatis常用配置解析</h2><blockquote><ol><li><h3 id="environments标签">environments标签</h3><p>数据库环境的配置，支持多环境配置</p></li></ol></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--指定默认的环境名称--&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--指定当前环境的名称--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--指定事务类型的JDBC--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--指定当前数据类型是连接池--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--数据源配置的基本参数--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///test"</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>其中，事务管理器（transactionManager）类型有两种：</p></blockquote><ul><li><p><code>JDBC</code>：这个配置就是直接使用了JDBC 的提交和回滚设置，它依赖于从数据源得到的连接来管理事务作用域</p></li><li><p><code>MANAGED</code>：这个配置几乎没做什么。它从来不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如JEE  应用服务器的上下文）</p><p>默认情况下它会关闭连接，然而一些容器并不希望这样，因此需要将 closeConnection 属性设置 为 false 来阻止它默认的关闭行为</p></li></ul><blockquote><p>其中，数据源（dataSource）类型有三种：</p></blockquote><ul><li><code>UNPOOLED</code>：这个数据源的实现只是每次被请求时打开和关闭连接</li><li><code>POOLED</code>：这种数据源的实现利用“池”的概念将 JDBC 连接对象组织起来</li><li><code> JNDI</code>：这个数据源的实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置 一个 JNDI 上下文的引用</li></ul><blockquote><ol start="2"><li><h3 id="mapper标签">mapper标签</h3></li></ol></blockquote><p>该标签的作用是加载映射的，加载方式有如下几种：</p><ul><li>使用相对于类路径的资源引用，例如：&lt; mapper resource=“org/mybatis/builder/AuthorMapper.xml”/&gt;</li><li>使用完全限定资源定位符（URL），例如：&lt; mapper url=“file:///var/mappers/AuthorMapper.xml”/&gt;</li><li>使用映射器接口实现类的完全限定类名，例如：&lt; mapper class=“org.mybatis.builder.AuthorMapper”/&gt;</li><li>将包内的映射器接口实现全部注册为映射器，例如：&lt; package name=“org.mybatis.builder”/&gt;</li></ul><blockquote><ol start="3"><li><h3 id="Properties标签">Properties标签</h3></li></ol></blockquote><p>实际开发中，习惯将数据源的配置信息单独抽取成一个properties文件，该标签可以加载额外配置的properties文件</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbc.properties"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据源环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--池子--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driver}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><ol start="4"><li>typeAliases标签</li></ol></blockquote><p>类型别名是为Java 类型设置一个短的名字。原来的类型名称配置如下</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"cn.jyw.pojo.User"</span>&gt;</span></span><br><span class="line">select * from User</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>配置typeAliases,为cn.jyw.pojo.User定义别名为user</strong></p><p><strong>typeAliases 放在核心配置文件中且位置在映射之前</strong></p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">"cn.jyw.pojo.User"</span> <span class="attr">alias</span>=<span class="string">"user"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findll"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">select * from User</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>上面我们是自定义的别名，mybatis框架已经为我们设置好的一些常用的类型的别名</p></blockquote><table><thead><tr><th style="text-align:center">别名</th><th style="text-align:center">数据类型</th></tr></thead><tbody><tr><td style="text-align:center">string</td><td style="text-align:center">String</td></tr><tr><td style="text-align:center">long</td><td style="text-align:center">Long</td></tr><tr><td style="text-align:center">int</td><td style="text-align:center">Interger</td></tr><tr><td style="text-align:center">double</td><td style="text-align:center">Double</td></tr><tr><td style="text-align:center">boolean</td><td style="text-align:center">Boolean</td></tr><tr><td style="text-align:center">… …</td><td style="text-align:center">… …</td></tr></tbody></table><h2 id="5-3-知识小结">5.3 知识小结</h2><blockquote><ol><li><p>properties标签：该标签可以加载外部的properties文件</p><p>&lt; properties resource=“jdbc.properties”/&gt;</p></li><li><p>typeAliases标签：设置类型别名</p><p><strong>typeAliases 放在核心配置文件中且位置在映射之前</strong></p><p>&lt; typeAlias type=“cn.jyw.pojo.User” alias=“user”&gt;</p></li><li><p>mappers标签：加载映射配置</p><p>&lt; mapper resource=“cn.jyw/mapper.xml”/&gt;</p></li><li><p>environments标签：数据源环境配置标签</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--池子--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driver}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li></ol></blockquote><h1>6. MyBatis的相应API</h1><h2 id="6-1-SqlSession工厂构建器SqlSessionFactoryBuilder">6.1 SqlSession工厂构建器SqlSessionFactoryBuilder</h2><p>常用API：<code>SqlSessionFactory build(InputStream inputStream)</code></p><p>通过加载mybatis的核心文件的输入流的形式构建一个<strong>SqlSessionFactory</strong>对象</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">"org/mybatis/builder/mybatis-config.xml"</span>;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> builder.build(inputStream);</span><br></pre></td></tr></tbody></table></figure><p>其中， Resources 工具类，这个类在 <a href="http://org.apache.ibatis.io">org.apache.ibatis.io</a> 包中</p><p>Resources 类帮助你从类路径下、文件系统或 一个 web URL 中加载资源文件。</p><h2 id="6-2-SqlSession工厂对象SqlSessionFactory">6.2 SqlSession工厂对象SqlSessionFactory</h2><p>SqlSessionFactory 有多个个方法创建 SqlSession 实例。常用的有如下两个：</p><table><thead><tr><th style="text-align:center">方法</th><th style="text-align:center">解释</th></tr></thead><tbody><tr><td style="text-align:center">openSession()</td><td style="text-align:center">会默认开启一个事务，但事务不会自动提交，也就意味着需要手动提 交该事务，更新操作数据才会持久化到数据库中</td></tr><tr><td style="text-align:center">openSession(boolean autoCommit)</td><td style="text-align:center">参数为是否自动提交，如果设置为true，那么不需要手动提交事务</td></tr></tbody></table><h2 id="6-3-SqlSession会话对象">6.3 SqlSession会话对象</h2><p>SqlSession 实例在 MyBatis 中是非常强大的一个类</p><p>在这里你会看到所有执行语句、提交或回滚事务和获取映射器实例的方法</p><blockquote><p>执行语句的方法主要有：</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement, Object parameter)</span> </span><br><span class="line">&lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement, Object parameter)</span> </span><br><span class="line"><span class="type">int</span> <span class="title function_">insert</span><span class="params">(String statement, Object parameter)</span> </span><br><span class="line"><span class="type">int</span> <span class="title function_">update</span><span class="params">(String statement, Object parameter)</span> </span><br><span class="line"><span class="type">int</span> <span class="title function_">delete</span><span class="params">(String statement, Object parameter)</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>操作事务的方法主要有：</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span></span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> MyBatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring(五) JdbcTemplate基本使用与事务控制</title>
      <link href="/javaee/spring/spring-wu-jdbctemplate/"/>
      <url>/javaee/spring/spring-wu-jdbctemplate/</url>
      
        <content type="html"><![CDATA[<h1>1. Spring JdbcTemplate基本使用</h1><h2 id="1-1-JdbcTemplate概述">1.1 JdbcTemplate概述</h2><p>它是spring框架中提供的一个对象，是对原始繁琐的<strong>Jdbc API对象的简单封装</strong>。spring框架为我们提供了很多的操作模板类</p><p>例如：操作关系型数据的<strong>JdbcTemplate</strong>和<strong>HibernateTemplate</strong>，操作nosql数据库的RedisTemplate操 作消息队列的JmsTemplate等等。</p><h2 id="1-2-JdbcTemplate开发步骤-快速入门">1.2 JdbcTemplate开发步骤/快速入门</h2><h3 id="1-2-1-导入spring-jdbc和spring-tx坐标">1.2.1 导入spring-jdbc和spring-tx坐标</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-2-2-创建数据库表和实体">1.2.2 创建数据库表和实体</h3><p>运行SQL脚本 和 Generate POJOs.groovy即可</p><h3 id="1-2-3-创建JdbcTemplate对象">1.2.3 创建JdbcTemplate对象</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、创建数据源对象</span></span><br><span class="line"><span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">dataSource.setDriverClass(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://localhost:3306/test"</span>);</span><br><span class="line">dataSource.setUser(<span class="string">"root"</span>);</span><br><span class="line">dataSource.setPassword(<span class="string">"root"</span>);</span><br><span class="line"><span class="comment">//2、创建JdbcTemplate对象</span></span><br><span class="line"><span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>();</span><br><span class="line"><span class="comment">//3、设置数据源给JdbcTemplate</span></span><br><span class="line">jdbcTemplate.setDataSource(dataSource);</span><br></pre></td></tr></tbody></table></figure><h3 id="1-2-4执行数据库操作">1.2.4执行数据库操作</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"insert into account values(?,?)"</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> jdbcTemplate.update(sql, <span class="string">"user3"</span>, <span class="number">10</span>);</span><br><span class="line">System.out.println(row);</span><br></pre></td></tr></tbody></table></figure><h2 id="1-3-Spring产生JdbcTemplate对象">1.3 Spring产生JdbcTemplate对象</h2><blockquote><p>我们可以将JdbcTemplate的创建权交给Spring</p><p>将数据源DataSource的创建权也交给Spring</p><p><strong>注意</strong>:<strong>applicationContext.xml加载jdbc.properties配置文件获得连接信息时别忘了   引入context命名空间和约束路径</strong></p><p>在Spring容器内部将 数据源DataSource注入到JdbcTemplate模版对象中，配置如下：</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driver}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--jidbc模板对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> app.getBean(JdbcTemplate.class);</span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"insert into account values(?,?)"</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">row</span> <span class="operator">=</span> jdbcTemplate.update(sql, <span class="string">"user4"</span>, <span class="number">20</span>);</span><br><span class="line">System.out.println(row);</span><br></pre></td></tr></tbody></table></figure><h2 id="1-4-JdbcTemplate的常用操作">1.4 JdbcTemplate的常用操作</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">update(sql,?的值)</button></li><li class="tab"><button type="button" data-href="#1-2">queryForMap(sql,?的值)</button></li><li class="tab"><button type="button" data-href="#1-3">queryForList(sql,?的值)</button></li><li class="tab"><button type="button" data-href="#1-4">query(sql,query的参数)</button></li><li class="tab"><button type="button" data-href="#1-5">queryForObject</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>执行DML语句。增、删、改语句</p><ol><li><p>修改</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"update emp set salary = 10000 where id = 1001"</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> template.update(sql)</span><br></pre></td></tr></tbody></table></figure></li><li><p>增加</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"insert into emp(id,ename,dept_id) values(?,?,?)"</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> template.update(sql, <span class="number">1015</span>, <span class="string">"郭靖"</span>, <span class="number">10</span>);</span><br></pre></td></tr></tbody></table></figure></li><li><p>删除</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"delete from emp where id = ?"</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> template.update(sql, <span class="number">1015</span>);</span><br></pre></td></tr></tbody></table></figure></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>查询结果将结果集封装为map集合</p><p>将列名作为 key，将值作为value</p><p>将这条记录封装为一个map 集合</p><blockquote><p><strong>注意：这个方法查询的结果集长度只能是1</strong></p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"select * from emp where id = ? or id = ?"</span>;</span><br><span class="line"></span><br><span class="line">Map&lt;String, Object&gt; map = template.queryForMap(sql, <span class="number">1001</span>,<span class="number">1002</span>);</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p>查询结果将结果集封装为list集合</p><blockquote><p>注意：将每一条记录封装为一个Map集合，再将 Map集合装载到List集合中</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"select * from emp"</span>;</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; list = template.queryForList(sql);</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><blockquote><p>查询结果，将结果封装为JavaBean对象 封装给对象</p><p>用封装类 不然 数值类型 不能被赋null</p></blockquote><ol><li><p>new BeanPropertyRowMapper&lt;类型&gt;(类型. class)</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"select * from emp"</span>;</span><br><span class="line">List&lt;Emp&gt; list = template.query(sql, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Emp&gt;(Emp.class));</span><br><span class="line"><span class="keyword">for</span> (Emp emp : list) { System.out.println(emp); }</span><br></pre></td></tr></tbody></table></figure></li><li><p>new RowMapper&lt;类型&gt;</p><blockquote><p>我们使用BeanPropertyRowMapper实现类</p><p>可 以完成数据到JavaBean的自动封装</p><p>不推荐)手动 设置 要接收的值的set与get</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"select * from emp"</span>;</span><br><span class="line">List&lt;Emp&gt; list = template.query(sql, <span class="keyword">new</span></span><br><span class="line"><span class="title class_">RowMapper</span>&lt;Emp&gt;() {</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Emp <span class="title function_">mapRow</span><span class="params">(ResultSet rs, <span class="type">int</span> i)</span> <span class="keyword">throws</span></span><br><span class="line">SQLException {</span><br><span class="line"><span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line"><span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">"id"</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">ename</span> <span class="operator">=</span> rs.getString(<span class="string">"ename"</span>);</span><br><span class="line">emp.setId(id); </span><br><span class="line">    emp.setEname(ename);</span><br><span class="line"><span class="keyword">return</span> emp; }</span><br><span class="line">}</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><ol><li><p>聚合函数的查询 查询有多少记录</p><blockquote><p>还可以用主键代替要用主键</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">"select count(*) from emp"</span>; </span><br><span class="line"><span class="type">Long</span> <span class="variable">total</span> <span class="operator">=</span> template.queryForObject(sql,Long.class);</span><br></pre></td></tr></tbody></table></figure></li><li><p>返回对象</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> jdbcTemplate.queryForObject(</span><br><span class="line">    sql, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;Book&gt;(Book.class), id);</span><br></pre></td></tr></tbody></table></figure></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>2. 事务控制</h1><h2 id="2-1-编程式事务控制相关对象">2.1 编程式事务控制相关对象</h2><h3 id="2-1-1-PlatformTransactionManager-事务管理器">2.1.1 PlatformTransactionManager 事务管理器</h3><p>PlatformTransactionManager 接口是 spring 的事务管理器</p><p>它里面提供了我们常用的操作事务的方法</p><table><thead><tr><th style="text-align:center">方法</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">TransactionStatus  getTransaction(TransactionDefination defination)</td><td style="text-align:center">获取事务的状态信息</td></tr><tr><td style="text-align:center">void commit(TransactionStatus status)</td><td style="text-align:center">提交事务</td></tr><tr><td style="text-align:center">void rollback(TransactionStatus status)</td><td style="text-align:center">回滚事务</td></tr></tbody></table><blockquote><p>注意：</p><p>PlatformTransactionManager 是接口类型，不同的 Dao 层技术则有不同的实现类<br>例如：Dao 层技术是jdbc  或 mybatis 时：</p><p>org.springframework.jdbc.datasource.DataSourceTransactionManager</p><p>Dao 层技术是hibernate时：</p><p>org.springframework.orm.hibernate5.HibernateTransactionManager</p></blockquote><h3 id="2-1-2-TransactionDefinition-事务的定义信息对象">2.1.2 TransactionDefinition 事务的定义信息对象</h3><p>TransactionDefinition 是事务的定义信息对象，里面有如下方法：</p><table><thead><tr><th style="text-align:center">方法</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">int getIsolationLevel()</td><td style="text-align:center">获得事务的隔离级别</td></tr><tr><td style="text-align:center">int getPropogationBehavior()</td><td style="text-align:center">获得事务的传播行为</td></tr><tr><td style="text-align:center">int getTimeout()</td><td style="text-align:center">获得超时时间</td></tr><tr><td style="text-align:center">boolean isReadOnly()</td><td style="text-align:center">是否只读</td></tr></tbody></table><blockquote><p><strong>事务隔离级别</strong></p></blockquote><blockquote><p><strong>设置隔离级别，可以解决事务并发产生的问题，如脏读、不可重复读和虚读</strong></p></blockquote><p>数据库是要被广大客户所共享访问的，那么在数据库操作过程中很可能出现以下几种不确定情况。</p><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">更新丢失(Lost update)</button></li><li class="tab"><button type="button" data-href="#1-2">脏读（Dirty reads）</button></li><li class="tab"><button type="button" data-href="#1-3">不可重复读（Non-repeatable Reads）</button></li><li class="tab"><button type="button" data-href="#1-4">幻读（Phantom Reads）</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><blockquote><p>两个事务都同时更新一行数据，一个事务对数据的更新把另一个事务对数据的更新覆盖了</p></blockquote><p>比如 CMS系统中，两个同时打开一篇文章进行修改，一个人先保存，另一个人后保存，后保存的就覆盖了先保存的那个人的内容，这就造成更新丢失</p><p>这是因为系统没有执行任何的锁操作，因此并发事务并没有被隔离开来</p><p>在并发事务处理带来的问题中，“更新丢失”通常应该是完全避免的</p><p>但防止更新丢失，并不能单靠数据库事务控制器来解决，需要应用程序对要更新的数据加必要的锁来解决，因此，防止更新丢失应该是应用的责任。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><blockquote><p>一个事务读取到了另一个事务未提交的数据操作结果</p></blockquote><p>这是相当危险的，因为很可能所有的操作都被回滚。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><blockquote><p>一个事务对同一行数据重复读取两次，但是却得到了不同的结果</p></blockquote><p>比如事务T1读取某一数据后，事务T2对其做了修改，当事务T1再次读该数据时得到与前一次不同的值。又叫虚读。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><blockquote><p>事务在操作过程中进行两次查询，第二次查询的结果包含了第一次查询中未出现的数据或者缺少了第一次查询中出现的数据（这里并不要求两次查询的SQL语句相同）</p></blockquote><p>这是因为在两次查询过程中有另外一个事务插入数据造成的。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>不可重复读的重点是修改某个记录字段，幻读的重点在于新增或者删除记录。<br>对于前者, 只需要锁住满足条件的记录。对于后者, 要锁住满足条件及其相近的记录。</p><p>“脏读”、“不可重复读”和“幻读”，其实都是数据库读一致性问题，必须由数据库提供一定的事务隔离机制来解决。</p><table><thead><tr><th style="text-align:center">隔离级别</th><th style="text-align:center">读数据一致性</th><th style="text-align:center">脏读</th><th style="text-align:center">不可重复读</th><th style="text-align:center">幻读</th></tr></thead><tbody><tr><td style="text-align:center">ISOLATION_DEFAULT(默认)</td><td style="text-align:center">默认</td><td style="text-align:center">默认</td><td style="text-align:center">默认</td><td style="text-align:center">默认</td></tr><tr><td style="text-align:center">ISOLATION_READ_UNCOMMITTED(未提交读)</td><td style="text-align:center">最低级别,只能保证不读取物理上损坏的数据</td><td style="text-align:center">√</td><td style="text-align:center">√</td><td style="text-align:center">√</td></tr><tr><td style="text-align:center">ISOLATION_READ_COMMITTED(已提交读)</td><td style="text-align:center">语句级</td><td style="text-align:center">×</td><td style="text-align:center">√</td><td style="text-align:center">√</td></tr><tr><td style="text-align:center">ISOLATION_REPEATABLE_READ(可重复读)</td><td style="text-align:center">事务级</td><td style="text-align:center">×</td><td style="text-align:center">×</td><td style="text-align:center">√</td></tr><tr><td style="text-align:center">ISOLATION_SERIALIZABLE(可序列化)</td><td style="text-align:center">最高级别,事务级</td><td style="text-align:center">×</td><td style="text-align:center">×</td><td style="text-align:center">×</td></tr></tbody></table><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">默认(Default)</button></li><li class="tab"><button type="button" data-href="#1-2">未提交读取（Read Uncommitted）</button></li><li class="tab"><button type="button" data-href="#1-3">已提交读取（Read Committed）</button></li><li class="tab"><button type="button" data-href="#1-4">可重复读取（Repeatable Read）</button></li><li class="tab"><button type="button" data-href="#1-5">序列化（Serializable）</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>Spring中一个标识：ISOLATION_DEFAULT</p><p>表示使用后端数据库默认的隔离级别</p><p>大多数数据库默认的事务隔离级别是Read committed，比如Sql Server , Oracle</p><p>MySQL的默认隔离级别是Repeatable read</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>Spring标识：ISOLATION_READ_UNCOMMITTED</p><p>允许脏读取，但不允许更新丢失</p><p>如果一个事务已经开始写数据，则另外一个事务则不允许同时进行写操作，但允许其他事务读此行数据。</p><p>该隔离级别可以通过“排他写锁”实现。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p>Spring标识：ISOLATION_READ_COMMITTED</p><p>允许不可重复读取，但不允许脏读取</p><p>这可以通过“瞬间共享读锁”和“排他写锁”实现</p><p>读取数据的事务允许其他事务继续访问该行数据，但是未提交的写事务将会禁止其他事务访问该行。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-4"><p>Spring标识：ISOLATION_REPEATABLE_READ</p><p>禁止不可重复读取和脏读取，但是有时可能出现幻读数据</p><p>这可以通过“共享读锁”和“排他写锁”实现</p><p>读取数据的事务将会禁止写事务（但允许读事务），写事务则禁止任何其他事务。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-5"><p>Spring标识：ISOLATION_SERIALIZABLE</p><p>提供严格的事务隔离</p><p>它要求事务序列化执行，事务只能一个接着一个地执行，不能并发执行</p><p>仅仅通过“行级锁”是无法实现事务序列化的，必须通过其他机制保证新插入的数据不会被刚执行查询操作的事务访问到</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>隔离级别越高，越能保证数据的完整性和一致性，但是对并发性能的影响也越大</p><p>对于多数应用程序，可以优先考虑把数据库系统的隔离级别设为Read Committed</p><p>它能够避免脏读取，而且具有较好的并发性能</p><p>尽管它会导致不可重复读、幻读和第二类丢失更新这些并发问题，在可能出现这类问题的个别场合，可以由应用程序采用悲观锁或乐观锁来控制</p></blockquote><blockquote><p><strong>事务传播行为</strong></p></blockquote><table><thead><tr><th style="text-align:center">名词</th><th style="text-align:center">解释</th></tr></thead><tbody><tr><td style="text-align:center"><code>REQUIRED</code></td><td style="text-align:center"><code>如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。一般的选择（默认值)</code></td></tr><tr><td style="text-align:center"><code>SUPPORTS</code></td><td style="text-align:center"><code>支持当前事务，如果当前没有事务，就以非事务方式执行（没有事务）</code></td></tr><tr><td style="text-align:center">MANDATORY</td><td style="text-align:center">使用当前的事务，如果当前没有事务，就抛出异常</td></tr><tr><td style="text-align:center">REQUERS_NEW</td><td style="text-align:center">新建事务，如果当前在事务中，把当前事务挂起</td></tr><tr><td style="text-align:center">NOT_SUPPORTED</td><td style="text-align:center">以非事务方式执行操作，如果当前存在事务，就把当前事务挂起</td></tr><tr><td style="text-align:center">NEVER</td><td style="text-align:center">以非事务方式运行，如果当前存在事务，抛出异常</td></tr><tr><td style="text-align:center">NESTED</td><td style="text-align:center">如果当前存在事务，则在嵌套事务内执行如果当前没有事务，则执行 REQUIRED 类似的操作</td></tr><tr><td style="text-align:center">超时时间</td><td style="text-align:center">默认值是-1，没有超时限制。如果有，以秒为单位进行设置</td></tr><tr><td style="text-align:center">是否只读</td><td style="text-align:center">建议查询时设置为只读</td></tr></tbody></table><h3 id="2-1-3-TransactionStatus-事务具体的运行状态">2.1.3 TransactionStatus  事务具体的运行状态</h3><blockquote><p>TransactionStatus 接口提供的是事务具体的运行状态，方法介绍如下</p></blockquote><table><thead><tr><th style="text-align:center">方法</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">boolean hasSavepoint()</td><td style="text-align:center">是否存储回滚点</td></tr><tr><td style="text-align:center">boolean isCompleted()</td><td style="text-align:center">事务是否完成</td></tr><tr><td style="text-align:center">boolean isNewTransaction()</td><td style="text-align:center">是否是新事务</td></tr><tr><td style="text-align:center">boolean isRollbackOnly()</td><td style="text-align:center">事务是否回滚</td></tr></tbody></table><h2 id="2-2-基于-XML-的声明式事务控制">2.2 基于 XML 的声明式事务控制</h2><h3 id="2-2-1-什么是声明式事务控">2.2.1 什么是声明式事务控</h3><p>Spring 的声明式事务顾名思义就是采用<code>声明的方式来处理事务</code></p><p>这里所说的声明，就是指在配置文件中声明 ，用在 Spring 配置文件中声明式的处理事务来代替代码式的处理事务</p><blockquote><p>声明式事务处理的作用</p></blockquote><ul><li><p>事务管理不侵入开发的组件</p><p>具体来说，业务逻辑对象就不会意识到正在事务管理之中，事实上也应该如此，因为事务管理是属于系统层面的服务，而不是业务逻辑的一部分，如果想要改变事务管理策划的话， 也只需要在定义文件中重新配置即可</p></li><li><p>在不需要事务管理的时候，只要在设定文件上修改一下，即可移去事务管理服务，无需改变代码重新编译 ，这样维护起来极其方便</p></li></ul><blockquote><p>注意：Spring 声明式事务控制底层就是AOP</p></blockquote><h3 id="2-2-2-声明式事务控制的实现">2.2.2 声明式事务控制的实现</h3><p>声明式事务控制明确事项：</p><ul><li>谁是切点？</li><li>谁是通知？</li><li>配置切面？</li></ul><ol><li><p>引入tx命名空间</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xmlns:aop="http://www.springframework.org/schema/tx"</span><br><span class="line">http://www.springframework.org/schema/tx</span><br><span class="line">http://www.springframework.org/schema/tx/spring-tx.xsd</span><br></pre></td></tr></tbody></table></figure></li><li><p>配置事务增强</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--平台事务管理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--事务增强配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置事务的信息--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>其中， &lt; tx:method &gt;代表切点方法的事务参数的配置，例如:</p><blockquote><p>&lt;tx:method name=“transfer” isolation=“REPEATABLE_READ” propagation=“REQUIRED” timeout=“-1” read-only=“false”/&gt;</p></blockquote><ul><li>name：切点方法名称</li><li>isolation:事务的隔离级别</li><li>propogation：事务的传播行为</li><li>timeout：超时时间</li><li>read-only：是否只读</li></ul></li><li><p>配置事务 AOP 织入</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--事务的aop增强--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"myPointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* </span></span></span><br><span class="line"><span class="string"><span class="tag">cn.jyw.service.impl.*.*(..))"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id="2-3-使用注解配置声明式事务控制">2.3 使用注解配置声明式事务控制</h2><h3 id="2-3-1-使用注解配置声明式事务控制">2.3.1 使用注解配置声明式事务控制</h3><ol><li><p>编写 AccoutDao</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository("accountDao")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountDao</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">(String outMan, <span class="type">double</span> money)</span> {</span><br><span class="line">    jdbcTemplate.update(<span class="string">"update account set money=money-? where name=?"</span>,money,outMan);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">in</span><span class="params">(String inMan, <span class="type">double</span> money)</span> {</span><br><span class="line">    jdbcTemplate.update(<span class="string">"update account set money=money+? where name=?"</span>,money,inMan);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>编写 AccoutService</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service("accountService")</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    <span class="meta">@Transactional(isolation = Isolation.READ_COMMITTED,propagation = Propagation.REQUIRED)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String outMan, String inMan, <span class="type">double</span> money)</span> {</span><br><span class="line">        accountDao.out(outMan,money);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">        accountDao.in(inMan,money);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>编写 applicationContext.xml 配置文件</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!—之前省略datsSource、jdbcTemplate、平台事务管理器的配置--&gt;</span><br><span class="line"><span class="comment">&lt;!--组件扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--事务的注解驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure></li></ol><h3 id="2-3-2-注解配置声明式事务控制解析">2.3.2 注解配置声明式事务控制解析</h3><ol><li>使用 @Transactional 在需要进行事务控制的类或是方法上修饰，注解可用的属性同 xml 配置方式，例如隔离 级别、传播行为等</li><li>注解使用在类上，那么该类下的所有方法都使用同一套注解参数配置</li><li>使用在方法上，不同的方法可以采用不同的事务参数配置</li><li>Xml配置文件中要开启事务的注解驱动&lt;tx:annotation-driven /&gt;</li></ol>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring(四) 面向切面编程AOP</title>
      <link href="/javaee/spring/spring-si-mian-xiang-qie-mian-bian-cheng-aop/"/>
      <url>/javaee/spring/spring-si-mian-xiang-qie-mian-bian-cheng-aop/</url>
      
        <content type="html"><![CDATA[<h1>1. Spring 的 AOP 简介</h1><h2 id="1-1-什么是-AOP">1.1 什么是 AOP</h2><p>AOP 为 <em><strong>A</strong></em>spect <em><strong>O</strong></em>riented <em><strong>P</strong></em>rogramming 的缩写，意思为面向切面编程，<strong>是通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术</strong></p><p><strong>AOP 是 OOP 的延续</strong>，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍 生范型。</p><blockquote><p><strong>利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率</strong></p></blockquote><p>在应用 AOP 编程时，仍然需要定义公共功能，但可以明确的定义这个功能在哪里，以什么方式应用，并且不必修改受影响的类， 这样一来横切关注点就被模块化到特殊的对象(切面)里</p><h2 id="1-2-AOP-的作用及其优势">1.2 AOP 的作用及其优势</h2><blockquote><p>作用：在程序运行期间，在不修改源码的情况下对方法进行功能增强</p></blockquote><blockquote><p>优势：每个切面位于一个位置，代码不分散， 减少重复代码，提高开发效率，并且便于维护和升级，业务模块更简洁, 只包含核心业务代码</p></blockquote><h2 id="1-3-AOP-的底层实现">1.3 AOP 的底层实现</h2><p>实际上，AOP 的底层是通过 Spring 提供的的动态代理技术实现的。</p><p>在运行期间，Spring通过动态代理技术动态 的生成代理对象，代理对象方法执行时进行增强功能的介入，在去调用目标对象的方法，从而完成功能的增强</p><h2 id="1-4-AOP-的动态代理技术">1.4 AOP 的动态代理技术</h2><p>常用的动态代理技术</p><ul><li><blockquote><p>JDK 代理 : 基于接口的动态代理技术</p></blockquote><p>要求:</p><ol><li><p>使用反射包下的 Proxy类及InvocationHandler接口</p></li><li><p>目标类必须要实现接口，代理类同样也要使用相同的接口</p></li><li><p>使用场合:struts拦截器，spring的AOP使用的都是jdk代理</p></li></ol></li><li><blockquote><p>cglib 代理：基于父类的动态代理技术</p></blockquote><p>code Generation lib(高性能开源的代码生成包，它采用非常底层的字节码技术，在程序执行期间对指定的目标类生成一个子类，并对子类进行增强)</p><p>它使用的底层框架是ASM（java字节码生成小框架）</p><p>要求：</p><ol><li><p>目标类不用实现任何接口，也可以实现接口</p></li><li><p>目标类不能被final 修饰，因为代理类是目标类的子类</p></li></ol><p>​       使用场合：hibernate中的session.load()得到的就是cglib的代理对象</p><ol start="3"><li>spring中也有使用</li></ol></li></ul><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/AOP%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="AOP 的动态代理技术示意图"></p><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">JDK 的动态代理</button></li><li class="tab"><button type="button" data-href="#1-2">cglib 的动态代理</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>目标类接口</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TargetInterface</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>目标类</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Target</span> <span class="keyword">implements</span> <span class="title class_">TargetInterface</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"Target runing..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>动态代理代码</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">TargetInterface target=<span class="keyword">new</span> <span class="title class_">Target</span>();<span class="comment">//创建目标对象</span></span><br><span class="line">        <span class="comment">//创建代理对象 返回值就是动态生成的代理对象 目标对象和代理对象同级故都用多态来接收</span></span><br><span class="line">        <span class="type">TargetInterface</span> <span class="variable">proxy</span> <span class="operator">=</span> (TargetInterface) Proxy.newProxyInstance(</span><br><span class="line">                target.getClass().getClassLoader(),<span class="comment">//目标对象类加载器</span></span><br><span class="line">                target.getClass().getInterfaces(),<span class="comment">//目标对象相同的接口字节码对象数组</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() {</span><br><span class="line">                    <span class="comment">//调用代理对象的任何方法,实质执行的哦都是invoke方法</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span><br><span class="line">                            <span class="keyword">throws</span> Throwable {</span><br><span class="line">                        System.out.println(<span class="string">"前置增强代码..."</span>);</span><br><span class="line">                        <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span> method.invoke(target, args);<span class="comment">//执行目标方法</span></span><br><span class="line">                        System.out.println(<span class="string">"后置增强代码..."</span>);</span><br><span class="line">                        <span class="keyword">return</span> invoke;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">        );</span><br><span class="line"><span class="comment">//调用代理对象的方法测试</span></span><br><span class="line">        proxy.method();</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>目标类</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Target</span>  {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"Target runing..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>动态代理代码</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Target</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Target</span>(); <span class="comment">//创建目标对象</span></span><br><span class="line"><span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>(); <span class="comment">//创建增强器</span></span><br><span class="line">enhancer.setSuperclass(Target.class); <span class="comment">//设置父类</span></span><br><span class="line">enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() { <span class="comment">//设置回调</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects,</span></span><br><span class="line"><span class="params">                            MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">        System.out.println(<span class="string">"前置代码增强...."</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span> method.invoke(target, objects);</span><br><span class="line">        System.out.println(<span class="string">"后置代码增强...."</span>);</span><br><span class="line">        <span class="keyword">return</span> invoke;</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"><span class="comment">//创建代理对象  基于父的代理对象 用子来接</span></span><br><span class="line"><span class="type">Target</span> <span class="variable">proxy</span> <span class="operator">=</span> (Target) enhancer.create();</span><br><span class="line">proxy.method();</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-5AOP-相关概念">1.5AOP 相关概念</h2><blockquote><p>Spring 的 AOP 实现底层就是对上面的动态代理的代码进行了封装，封装后我们只需要对需要关注的部分进行代码编写，并通过配置的方式完成指定目标的方法增强</p></blockquote><p>在正式讲解 AOP 的操作之前，我们必须理解 AOP 的<em><strong>相关术语</strong></em>，常用的术语如下：</p><ul><li>Target（目标对象）：代理的目标对象</li><li>Proxy （代理）：一个类被 AOP 织入增强后，就产生一个结果代理类</li><li>Joinpoint（连接点）：所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法，因为spring只支持方 法类型的连接点</li><li><code>Pointcut</code>（切入点）：所谓切入点是指我们要对哪些 Joinpoint 进行拦截的定义</li><li><code>Advice</code>（通知/ 增强）：所谓通知是指拦截到 Joinpoint 之后所要做的事情就是通知</li><li><code>Aspect</code>（切面）：是切入点和通知（引介）的结合</li><li><code>Weaving</code>（织入）：是指把增强应用到目标对象来创建新的代理对象的过程。spring采用动态代理织入，而 AspectJ采用编译期织入和类装载期织入</li></ul><h2 id="1-6-AOP-开发明确的事项">1.6 AOP 开发明确的事项</h2><h3 id="1-6-1-需要编写的内容">1.6.1 需要编写的内容</h3><ul><li>编写核心业务代码（目标类的目标方法）</li><li>编写切面类，切面类中有通知(增强功能方法)</li><li>在配置文件中，配置织入关系，即将哪些通知与哪些连接点进行结合</li></ul><h3 id="1-6-2-AOP-技术实现的内容">1.6.2 AOP 技术实现的内容</h3><p>Spring 框架监控切入点方法的执行。</p><p>一旦监控到切入点方法被运行，使用代理机制，动态创建目标对象的 代理对象</p><p>根据通知类别，在代理对象的对应位置，将通知对应的功能织入，完成完整的代码逻辑运行</p><h3 id="1-6-3-AOP-底层使用哪种代理方式">1.6.3 AOP 底层使用哪种代理方式</h3><p>在 spring 中，框架会根据目标类是否实现了接口来决定采用哪种动态代理的方式</p><h2 id="知识要点">知识要点</h2><blockquote><ul><li><p>aop：面向切面编程</p></li><li><p>aop底层实现：基于JDK的动态代理 和 基于Cglib的动态代理</p></li><li><p>aop的重点概念： Pointcut（切入点）：被增强的方法</p><p>​Advice（通知/ 增强）：封装增强业务逻辑的方法</p><p>​Aspect（切面）：切点+通知</p><p>​Weaving（织入）：将切点与通知结合的过程</p></li><li><p>开发明确事项：</p><p>​谁是切点（切点表达式配置）</p><p>​谁是通知（切面类中的增强方法）</p><p>​ 将切点和通知进行织入配置</p></li></ul></blockquote><h1>2. 基于 XML 的 AOP 开发</h1><h2 id="2-1-快速入门">2.1 快速入门</h2><ol><li>导入 AOP 相关坐标</li><li>创建目标接口和目标类（内部有切点）</li><li>创建切面类（内部有增强方法）</li><li>将目标类和切面类的对象创建权交给 spring</li><li>在 applicationContext.xml 中配置织入关系</li><li>测试代码</li></ol><h3 id="2-1-1-导入-AOP-相关坐标">2.1.1 导入 AOP 相关坐标</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入spring的context坐标，context依赖aop--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- aspectj的织入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-2-创建目标接口和目标类（内部有切点）">2.2.2 创建目标接口和目标类（内部有切点）</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TargetInterface</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Target</span> <span class="keyword">implements</span> <span class="title class_">TargetInterface</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(<span class="string">"Target runing..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>{</span><br><span class="line">        System.out.println(<span class="string">"前置增强"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="2-1-3-将目标类和切面类的对象创建权交给-sprin">2.1.3 将目标类和切面类的对象创建权交给 sprin</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--目标对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"target"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.aop.aop.Target"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--切面对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.aop.aop.MyAspect"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2-1-4-在-applicationContext-xml-中配置织入关系">2.1.4 在 applicationContext.xml 中配置织入关系</h3><blockquote><p>导入aop命名空间</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       </span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           </span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           </span></span></span><br><span class="line"><span class="string"><span class="tag">"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>配置切点表达式和前置增强的织入关系</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置织入,告诉spring框架 哪些方法需要哪写增强--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--声明切面--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--切面:切点+通知--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut</span>=<span class="string">"execution(public void cn.jyw.aop.aop.Target.save())"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2-1-5-测试代码">2.1.5 测试代码</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration("classpath:applicationContext.xml")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> {</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Target target;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>{</span><br><span class="line">        target.save();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">前置增强</span><br><span class="line">Target runing...</span><br></pre></td></tr></tbody></table></figure><h2 id="2-2-XML-配置-AOP-详解">2.2 XML 配置 AOP 详解</h2><h3 id="2-2-1-切点表达式的写法">2.2.1 切点表达式的写法</h3><p>表达式语法：</p><blockquote><p><strong>execution([修饰符] 返回值类型 包名.类名.方法名(参数)</strong></p></blockquote><ul><li>访问修饰符可以省略</li><li>返回值类型、包名、类名、方法名可以使用星号* 代表任意</li><li>包名与类名之间一个点 . 代表当前包下的类，两个点 … 表示当前包及其子包下的类</li><li>参数列表可以使用两个点 … 表示任意个数，任意类型的参数列表</li></ul><p>例如:</p><blockquote><p>execution(public <strong>void</strong> cn.jyw.aop.Target.method())  //Target类下的 method 没有返回值没有参数</p><p>execution(<strong>void</strong> cn.jyw.aop.Target.*(…))  //Target类下的 任意方法任意参数(void 没有返回值的)</p><p>execution(* cn.jyw.aop.* .*(…)) // aop包下的任意类任意参数</p><p>execution(* cn.jyw.aop…* .*(…)) //aop包下及其子包下任何</p><p>execution(* * …* .*(…))// 任意</p></blockquote><h3 id="2-2-2-通知的类型">2.2.2 通知的类型</h3><p>通知的配置语法：</p><blockquote><p>&lt;aop:通知类型 method=“切面类中方法名” pointcut=“切点表达式"&gt;&lt; /aop:通知类型&gt;</p></blockquote><table><thead><tr><th>名称</th><th>标签</th><th>说明</th></tr></thead><tbody><tr><td>前置通知</td><td>&lt; aop:before&gt;</td><td>用于配置前置通知。指定增强的方法在切入点方法之前执行</td></tr><tr><td>后置通知</td><td>&lt; aop:after-returning&gt;</td><td>用于配置后置通知。指定增强的方法在切入点方法之后执行</td></tr><tr><td>环绕通知</td><td>&lt; aop:around&gt;</td><td>用于配置环绕通知。指定增强的方法在切入点方法之前和之后都执行</td></tr><tr><td>异常抛出通知</td><td>&lt; aop:throwing&gt;</td><td>用于配置异常抛出通知。指定增强的方法在出现异常时执行</td></tr><tr><td>最终通知</td><td>&lt; aop:after&gt;</td><td>用于配置最终通知。无论增强方式执行是否有异常都会执行</td></tr></tbody></table><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>{</span><br><span class="line">    System.out.println(<span class="string">"前置增强"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>{</span><br><span class="line">    System.out.println(<span class="string">"后置增强"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="comment">//proceeding JoinPoint 正在执行的连接点===切点</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable {</span><br><span class="line">    System.out.println(<span class="string">"增强前"</span>);</span><br><span class="line">    <span class="comment">//切点方法</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">    System.out.println(<span class="string">"增前后"</span>);</span><br><span class="line">    <span class="keyword">return</span> proceed;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>{</span><br><span class="line">    System.out.println(<span class="string">"异常抛出增强"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>{</span><br><span class="line">    System.out.println(<span class="string">"最终增强"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--目标对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"target"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.aop.aop.Target"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--切面对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.aop.aop.MyAspect"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置织入,告诉spring框架 哪些方法需要哪写增强--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--声明切面--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--切面:切点+通知--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* cn.jyw.aop.aop.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterReturning"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* cn.jyw.aop.aop.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"around"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* cn.jyw.aop.aop.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"afterThrowing"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* cn.jyw.aop.aop.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"after"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* cn.jyw.aop.aop.*.*(..))"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>结果</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">前置增强</span><br><span class="line">增强前</span><br><span class="line">//Target runing...</span><br><span class="line">//增强后</span><br><span class="line">//后置增强</span><br><span class="line">最终增强</span><br><span class="line">异常抛出增强</span><br><span class="line">java.lang.ArithmeticException: / by zero</span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-3-切点表达式的抽取">2.2.3 切点表达式的抽取</h3><blockquote><p>当多个增强的切点表达式相同时，可以将切点表达式进行抽取，在增强中使用 pointcut-ref 属性代替 pointcut 属性来引用抽 取后的切点表达式</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引用myAspect的Bean为切面对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"myPointcut"</span> <span class="attr">expression</span>=<span class="string">"execution(* cn.jyw.aop.*.*(..))"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointcut"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="2-2-4-知识要点">2.2.4 知识要点</h2><blockquote><p>aop织入的配置</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">“切面类”</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">“通知方法名称”</span> <span class="attr">pointcut</span>=<span class="string">“切点表达式</span>"&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>通知的类型：前置通知、后置通知、环绕通知、异常抛出通知、最终通知</p></blockquote><blockquote><p>切点表达式的写法： execution([修饰符] 返回值类型 包名.类名.方法名(参数))</p></blockquote><h1>3. 基于注解的 AOP 开发</h1><h2 id="3-1-快速入门">3.1 快速入门</h2><p>基于注解的aop开发步骤：</p><h3 id="3-1-1-创建目标接口和目标类（内部有切点）">3.1.1 创建目标接口和目标类（内部有切点）</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TargetInterface</span> {</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Target</span> <span class="keyword">implements</span> <span class="title class_">TargetInterface</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(<span class="string">"Target running...."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="3-1-2-创建切面类（内部有增强方法）">3.1.2 创建切面类（内部有增强方法）</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> {</span><br><span class="line">    <span class="comment">//前置增强方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>{</span><br><span class="line">    System.out.println(<span class="string">"前置代码增强....."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="3-1-3-将目标类和切面类的对象创建权交给-spring">3.1.3 将目标类和切面类的对象创建权交给 spring</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component("target")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Target</span> <span class="keyword">implements</span> <span class="title class_">TargetInterface</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(<span class="string">"Target running...."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="meta">@Component("myAspect")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>{</span><br><span class="line">    System.out.println(<span class="string">"前置代码增强....."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="3-1-4-在切面类中使用注解配置织入关系">3.1.4 在切面类中使用注解配置织入关系</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component("myAspect")</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> {</span><br><span class="line">    <span class="meta">@Before("execution(* cn.jyw.aop.*.*(..))")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>{</span><br><span class="line">    System.out.println(<span class="string">"前置代码增强....."</span>);</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="3-1-5-在配置文件中开启组件扫描和-AOP-的自动代理">3.1.5 在配置文件中开启组件扫描和 AOP 的自动代理</h3><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--组件扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw.aop"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--aop的自动代理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3-1-6-测试">3.1.6 测试</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration("classpath:applicationContext.xml")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TargetInterface target;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>{</span><br><span class="line">    target.method();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol><li><p>测试结果</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">前置代码增强.....</span><br><span class="line">Target running....</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id="3-2-注解配置-AOP-详解">3.2 注解配置 AOP 详解</h2><h3 id="3-2-1-注解通知的类型">3.2.1 注解通知的类型</h3><blockquote><p>通知的配置语法：@通知注解(“切点表达式")</p></blockquote><table><thead><tr><th>名称</th><th>注解</th><th>说明</th></tr></thead><tbody><tr><td>前置通知</td><td>@Before</td><td>用于配置前置通知。指定增强的方法在切入点方法之前执行</td></tr><tr><td>后置通知</td><td>@AfterReturning</td><td>用于配置后置通知。指定增强的方法在切入点方法之后执行</td></tr><tr><td>环绕通知</td><td>@Around</td><td>用于配置环绕通知。指定增强的方法在切入点方法之前和之后都执行</td></tr><tr><td>异常抛出通知</td><td>@AfterThrowing</td><td>用于配置异常抛出通知。指定增强的方法在出现异常时执行</td></tr><tr><td>最终通知</td><td>@After</td><td>用于配置最终通知。无论增强方式执行是否有异常都会执行</td></tr></tbody></table><h3 id="3-2-2-切点表达式的抽取">3.2.2 切点表达式的抽取</h3><blockquote><p>同 xml 配置 aop 一样，我们可以将切点表达式抽取</p><p>抽取方式是在切面内定义方法</p><p>在该方法上使用@Pointcut 注解定义切点表达式</p><p>然后在在增强注解中进行引用。具体如下：</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component("myAspect")</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> {</span><br><span class="line">    <span class="meta">@Before("MyAspect.myPoint()")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>{</span><br><span class="line">    System.out.println(<span class="string">"前置代码增强....."</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Pointcut("execution(* cn.jyw.aop.*.*(..))")</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myPoint</span><span class="params">()</span>{}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> JavaEE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring(三) IoC和DI注解开发</title>
      <link href="/javaee/spring/spring-san-ji-yu-zhu-jie-fang-shi-pei-zhi/"/>
      <url>/javaee/spring/spring-san-ji-yu-zhu-jie-fang-shi-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h1>1. Spring配置数据源</h1><h2 id="1-1-数据源（连接池）的作用">1.1 数据源（连接池）的作用</h2><ul><li><p>数据源(连接池)是提高程序性能如出现的</p></li><li><p>事先实例化数据源，初始化部分连接资源</p></li><li><p>使用连接资源时从数据源中获取</p></li><li><p>使用完毕后将连接资源归还给数据源</p></li><li><p>常见的数据源(连接池)：DBCP、C3P0、BoneCP、Druid等</p></li></ul><h2 id="1-2-数据源的开发步骤">1.2 数据源的开发步骤</h2><ol><li>导入数据源的坐标和数据库驱动坐标</li><li>创建数据源对象</li><li>设置数据源的基本连接数据</li><li>使用数据源获取连接资源和归还连接资源</li></ol><h2 id="1-3-数据源的手动创建">1.3 数据源的手动创建</h2><ol><li>导入<strong>c3p0</strong>和<strong>druid</strong>的坐标以及导入<strong>mysql</strong>数据库驱动坐标</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">&lt;!-- C3P0连接池 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Druid连接池 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mysql驱动 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>数据源的手动创建</li></ol><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">创建Druid连接池</button></li><li class="tab"><button type="button" data-href="#1-2">创建C3P0连接池</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDruid</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="comment">//创建数据源</span></span><br><span class="line">    <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    <span class="comment">//设置数据库连接参数</span></span><br><span class="line">    dataSource.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">    dataSource.setUrl(<span class="string">"jdbc:mysql://localhost:3306"</span>);</span><br><span class="line">    dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">    dataSource.setPassword(<span class="string">"root"</span>);</span><br><span class="line">    <span class="comment">//获得连接对象</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">    System.out.println(connection);</span><br><span class="line">    connection.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testC3P0</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="comment">//创建数据源</span></span><br><span class="line">    <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">    <span class="comment">//设置数据库连接参数</span></span><br><span class="line">    dataSource.setDriverClass(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">    dataSource.setJdbcUrl(<span class="string">"jdbc:mysql://localhost:3306"</span>);</span><br><span class="line">    dataSource.setUser(<span class="string">"root"</span>);</span><br><span class="line">    dataSource.setPassword(<span class="string">"root"</span>);</span><br><span class="line">    <span class="comment">//获得连接对象</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">    System.out.println(connection);</span><br><span class="line">    connection.close();</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><blockquote><p>但是这种创建连接池高耦合了 用配置文件来解耦</p></blockquote><ol><li>提取jdbc.properties配置文件</li></ol><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/test</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>测试手动创建数据源(加载properties配置文件)</li></ol><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">创建Druid连接池</button></li><li class="tab"><button type="button" data-href="#1-2">创建C3P0连接池</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDruidProperties</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="comment">//加载类路径下的jdbc.properties</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">rb</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">"jdbc"</span>);</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        druidDataSource.setDriverClassName(rb.getString(<span class="string">"jdbc.driver"</span>));</span><br><span class="line">        druidDataSource.setUrl(rb.getString(<span class="string">"jdbc.url"</span>));</span><br><span class="line">        druidDataSource.setUsername(rb.getString(<span class="string">"jdbc.username"</span>));</span><br><span class="line">        druidDataSource.setPassword(rb.getString(<span class="string">"jdbc.password"</span>));</span><br><span class="line">        <span class="type">DruidPooledConnection</span> <span class="variable">connection</span> <span class="operator">=</span> druidDataSource.getConnection();</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">        connection.close();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testC3P0ByProperties</span><span class="params">()</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">    <span class="comment">//加载类路径下的jdbc.properties</span></span><br><span class="line">    <span class="type">ResourceBundle</span> <span class="variable">rb</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">"jdbc"</span>);</span><br><span class="line">    <span class="type">ComboPooledDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>();</span><br><span class="line">    dataSource.setDriverClass(rb.getString(<span class="string">"jdbc.driver"</span>));</span><br><span class="line">    dataSource.setJdbcUrl(rb.getString(<span class="string">"jdbc.url"</span>));</span><br><span class="line">    dataSource.setUser(rb.getString(<span class="string">"jdbc.username"</span>));</span><br><span class="line">    dataSource.setPassword(rb.getString(<span class="string">"jdbc.password"</span>));</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">    System.out.println(connection);</span><br><span class="line">    connection.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-4-Spring配置数据源">1.4 Spring配置数据源</h2><p>可以将DataSource的创建权交由Spring容器去完成</p><ul><li>DataSource有无参构造方法，而Spring默认就是通过无参构造方法实例化对象的</li><li>DataSource要想使用需要通过set方法设置数据库连接信息，而Spring可以通过set方法进行字符串注入</li></ul><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">创建Druid连接池</button></li><li class="tab"><button type="button" data-href="#1-2">创建C3P0连接池</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>测试Spring容器产生数据源对象</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassPathXmlApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> (DataSource) app.getBean(<span class="string">"dataSource"</span>);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">System.out.println(connection);</span><br><span class="line">connection.close();</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>测试Spring容器产生数据源对象</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> (DataSource) </span><br><span class="line">applicationContext.getBean(<span class="string">"dataSource"</span>);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">System.out.println(connection);</span><br><span class="line">connection.close();</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-5-抽取jdbc配置文件">1.5 抽取jdbc配置文件</h2><blockquote><p>applicationContext.xml加载jdbc.properties配置文件获得连接信息。</p><p>首先，需要引入context命名空间和约束路径：</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context="http://www.springframework.org/schema/context"  //命名空间</span><br><span class="line"></span><br><span class="line">http://www.springframework.org/schema/context  </span><br><span class="line"></span><br><span class="line">http://www.springframework.org/schema/context/spring-context.xsd //约束路径</span><br></pre></td></tr></tbody></table></figure>  <div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">创建Druid连接池</button></li><li class="tab"><button type="button" data-href="#1-2">创建C3P0连接池</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">context:property-placeholder location="classpath:jdbc.properties"/&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driver}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">context:property-placeholder location="classpath:jdbc.properties"/&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driver}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>2. Spring注解开发</h1><h2 id="2-1-Spring原始注解">2.1 Spring原始注解</h2><p>Spring是轻代码而重配置的框架，配置比较繁重，影响开发效率</p><p>所以注解开发是一种趋势，注解代替xml配置 文件可以简化配置，提高开发效率</p><blockquote><p>Spring原始注解主要是替代的配置</p></blockquote><table><thead><tr><th>注解</th><th>说明</th></tr></thead><tbody><tr><td><strong><code>@Component</code></strong></td><td>使用在类上用于实例化Bean</td></tr><tr><td><strong><code>@Controller</code></strong></td><td>使用在web层类上用于实例化Bean</td></tr><tr><td><strong><code>@Service</code></strong></td><td>使用在service层类上用于实例化Bean</td></tr><tr><td><strong><code>@Repository</code></strong></td><td>使用在dao层类上用于实例化Bean</td></tr><tr><td><strong><code>@Autowired</code></strong></td><td>使用在字段上用于根据类型依赖注入</td></tr><tr><td><strong><code>@Qualifier</code></strong></td><td>结合@Autowired一起使用用于根据名称进行依赖注入</td></tr><tr><td><strong><code>@Resource</code></strong></td><td>相当于@Autowired+@Qualifier，按照名称进行注入</td></tr><tr><td><strong><code>@Value</code></strong></td><td>注入普通属性</td></tr><tr><td><strong><code>@Scope</code></strong></td><td>标注Bean的作用范围</td></tr><tr><td>@PostConstruct</td><td>使用在方法上标注该方法是Bean的初始化方法</td></tr><tr><td>@PreDestroy</td><td>使用在方法上标注该方法是Bean的销毁方法</td></tr></tbody></table><blockquote><p>使用注解进行开发时，需要在applicationContext.xml中配置组件扫描，作用是指定哪个包及其子包下的Bean 需要进行扫描以便识别使用注解配置的类、字段和方法</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context="http://www.springframework.org/schema/context"</span><br><span class="line"><span class="comment">&lt;!--注解的组件扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.jyw"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>使用 @Compont 或 @Repository 标识UserDaoImpl需要Spring进行实例化</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//相当于&lt;bean id="userDao" class="cn.jyw.dao.impl.UserDaoImpl/&gt;</span></span><br><span class="line"><span class="comment">//@Component("userDao")</span></span><br><span class="line"><span class="meta">@Repository("userDao")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(<span class="string">"save running... ..."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>使用@Compont或@Service标识UserServiceImpl需要Spring进行实例化</p><p>使用@Autowired或者@Autowired+@Qulifier或者@Resource进行userDao的注入</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//相当于&lt;bean id="Service" class="cn.jyw.service.impl.UserServiceImpl"&gt;</span></span><br><span class="line"><span class="comment">//@Component("userService")</span></span><br><span class="line"><span class="meta">@Service("userService")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> {</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//相当于&lt;property name="userDao" ref="userDao"/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//@Autowired  //只写@Autowired也可以注入 按照&lt;数据类型&gt;从Spring容器中进行匹配</span></span><br><span class="line">    <span class="comment">//@Qualifier("userDao") 按照id值从容器中进行匹配但是要结合@Autowired一起使用</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource(name="userDao")</span> <span class="comment">//相当于@Autowired+@Qualifier</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//用注解方式可以不用写 这是配置文件用反射调用set方法进行注入</span></span><br><span class="line">    <span class="comment">/*public void setUserDao(UserDao userDao){</span></span><br><span class="line"><span class="comment">        this.userDao = userDao;</span></span><br><span class="line"><span class="comment">    }*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">    userDao.save(); <span class="comment">//  save running... ...</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>使用@Value进行字符串的注入</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository("userDao")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line">    <span class="meta">@Value("注入普通数据")</span></span><br><span class="line">    <span class="keyword">private</span> String str;</span><br><span class="line">    <span class="meta">@Value("${jdbc.driver}")</span> <span class="comment">//从spring容器中找key为jdbc.driver的值 并注入给下面</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(str); <span class="comment">//注入普通数据</span></span><br><span class="line">        System.out.println(driver); <span class="comment">// com.mysqll.jdbc.Driver</span></span><br><span class="line">        System.out.println(<span class="string">"save running... ..."</span>); <span class="comment">//</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>使用@Scope标注Bean的范围</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Scope("prototype")//产生多个对象</span></span><br><span class="line"><span class="meta">@Scope("singleton")</span> <span class="comment">//产生一个对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line"><span class="comment">//此处省略代码</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>使用@PostConstruct标注初始化方法，使用@PreDestroy标注销毁方法</p><p>调用有这两个方法的时候就会产生效果</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>{</span><br><span class="line">System.out.println(<span class="string">"初始化方法...."</span>);</span><br><span class="line">}</span><br><span class="line"><span class="meta">@PreDestroy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>{</span><br><span class="line">System.out.println(<span class="string">"销毁方法....."</span>);</span><br><span class="line">}   </span><br></pre></td></tr></tbody></table></figure><h2 id="2-2-Spring新注解">2.2 Spring新注解</h2><table><thead><tr><th>注解</th><th>说明</th></tr></thead><tbody><tr><td>@Configuration</td><td>用于指定当前类是一个 Spring 配置类，当创建容器时会从该类上加载注解</td></tr><tr><td>@ComponentScan</td><td>用于指定 Spring 在初始化容器时要扫描的包。 作用和在 Spring 的 xml 配置文件中的<code>&lt;context:component-scan base-package="cn.jyw"/&gt;</code>一样</td></tr><tr><td>@Bean</td><td>使用在方法上，标注将该方法的返回值存储到 Spring 容器中</td></tr><tr><td>@PropertySource</td><td>用于加载.properties 文件中的配置</td></tr><tr><td>@Import</td><td>用于导入其他配置类</td></tr></tbody></table><blockquote><p>相当于xml在配置</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//标志该类是Spring的核心配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//代替&lt;context:component-scan base-package="cn.jyw"/&gt;</span></span><br><span class="line"><span class="meta">@ComponentScan("cn.jyw")</span></span><br><span class="line"><span class="comment">//代替&lt;import resource=""&gt;</span></span><br><span class="line"><span class="meta">@Import({DataSourceConfiguration.class})</span> <span class="comment">//多个类是数组</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringCofiguration</span> {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代替&lt;context:property-placeholder location="jdbc.properties"/&gt;</span></span><br><span class="line"><span class="meta">@PropertySource("classpath:jdbc.properties")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfiguration</span> {</span><br><span class="line">    <span class="meta">@Value("${jdbc.driver}")</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value("${jdbc.url}")</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value("${jdbc.username}")</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value("${jdbc.password}")</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean("dataSource")</span> <span class="comment">//Spring会将当前方法的返回值以指定名称储存到Spring容器中</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">geDataSource</span><span class="params">()</span>{</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">druidDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        druidDataSource.setDriverClassName(driver);</span><br><span class="line">        druidDataSource.setUrl(url);</span><br><span class="line">        druidDataSource.setUsername(username);</span><br><span class="line">        druidDataSource.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ClassPathXmlApplicationContext app = new ClassPathXmlApplicationContext("applicationContext.xml");</span></span><br><span class="line"><span class="type">AnnotationConfigApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringCofiguration.class);</span><br><span class="line"><span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> (DataSource) app.getBean(<span class="string">"dataSource"</span>);</span><br><span class="line"><span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">System.out.println(connection);</span><br><span class="line">connection.close();</span><br></pre></td></tr></tbody></table></figure><h1>3. Spring集成Junit</h1><h2 id="3-1-原始Junit测试Spring的问题">3.1 原始Junit测试Spring的问题</h2><blockquote><p>在测试类中，每个测试方法都有以下两行代码：</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"bean.xml"</span>);</span><br><span class="line"><span class="type">IAccountService</span> <span class="variable">as</span> <span class="operator">=</span> ac.getBean(<span class="string">"accountService"</span>,IAccountService.class);</span><br></pre></td></tr></tbody></table></figure><p>这两行代码的作用是获取容器，如果不写的话，直接会提示空指针异常。所以又不能轻易删掉</p><h2 id="3-2-解决思路">3.2 解决思路</h2><blockquote><p>让SpringJunit负责创建Spring容器，但是需要将配置文件的名称告诉它<br>将需要进行测试Bean直接在测试类中进行注入</p></blockquote><h2 id="3-3-Spring集成Junit步骤">3.3 Spring集成Junit步骤</h2><ol><li>导入spring集成Junit的坐标</li><li>使用@Runwith注解替换原来的运行期</li><li>使用@ContextConfiguration指定配置文件或配置类</li><li>使用@Autowired注入需要测试的对象</li><li>创建测试方法进行测试</li></ol><h2 id="3-4-Spring集成Junit代码实现">3.4 Spring集成Junit代码实现</h2><ol><li>导入spring集成Junit的坐标</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--此处需要注意的是，spring5 及以上版本要求 junit 的版本必须是 4.12 及以上--&gt;</span>   </span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>使用@Runwith注解替换原来的运行期</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringJunitTest</span> {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>使用@ContextConfiguration指定配置文件或配置类</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//加载spring核心配置文件</span></span><br><span class="line"><span class="comment">//@ContextConfiguration(value = {"classpath:applicationContext.xml"})</span></span><br><span class="line"><span class="comment">//加载spring核心配置类</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = {SpringConfiguration.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringJunitTest</span> {</span><br><span class="line">}      </span><br></pre></td></tr></tbody></table></figure><ol start="4"><li>使用@Autowired注入需要测试的对象</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = {SpringConfiguration.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringJunitTest</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol start="5"><li>创建测试方法进行测试</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//@ContextConfiguration("classpath:applicationContext.xml")</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = {SpringConfiguration.class})</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringJunitTest</span> {</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserService</span><span class="params">()</span>{</span><br><span class="line">        userService.save();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring(二) IOC和DI</title>
      <link href="/javaee/spring/spring-er-ioc-he-di/"/>
      <url>/javaee/spring/spring-er-ioc-he-di/</url>
      
        <content type="html"><![CDATA[<h1>1. IOC和DI的基本概念</h1><h2 id="1-1-IOC-Inversion-of-Control-控制反转-：">1.1 IOC(Inversion of Control 控制反转)：</h2><ol><li><p>其思想是反转资源获取的方向。传统的资源查找方式要求组件向容器发起请求查找资源，作为回应，容器适时的返回资源。</p></li><li><p>而应用了 IOC 之后，则是容器主动地将资源推送给它所管理的组件，组件所要做的仅是选择一种合适的方式来接受资源。</p></li><li><p>这种行为也被称为查找的被动形式。这体现的是一种设计思想，而不是具体的实现。</p></li></ol><h2 id="1-2-DI-Dependency-Injection-依赖注入-—-IOC-的另一种表达方式">1.2 DI(Dependency Injection 依赖注入) — IOC 的另一种表达方式</h2><ol><li><p>组件以一些预先定义好的方式(例如: setter 方法)接受来自于容器的资源注入。</p></li><li><p>DI是实现了IOC设计思想的具体行为，spring容器就是通过DI来实现了IOC的设计思想。</p></li><li><p>依赖注入的目的并不是给应用程序带来更多的功能,而是为了提升组件的重用频率,并为系统搭建一个灵活、可扩展的平台。通过依赖注入机制,我们只要通过简单的配置就可指定目标需要的资源,完成自身的业务逻辑,而不需要关心具体的资源来自何处,由谁实现。</p></li></ol><h1>2. Spring配置文件</h1><h2 id="2-1-Bean标签基本配置">2.1 Bean标签基本配置</h2><p>用于配置<strong>对象交由Spring 来创建</strong>。</p><p>默认情况下它调用的是类中的<strong>无参构造函数</strong>，如果没有无参构造函数则不能创建成功。</p><p>基本属性： id：Bean实例在Spring容器中的唯一标识   class：Bean的全限定名称</p><h2 id="2-2-Bean标签范围配置">2.2 Bean标签范围配置</h2><p>scope：指对象的作用范围，取值如下：</p><table><thead><tr><th>取值范围</th><th>说明</th></tr></thead><tbody><tr><td>singleton</td><td>默认的,单列的</td></tr><tr><td>prototype</td><td>多例的</td></tr><tr><td>request</td><td>WEB 项目中，Spring 创建一个 Bean 的对象，将对象存入到 request 域中</td></tr><tr><td>session</td><td>WEB 项目中，Spring 创建一个 Bean 的对象，将对象存入到 session 域中</td></tr><tr><td>global session</td><td>WEB 项目中，应用在 Portlet 环境，如果没有 Portlet 环境那么globalSession 相当 于 session</td></tr></tbody></table><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">singleton</button></li><li class="tab"><button type="button" data-href="#1-2">prototype</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>Bean的实例化个数：1个</p><p>Bean的实例化时机：当Spring核心文件被加载时，实例化配置的Bean实例</p><p>Bean的生命周期：</p><ul><li><p>对象创建：当应用加载，创建容器时，对象就被创建了</p></li><li><p>对象运行：只要容器在，对象一直活着</p></li><li><p>对象销毁：当应用卸载，销毁容器时，对象就被销毁了</p></li></ul><p>示例</p>  <figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.impl.UserDaoImpl"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">            <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao1</span> <span class="operator">=</span> (UserDao) applicationContext.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao2</span> <span class="operator">=</span> (UserDao) applicationContext.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">    System.out.println(userDao1);</span><br><span class="line">    System.out.println(userDao2);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>结果</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserDaoImpl对象创建</span><br><span class="line">cn.jyw.impl.UserDaoImp@4abdb505</span><br><span class="line">cn.jyw.impl.UserDaoImp@4abdb505</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>Bean的实例化个数：多个</p><p>Bean的实例化时机：当调用getBean()方法时实例化Bean</p><p>Bean的生命周期：</p><ul><li><p>对象创建：当使用对象时，创建新的对象实例</p></li><li><p>对象运行：只要对象在使用中，就一直活着</p></li><li><p>对象销毁：当对象长时间不用时，被 Java 的垃圾回收器回收了</p></li></ul><p>示例</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.impl.UserDaoImpl"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">            <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao1</span> <span class="operator">=</span> (UserDao) applicationContext.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao2</span> <span class="operator">=</span> (UserDao) applicationContext.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">    System.out.println(userDao1);</span><br><span class="line">    System.out.println(userDao2);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>结果</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UserDaoImpl对象创建</span><br><span class="line">UserDaoImpl对象创建</span><br><span class="line">cn.jyw.impl.UserDaoImpl@587d1d39</span><br><span class="line">cn.jyw.impl.UserDaoImpl@58c1670b</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-3-Bean生命周期配置">2.3 Bean生命周期配置</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.impl.UserDaoImpl"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"destroy"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li><p><em><strong>init-method</strong></em>：指定类中的初始化方法名称</p><p>创建对象后 执行init方法</p></li><li><p><em><strong>destroy-method</strong></em>：指定类中销毁方法名称</p><p>销毁之前执行 destroy方法</p></li></ul><p>ClassPathXmlApplicationContext.close 销毁执行</p><h2 id="2-4-Bean实例化三种方式">2.4 Bean实例化三种方式</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">使用无参构造方法实例化</button></li><li class="tab"><button type="button" data-href="#1-2">工厂静态方法实例化</button></li><li class="tab"><button type="button" data-href="#1-3">工厂实例方法实例化</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>它会根据默认无参构造方法来创建类对象，如果bean中没有默认无参构造函数，将会创建失败</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.impl.UserDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>工厂的静态方法返回Bean实例</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticFactory</span> {</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">static</span> UserDao <span class="title function_">getUserDao</span><span class="params">()</span>{</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImp</span>();</span><br><span class="line">       }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.factory.StaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getUserDao"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">            <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao1</span> <span class="operator">=</span> (UserDao) applicationContext.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">    System.out.println(userDao1);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserDaoImpl对象创建</span><br><span class="line">cn.jyw.impl.UserDaoImpl@13c27452</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-3"><p>由于工厂是不是静态方法 无法在创建时就使用方法 所以在使用工厂方法前需要先创建工厂</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticFactory</span> {</span><br><span class="line">    <span class="keyword">public</span> UserDao <span class="title function_">getUserDao</span><span class="params">()</span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"factory"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.factory.StaticFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">factory-bean</span>=<span class="string">"factory"</span> <span class="attr">factory-method</span>=<span class="string">"getUserDao"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">            <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao1</span> <span class="operator">=</span> (UserDao) applicationContext.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">    System.out.println(userDao1);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserDaoImpl对象创建</span><br><span class="line">cn.jyw.impl.UserDaoImpl@13c27452</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>3. Bean的依赖注入(DI)入门</h1><ol><li>创建UserService，UserService 内部在调用 UserDao的save() 方法</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> {</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> (UserDao)applicationContext.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">userDao.save();</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>将 UserServiceImpl 的创建权交给 Spring</li></ol><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.service.impl.UserServiceImpl"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>从 Spring 容器中获得 UserService 进行操作</li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> </span><br><span class="line"><span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService)applicationContext.getBean(<span class="string">"userService"</span>);</span><br><span class="line">userService.save();</span><br></pre></td></tr></tbody></table></figure><h2 id="3-1-Bean的依赖注入分析">3.1 Bean的依赖注入分析</h2><p>​目前UserService实例和UserDao实例都存在与Spring容器中，当前的做法是在容器外部获得UserService 实例和UserDao实例，然后在程序中进行结合。</p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Bean%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%88%86%E6%9E%90.png" alt="Bean的依赖注入分析"></p><p>​因为UserService和UserDao都在Spring容器中，而最终程序直接使用的是UserService，所以可以在 Spring容器中，将UserDao设置到UserService内部。</p><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Bean%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86.png" alt="Bean的依赖注入原理"></p><h2 id="3-2-Bean的依赖注入概念">3.2 Bean的依赖注入概念</h2><p>依赖注入（<em><strong>Dependency Injection</strong></em>）：它是 Spring 框架核心 IOC 的具体实现。</p><p>在编写程序时，通过控制反转，把对象的创建交给了 Spring，但是代码中不可能出现没有依赖的情况。</p><p>IOC 解耦只是降低他们的依赖关系，但不会消除。</p><p>例如：<strong>业务层</strong>仍会<strong>调用持久层</strong>的方法。</p><p>那这种业务层和持久层的依赖关系，在使用 Spring 之后，就让 Spring 来维护了。</p><p><strong>简单的说，就是坐等框架把持久层对象传入业务层，而不用我们自己去获取</strong></p><h2 id="3-3-Bean的依赖注入方式">3.3 Bean的依赖注入方式</h2><ul><li>构造方法</li><li>set方法</li></ul><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">属性注入(set方法注入)</button></li><li class="tab"><button type="button" data-href="#1-2">构造方法注入</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p>属性注入是最常用的注入方式，通过 setter方法注入Bean 的属性值或依赖的对象。属性注入使用 <code>&lt;property&gt; </code>元素, 使用 name 属性指定 Bean 的属性名称，value 属性或<code>&lt;value&gt;</code>子节点指定属性值</p><p>在UserServiceImpl中添加setUserDao方法</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> {</span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> {</span><br><span class="line"><span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">}</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">userDao.save();</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>配置Spring容器调用set方法进行注入</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.dao.impl.UserDaoImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.service.impl.UserServiceImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userDao"</span> <span class="attr">ref</span>=<span class="string">"userDao"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>P命名空间注入本质也是set方法注入，但比起上述的set方法注入更加方便，主要体现在配置文件中，如下： 首先，需要引入P命名空间：</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xmlns:p="http://www.springframework.org/schema/p"</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.service.impl.UserServiceImpl"</span> <span class="attr">p:userDao-ref</span>=<span class="string">"userDao"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><p>通过构造方法注入Bean 的属性值或依赖的对象，它保证了 Bean 实例在实例化后就可以使用。构造器注入在 <code>&lt;constructor-arg&gt;</code> 元素里声明属性, <code>&lt;constructor-arg&gt; </code>中没有 name 属性，可以按索引匹配入参，也可以按类型匹配入参</p><p>创建有参构造</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> {</span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    pub1ic <span class="title function_">UserServiceImpl</span><span class="params">(UserDao userDao)</span> {</span><br><span class="line">        <span class="built_in">this</span>. userDao = userDao;</span><br><span class="line">    }</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">userDao.save();</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>配置Spring容器调用有参构造时进行注入</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.dao.impl.UserDaoImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.service.impl.UserServiceImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"userDao"</span> <span class="attr">ref</span>=<span class="string">"userDao"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="3-4-Bean的依赖注入的数据类型">3.4 Bean的依赖注入的数据类型</h2><div class="tabs" id="2"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#2-1">普通数据类型注入</button></li><li class="tab"><button type="button" data-href="#2-2">集合数据类型（List）的注入</button></li><li class="tab"><button type="button" data-href="#2-3">集合数据类型（ Map ）的注入</button></li><li class="tab"><button type="button" data-href="#2-4">集合数据类型（Properties）的注入</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="2-1"><p>可用字符串表示的值，可以通过 <value> 元素标签或 value 属性进行注入</value></p><p>基本数据类型及其封装类、String 等类型都可以采取字面值注入的方式</p><p>若字面值中包含特殊字符（会使用到xml文件中的一些专用字符），可以使用 <code>&lt;![CDATA[]]&gt; </code>把字面值包裹起来</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line"><span class="keyword">private</span> String company;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCompany</span><span class="params">(String company)</span> {</span><br><span class="line"><span class="built_in">this</span>.company = company;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> {</span><br><span class="line"><span class="built_in">this</span>.age = age;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">System.out.println(company+<span class="string">"==="</span>+age);</span><br><span class="line">System.out.println(<span class="string">"UserDao save method running...."</span>);</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.dao.impl.UserDaoImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"company"</span> <span class="attr">value</span>=<span class="string">"哈哈哈哈"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"15"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2-2"><p>配置 java.util.List 类型的属性, 需要指定 <code>&lt;list&gt;</code> 标签, 在标签里包含一些元素.</p><p>这些标签可以通过 <code>&lt;value&gt; </code>指定简单的常量值, 通过 <code>&lt;ref&gt; </code>指定对其他 Bean 的引用</p><p>通过<code>&lt;bean&gt;</code> 指定内置 Bean 定义. 通过 <code>&lt;null/&gt;</code> 指定空元素. 甚至可以内嵌其他集合。</p><p>数组的定义和 List 一样, 都使用 <code>&lt;list&gt;</code></p><p>配置 java.util.Set 需要使用<code> &lt;set&gt;</code> 标签, 定义元素的方法与 List 一样</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; strList;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStrList</span><span class="params">(List&lt;String&gt; strList)</span> {</span><br><span class="line">    <span class="built_in">this</span>.strList = strList;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(strList);</span><br><span class="line">    System.out.println(<span class="string">"UserDao save method running...."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.dao.impl.UserDaoImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"strList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p><strong>集合数据类型对象（List）的注入</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; userList;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserList</span><span class="params">(List&lt;User&gt; userList)</span> {</span><br><span class="line">    <span class="built_in">this</span>.userList = userList;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(userList);</span><br><span class="line">    System.out.println(<span class="string">"UserDao save method running...."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"u1"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.pojo.User"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"u2"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.pojo.User"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.dao.impl.UserDaoImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"u1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"u2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2-3"><p>Java.util.Map 通过 <code>&lt;map&gt; </code>标签定义, <code>&lt;map&gt;</code> 标签里可以使用多个 <code>&lt;entry&gt;</code> 作为子标签. 每个条目包含一个键和一个值.。</p><p>必须在 <code>&lt;key&gt;</code> 标签里定义键。</p><p>因为键和值的类型没有限制, 所以可以自由地为它们指定<code> &lt;value&gt;</code>, <code>&lt;ref&gt;</code>, <code>&lt;bean&gt;</code> 或 <code>&lt;null&gt; </code>元素.。</p><p>可以将 Map 的键和值作为 <code>&lt;entry&gt; </code>的属性定义: 简单常量使用 key 和 value 来定义; Bean 引用通过 key-ref 和 value-ref 属性定义。</p><p>使用 <code>&lt;props&gt;</code> 定义 java.util.Properties, 该标签使用多个 <prop> 作为子标签。 每个 <prop> 标签必须定义 key 属性</prop></prop></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,User&gt; userMap;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserMap</span><span class="params">(Map&lt;String, User&gt; userMap)</span> {</span><br><span class="line">    <span class="built_in">this</span>.userMap = userMap;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">        System.out.println(userMap);</span><br><span class="line">        System.out.println(<span class="string">"UserDao save method running...."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"u1"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.pojo.User"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"u2"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.pojo.User"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.dao.impl.UserDaoImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"user1"</span> <span class="attr">value-ref</span>=<span class="string">"u1"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"user2"</span> <span class="attr">value-ref</span>=<span class="string">"u2"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="2-4"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> {</span><br><span class="line">    <span class="built_in">this</span>.properties = properties;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">    System.out.println(properties);</span><br><span class="line">    System.out.println(<span class="string">"UserDao save method running...."</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.dao.impl.UserDaoImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"p1"</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"p2"</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"p3"</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="3-5-Bean的自动装配">3.5 Bean的自动装配</h2><p>Spring IOC 容器可以自动装配 Bean。需要做的仅仅是在 <code>&lt;bean&gt;</code>的 autowire 属性里指定自动装配的模式</p><ol><li>byType(根据类型自动装配): 若 IOC 容器中有多个与目标 Bean 类型一致的 Bean. 在这种情况下, Spring 将无法判定哪个 Bean 最合适该属性, 所以不能执行自动装配</li><li>byName(根据名称自动装配): 必须将目标 Bean 的名称和属性名设置的完全相同。</li><li>constructor(通过构造器自动装配): 当 Bean 中存在多个构造器时, 此种自动装配方式将会很复杂. 不推荐使用</li><li>在 Bean 配置文件里设置 autowire 属性进行自动装配将会装配 Bean 的所有属性. 然而, 若只希望装配个别属性时, autowire 属性就不够灵活了</li><li>autowire 属性要么根据类型自动装配, 要么根据名称自动装配, 不能两者兼而有之</li><li>一般情况下，在实际的项目中很少使用自动装配功能，因为和自动装配功能所带来的好处比起来，明确清晰的配置文档更有说服力一些</li></ol><h2 id="3-6-Bean-的作用域">3.6 Bean 的作用域</h2><ol><li><p>在 Spring 中, 可以在 <code>&lt;bean&gt;</code> 元素的 <code>scope</code> 属性里设置 Bean 的作用域。</p></li><li><p>默认情况下, Spring 只为每个在 IOC 容器里声明的 Bean 创建唯一一个实例</p><p>整个 IOC 容器范围内都能共享该实例，所有后续的 getBean() 调用和 Bean 引用都将返回这个唯一的 Bean 实例</p><p>该作用域被称为 singleton, 它是所有 Bean 的默认作用域。</p></li></ol><h2 id="3-7-使用外部属性文件">3.7 使用外部属性文件</h2><ol><li><p>在配置文件里配置 Bean 时, 有时需要在 Bean 的配置里混入系统部署的细节信息(例如: 文件路径, 数据源配置信息等)。 而这些部署细节实际上需要和 Bean 配置相分离。</p></li><li><p>可通过 &lt; context:property-placeholder&gt; 元素来加载属性文件（.properties）中的属性值</p></li><li><p>Spring 允许在value属性中使用 ${propName}，以实现属性之间的相互引用</p></li></ol><p>​&lt;context:property-placeholder location=“classpath:jdbc.properties”/&gt;</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入属性文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context</span> <span class="attr">:</span> <span class="attr">property-placeholder</span> <span class="attr">location</span>= <span class="string">"classpath:db.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>= <span class="string">"dataSource"</span> <span class="attr">class</span>= <span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用外部化属性文件的属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"${user}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${password}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"${driverclass}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"${jdbcurl}"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h2 id="3-8-引入其他配置文件（分模块开发）">3.8 引入其他配置文件（分模块开发）</h2><p>实际开发中，Spring的配置内容非常多，这就导致Spring配置很繁杂且体积很大，所以，可以将部分配置拆解到其他配置文件中，而在Spring主配置文件通过import标签进行加载</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"applicationContext-xxx.xml"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="3-9-Bean-的生命周期">3.9 Bean 的生命周期</h2><blockquote><p>Spring IOC容器可以管理Bean的生命周期, Spring 允许在 Bean 生命周期的特定点执行定制的任务。</p></blockquote><blockquote><p>Spring IOC 容器对 Bean 的生命周期进行管理的过程:</p></blockquote><ol><li>通过构造器或工厂方法创建 Bean 实例</li><li>为 Bean 的属性设置值和对其他 Bean 的引用</li><li>调用 Bean 的初始化方法</li><li>Bean 可以使用了</li><li>当容器关闭时, 调用 Bean 的销毁方法</li><li>在Bean的声明里设置 init-method 和 destroy-method 属性, 为 Bean 指定初始化和销毁方法</li></ol><blockquote><p>Bean的完整生命周期经历了各种方法调用，这些方法可以划分为以下几类：</p></blockquote><ol><li>Bean自身的方法：<br>这个包括了Bean本身调用的方法和通过配置文件中<code>&lt;bean&gt;</code>的init-method和destroy-method指定的方法。</li><li>Bean级生命周期接口方法：　　<br>这个包括了<strong>BeanNameAware</strong>、<strong>BeanFactoryAware</strong>、<strong>InitializingBean</strong>和<strong>DiposableBean</strong>这些接口的方法。</li><li>容器级生命周期接口方法：<br>这个包括了<strong>InstantiationAwareBeanPostProcessor</strong> 和 <strong>BeanPostProcessor</strong> 这两个接口实现，一般称它们的实现类为“后处理器”。</li><li>工厂后处理器接口方法：<br>这个包括了<strong>AspectJWeavingEnabler</strong>, <strong>ConfigurationClassPostProcessor</strong>, <strong>CustomAutowireConfigurer</strong>等等非常有用的工厂后处理器接口的方法。工厂后处理器也是容器级的。在应用上下文装配配置文件之后立即调用</li></ol><blockquote><p>创建 Bean 后置处理器</p></blockquote><ol><li><p>Bean 后置处理器允许在调用初始化方法前后对 Bean 进行额外的处理</p></li><li><p>Bean 后置处理器对 IOC 容器里的所有 Bean 实例逐一处理, 而非单一实例.</p><p>其典型应用是: 检查 Bean 属性的正确性或根据特定的标准更改 Bean 的属性。</p></li><li><p>对Bean 后置处理器而言, 需要实现接口（BeanPostProcessor）</p><p>在初始化方法被调用前后, Spring 将把每个 Bean 实例分别传递给上述接口的以下两个方法:</p><p>Object <em><strong>postProcessAfterInitialization</strong></em> (Object bean,String bname)</p><p>Object <em><strong>postProcessBeforeInitialization</strong></em> (Object bean,String bname)</p></li></ol><blockquote><p>添加 Bean 后置处理器后 Bean 的生命周期<br>Spring IOC 容器对 Bean 的生命周期进行管理的过程:</p></blockquote><ol><li><p>通过构造器或工厂方法创建 Bean 实例;</p></li><li><p>为 Bean 的属性设置值和对其他 Bean 的引用;</p></li><li><p>将Bean例传递给Bean后置处理器的 <em><strong>postProcessBeforeInitialization</strong></em> 方法;</p></li><li><p>调用 Bean 的初始化方法;</p></li><li><p>将Bean实例传递给Bean后置处理器的<em><strong>postProcessAfterInitialization</strong></em>方法;</p></li><li><p>Bean 可以使用了</p></li><li><p>当容器关闭时, 调用 Bean 的销毁方法</p></li></ol><p>后置处理器主要应用在spring容器的底层，spring容器的原生AOP要使用它实现对Bean的切面编程</p><h2 id="Spring的重点配置">Spring的重点配置</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span>&gt;</span>标签</span><br><span class="line">    id属性:在容器中Bean实例的唯一标识，不允许重复</span><br><span class="line">    class属性:要实例化的Bean的全限定名</span><br><span class="line">    scope属性:Bean的作用范围，常用是Singleton(默认)和prototype</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span>标签：属性注入</span><br><span class="line">        name属性：属性名称</span><br><span class="line">        value属性：注入的普通属性值</span><br><span class="line">        ref属性：注入的对象引用值</span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span>标签</span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span>标签</span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span>标签</span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span>标签</span><br><span class="line"><span class="tag">&lt;<span class="name">import</span>&gt;</span>标签:导入其他的Spring的分文件</span><br></pre></td></tr></tbody></table></figure><h1>4. Spring相关API</h1><h2 id="4-1-ApplicationContext的继承体系">4.1 ApplicationContext的继承体系</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/ClassPathXmlApplicationContext.png" alt="ClassPathXmlApplicationContext"></p><p>Spring 提供了两种类型的 IOC 容器实现：</p><ul><li><p><strong>BeanFactory: IOC</strong> 容器的基本实现，是 Spring 框架的基础设施，面向 Spring 本身</p></li><li><p><strong>ApplicationContext</strong>:供了更多的高级特性. 是 BeanFactory 的子接口，面向使用 Spring 框架的开发者，几乎所有的应用场合都直接使用 ApplicationContext 而非底层的 BeanFactory，无论使用何种方式, 配置文件是相同的</p></li></ul><h2 id="4-2-ApplicationContext的实现类">4.2 ApplicationContext的实现类</h2><p><em><strong>applicationContext</strong></em>：接口类型，代表应用上下文，可以通过其实例获得 Spring 容器中的 Bean 对象</p><ol><li><p><em><strong>ClassPathXmlApplicationContext</strong></em></p><p>它是从类的根路径下加载配置文件 推荐使用这种</p></li><li><p><em><strong>FileSystemXmlApplicationContext</strong></em></p><p>它是从磁盘路径上加载配置文件，配置文件可以在磁盘的任意位置。</p></li><li><p><em><strong>AnnotationConfigApplicationContext</strong></em></p><p>当使用注解配置容器对象时，需要使用此类来创建 spring 容器。它用来读取注解。</p></li><li><p><em><strong>ConfigurableApplicationContext</strong></em></p><p>扩展于 ApplicationContext，新增加两个主要方法：refresh() 和 close()， 让 ApplicationContext 具有启动、刷新和关闭上下文的能力</p></li><li><p><em><strong>WebApplicationContext</strong></em></p><p>是专门为**<code>WEB</code>**应用而准备的，它允许从相对于 WEB 根目录的路径中完成初始化工作</p></li></ol><h2 id="4-3-getBean-方法使用">4.3 getBean()方法使用</h2><p>getBean()的源码</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">    assertBeanFactoryActive();</span><br><span class="line">    <span class="keyword">return</span> getBeanFactory().getBean(name);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException {</span><br><span class="line">    assertBeanFactoryActive();</span><br><span class="line">    <span class="keyword">return</span> getBeanFactory().getBean(requiredType);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其中，当参数的数据类型是字符串时，表示根据Bean的id从容器中获得Bean实例，返回是Object，需要强转。 当参数的数据类型是Class类型时，表示根据类型从容器中匹配Bean实例，当容器中相同类型的Bean有多个时， 则此方法会报错</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> </span><br><span class="line">    <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService1</span> <span class="operator">=</span> (UserService) </span><br><span class="line">applicationContext.getBean(<span class="string">"userService"</span>);</span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService2</span> <span class="operator">=</span> applicationContext.getBean(UserService.class);</span><br></pre></td></tr></tbody></table></figure><h2 id="4-4-Spring的重点API">4.4 Spring的重点API</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClasspathXmlApplicationContext</span>(<span class="string">"xml文件"</span>)</span><br><span class="line">app.getBean(<span class="string">"id"</span>)</span><br><span class="line">app.getBean(Class)</span><br></pre></td></tr></tbody></table></figure><p>当容器中某一类型的对象有多个 用不同的id获取</p><p>有一个可以用.class获取</p>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring(一) Spring的入门概念</title>
      <link href="/javaee/spring/spring-yi-spring-de-ru-men-gai-nian/"/>
      <url>/javaee/spring/spring-yi-spring-de-ru-men-gai-nian/</url>
      
        <content type="html"><![CDATA[<h1>1. Spring简介</h1><h2 id="1-1-Spring是什么">1.1 Spring是什么</h2><p>Spring是分层的 Java SE/EE应用 full-stack 轻量级开源框架，以 <em><strong>IOC</strong></em>（Inverse Of Control：<strong>反转控制</strong>）和 <em><strong>AOP</strong></em>（Aspect Oriented Programming：<strong>面向切面编程</strong>）为内核。</p><p>提供了<strong>展现层 SpringMVC</strong> 和<strong>持久层 Spring JDBCTemplate</strong> 以及<strong>业务层事务管理</strong>等众多的企业级应用技术 ，还能整合开源世界众多著名的第三方框架和类库，逐渐成为使用最多的Java EE 企业应用开源框架</p><h2 id="1-2-Spring的优势">1.2 Spring的优势</h2><ol><li>方便解耦，简化开发</li></ol><blockquote><p>通过 Spring 提供的 <strong><strong><strong>IoC</strong></strong></strong>容器，可以将对象间的依赖关系交由 Spring 进行控制，避免硬编码所造成的过度耦合。 用户也不必再为单例模式类、属性文件解析等这些很底层的需求编写代码，可以更专注于上层的应用。</p></blockquote><ol start="2"><li><em><strong>AOP</strong></em> 编程的支持</li></ol><blockquote><p>通过 Spring的 <em><strong>AOP</strong></em> 功能，方便进行面向切面编程，许多不容易用传统 OOP 实现的功能可以通过 <em><strong>AOP</strong></em> 轻松实现。</p></blockquote><ol start="3"><li>声明式事务的支持</li></ol><blockquote><p>可以将我们从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活的进行事务管理，提高开发效率和质量。</p></blockquote><ol start="4"><li>方便程序的测试</li></ol><blockquote><p>可以用非容器依赖的编程方式进行几乎所有的测试工作，测试不再是昂贵的操作，而是随手可做的事情。</p></blockquote><ol start="5"><li>方便集成各种优秀框架</li></ol><blockquote><p>Spring对各种优秀框架（Struts、Hibernate、Hessian、Quartz等）的支持。</p></blockquote><ol start="6"><li>降低 JavaEE API 的使用难度</li></ol><blockquote><p>Spring对 JavaEE API（如 JDBC、JavaMail、远程调用等）进行了薄薄的封装层，使这些 API 的使用难度大为降低。</p></blockquote><ol start="7"><li>Java 源码是经典学习范例</li></ol><blockquote><p>Spring的源代码设计精妙、结构清晰、匠心独用，处处体现着大师对Java 设计模式灵活运用以及对 Java技术的高深 造诣。它的源代码无意是 Java 技术的最佳实践的范例。</p></blockquote><h2 id="1-3-Spring的相关描述">1.3 Spring的相关描述</h2><ol><li><p>轻量级</p><p>Spring 是非侵入性的 - 基于 Spring 开发的应用中的对象可以不依赖于 Spring 的 API。</p></li><li><p>依赖注入(DI — dependency injection、IOC)</p></li><li><p>面向切面编程(AOP — aspect oriented programming)</p></li><li><p>容器</p><p>Spring 是一个容器, 因为它包含并且管理应用对象的生命周期。</p></li><li><p>框架</p><p>Spring 实现了使用简单的组件配置组合成一个复杂的应用。在 Spring 中可以使用 XML 和 Java 注解组合这些对象。</p></li><li><p>一站式</p><p>在 IOC 和 AOP 的基础上可以整合各种企业应用的开源框架和优秀的第三方类库 （实际上 Spring</p><p>自身也提供了展现层的 SpringMVC 和 持久层的 Spring JDBC）。</p></li></ol><h2 id="1-4-Spring的体系结构">1.4 Spring的体系结构</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Spring%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png" alt="Spring的体系结构"></p><h1>2. Spring快速入门</h1><h2 id="2-1-Spring程序开发步骤">2.1 Spring程序开发步骤</h2><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Spring%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4.png" alt="Spring程序开发步骤"></p><ol><li>导入 Spring 开发的基本包坐标</li><li>编写 Dao 接口和实现类</li><li>创建 Spring 核心配置文件</li><li>创建 Spring 核心配置文件</li><li>使用 Spring 的 API 获得 Bean 实例</li></ol><h2 id="2-2-导入Spring开发的基本包坐标">2.2 导入Spring开发的基本包坐标</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--导入spring的context坐标，context依赖core、beans、expression--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-3-编写Dao接口和实现类">2.3 编写Dao接口和实现类</h2><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">接口</button></li><li class="tab"><button type="button" data-href="#1-2">实现类</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> {</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="1-2"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> {</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> {</span><br><span class="line">System.out.println(<span class="string">"UserDao save method running...."</span>);</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-4-创建Spring核心配置文件">2.4 创建Spring核心配置文件</h2><div class="note info flat"><p>在类路径下（resources）创建applicationContext.xml配置文件</p></div><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-5-在Spring配置文件中配置UserDaoImpl">2.5 在Spring配置文件中配置UserDaoImpl</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"cn.jyw.impl.UserDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="2-6-使用Spring的API获得Bean实例">2.6 使用Spring的API获得Bean实例</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> </span><br><span class="line">            <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> (UserDao) applicationContext.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">    userDao.save();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="Spring的开发步骤">Spring的开发步骤</h2><ol><li>导入坐标</li><li>创建Bean</li><li>创建applicationContext.xml</li><li>在配置文件中进行配置</li><li>创建ApplicationContext对象getBean</li></ol>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>blog美化记录</title>
      <link href="/blog/blog-mei-hua/bolg-mei-hua-ji-lu/"/>
      <url>/blog/blog-mei-hua/bolg-mei-hua-ji-lu/</url>
      
        <content type="html"><![CDATA[<h2 id="第一次优化">第一次优化</h2><div class="tabs" id="test"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test-1">添加emoji表情支持（可选的）</button></li><li class="tab"><button type="button" data-href="#test-2">代码高亮</button></li><li class="tab"><button type="button" data-href="#test-3">搜索</button></li><li class="tab"><button type="button" data-href="#test-4">中文链接转拼音（可选的）</button></li><li class="tab"><button type="button" data-href="#test-5">文章字数统计插件 （可选的）</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test-1"><h3 id="1-添加emoji表情支持（可选的）">1. 添加emoji表情支持（可选的）</h3><p><strong>本主题新增了对emoji表情的支持，使用到了 hexo-filter-github-emojis 的 Hexo 插件来支持 emoji表情的生成，把对应的markdown emoji语法（::,例如：<span class="github-emoji"><span>😄</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>）转变成会跳跃的emoji表情</strong> <strong>安装命令如下：</strong></p><figure class="highlight cmd"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-filter-github-emojis --save</span><br></pre></td></tr></tbody></table></figure><p>在 Hexo 根目录下的 _config.yml 文件中，新增以下的配置项：</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">githubEmojis:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">className:</span> <span class="string">github-emoji</span></span><br><span class="line">  <span class="attr">inject:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">styles:</span></span><br><span class="line">  <span class="attr">customEmojis:</span></span><br></pre></td></tr></tbody></table></figure><p>执行 hexo clean &amp;&amp; hexo g 重新生成博客文件，然后就可以在文章中对应位置看到你用emoji语法写的表情了。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-2"><h3 id="2-代码高亮">2. 代码高亮</h3><p><strong>由于 Hexo 自带的代码高亮主题显示不好看，所以主题中使用到了 <a href="https://github.com/ele828/hexo-prism-plugin">hexo-prism-plugin</a> 的 Hexo 插件来做代码高亮</strong> <strong>安装命令如下:</strong></p><figure class="highlight cmd"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -S hexo-prism-plugin</span><br></pre></td></tr></tbody></table></figure><p>然后，修改 Hexo 根目录下 _config.yml 文件中 highlight.enable 的值为 false，并新增 prism 插件相关的配置，主要配置如下：</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">prism_plugin:</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">'preprocess'</span>    <span class="comment"># realtime/preprocess</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">'tomorrow'</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">false</span>    <span class="comment"># default false</span></span><br><span class="line">  <span class="attr">custom_css:</span></span><br></pre></td></tr></tbody></table></figure><p>当你添加代码块时一定要加上语言的名字不然此功能会无效！</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-3"><h3 id="3-搜索">3. 搜索</h3><p><strong>本主题中还使用到了 <a href="https://github.com/wzpan/hexo-generator-search">hexo-generator-search</a> 的 Hexo 插件来做内容搜索</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-search --save</span><br></pre></td></tr></tbody></table></figure><p>在 Hexo 根目录下的 _config.yml 文件中，新增以下的配置项：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-4"><h3 id="4-中文链接转拼音（可选的）">4. 中文链接转拼音（可选的）</h3><p><strong>如果你的文章名称是中文的，那么 Hexo 默认生成的永久链接也会有中文，这样不利于 SEO，且 gitment 评论对中文链接也不支持。我们可以用 <a href="https://github.com/viko16/hexo-permalink-pinyin">hexo-permalink-pinyin Hexo</a> 插件使在生成文章时生成中文拼音的永久链接</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-permalink-pinyin --save</span><br></pre></td></tr></tbody></table></figure><p>在 Hexo 根目录下的 _config.yml 文件中，新增以下的配置项：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">permalink_pinyin:</span><br><span class="line">  enable: true</span><br><span class="line">  separator: '-' # default: '-'</span><br></pre></td></tr></tbody></table></figure><p>注：除了此插件外，<a href="https://github.com/rozbo/hexo-abbrlink">hexo-abbrlink</a> 插件也可以生成非中文的链接。</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-5"><p><strong>如果你想要在文章中显示文章字数、阅读时长信息，可以安装 <a href="https://github.com/willin/hexo-wordcount">hexo-wordcount</a>插件</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save hexo-wordcount</span><br></pre></td></tr></tbody></table></figure><p>然后只需在本主题下的 _config.yml 文件中，激活以下配置项即可：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wordCount:</span><br><span class="line">  enable: false # 将这个值设置为 true 即可.</span><br><span class="line">  postWordCount: true</span><br><span class="line">  min2read: true</span><br><span class="line">  totalCount: true</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="btn-center"><a class="btn-beautify outline blue larger" href="/blog-mei-hua-yi/" title="详情步骤"><span>详情步骤</span></a></div><h1>第二次优化</h1><div class="tabs" id="test"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test-1">hexo-githubcalendar 插件</button></li><li class="tab"><button type="button" data-href="#test-2">透明特效</button></li><li class="tab"><button type="button" data-href="#test-3">字体样式修改</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test-1"><h3 id="1-hexo-githubcalendar-插件">1. hexo-githubcalendar 插件</h3><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/hexo-githubcalendar%E6%8F%92%E4%BB%B6%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA.png" alt="hexo-githubcalendar 插件 效果演示"></p><blockquote><p>NPM 插件安装的部署方法</p></blockquote><blockquote><p>执行 npm 安装操作</p></blockquote><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo<span class="literal">-githubcalendar</span> <span class="literal">--save</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">cnpm i hexo<span class="literal">-githubcalendar</span> <span class="literal">--save</span></span><br></pre></td></tr></tbody></table></figure><div class="note info flat"><p>注意，一定要加 <code>--save</code>，不然本地预览的时候可能不会显示！！！</p></div><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ice Kano Plus_in</span></span><br><span class="line"><span class="comment"># hexo-githubcalendar 插件 1.0</span></span><br><span class="line"><span class="comment"># Author: Ice Kano</span></span><br><span class="line"><span class="comment"># Modify: Lete乐特 https://zfe.space/post/hexo-githubcalendar.html</span></span><br><span class="line"><span class="attr">githubcalendar:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是否开启插件</span></span><br><span class="line">  <span class="attr">enable_page:</span> <span class="string">/</span> <span class="comment"># 路由地址，如 / 代表主页。/me/ 代表自我介绍页等等</span></span><br><span class="line">  <span class="attr">user:</span> <span class="string">WindAndStill</span> <span class="comment"># 你的 github 或者 gitee 用户名</span></span><br><span class="line">  <span class="attr">layout:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">id</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">recent-posts</span></span><br><span class="line">    <span class="attr">index:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">githubcalendar_html:</span> <span class="string">'&lt;div class="recent-post-item" style="width:100%;height:auto;padding:10px;"&gt;&lt;div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"&gt;&lt;svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"&gt;&lt;path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"&gt;&lt;animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"&gt;&lt;/animateTransform&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/div&gt;&lt;div id="github_container"&gt;&lt;/div&gt;&lt;/div&gt;'</span></span><br><span class="line">  <span class="attr">pc_minheight:</span> <span class="string">280px</span></span><br><span class="line">  <span class="attr">mobile_minheight:</span> <span class="string">0px</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">"['#ebedf0', '#cdeefd', '#9bcffc', '#6ab6fa', '#389df8', '#0889f5', '#0672c4', '#055492', '#033354', '#022d48', '#021f30']"</span></span><br><span class="line">  <span class="attr">api:</span> <span class="string">https://python-github-calendar-api.vercel.app/api</span></span><br><span class="line">  <span class="comment"># api: https://python-gitee-calendar-api.vercel.app/api</span></span><br><span class="line">  <span class="attr">calendar_js:</span> <span class="string">https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js</span></span><br><span class="line">  <span class="attr">plus_style:</span> <span class="string">""</span></span><br></pre></td></tr></tbody></table></figure><p>更多主题配置请前往：<a href="https://github.com/Zfour/hexo-github-calendar/issues">https://github.com/Zfour/hexo-github-calendar/issues</a><br>也欢迎共享自己的配置和进行修改。</p><p>接下来来简单说明一下配置项的含义：</p><blockquote><p>enable</p></blockquote><p>**参数：**true/false<br>**含义：**是否开启插件</p><blockquote><p>enable_page</p></blockquote><p><strong>参数：</strong>/<br>**含义：**路由地址，如 / 代表主页。/me/ 代表自我介绍页等等</p><blockquote><p>user</p></blockquote><p>**参数：**zfour<br>**含义：**你的 github 或者 gitee 用户名</p><blockquote><p>layout</p></blockquote><p>**参数：**type; （class&amp;id）<br>**参数：**name;<br>**参数：**index；（数字）<br>**含义：**如果说 gihubcalendar 是一幅画，那么这个 layout 就是指定了哪面墙来挂画<br>而在 HTML 的是世界里有两种墙分别 type 为 id 和 class。<br>其中在定义 class 的时候会出现多个 class 的情况，这时就需要使用 index，确定是哪一个。<br>最后墙的名字即是 name;</p><blockquote><p>githubcalendar_html</p></blockquote><p>**参数：**html 模板字段<br>**含义：**包含 loading，和挂载容器</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">name</span>=<span class="string">"我是墙"</span> <span class="attr">id</span>=<span class="string">"recent-posts"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- id=&gt;type  recent-posts=&gt;name    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">name</span>=<span class="string">"我是画框"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">name</span>=<span class="string">"我是纸"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--这里通过js挂载githubcalendar，也就是画画--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>githubcalendar_html</p></blockquote><p>**参数：**html 模板字段<br>**含义：**包含 loading，和挂载容器</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"recent-post-item"</span> <span class="attr">style</span>=<span class="string">"width:100%;height:auto;padding:10px;"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--这个是画框，顾名思义就是借用文章样式给加个框--&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--这个是loading的样式，可自行调整--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">id</span>=<span class="string">"github_loading"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">"width:10%;height:100%;margin:0 auto;display: block"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xlink</span>=<span class="string">"http://www.w3.org/1999/xlink"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">viewBox</span>=<span class="string">"0 0 50 50"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">style</span>=<span class="string">"enable-background:new 0 0 50 50"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xml:space</span>=<span class="string">"preserve"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">path</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fill</span>=<span class="string">"#d0d0d0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">d</span>=<span class="string">"M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">transform</span>=<span class="string">"rotate(275.098 25 25)"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">animateTransform</span></span></span><br><span class="line"><span class="tag">          <span class="attr">attributeType</span>=<span class="string">"xml"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">attributeName</span>=<span class="string">"transform"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">type</span>=<span class="string">"rotate"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">from</span>=<span class="string">"0 25 25"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">to</span>=<span class="string">"360 25 25"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">dur</span>=<span class="string">"0.6s"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">repeatCount</span>=<span class="string">"indefinite"</span></span></span><br><span class="line"><span class="tag">        &gt;</span><span class="tag">&lt;/<span class="name">animateTransform</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--这个是github_containner容器，也就是纸--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"github_container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>pc_minheight</p></blockquote><p>**参数：**280px<br>**含义：**电脑端插件的最小高度，减少加载带来的视觉偏移</p><blockquote><p>mobile_minheight</p></blockquote><p>**参数：**0px<br>**含义：**手机端插件的最小高度，减少加载带来的视觉偏移</p><blockquote><p>color</p></blockquote><p><strong>参数：</strong>“[‘#ebedf0’, ‘#fdcdec’, ‘#fc9bd9’, ‘#fa6ac5’, ‘#f838b2’, ‘#f5089f’, ‘#c4067e’, ‘#92055e’, ‘#540336’, ‘#48022f’, ‘#30021f’]”<br>**含义：**calendar 的主题色</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下色调选择喜欢的一行保留即可。其余注释。—————akilar的糖果色</span></span><br><span class="line"><span class="attr">color:</span> <span class="string">"['#e4dfd7', '#f9f4dc', '#f7e8aa', '#f7e8aa', '#f8df72', '#fcd217', '#fcc515', '#f28e16', '#fb8b05', '#d85916', '#f43e06']"</span> <span class="comment">#橘黄色调</span></span><br><span class="line"><span class="comment"># color: "['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f']" #浅紫色调</span></span><br><span class="line"><span class="comment"># color: "['#ebedf0', '#f0fff4', '#dcffe4', '#bef5cb', '#85e89d', '#34d058', '#28a745', '#22863a', '#176f2c', '#165c26', '#144620']" #翠绿色调</span></span><br><span class="line"><span class="comment"># color: "['#ebedf0', '#f1f8ff', '#dbedff', '#c8e1ff', '#79b8ff', '#2188ff', '#0366d6', '#005cc5', '#044289', '#032f62', '#05264c']" #天青色调</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>api</p></blockquote><p>**参数：**<a href="https://python-github-calendar-api.vercel.app/api">https://python-github-calendar-api.vercel.app/api</a><br>或 <a href="https://python-gitee-calendar-api.vercel.app/api">https://python-gitee-calendar-api.vercel.app/api</a><br>**含义：**这里提供的是公用的 api，仅供日常使用，请不要滥用。如果想搭建自用 api，具体的部署方案可看考 <a href="https://github.com/Zfour/python_github_calendar_api">python_github_calendar_api</a> 及 <a href="https://github.com/Zfour/python_gitee_calendar_api">python_gitee_calendar_api</a> 的文档说明，这里不多加赘述。</p><blockquote><p>calendar_js</p></blockquote><p>**参数：**<a href="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js">https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js</a><br>**含义：**jsd 加速的 js，将 github calendar 挂载入容器中<br>**目前已知 bug：**在 1.21 适配 retina 屏幕后虽解决了模糊问题，但部分用户的 tooltip 会出现数据错误。降级到 @1.16 使用即可解决。</p><p>plus_style</p><p><strong>参数：</strong>“”<br>**含义：**提供可自定义的 style</p><p>如果你是 butterfly 主题，你需要修改用户名即可，如果你想在友链或者个人介绍挂载，你可以在 md 中增加墙 —— 也就是具有某一的 id 的 div。因为是在 md 中所以通过去掉 class 隐藏画框的样式，即可。同时需要调整 <code>enable_page</code> 来限定展示的页面。</p><p>如果你是其他主题用户，你可以尝试使用墙 &gt; 画框 &gt; 画的方式挂载，也可以通过修改主题模板来挂载。如<br><a href="https://imciraos.com/posts/353f0aee/">给萌典主题加上 git-calendar</a> 的方法。</p><blockquote><p>hexo 三连</p></blockquote><p>执行 hexo 三连</p><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</span><br></pre></td></tr></tbody></table></figure><p>更多详情请查看</p><div class="btn-center"><a class="btn-beautify outline blue larger" href="https://www.wwru.cn/archives/125" title="大佬的博客"><i class="far fa-hand-point-right"></i><span>大佬的博客</span></a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-2"><h3 id="2-透明特效">2. 透明特效</h3><p><strong><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/%E8%83%8C%E6%99%AF%E4%B8%BB%E9%A2%98.png" alt="背景主题"></strong></p><blockquote><p>首页部分</p></blockquote><p>把横幅图片<code>top_img</code>与背景图<code>background</code>设置成一样的</p><blockquote><p>页脚部分</p></blockquote><p>在<code>footer.styl</code>（位置直接搜索）里的<code>#footer</code>里</p><figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br></pre></td></tr></tbody></table></figure><p>首先在主题配置文件里全部把这些页面的图片值改为<code>false</code></p><blockquote><p>其他页面头部</p></blockquote><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">disable_top_img:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">archive_img:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">tag_img:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">category_img:</span> <span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure><p>然后在<code>head.styl</code>里把<em><strong>background-color: $light-blue</strong></em>注释</p><figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// background-color: $light-blue</span></span><br></pre></td></tr></tbody></table></figure><p>更多详情请查看</p><div class="btn-center"><a class="btn-beautify outline blue larger" href="https://sady0.com/archives/d6cfcb1a.html" title="大佬的博客"><i class="far fa-hand-point-right"></i><span>大佬的博客</span></a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test-3"><h3 id="3-字体样式修改">3. 字体样式修改</h3><ol><li><p>首先需要下载心仪的字体。得到相应的字体文件。为了方便起见，我将其重命名为 <code>Candy.ttf</code>。</p></li><li><p>将下载好的字体包放到本地文件夹下，这里推荐新建一个 <code>fonts</code> 文件夹。例如我是放在 <code>[Blogroot]\themes\butterfly\source\fonts\</code> 目录下。</p></li><li><p>在自定义样式 <code>custom.css</code> 中引入字体包：</p><figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@font-face</span>{</span><br><span class="line">    <span class="attribute">font-family</span>:<span class="string">'Candyhome'</span> ;  <span class="comment">/* 字体名自定义即可 */</span></span><br><span class="line">    <span class="attribute">src</span>:<span class="built_in">url</span>(<span class="string">'/fonts/Candy.ttf'</span>); <span class="comment">/* 字体文件路径 */</span></span><br><span class="line">    <span class="attribute">font-display</span> : swap;</span><br><span class="line">}</span><br><span class="line">  </span><br><span class="line"><span class="selector-tag">body</span>{</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">'Candyhome'</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>更多详情请查看</p></li></ol><div class="btn-center"><a class="btn-beautify outline blue larger" href="https://akilar.top/posts/ebf20e02/" title="大佬的博客"><i class="far fa-hand-point-right"></i><span>大佬的博客</span></a></div><p>1</p><p><strong>更改整体字体</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>第三次优化</h1><div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#1-1">引入全局吸底Aplayer</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="1-1"><p><img src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/Aplayer%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA.png" alt="Aplayer音乐播放器效果展示"></p><ol><li><p>在博客根目录 <code>[Blogroot]</code> 下打开终端，运行以下指令安装 <a href="https://www.npmjs.com/package/hexo-tag-aplayer">hexo-tag-aplayer</a> 插件</p><figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo<span class="literal">-tag-aplayer</span> <span class="literal">--save</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>在站点配置文件 <code>[Blogroot]\_config.yml</code> 中新增配置项，建议直接加在最底下</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># APlayer</span></span><br><span class="line"><span class="comment"># https://github.com/MoePlayer/hexo-tag-aplayer/blob/master/docs/README-zh_cn.md</span></span><br><span class="line"><span class="attr">aplayer:</span></span><br><span class="line">  <span class="attr">meting:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">asset_inject:</span> <span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>修改主题配置文件 <code>[Blogroot]\_config.butterfly.yml</code> 中关于 Aplayer 的配置内容</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inject the css and script (aplayer/meting)</span></span><br><span class="line"><span class="attr">aplayerInject:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>配置成功后会发现 Aplayer 的吸底标签一直占据着左下角的一片空间，对手机端阅读不太友好，可以添加一下 CSS 样式使其自动缩进隐藏。在 <code>[Blogroot]\themes\butterfly\source\css\custom.css</code> 中 (没有这个文件就按照路径自己新建) 添加如下内容</p><figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.aplayer</span><span class="selector-class">.aplayer-fixed</span><span class="selector-class">.aplayer-narrow</span> <span class="selector-class">.aplayer-body</span> {</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">66px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="comment">/* 默认情况下缩进左侧66px，只留一点箭头部分 */</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.aplayer</span><span class="selector-class">.aplayer-fixed</span><span class="selector-class">.aplayer-narrow</span> <span class="selector-class">.aplayer-body</span><span class="selector-pseudo">:hover</span> {</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="comment">/* 鼠标悬停是左侧缩进归零，完全显示按钮 */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>在主题配置文件 <code>[Blogroot]\_config.butterfly.yml</code> 的 inject 配置项中添加 Aplayer 的容器</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">   <span class="attr">head:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel="stylesheet"</span> <span class="string">href="/css/custom.css"</span>  <span class="string">media="defer"</span> <span class="string">onload="this.media='all'"&gt;</span></span><br><span class="line">   <span class="attr">bottom:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">&lt;div</span> <span class="string">class="aplayer</span> <span class="literal">no</span><span class="string">-destroy"</span> <span class="string">data-id="5183531430"</span> <span class="string">data-server="netease"</span> <span class="string">data-type="playlist"</span> <span class="string">data-fixed="true"</span> <span class="string">data-mini="true"</span> <span class="string">data-listFolded="false"</span> <span class="string">data-order="random"</span> <span class="string">data-preload="none"</span> <span class="string">data-autoplay="false"</span> <span class="string">muted&gt;&lt;/div&gt;</span></span><br></pre></td></tr></tbody></table></figure></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>更多详情请查看</p><div class="btn-center"><a class="btn-beautify outline blue larger" href="https://akilar.top/posts" title="大佬的博客(Akilar)"><i class="far fa-hand-point-right"></i><span>大佬的博客(Akilar)</span></a></div><h1>想要添加的功能的功能</h1><p>封面图片加载自动切换</p><p>图册</p><p>live2d</p><p>以及很多</p><h1>先放着以后再写</h1>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
          <category> blog 美化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog美化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaEE中上传图片的方式</title>
      <link href="/javaee/servlet/utils/javaee-zhong-shang-chuan-tu-pian-de-fang-shi/"/>
      <url>/javaee/servlet/utils/javaee-zhong-shang-chuan-tu-pian-de-fang-shi/</url>
      
        <content type="html"><![CDATA[<h1>HTML页面</h1><div class="note info flat"><p>1.要有一个<em><strong>form</strong></em>标签,<em><strong>method=post</strong></em>请求,以及在<em><strong>form</strong></em>标签中使用<em><strong>input type=file</strong></em>添加上传文件</p></div><p>因为传输的带有图片文件 数据会很大 <em><strong>get</strong></em>请求用容量限制 <em><strong>post</strong></em>没有 所以如果需要传输文件就要用<em><strong>post</strong></em>请求</p><div class="note info flat"><p>2.<em><strong>form</strong></em>标签的<em><strong>encType</strong></em>属性必须为<em><strong>multipart/form-data</strong></em></p></div><p>​在http协议中  请求头中有这样一个信息</p><p>Content-Type: <em><strong>multipart/form-data</strong></em>; <em><strong>boundary</strong></em>=----WebKitFormBoundarysrd39rxk51BB2BtB</p><p>Content-Type表示提交的数据类型<br>而<em><strong>encType=multipart/form-data</strong></em>表示提交的数据,以多段(每一个表单项一个数据段)的形式进行拼接,然后<strong>以二进制流的形式发送给服务器</strong><br><em><strong>boundary</strong></em> 表示每段数据的分隔符</p><ol><li>表示数据的开始</li><li>每次都由浏览器随机生成</li><li>结束会再生成一个多了两个-的分隔符</li></ol><h1>导入jar包</h1><p>导入<em><strong>conmons-fileupload.jar</strong></em>  而 这个jar包又依赖于 <em><strong>conmmons-io.jar</strong></em>  所以这两个都要导入</p><div class="note info flat"><p>jar包中常用的类与方法</p></div><p>ServletFileUpload类  , 用于解析上传数据</p><p>Fileltem类，表示每一一个表单项。</p><div class="note info flat"><ul><li>boolean ServletFileUpload.isMultipartContent(HttpServletRequest request);</li></ul></div><p>​判断当前上传的数据格式是否是多段的格式。</p><ul><li><p>public List<fileitem> parseRequest(HttpServletRequest request)<br>​解释上传的文件</fileitem></p></li><li><p>boolean FileItem.isFormField()</p><p>判断当前这个表单项，是否是普通的表单项。还是上传的文件类型。<br>true  表示普通类型的表单项</p><p>false 表示上传文件内容</p></li><li><p>String FileItem.getFieldName()<br>获取表单项的name属性值</p></li><li><p>String FileItem. getString( )<br>获取当前表单项的值。</p></li><li><p>String FileItem. getName();<br>获取上传的文件名</p></li><li><p>void FileItem.write( file );<br>将上传的文件写到参数file所指向抽硬盘位置。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Servlet </category>
          
          <category> Utils </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaEE </tag>
            
            <tag> Servlet </tag>
            
            <tag> Utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客标签外挂的写法</title>
      <link href="/blog/bo-ke-biao-qian-wai-gua-de-xie-fa/"/>
      <url>/blog/bo-ke-biao-qian-wai-gua-de-xie-fa/</url>
      
        <content type="html"><![CDATA[<h1>标签外挂（Tag Plugins）</h1><p>标签外挂是Hexo独有的功能，并不是标准的Markdown格式。</p><p>以下的写法，只适用于Butterfly主题，用在其它主题上不会有效果，甚至可能会报错。使用前请留意</p><a class="btn-beautify outline blue larger" href="https://butterfly.js.org/posts/4aa8abbe/#%E6%A8%99%E7%B1%A4%E5%A4%96%E6%8E%9B%EF%BC%88Tag-Plugins%EF%BC%89" title="本文章来源"><span>本文章来源</span></a><h1>Note (Bootstrap Callout)</h1><div class="tabs" id="test1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test1-1">通用设置</button></li><li class="tab"><button type="button" data-href="#test1-2">用法1</button></li><li class="tab"><button type="button" data-href="#test1-3">用法2(自定义icon)</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test1-1"><p>移植于next主题，并进行修改。</p><p>修改 主题配置文件</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">note:</span></span><br><span class="line">  <span class="comment"># Note tag style values:</span></span><br><span class="line">  <span class="comment">#  - simple    bs-callout old alert style. Default.</span></span><br><span class="line">  <span class="comment">#  - modern    bs-callout new (v2-v3) alert style.</span></span><br><span class="line">  <span class="comment">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class="line">  <span class="comment">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">flat</span></span><br><span class="line">  <span class="attr">icons:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">border_radius:</span> <span class="number">3</span></span><br><span class="line">  <span class="comment"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line">  <span class="comment"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line">  <span class="attr">light_bg_offset:</span> <span class="number">0</span></span><br></pre></td></tr></tbody></table></figure><p><em><strong>icons</strong></em>和<em><strong>light_bg_offset</strong></em>只对用法1生效</p><p><strong>Note</strong> 标签外挂有两种用法</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-2"><div class="note info simple"><h2 id="simple">simple</h2></div><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">{% note simple %}</span><br><span class="line">默认 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note default simple %}</span><br><span class="line">default 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note primary simple %}</span><br><span class="line">primary 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note success simple %}</span><br><span class="line">success 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note info simple %}</span><br><span class="line">info 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note warning simple %}</span><br><span class="line">warning 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note danger simple %}</span><br><span class="line">danger 提示块标签</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure><div class="note simple"><p>默认 提示块标签</p></div><div class="note default simple"><p>default 提示块标签</p></div><div class="note primary simple"><p>primary 提示块标签</p></div><div class="note success simple"><p>success 提示块标签</p></div><div class="note info simple"><p>info 提示块标签</p></div><div class="note warning simple"><p>warning 提示块标签</p></div><div class="note danger simple"><p>danger 提示块标签</p></div><div class="note info modern"><h2 id="modern">modern</h2></div><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">{% note modern %}</span><br><span class="line">默认 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note default modern %}</span><br><span class="line">default 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note primary modern %}</span><br><span class="line">primary 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note success modern %}</span><br><span class="line">success 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note info modern %}</span><br><span class="line">info 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note warning modern %}</span><br><span class="line">warning 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note danger modern %}</span><br><span class="line">danger 提示块标签</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure><div class="note modern"><p>默认 提示块标签</p></div><div class="note default modern"><p>default 提示块标签</p></div><div class="note primary modern"><p>primary 提示块标签</p></div><div class="note success modern"><p>success 提示块标签</p></div><div class="note info modern"><p>info 提示块标签</p></div><div class="note warning modern"><p>warning 提示块标签</p></div><div class="note danger modern"><p>danger 提示块标签</p></div><div class="note info flat"><h2 id="flat">flat</h2></div><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">{% note flat %}</span><br><span class="line">默认 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note default flat %}</span><br><span class="line">default 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note primary flat %}</span><br><span class="line">primary 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note success flat %}</span><br><span class="line">success 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note info flat %}</span><br><span class="line">info 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note warning flat %}</span><br><span class="line">warning 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note danger flat %}</span><br><span class="line">danger 提示块标签</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure><div class="note flat"><p>默认 提示块标签</p></div><div class="note default flat"><p>default 提示块标签</p></div><div class="note primary flat"><p>primary 提示块标签</p></div><div class="note success flat"><p>success 提示块标签</p></div><div class="note info flat"><p>info 提示块标签</p></div><div class="note warning flat"><p>warning 提示块标签</p></div><div class="note danger flat"><p>danger 提示块标签</p></div><div class="note info disabled"><h2 id="disabled">disabled</h2></div><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">{% note disabled %}</span><br><span class="line">默认 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note default disabled %}</span><br><span class="line">default 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note primary disabled %}</span><br><span class="line">primary 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note success disabled %}</span><br><span class="line">success 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note info disabled %}</span><br><span class="line">info 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note warning disabled %}</span><br><span class="line">warning 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note danger disabled %}</span><br><span class="line">danger 提示块标签</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure><div class="note disabled"><p>默认 提示块标签</p></div><div class="note default disabled"><p>default 提示块标签</p></div><div class="note primary disabled"><p>primary 提示块标签</p></div><div class="note success disabled"><p>success 提示块标签</p></div><div class="note info disabled"><p>info 提示块标签</p></div><div class="note warning disabled"><p>warning 提示块标签</p></div><div class="note danger disabled"><p>danger 提示块标签</p></div><div class="note info no-icon flat"><h2 id="no-icon">no-icon</h2></div><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">{% note no-icon %}</span><br><span class="line">默认 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note default no-icon %}</span><br><span class="line">default 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note primary no-icon %}</span><br><span class="line">primary 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note success no-icon %}</span><br><span class="line">success 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note info no-icon %}</span><br><span class="line">info 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note warning no-icon %}</span><br><span class="line">warning 提示块标签</span><br><span class="line">{% endnote %}</span><br><span class="line"></span><br><span class="line">{% note danger no-icon %}</span><br><span class="line">danger 提示块标签</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure><div class="note no-icon flat"><p>默认 提示块标签</p></div><div class="note default no-icon flat"><p>default 提示块标签</p></div><div class="note primary no-icon flat"><p>primary 提示块标签</p></div><div class="note success no-icon flat"><p>success 提示块标签</p></div><div class="note info no-icon flat"><p>info 提示块标签</p></div><div class="note warning no-icon flat"><p>warning 提示块标签</p></div><div class="note danger no-icon flat"><p>danger 提示块标签</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-3"><div class="note info flat"><p>3.2.0 以上版本支持</p></div><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{% note [color] [icon] [style] %}</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>名称</th><th>用法</th></tr></thead><tbody><tr><td>color</td><td>【可选】顔色(default / blue / pink / red / purple / orange / green)</td></tr><tr><td>icon</td><td>【可选】可配置自定义 icon (只支持 fontawesome 图标, 也可以配置 no-icon )</td></tr><tr><td>style</td><td>【可选】可以覆盖配置中的 style（simple/modern/flat/disabled）</td></tr></tbody></table><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">{% note 'fab fa-cc-visa' flat %}</span><br><span class="line">你是刷 Visa 还是 UnionPay</span><br><span class="line">{% endnote %}</span><br><span class="line">{% note blue 'fas fa-bullhorn' flat %}</span><br><span class="line">加油</span><br><span class="line">{% endnote %}</span><br><span class="line">{% note pink 'fas fa-car-crash' flat %}</span><br><span class="line">小心开车 安全至上</span><br><span class="line">{% endnote %}</span><br><span class="line">{% note red 'fas fa-fan' flat%}</span><br><span class="line">这是三片呢？还是四片？</span><br><span class="line">{% endnote %}</span><br><span class="line">{% note orange 'fas fa-battery-half' flat %}</span><br><span class="line">电量不足</span><br><span class="line">{% endnote %}</span><br><span class="line">{% note purple 'far fa-hand-scissors' flat %}</span><br><span class="line">剪刀石头布</span><br><span class="line">{% endnote %}</span><br><span class="line">{% note green 'fab fa-internet-explorer' flat %}</span><br><span class="line">前端最讨厌的浏览器</span><br><span class="line">{% endnote %}</span><br></pre></td></tr></tbody></table></figure><div class="note icon flat"><i class="note-icon fab fa-cc-visa"></i><p>你是刷 Visa 还是 UnionPay</p></div><div class="note blue icon flat"><i class="note-icon fas fa-bullhorn"></i><p>加油</p></div><div class="note pink icon flat"><i class="note-icon fas fa-car-crash"></i><p>小心开车 安全至上</p></div><div class="note red icon flat"><i class="note-icon fas fa-fan"></i><p>这是三片呢？还是四片？</p></div><div class="note orange icon flat"><i class="note-icon fas fa-battery-half"></i><p>电量不足</p></div><div class="note purple icon flat"><i class="note-icon far fa-hand-scissors"></i><p>剪刀石头布</p></div><div class="note green icon flat"><i class="note-icon fab fa-internet-explorer"></i><p>前端最讨厌的浏览器</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>Gallery相册图库</h1><p>写法</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"gallery-group-main"</span>&gt;</span></span><br><span class="line">{% galleryGroup name description link img-url %}</span><br><span class="line">{% galleryGroup name description link img-url %}</span><br><span class="line">{% galleryGroup name description link img-url %}</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>name：图库名字</li><li>description：图库描述</li><li>link：连接到对应相册的地址</li><li>img-url：图库封面的地址</li></ul><p>例如：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"gallery-group-main"</span>&gt;</span></span><br><span class="line">{% galleryGroup '原神' 'Q版头像' 'gallery/原神q版头像'https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/01A9ABB42D5C96647074F5FF24D8C29B.jpg%}</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/01A9ABB42D5C96647074F5FF24D8C29B.jpg" alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">原神</div>  <p>Q版头像</p>  <a href="/gallery/%E5%8E%9F%E7%A5%9Eq%E7%89%88%E5%A4%B4%E5%83%8F"></a>  </figcaption>  </figure>  </div><h1>Gallery相册</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{% gallery %}</span><br><span class="line">markdown 图片格式</span><br><span class="line">{% endgallery %}</span><br></pre></td></tr></tbody></table></figure><p>例如</p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PageBean的一些用法</title>
      <link href="/javaee/servlet/utils/pagebean-de-yi-xie-yong-fa/"/>
      <url>/javaee/servlet/utils/pagebean-de-yi-xie-yong-fa/</url>
      
        <content type="html"><![CDATA[<h1>使用范围</h1><p>下面有分页选项的时候 有一个PageBean就可以对该列表进行多种不同分页查询</p><h1>PaheBean对象的创建</h1><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//分页Bean，它会在各层之间传递！</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageBean</span>&lt;T&gt; {</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> pageNow;<span class="comment">//当前页码</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> totalRecords;<span class="comment">//总记录数</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> pageSize;<span class="comment">//每页记录数</span></span><br><span class="line"><span class="keyword">private</span> String url;<span class="comment">//请求路径和参数，例如：/BookServlet?method=findXXX&amp;cid=1&amp;bname=2</span></span><br><span class="line"><span class="keyword">private</span> List&lt;T&gt; beanList;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算总页数</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPageCount</span><span class="params">()</span> {</span><br><span class="line"><span class="type">int</span> <span class="variable">pageCount</span> <span class="operator">=</span> totalRecords / pageSize;</span><br><span class="line"><span class="keyword">return</span> totalRecords % pageSize == <span class="number">0</span> ? pageCount : pageCount + <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPageNow</span><span class="params">()</span> { <span class="keyword">return</span> pageNow; }</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPageNow</span><span class="params">(<span class="type">int</span> pageNow)</span> { <span class="built_in">this</span>.pageNow = pageNow; }</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTotalRecords</span><span class="params">()</span> { <span class="keyword">return</span> totalRecords; }</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalRecords</span><span class="params">(<span class="type">int</span> totalRecords)</span> { <span class="built_in">this</span>.totalRecords = totalRecords; }</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPageSize</span><span class="params">()</span> { <span class="keyword">return</span> pageSize; }</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPageSize</span><span class="params">(<span class="type">int</span> pageSize)</span> { <span class="built_in">this</span>.pageSize = pageSize; }</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> { <span class="keyword">return</span> url; }</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUrl</span><span class="params">(String url)</span> { <span class="built_in">this</span>.url = url; }</span><br><span class="line"><span class="keyword">public</span> List&lt;T&gt; <span class="title function_">getBeanList</span><span class="params">()</span> { <span class="keyword">return</span> beanList; }</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanList</span><span class="params">(List&lt;T&gt; beanList)</span> { <span class="built_in">this</span>.beanList = beanList; }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="封装每页记录数的类">封装每页记录数的类</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageConstants</span> {</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">BOOK_PAGE_SIZE</span> <span class="operator">=</span> <span class="number">12</span>;<span class="comment">//图书每页记录数</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ORDER_PAGE_SIZE</span> <span class="operator">=</span> <span class="number">8</span>;<span class="comment">//订单每页记录数</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1>Dao层</h1><h2 id="通用的查询方法">通用的查询方法</h2><p>通用的查询方法只需要对应查询传过来sql语句与pageNow即可返回封装好的PagebBean对象与查询对象的List集合</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写入sql 返回分页查询结果</span></span><br><span class="line"><span class="keyword">public</span> PageBean&lt;Book&gt; <span class="title function_">findByCriteria</span><span class="params">(String sql, <span class="type">int</span> pageNow)</span> {</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> PageConstants.BOOK_PAGE_SIZE;<span class="comment">//每页记录数</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">totalRecords</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//查询一共有多少条数据</span></span><br><span class="line">    List&lt;Book&gt; list = template.query(sql,<span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Book.class));</span><br><span class="line">    <span class="comment">//得到了总记录数</span></span><br><span class="line">   <span class="keyword">for</span>(Book book :list){</span><br><span class="line">       totalRecords++;</span><br><span class="line">   }</span><br><span class="line">    <span class="comment">//得到beanList，即当前页记录</span></span><br><span class="line">    sql = sql+<span class="string">" order by orderBy limit ?,?"</span>;</span><br><span class="line">    List&lt;Book&gt; beanList = template.query(sql,<span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Book.class),</span><br><span class="line">    (pageNow-<span class="number">1</span>) * pageSize,pageSize);</span><br><span class="line">    PageBean&lt;Book&gt; pb = <span class="keyword">new</span> <span class="title class_">PageBean</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//其中PageBean没有url，这个任务由Servlet完成</span></span><br><span class="line">    pb.setBeanList(beanList);</span><br><span class="line">    pb.setPageNow(pageNow);</span><br><span class="line">    pb.setPageSize(pageSize);</span><br><span class="line">    pb.setTotalRecords(totalRecords);</span><br><span class="line">    <span class="keyword">return</span> pb;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="例如">例如</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按书名模糊查询</span></span><br><span class="line"><span class="keyword">public</span> PageBean&lt;Book&gt; <span class="title function_">findByBname</span><span class="params">(String bname, <span class="type">int</span> pageNow)</span> {</span><br><span class="line">        String sql=<span class="string">"select * from t_book where bname like '%"</span> + bname + <span class="string">"%'"</span>;</span><br><span class="line">        <span class="keyword">return</span> findByCriteria(sql,pageNow);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//多条件组合查询</span></span><br><span class="line"><span class="keyword">public</span> PageBean&lt;Book&gt; <span class="title function_">findByCombination</span><span class="params">(Book criteria, <span class="type">int</span> pageNow)</span> {</span><br><span class="line">    String sql=<span class="string">"select * from t_book where 1=1 "</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">""</span>.equals(criteria.getBname())){</span><br><span class="line">        sql = sql+ <span class="string">"AND bname like '%"</span> + criteria.getBname() +<span class="string">"%'"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">""</span>.equals(criteria.getAuthor())){</span><br><span class="line">        sql = sql+ <span class="string">"AND author like '%"</span> + criteria.getAuthor() +<span class="string">"%'"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">""</span>.equals(criteria.getPress())){</span><br><span class="line">        sql = sql+ <span class="string">"AND press like '%"</span> + criteria.getPress() +<span class="string">"%'"</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//将sql传入findByCriteria方法即可</span></span><br><span class="line">    <span class="keyword">return</span> findByCriteria(sql, pageNow);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1>Service层</h1><p>直接调用相应方法即可</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageBean&lt;Book&gt; <span class="title function_">findByBname</span><span class="params">(String bname, <span class="type">int</span> pageNow)</span>  {</span><br><span class="line">    <span class="keyword">return</span> bookDao.findByBname(bname,pageNow);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> PageBean&lt;Book&gt; <span class="title function_">findByCombination</span><span class="params">(Book book, <span class="type">int</span> pageNow)</span> {</span><br><span class="line">    <span class="keyword">return</span> bookDao.findByCombination(book,pageNow);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1>Servlet层</h1><h2 id="获取当前页码">获取当前页码</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前页码</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getPageNow</span><span class="params">(HttpServletRequest req)</span> {</span><br><span class="line"><span class="comment">//默认pageNow=1</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNow</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">param</span> <span class="operator">=</span> req.getParameter(<span class="string">"pageNow"</span>);</span><br><span class="line">    <span class="comment">//用来确定传过来的pageNow是否为空 如果不为空就转成整形赋给pageNow</span></span><br><span class="line">    <span class="comment">//trim()方法用来返回字符串的副本，忽略前导空白和尾部空白</span></span><br><span class="line">    <span class="keyword">if</span>(param != <span class="literal">null</span> &amp;&amp; !param.trim().isEmpty()) {</span><br><span class="line">            pageNow = Integer.parseInt(param);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> pageNow;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="获取需要分页的url">获取需要分页的url</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 截取url，页面中的分页导航中需要使用它做为超链接的目标！</span></span><br><span class="line"><span class="comment"> * http://localhost:8080/BookeWeb/user/bookServlet?methed=findByBname&amp;bid=xxx&amp;pageNow=3</span></span><br><span class="line"><span class="comment"> * /BookeWeb/user/bookServlet + methed=findByBname&amp;bid=xxx&amp;pageNow=3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">getUrl</span><span class="params">(HttpServletRequest req)</span> {</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURI() + <span class="string">"?"</span> + req.getQueryString();</span><br><span class="line">     <span class="comment">//如果url中存在pageNow参数，截取掉，如果不存在那就不用截取。</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> url.lastIndexOf(<span class="string">"&amp;pageNow="</span>);</span><br><span class="line">    <span class="keyword">if</span>(index != -<span class="number">1</span>) {</span><br><span class="line">        url = url.substring(<span class="number">0</span>, index);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> url;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="例如-2">例如</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//按书名查</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">findByBname</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span>  {</span><br><span class="line">    <span class="comment">//1. 得到pageNow：如果页面传递，使用页面的，如果没传，pageNow=1</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNow</span> <span class="operator">=</span> getPageNow(req);</span><br><span class="line">    <span class="comment">//2. 得到url:</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getUrl(req);</span><br><span class="line">    <span class="type">String</span> <span class="variable">bname</span> <span class="operator">=</span> req.getParameter(<span class="string">"bname"</span>);</span><br><span class="line">    PageBean&lt;Book&gt; pb = bookService.findByBname(bname, pageNow);</span><br><span class="line">    <span class="comment">//3. 给PageBean设置url，保存PageBean，转发到/jsps/book/list.jsp</span></span><br><span class="line">    pb.setUrl(url);</span><br><span class="line">    req.setAttribute(<span class="string">"pb"</span>, pb);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"f:/jsps/book/list.jsp"</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//组合查询</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">findByCombination</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> {</span><br><span class="line">    <span class="comment">//1. 得到pageNow：如果页面传递，使用页面的，如果没传，pageNow=1</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">pageNow</span> <span class="operator">=</span> getPageNow(req);</span><br><span class="line">    <span class="comment">//2. 得到url：...</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getUrl(req);</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    book.setBname(req.getParameter(<span class="string">"bname"</span>));</span><br><span class="line">    book.setAuthor(req.getParameter(<span class="string">"author"</span>));</span><br><span class="line">    book.setPress(req.getParameter(<span class="string">"press"</span>));</span><br><span class="line">    PageBean&lt;Book&gt; pb = bookService.findByCombination(book, pageNow);</span><br><span class="line">    <span class="comment">//3. 给PageBean设置url，保存PageBean，转发到/jsps/book/list.jsp</span></span><br><span class="line">    pb.setUrl(url);</span><br><span class="line">    req.setAttribute(<span class="string">"pb"</span>, pb);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"f:/jsps/book/list.jsp"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1>Jsp页面</h1><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%&gt;</span><br><span class="line">&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">_go</span>(<span class="params"></span>) {</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> pageNow = $(<span class="string">"#pageCode"</span>).<span class="title function_">val</span>();<span class="comment">//获取文本框中的当前页码</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span>(!<span class="regexp">/^[1-9]\d*$/</span>.<span class="title function_">test</span>(pageNow)) {<span class="comment">//对当前页码进行整数校验</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">'请输入正确的页码！'</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span>(pageNow &gt; ${pb.<span class="property">pageCount</span>}) {<span class="comment">//判断当前页码是否大于最大页</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">'请输入正确的页码！'</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        }</span></span><br><span class="line"><span class="language-javascript">        location = <span class="string">"${pb.url}&amp;pageNow="</span> + pageNow;</span></span><br><span class="line"><span class="language-javascript">   }</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divBody"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divContent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;%--上一页 --%&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">c:choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c:when</span> <span class="attr">test</span>=<span class="string">"${pb.pageNow eq 1 }"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"spanBtnDisabled"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">c:when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c:otherwise</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"${pb.url}&amp;pageNow=${pb.pageNow-1}"</span> <span class="attr">class</span>=<span class="string">"aBtn bold"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c:choose</span>&gt;</span></span><br><span class="line">&lt;%--</span><br><span class="line">我们需要计算页码列表的开始和结束位置，即两个变量begin和end</span><br><span class="line">计算它们需要通过当前页码！</span><br><span class="line">1. 总页数不足6页--&gt; begin=1, end=最大页</span><br><span class="line">2. 通过公式设置begin和end，begin=当前页-1，end=当前页+3</span><br><span class="line">3. 如果begin&lt;1，那么让begin=1，end=6</span><br><span class="line">4. 如果end&gt;tp, 让begin=pageCount-5, end=pageCount</span><br><span class="line"> --%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">c:choose</span>&gt;</span></span><br><span class="line">            &lt;%--1. 总页数不足6页--&gt; begin=1, end=最大页--%&gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">c:when</span> <span class="attr">test</span>=<span class="string">"${pb.pageCount &lt;= 6}"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"begin"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"end"</span> <span class="attr">value</span>=<span class="string">"${pb.pageCount}"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">c:when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line">                &lt;%--2. 通过公式设置begin和end，begin=当前页-1，end=当前页+3--%&gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"begin"</span> <span class="attr">value</span>=<span class="string">"${pb.pageNow-2}"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"end"</span> <span class="attr">value</span>=<span class="string">"${pb.pageNow+3}"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">                &lt;%--3. 如果begin&lt;1，那么让begin=1，end=6--%&gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"${begin &lt;= 1}"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"begin"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"end"</span> <span class="attr">value</span>=<span class="string">"6"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">                &lt;%--4. 如果end&gt;tp, 让begin=pageCount-5, end=pageCount--%&gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"${end &gt;= pb.pageCount}"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"begin"</span> <span class="attr">value</span>=<span class="string">"${pb.pageCount-5}"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"end"</span> <span class="attr">value</span>=<span class="string">"${pb.pageCount}"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">c:choose</span>&gt;</span></span><br><span class="line">           &lt;%--开始根据获取到的begin和end来遍历生成页码--%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">begin</span>=<span class="string">"${begin}"</span> <span class="attr">end</span>=<span class="string">"${end}"</span> <span class="attr">var</span>=<span class="string">"i"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">c:choose</span>&gt;</span></span><br><span class="line">                &lt;%--如果是本页面就不生成链接--%&gt;</span><br><span class="line">                <span class="tag">&lt;<span class="name">c:when</span> <span class="attr">test</span>=<span class="string">"${pb.pageNow eq i}"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"spanBtnSelect"</span>&gt;</span>${i}<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">c:when</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"${pb.url}&amp;pageNow=${i}"</span> <span class="attr">class</span>=<span class="string">"aBtn"</span>&gt;</span>${i}<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">c:choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    &lt;%-- 显示点点点 --%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"${end &lt; pb.pageCount}"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"spanApostrophe"</span>&gt;</span>...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">     &lt;%--下一页 --%&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">c:choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">c:when</span> <span class="attr">test</span>=<span class="string">"${pb.pageNow eq pb.pageCount }"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"spanBtnDisabled"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">c:when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">c:otherwise</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"${pb.url}&amp;pageNow=${pb.pageNow+1}"</span> <span class="attr">class</span>=<span class="string">"aBtn bold"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">c:otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">c:choose</span>&gt;</span></span><br><span class="line">    <span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span><span class="symbol">&amp;nbsp;</span></span><br><span class="line">    &lt;%-- 共N页 到M页 --%&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>共${pb.pageCount}页<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>到<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"inputPageCode"</span> <span class="attr">id</span>=<span class="string">"pageCode"</span> <span class="attr">value</span>=<span class="string">"${pb.pageNow}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>页<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:_go();"</span> <span class="attr">class</span>=<span class="string">"aSubmit"</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>使用时在jsp页面中导如即可</p><p>比如</p><figure class="highlight jsp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@include</span> file=<span class="string">"/jsps/pager/pager.jsp"</span> %&gt;</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Servlet </category>
          
          <category> Utils </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaEE </tag>
            
            <tag> Servlet </tag>
            
            <tag> Utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于BaseServlet的使用方法</title>
      <link href="/javaee/servlet/utils/guan-yu-baseservlet-de-shi-yong-fang-fa/"/>
      <url>/javaee/servlet/utils/guan-yu-baseservlet-de-shi-yong-fang-fa/</url>
      
        <content type="html"><![CDATA[<h1>使用方式</h1><p>在访问服务器的时候在后面带上?methon=方法名 即可调用方法</p><p>比如访问TestServlet?method=regist 就会调用下面的方法</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet("/TestServlet")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServlet</span> <span class="keyword">extends</span> <span class="title class_">BaseServlet</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">regist</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            response.sendRedirect(<span class="string">"https://www.baidu.com"</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h1>BaseServlet 源码</h1><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException {</span><br><span class="line">        <span class="comment">//设置编码</span></span><br><span class="line">        request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">        <span class="comment">//获取表单路径后面带的参数method=方法名中的方法名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> request.getParameter(<span class="string">"method"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//获得方法对象</span></span><br><span class="line">            method = <span class="built_in">this</span>.getClass().getMethod(methodName, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">        } <span class="keyword">catch</span> (Exception var10) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">"您要调用的方法："</span> + methodName + <span class="string">"它不存在！"</span>, var10);</span><br><span class="line">        }</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 获取调用请求后处理的方法返回的字符串,来确定是转发还是重定向</span></span><br><span class="line"><span class="comment">             * "/index.jsp" 表示转发到index.jsp</span></span><br><span class="line"><span class="comment">             * "f:/index.jsp" f前缀表示forward 转发到index.jsp</span></span><br><span class="line"><span class="comment">             * "r:/index.jsp" r前缀表示redirect 重定向到index.jsp</span></span><br><span class="line"><span class="comment">             * null 或者 "" 表示既不转发又不重定向</span></span><br><span class="line"><span class="comment">             *  想重定向到百度,return null 自己去设置重定向</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            result = (String)method.invoke(<span class="built_in">this</span>, request, response);</span><br><span class="line">        } <span class="keyword">catch</span> (IllegalAccessException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        } <span class="keyword">catch</span> (InvocationTargetException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span> &amp;&amp; !result.trim().isEmpty()) {</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> result.indexOf(<span class="string">":"</span>);</span><br><span class="line">            <span class="keyword">if</span> (index == -<span class="number">1</span>) {</span><br><span class="line">                request.getRequestDispatcher(result).forward(request, response);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="type">String</span> <span class="variable">start</span> <span class="operator">=</span> result.substring(<span class="number">0</span>, index);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> result.substring(index + <span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">if</span> (start.equals(<span class="string">"f"</span>)) {</span><br><span class="line">                        request.getRequestDispatcher(path).forward(request, response);</span><br><span class="line">                    } <span class="keyword">else</span> <span class="keyword">if</span> (start.equals(<span class="string">"r"</span>)) {</span><br><span class="line">                        response.sendRedirect(request.getContextPath() + path);</span><br><span class="line"></span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException {</span><br><span class="line">        doGet(request, response);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaEE </category>
          
          <category> Servlet </category>
          
          <category> Utils </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaEE </tag>
            
            <tag> Servlet </tag>
            
            <tag> Utils </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客写法</title>
      <link href="/blog/bo-ke-xie-fa/"/>
      <url>/blog/bo-ke-xie-fa/</url>
      
        <content type="html"><![CDATA[<hr><h1>Front-matter的使用</h1><p>Front-matter 是 markdown 文件最上方以 — 分隔的区域，用于指定个别档案的变数。</p><p><strong>Page Front-matter 用于页面配置</strong><br><strong>Post Front-matter 用于文章页配置</strong></p><h2 id="Page-Front-matter-用于页面配置">Page Front-matter 用于页面配置</h2><table><thead><tr><th>写法</th><th>解释</th></tr></thead><tbody><tr><td>title</td><td>【必需】页面标题</td></tr><tr><td>date</td><td>【必需】页面创建日期</td></tr><tr><td>type</td><td>【必需】标签、分类和友情链接三个页面需要配置</td></tr><tr><td>sticky</td><td>【可选】数字  数值越大，置顶的优先级越大。</td></tr><tr><td>updated</td><td>【可选】页面更新日期</td></tr><tr><td>description</td><td>【可选】页面描述</td></tr><tr><td>keywords</td><td>【可选】页面关键字</td></tr><tr><td>comments</td><td>【可选】显示页面评论模块(默认 true)</td></tr><tr><td>top_img</td><td>【可选】页面顶部图片</td></tr><tr><td>mathjax</td><td>【可选】显示mathjax(当设置mathjax的per_page: false时，才需要配置，默认 false)</td></tr><tr><td>katex</td><td>【可选】显示katex(当设置katex的per_page: false时，才需要配置，默认 false)</td></tr><tr><td>aside</td><td>【可选】显示侧边栏 (默认 true)</td></tr><tr><td>aplayer</td><td>【可选】在需要的页面加载aplayer的js和css,请参考文章下面的音乐 配置</td></tr><tr><td>highlight_shrink</td><td>【可选】配置代码框是否展开(true/false)(默认为设置中highlight_shrink的配置)</td></tr></tbody></table><h2 id="Post-Front-matter用于文章页配置">Post Front-matter用于文章页配置</h2><table><thead><tr><th>写法</th><th>解释</th></tr></thead><tbody><tr><td>title</td><td>【必需】文章标题</td></tr><tr><td>date</td><td>【必需】文章创建日期</td></tr><tr><td>updated</td><td>【可选】文章更新日期</td></tr><tr><td>tags</td><td>【可选】文章标签</td></tr><tr><td>categories</td><td>【可选】文章分类</td></tr><tr><td>keywords</td><td>【可选】文章关键字</td></tr><tr><td>description</td><td>【可选】文章描述</td></tr><tr><td>top_img</td><td>【可选】文章顶部图</td></tr><tr><td>cover</td><td>【可选】文章缩略图(如果没有设置top_img,文章页顶部将显示缩略图，可设为false/图片地址/留空)</td></tr><tr><td>comments</td><td>【可选】显示文章评论模块(默认 true)</td></tr><tr><td>toc</td><td>【可选】显示文章TOC(默认为设置中toc的enable配置)</td></tr><tr><td>toc_number</td><td>【可选】显示toc_number(默认为设置中toc的number配置)</td></tr><tr><td>toc_style_simple</td><td>【可选】显示 toc 简洁模式</td></tr><tr><td>copyright</td><td>【可选】显示文章版权模块(默认为设置中post_copyright的enable配置)</td></tr><tr><td>copyright_author</td><td>【可选】文章版权模块的文章作者</td></tr><tr><td>copyright_author_href</td><td>【可选】文章版权模块的文章作者链接</td></tr><tr><td>copyright_url</td><td>【可选】文章版权模块的文章连结链接</td></tr><tr><td>copyright_info</td><td>【可选】文章版权模块的版权声明文字</td></tr><tr><td>mathjax</td><td>【可选】显示mathjax(当设置mathjax的per_page: false时，才需要配置，默认 false)</td></tr><tr><td>katex</td><td>【可选】显示katex(当设置katex的per_page: false时，才需要配置，默认 false)</td></tr><tr><td>aplayer</td><td>【可选】在需要的页面加载aplayer的js和css,请参考文章下面的音乐 配置</td></tr><tr><td>highlight_shrink</td><td>【可选】配置代码框是否展开(true/false)(默认为设置中highlight_shrink的配置)</td></tr><tr><td>aside</td><td>【可选】显示侧边栏 (默认 true)</td></tr></tbody></table><p>标签与分类的写法</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tags:</span><br><span class="line">  - 123</span><br><span class="line">  - 456</span><br><span class="line">tags: [123, 456]</span><br></pre></td></tr></tbody></table></figure><p>多标签写法，这2种都是一样的效果，用哪个都可以，建议使用列表[]式，直观清晰。</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 这是默认的写法，给文章添加一个分类。</span><br><span class="line">categories: 123</span><br><span class="line"># 这会将文章分类123/456子分类目录下。</span><br><span class="line">categories: [123, 456]</span><br><span class="line">这会将文章分类到123/456子分类目录下。</span><br><span class="line">categories:</span><br><span class="line">   - 123</span><br><span class="line">   - 456</span><br><span class="line">多标签写法，文章被分类到123、456以及123的自分类789这3个分类下面，官方指定写法。</span><br><span class="line">categories:</span><br><span class="line">   - [123]</span><br><span class="line">   - [456]</span><br><span class="line">   - [123, 789]</span><br></pre></td></tr></tbody></table></figure><h1>Gallery相册图库</h1><p>写法</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"gallery-group-main"</span>&gt;</span></span><br><span class="line">{% galleryGroup name description link img-url %}</span><br><span class="line">{% galleryGroup name description link img-url %}</span><br><span class="line">{% galleryGroup name description link img-url %}</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>name：图库名字</li><li>description：图库描述</li><li>link：连接到对应相册的地址</li><li>img-url：图库封面的地址</li></ul><p>例如：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"gallery-group-main"</span>&gt;</span></span><br><span class="line">{% galleryGroup '原神' 'Q版头像' 'gallery/原神q版头像'https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/01A9ABB42D5C96647074F5FF24D8C29B.jpg%}</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src="https://windandstill-1309695473.cos.ap-guangzhou.myqcloud.com/img/01A9ABB42D5C96647074F5FF24D8C29B.jpg" alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">原神</div>  <p>Q版头像</p>  <a href="/gallery/%E5%8E%9F%E7%A5%9Eq%E7%89%88%E5%A4%B4%E5%83%8F"></a>  </figcaption>  </figure>  </div><h1>Gallery相册</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">{% gallery %}</span><br><span class="line">markdown 图片格式</span><br><span class="line">{% endgallery %}</span><br></pre></td></tr></tbody></table></figure><p>例如</p>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解读hexo的config.yml文件</title>
      <link href="/blog/jie-du-hexo-de-config.yml-wen-jian/"/>
      <url>/blog/jie-du-hexo-de-config.yml-wen-jian/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Hexo Configuration</span><br><span class="line">## Docs: https://hexo.io/docs/configuration.html</span><br><span class="line">## Source: https://github.com/hexojs/hexo/</span><br></pre></td></tr></tbody></table></figure><p>Hexo <a href="https://so.csdn.net/so/search?q=Configuration&amp;spm=1001.2101.3001.7020">Configuration</a>下的两行表示hexo文档的相关文档，Docs指的是hexo的文档，Source指的是hexo的GitHub源码</p><h1># Site 网站</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">title: Hexo  #网站的名字，会写在hexo generator命令生成后的public文件夹下的index.html文件的title标签里</span><br><span class="line"></span><br><span class="line">subtitle: '' #网站的副标题，生成的时候默认为空</span><br><span class="line"></span><br><span class="line">description: '' #主要用于SEO，告诉搜索引擎一个关于站点的简单描述，在官方文档中建议在这段描述中增加自己的一</span><br><span class="line"></span><br><span class="line">keywords: #网站的关键词，使用半角逗号分隔开多个关键词，关键词对SEO的优化有一定的作用</span><br><span class="line"></span><br><span class="line">author: John Doe #顾名思义就是作者，这个也只是署个名而已</span><br><span class="line"></span><br><span class="line">language: zh-CN #这里就写了网站使用的语言</span><br><span class="line"></span><br><span class="line">timezone: 'Asia/Shanghai' #网站对应的时区，一般情况下不用去刻意配置，会默认使用电脑的时区，但如果发布到其他地方的服务器，可能会使用当地服务器的时区，此时如果有需要用到本电脑的时区就要手动设置时区了，一般中国的时区可以设置为Asia/Shanghai</span><br></pre></td></tr></tbody></table></figure><h1># URL 网址</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">url: #网站的网址</span><br><span class="line"></span><br><span class="line">permalink: :title/ #文章的永久链接格式，可以在permalink这里配置 也就是文章打开url显示的格式</span><br><span class="line"></span><br><span class="line">permalink_defaults:</span><br><span class="line"></span><br><span class="line">pretty_urls:</span><br><span class="line">  trailing_index: true # 设置为false时会将末尾的index.html去掉</span><br><span class="line">  trailing_html: true # 设置为false时会将末尾的.html去掉，对index.html无效</span><br></pre></td></tr></tbody></table></figure><p>对应上面的年，月，天和标题，我们自己配置时，使用:加上要设置的对应属性，以/分隔，可以配置的有以下内容，</p><table><thead><tr><th>变量</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td>:year</td><td style="text-align:left">文章的发表年份(4 位数)</td></tr><tr><td>:motnth</td><td style="text-align:left">文章的发表月份(2 位数)</td></tr><tr><td>:i_month</td><td style="text-align:left">文章的发表月份(去掉开头的零)</td></tr><tr><td>:i_day</td><td style="text-align:left">文章的发表日期(去掉开头的零)</td></tr><tr><td>:hour</td><td style="text-align:left">文章发表时的小时(2位数)</td></tr><tr><td>:minute</td><td style="text-align:left">文章发表时的分钟(2位数)</td></tr><tr><td>:title</td><td style="text-align:left">文件名称</td></tr><tr><td>:post_title</td><td style="text-align:left">文章标题</td></tr><tr><td>:id</td><td style="text-align:left">文章ID (not persistent across cache reset)</td></tr><tr><td>:category</td><td style="text-align:left">分类。如果文章没有分类,则是default_ category 配置信息。</td></tr></tbody></table><p>比如默认生成的hello-world.md中这里要注意的是，如果使用id的话，在使用hexo clean后重新hexo g会使得id发生改变，将permalink改为:year/:month/:day/:title/:id/使用hexo g构造文件，然后使用hexo clean后重新使用hexo g构造，发现前后两次文章的id是不一样的</p><p>除了上面的变量外，也可以使用Font-matter中的值，Font-matter是文章文件最上方以—分隔的区域，用于指定个别文件的变量</p><table><thead><tr><th>参数</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>layout</td><td>布局</td><td></td></tr><tr><td>title</td><td>标题</td><td>文章的文件名</td></tr><tr><td>date</td><td>建立日期</td><td>文件建立日期</td></tr><tr><td>updated</td><td>更新日期</td><td>文件更新日期</td></tr><tr><td>comments</td><td>开启文章的评论功能</td><td>true</td></tr><tr><td>tags</td><td>标签(不适用于分页)</td><td></td></tr><tr><td>categories</td><td>分类(不适用于分页)</td><td></td></tr><tr><td>permalink</td><td>覆盖文章网址</td><td></td></tr><tr><td>keywords</td><td>仅用于meta标签和Open Graph的关键词(不推荐使用)</td><td></td></tr></tbody></table><h1>#Directory 目录</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">source_dir: source #存放hexo文章的文件夹，我们写的md文件都放在这个配置对应的文件夹下，默认值是source</span><br><span class="line"></span><br><span class="line">public_dir: public #存放hexo g生成的文件，执行hexo g后根目录就会出现这个文件夹，默认值是public</span><br><span class="line"></span><br><span class="line">tag_dir: tags #按标签存放文章的目录，默认值是tags，如果我们给文章添加标签，使用hexo g时public文件夹下就会多出一个tags文件夹（根据我们的配置文件夹名不同）</span><br><span class="line"></span><br><span class="line">archive_dir: archives #归档文件夹，存放归档文件，默认值为archives</span><br><span class="line"></span><br><span class="line">category_dir: categories #分类文件夹，按分类存放的文件，和上面的tags一样，只要在文章中的Font-matter添加了categories就会在使用hexo g构造时出现相应的文件夹</span><br><span class="line"></span><br><span class="line">code_dir: downloads/code #Include code 文件夹，source_dir 下的子目录，默认值为downloads/code</span><br><span class="line"></span><br><span class="line">i18n_dir: :lang #国际化（i18n）文件夹，默认值:lang</span><br><span class="line"></span><br><span class="line">skip_render: #跳过指定文件的渲染，匹配到的文件将会被不做改动复制到public文件夹下，如果路径对应的是我们的文章，那会直接忽略掉该文章</span><br></pre></td></tr></tbody></table></figure><h1>#Writing 文章</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">new_post_name: :title.md #新文章的默认名称，我们是使用hexo new来构造文章的，生成的文章名就是通过这里配置的，默认为:title.md，也就是标题.md</span><br><span class="line"></span><br><span class="line">default_layout: post #预设布局，hexo new可以创建三种文件，post/帖子，draft/草稿，page/页面，这里设置默认值在使用hexo new就可以直接创建对应默认类型的文章，设置了post就等同于说在命令行执行hexo new &lt;name&gt;和执行hexo new post &lt;name&gt;是一样的，也可以设置为draft和page</span><br><span class="line"></span><br><span class="line">titlecase: false #把标题转换为 title case</span><br><span class="line"></span><br><span class="line">external_link:</span><br><span class="line">  enable: true #是否在新标签中打开链接</span><br><span class="line">  field: site #external_link.enable的配置对当前网站（site）生效或仅对文章（post）生效，默认为site</span><br><span class="line">  exclude: '' #需要排除的域名</span><br><span class="line">  </span><br><span class="line">filename_case: 0 #把文件名称转换为小写(1)或者大写(2)，默认不转换(0)</span><br><span class="line"></span><br><span class="line">render_drafts: false #否渲染草稿文件，默认为false不渲染</span><br><span class="line"></span><br><span class="line">post_asset_folder: false #是否启动资源文件夹，对于我们的网站，如果我们的文章里面有图片，我们可以在source文件夹下建立一个统一的images文件夹来存放图片，但是如果有的文章有很多的资源文件如图片，我们可以通过设置该配置为true，这样在source文件夹下创建文件的同时也会创建一个同名文件夹来存放相应的资源，比如我设置为true，然后执行hexo new newPost</span><br><span class="line"></span><br><span class="line">relative_link: false #是否把链接改为与根目录的相对地址，默认为false</span><br><span class="line"></span><br><span class="line">future: true #是否显示当前时间之后的文章，默认为true，如果设置为false的话，我们设置的日期如果是未来的日期的话，就不会显示</span><br><span class="line"></span><br><span class="line">highlight: #代码块的设置</span><br><span class="line">  enable: true #开启代码高亮，默认为true</span><br><span class="line">  line_number: true #显示代码的行数，默认为true</span><br><span class="line">  auto_detect: false #如果未指定语言，就自动检测，默认为false</span><br><span class="line">  tab_replace: '' #用n个空格来代表tab键，如果值为空，则不会代替tab键</span><br><span class="line">  wrap: true #是否将代码放在table标签里，默认为true</span><br><span class="line">  hljs: false #是否对CSS类使用hljs-*前缀，默认为false</span><br><span class="line">  </span><br><span class="line">prismjs:</span><br><span class="line">  enable: false</span><br><span class="line">  preprocess: true</span><br><span class="line">  line_number: true</span><br><span class="line">  tab_replace: ''</span><br></pre></td></tr></tbody></table></figure><h1>#Home page setting 主页设置</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index_generator: #index_generator：主页相关的设置</span><br><span class="line">  path: '' #path：主页对应的路径，默认为’’，即域名根目录就是主页的路径</span><br><span class="line">  per_page: 10 #per_page：每页显示的帖子数，默认为10</span><br><span class="line">  order_by: -date #order_by：帖子的排序，默认为-date，即按日期倒序排</span><br></pre></td></tr></tbody></table></figure><h1>#Category &amp; Tag 分类和标签</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">default_category: uncategorized #默认分类</span><br><span class="line"></span><br><span class="line">category_map: #分类别名</span><br><span class="line"></span><br><span class="line">tag_map: #标签别名</span><br></pre></td></tr></tbody></table></figure><h1>#Metadata elements 元数据元素</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meta_generator: true #是否在页面开头插入下面的meta标签，默认为true</span><br></pre></td></tr></tbody></table></figure><h1>#日期/时间格式</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">date_format: YYYY-MM-DD #日期格式，默认为YYYY-MM-DD，即年月日</span><br><span class="line"></span><br><span class="line">time_format: HH:mm:ss #时间格式，默认为HH:mm:ss，即时分秒</span><br><span class="line"></span><br><span class="line">## updated_option supports 'mtime', 'date', 'empty'</span><br><span class="line">updated_option: 'mtime' #启用以后，如果 Front Matter 中没有指定 updated（文件更新日期），post.updated 将会使用 date 的值而不是文件的创建时间，默认值为true</span><br></pre></td></tr></tbody></table></figure><h1>#Pagination 分页</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">per_page: 10 #分页时每页的文章数，如果为0则不分页，默认为10</span><br><span class="line"></span><br><span class="line">pagination_dir: page #分页的目录，默认为page，对应于public文件夹下的archives文件夹下的page文件夹，如果只有一页是不会生成这个文件夹的</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h1>#Include / Exclude file(s) 包括或不包括目录和文件</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">include: #Hexo 默认会忽略隐藏文件和文件夹（包括名称以下划线和 . 开头的文件和文件夹，Hexo 的 _posts 和 _data 等</span><br><span class="line"></span><br><span class="line">exclude: #Hexo 会忽略这些文件和目录</span><br><span class="line"></span><br><span class="line">ignore: #忽略的文件 要注意的是，这里要写入的是数组，而yaml的数组要用-值表示数组中一个元素或者直接采用js中数组的写法[]</span><br></pre></td></tr></tbody></table></figure><h1>#Extensions 主题</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## Plugins: https://hexo.io/plugins/</span><br><span class="line"></span><br><span class="line">## Themes: https://hexo.io/themes/</span><br><span class="line"></span><br><span class="line">theme: butterfly # 当前使用的主题名</span><br></pre></td></tr></tbody></table></figure><h1>#Deployment 部署</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## Docs: https://hexo.io/docs/one-command-deployment</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo:  # 库地址</span><br><span class="line">  branch: master # 分支名称</span><br></pre></td></tr></tbody></table></figure>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>做这个博客的一些步骤</title>
      <link href="/blog/zuo-zhe-ge-bo-ke-de-yi-xie-bu-zou/"/>
      <url>/blog/zuo-zhe-ge-bo-ke-de-yi-xie-bu-zou/</url>
      
        <content type="html"><![CDATA[<p>本博客基于node.js 完成的hexo博客</p><p>欢迎大家共同学习</p><h1>做这个博客的一些步骤</h1><h2 id="1-前置安装">1.前置安装</h2><ol><li><p>安装Nodejs</p></li><li><p>npm install -g cnpm --registry=http://registry.npm.taobao.org#安装淘宝的cnpm 管理器</p></li><li><p>cnpm install -g hexo-cli    #安装hexo框架</p><h6 id="常用指令">常用指令</h6></li></ol><ul><li>node -v#查看node版本</li><li>npm -v#查看npm版本</li><li>cnpm -v#查看cnpm版本</li><li>hexo -v#查看hexo版本</li></ul><h2 id="2-创建目录">2.创建目录</h2><ol><li>mkdir blog#创建blog目录</li><li>cd blog #进入blog目录</li><li>sudo hexo init #生成博客 初始化博客</li><li>hexo s#启动本地博客服务</li><li><a href="http://localhost:4000/">http://localhost:4000/</a>#本地访问地址</li></ol><h2 id="3-开始写文章">3.开始写文章</h2><ol><li><p>hexo n 我的第一篇文章 #创建新的文章</p></li><li><p>#返回blog目录</p></li><li><p>hexo clean #清理</p></li><li><p>hexo g #生成</p></li></ol><h2 id="4-推送到GitHub">4.推送到GitHub</h2><ol><li>Github创建一个的仓库 <a href="http://WindAndStill.github.io">WindAndStill.github.io</a></li><li>cnpm install --save hexo-deployer-git #在blog目录下安装git部署插件</li><li>hexo d#部署到Github仓库里</li><li><a href="https://WindAndStill.github.io/">https://WindAndStill.github.io/</a>  #访问这个地址可以查看博客</li></ol><h2 id="自定义主题">自定义主题</h2><ol><li><p>git clone <a href="https://github.com/litten/hexo-theme-yilia.git">https://github.com/litten/hexo-theme-yilia.git</a> themes/yilia  #下载yilia主题到本地</p></li><li><p>配置_config.yml</p></li></ol><p><em>Deployment</em></p><p><em>Docs: <a href="https://hexo.io/docs/deployment.html">https://hexo.io/docs/deployment.html</a></em></p><p>​<em>deploy:</em><br><em>type: git</em><br><em>repo: <a href="https://github.com/WindAndStill/WindAndStill.github.io.git">https://github.com/WindAndStill/WindAndStill.github.io.git</a></em><br><em>branch: master</em><br><em>-----</em></p><p>#修改hexo根目录下的 _config.yml 文件 ： theme: yilia</p><ol start="3"><li>hexo c#清理一下</li><li>hexo g#生成</li><li>hexo d#部署到远程Github仓库</li></ol><p>如果文字描述不清晰 请到下方链接去学习</p><p>本博客 制作来源于视频https://www.bilibili.com/video/BV1Yb411a7ty</p><p>本博客主题来源于https://github.com/jerryc127/hexo-theme-butterfly</p><p>文档教程：<a href="https://butterfly.js.org/">https://butterfly.js.org/</a></p><p>作者博客：<a href="https://immyw.com/">https://immyw.com/</a></p><h2 id="非常感谢该作者">非常感谢该作者</h2>]]></content>
      
      
      <categories>
          
          <category> blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
